{"componentChunkName":"component---src-templates-blog-post-js","path":"/deep-dive-into-svelte/","webpackCompilationHash":"84fe29e572b8dcee481c","result":{"data":{"site":{"siteMetadata":{"title":"Tan Li Hau","author":"Tan Li Hau"}},"markdownRemark":{"id":"8189029f-95c5-507b-b0e6-7404353dc590","excerpt":"","html":"<h1 id=\"draft-what-is-svelte\"><a href=\"#draft-what-is-svelte\" aria-label=\"draft what is svelte permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>[DRAFT] What is Svelte?</h1>\n<p><a href=\"http://svelte.dev/\">Svelte</a> is a compiler for web applications. Svelte provides a framework for you to write your web apps declaratively, and it will compile them into efficient JavaScript.</p>\n<p>In this article, I will be sharing how Svelte works.</p>\n<p>If you are:</p>\n<ul>\n<li>\n<p><strong>First time hearing Svelte?</strong></p>\n<p>Please go and watch <a href=\"https://twitter.com/Rich_Harris\">Rich Harris</a> inspiring talk on <a href=\"https://svelte.dev/blog/svelte-3-rethinking-reactivity\">“Rethinking reactivity”</a> where he announces Svelte.</p>\n</li>\n<li>\n<p><strong>Interested learning how to write Svelte application?</strong></p>\n<p>Please follow along <a href=\"https://svelte.dev/tutorial/basics\">Svelte’s interactive tutorial</a>, I find it very helpful and it get me started in no time!</p>\n</li>\n</ul>\n<p>Because, I will be going deep level by level, guiding you through the source code sometimes, explaining how Svelte works.</p>\n<ul>\n<li>\n<p>look at code written in vanilla vs using framework</p>\n<ul>\n<li>compile time vs build time spectrum, svelte and react opposite side of the spectrum</li>\n</ul>\n</li>\n<li>\n<p>a picture of how a svelte component works</p>\n<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"writing-vanilla-javascript\"><a href=\"#writing-vanilla-javascript\" aria-label=\"writing vanilla javascript permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Writing vanilla JavaScript</h2>\n<p>Before we get started, lets’ do an exercise.</p>\n<p>Let’s write a counter app like below, without using any framework:</p>\n<div style=\"text-align:center;\">\n  <button id=\"ex1-decrement\">-</button>\n  <span id=\"ex1-count\">0</span>\n  <button id=\"ex1-increment\">+</button>\n  <script>\n    let count = 0;\n    const span = document.querySelector('#ex1-count');\n    document.querySelector('#ex1-decrement').onclick = () => span.textContent = --count;\n    document.querySelector('#ex1-increment').onclick = () => span.textContent = ++count;\n  </script>\n</div>\n<p>There are generally 2 approaches to this:</p>\n<p><strong>1. HTML + JS</strong></p>\n<p>You build your app layout in HTML:</p>\n<p class=\"filename\">index.html</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>decrement<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>-<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>count<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>increment<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>+<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>then in JS, you use id selector to query out the dynamic part of your HTML and attach event listeners to respond to user inputs:</p>\n<p class=\"filename\">script.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> span <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#count'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#decrement'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token punctuation\">(</span>span<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token operator\">--</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#increment'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token punctuation\">(</span>span<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token operator\">++</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>2. JS only</strong></p>\n<p>If you want to have more than 1 counter, the former approach may require you to <em>copy + paste</em> your HTML <em>n</em> times for <em>n</em> number of counters.</p>\n<p>The alternative would be to build the HTML elements programatically:</p>\n<p class=\"filename\">script.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">buildCounter</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> span <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> decrementBtn <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> incrementBtn <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  span<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  decrementBtn<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">;</span>\n  decrementBtn<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>span<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token operator\">--</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  incrementBtn<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">;</span>\n  incrementBtn<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclick</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>span<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token operator\">++</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  parent<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>decrementBtn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  parent<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>span<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  parent<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>incrementBtn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// you can call `buildCounter` however times you want</span>\n<span class=\"token comment\">//  to get however many counters</span>\n<span class=\"token function\">buildCounter</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This is the least amount of code to be written for a counter app.</p>\n<p><em>(One may argue that you can abstract out <code class=\"language-text\">document.createElement</code> or <code class=\"language-text\">parent.appendChild</code> to a function to make the code smaller, but that’s besides the point.)</em></p>\n<p>This is the least amount of code to be written <strong>and be executed by the browser</strong> for a counter app.</p>\n<p>So why does this matter? Well, before we proceed to explain how this got to do with Svelte, let’s first talk about React.</p>\n<p><em>I chose to talk about React <strong>just because I am a React developer</strong>, I use React at my work and at this very blog site. I am most familiar with React than any other JS frameworks out there</em></p>\n<p>In React, you can argubly write a much concise and declarative code:</p>\n<p class=\"filename\">Counter.jsx</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">Counter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">=></span> c <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">-</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span><span class=\"token punctuation\">{</span> count <span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>button onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">=></span> c <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">+</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That’s because React has hidden all the <code class=\"language-text\">document.createElement</code>, <code class=\"language-text\">parent.appendChild</code>, … under <a href=\"https://reactjs.org/docs/react-dom.html\"><code class=\"language-text\">react-dom</code> renderer.</a></p>\n<p>Everytime you click on a counter button, the function <code class=\"language-text\">Counter</code> is called to get the new <a href=\"https://github.com/acdlite/react-fiber-architecture\">Fiber tree</a> with the new state value, and it is compared with the current Fiber tree. After the diffing between the 2 Fiber tree, React collects the necessary DOM operations, in this case is to update <code class=\"language-text\">span</code>’s <code class=\"language-text\">textContent</code>.</p>\n<p>If you feel this is overly complicated, wait, there is more.</p>\n<p>When the <code class=\"language-text\">react-dom</code> <a href=\"https://github.com/facebook/react/blob/b8d079b41372290aa1846e3a780d85d05ab8ffc1/packages/react-dom/src/client/ReactDOMComponent.js#L372-L377\">receives the DOM operations</a>, it receives <code class=\"language-text\">[&#39;span&#39;, { &#39;children&#39;: &#39;1&#39; }]</code>, the element and the update payload, and <code class=\"language-text\">react-dom</code> has to figure out that <code class=\"language-text\">children</code> meant <a href=\"https://github.com/facebook/react/blob/b8d079b41372290aa1846e3a780d85d05ab8ffc1/packages/react-dom/src/client/ReactDOMComponent.js#L386-L388\">setting the <code class=\"language-text\">textContent</code></a>.</p>\n<p>As you can see, there’s a lot of code <strong>executed</strong> under the hood, which you may think is overkill for this contrived example. But with a much larger/complex application, you will soon appreciate the flexibilty React provides. to achieve that, react has to make sure it has code to capture all the different scenarios, without knowing what will be written by us, the developer.</p>\n<p>Now, here is how Svelte is different. <strong>Svelte is a compiler</strong>. Svelte knows what we, the developer, has written, and generate only code that is needed for our application.</p>\n<p>Here’s what Svelte generated for our Counter app (<a href=\"https://svelte.dev/repl/2ed88da423f24cd980dad77e8a07e248?version=3.12.1\">repl</a>):</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// import { element, ... } from \"svelte/internal\"</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">create_fragment</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> button0<span class=\"token punctuation\">,</span> span<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">,</span> button1<span class=\"token punctuation\">,</span> dispose<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      button0 <span class=\"token operator\">=</span> <span class=\"token function\">element</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      button0<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">;</span>\n      span <span class=\"token operator\">=</span> <span class=\"token function\">element</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      t <span class=\"token operator\">=</span> <span class=\"token function\">text</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      button1 <span class=\"token operator\">=</span> <span class=\"token function\">element</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      button1<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>button0<span class=\"token punctuation\">,</span> <span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span>click_handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>button1<span class=\"token punctuation\">,</span> <span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span>click_handler_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">m</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> anchor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> button0<span class=\"token punctuation\">,</span> anchor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> span<span class=\"token punctuation\">,</span> anchor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>span<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> button1<span class=\"token punctuation\">,</span> anchor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">p</span><span class=\"token punctuation\">(</span>changed<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>changed<span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">set_data</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">instance</span><span class=\"token punctuation\">(</span>$$self<span class=\"token punctuation\">,</span> $$props<span class=\"token punctuation\">,</span> $$invalidate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">click_handler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">$$invalidate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'count'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">-=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">click_handler_1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">$$invalidate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'count'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> count<span class=\"token punctuation\">,</span> click_handler<span class=\"token punctuation\">,</span> click_handler_1 <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p><strong>Disclaimer:</strong> <em>There are parts of code deliberately removed to make the code more concise and readable, which should not affect the point I am trying to make here. Feel free to read the original code in the <a href=\"https://svelte.dev/repl/2ed88da423f24cd980dad77e8a07e248?version=3.12.1\">repl</a>.</em></p>\n<p>You see Svelte’s generated code is much like the one we’ve written in plain JavaScript just now. It generates the <code class=\"language-text\">.textContent</code> directly, because during compilation, Svelte knows exactly what you are trying to do. Therefore it can try to handle all the different scenarios, where React tries to handle in runtime, in build time.</p>\n<p>Now you know the fundamental differences between Svelte and React, let’s take a look how a Svelte component works.</p>\n<h2 id=\"conceptually-how-does-compiled-svelte-component-work\"><a href=\"#conceptually-how-does-compiled-svelte-component-work\" aria-label=\"conceptually how does compiled svelte component work permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conceptually, how does compiled Svelte component work?</h2>\n<p>In this section, we are going to write Svelte component incrementally, and see how each changes ended up in the compiled Svelte component.</p>\n<p>Let’s start with a simple button and a text:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span>Click Me<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Hello Svelte<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>When Svelte sees this, these HTML elements will translate into JavaScript statement to create the elements:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> <span class=\"token function\">element</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbutton<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Click Me'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> p <span class=\"token operator\">=</span> <span class=\"token function\">element</span><span class=\"token punctuation\">(</span><span class=\"token string\">'p'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\np<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Hello Svelte'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// element('p') is short for `document.createElement('p');</span></code></pre></div>\n<p>If you inspect the Svelte compiled output, you would notice that these instruction lies in a function call <code class=\"language-text\">create_fragment</code>. <code class=\"language-text\">create_fragment</code> is the function where Svelte keeps the DOM instructions for the component.</p>\n<p>Next, lets add some event listener to the button:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\">\n  <span class=\"token keyword\">function</span> <span class=\"token function\">onClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Greetings!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\"><span class=\"token namespace\">on:</span>click</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{onClick}</span><span class=\"token punctuation\">></span></span>Click Me<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Hello Svelte<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<!--  -->\n<h2 id=\"how-the-compiled-svelte-component-works\"><a href=\"#how-the-compiled-svelte-component-works\" aria-label=\"how the compiled svelte component works permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How the compiled Svelte component works</h2>\n<p>To differentiate between the component code you write, and the component code generated by Svelte, I will use <code class=\"language-text\">.svelte</code> component to refer the code you would write in a <code class=\"language-text\">.svelte</code> file, and Svelte component to refer the <code class=\"language-text\">.js</code> code, generated by Svelte from your <code class=\"language-text\">.svelte</code> component, that will be executed in your application.</p>\n<p>The best way to understand how Svelte component works is to use the <a href=\"https://svelte.dev/repl\">Svelte’s REPL</a>. Try writing a component, and see how Svelte compiles the component into plain JavaScript.</p>\n<p>Svelte compiles the <code class=\"language-text\">.svelte</code> file into a <code class=\"language-text\">.js</code> file, which the <code class=\"language-text\">export default</code> the compiled Svelte component.</p>\n<p>The compiled Svelte component contains 3 main sections:</p>\n<ul>\n<li><code class=\"language-text\">create_fragment</code></li>\n<li><code class=\"language-text\">instance</code></li>\n<li>the Component itself</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 1. create_fragment</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">create_fragment</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*...*/</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">m</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*...*/</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">p</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*...*/</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">d</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/*...*/</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 2. instance</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">instance</span><span class=\"token punctuation\">(</span>$$self<span class=\"token punctuation\">,</span> $$props<span class=\"token punctuation\">,</span> $$invalidate<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 3. the Component itself</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">SvelteComponent</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">,</span> create_fragment<span class=\"token punctuation\">,</span> safe_not_equal<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Let’s explain what each section of the code is for, from the bottom up.</p>\n<p><strong>3. The component itself</strong></p>\n<p>Each compiled component, by default, is a subclass of <code class=\"language-text\">SvelteComponent</code>.</p>\n<p>To create the component onto the DOM, you can create an instance of the component:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> target<span class=\"token punctuation\">:</span> document<span class=\"token punctuation\">.</span>body <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In the constructor of <code class=\"language-text\">App</code>, as you can see, calls the <code class=\"language-text\">init</code> function, which takes in both <code class=\"language-text\">instance</code> and <code class=\"language-text\">create_fragment</code> function.</p>\n<p>The <code class=\"language-text\">init</code> function, as the name suggests, will set things up, which lead us to the <code class=\"language-text\">instance</code> function.</p>\n<p><strong>2. <code class=\"language-text\">instance</code></strong></p>\n<p>The <code class=\"language-text\">instance</code> function is where all the business logic of your <code class=\"language-text\">.svelte</code> component lies.</p>\n<p>That’s why, if you take a closer look, the <code class=\"language-text\">instance</code> function contains most, if not all, the code you write in the <code class=\"language-text\">&lt;script&gt;</code> tag in the <code class=\"language-text\">.svelte</code> component.</p>\n<hr>\n<p>Code that you write in the <code class=\"language-text\">&lt;script&gt;</code> tag that will not be in the <code class=\"language-text\">instance</code> function are:</p>\n<ul>\n<li>\n<p><strong><code class=\"language-text\">import</code> statement</strong></p>\n<ul>\n<li>These will be moved to the beginning of the compiled file.</li>\n</ul>\n</li>\n<li>\n<p><strong><code class=\"language-text\">export</code> statement</strong></p>\n<ul>\n<li>These are exported properties or methods of the Svelte component. It will be present in the former section, “the component itself” section.</li>\n</ul>\n</li>\n<li>\n<p><strong>constants</strong></p>\n<ul>\n<li>Since the value of a constant will not change throughout the lifetime of your application, so there’s no point redeclaring a new constant for every instance of your Svelte component.</li>\n<li>Therefore it is moved out from the <code class=\"language-text\">instance</code> function.</li>\n<li><a href=\"https://svelte.dev/repl/hello-world\">Check out the repl</a>.</li>\n</ul>\n</li>\n<li>\n<p><strong>pure functions</strong></p>\n<ul>\n<li>The same logic goes with pure functions. If the function does not rely on any variables within the scope other than it’s own arguments, the function will be moved out from the <code class=\"language-text\">instance</code> function.</li>\n<li><a href=\"https://svelte.dev/repl/d831c0e1387d4105b9bf4cbf6e321477?version=3.12.1\">Check out this repl</a>.</li>\n</ul>\n</li>\n</ul>\n<hr>\n<p>The <code class=\"language-text\">instance</code> function contains all of your business logic, and returns an object. The object contains all the variables and functions you’ve declared and used in the HTML code. The object is referred as <code class=\"language-text\">ctx</code> in Svelte, and that brings us to the <code class=\"language-text\">create_fragment</code> function.</p>\n<p><strong>1. <code class=\"language-text\">create_fragment</code></strong></p>\n<p>The <code class=\"language-text\">create_fragment</code> function deals with the HTML code you’ve written in a <code class=\"language-text\">.svelte</code> component. The <code class=\"language-text\">create_fragment</code> function takes in the <code class=\"language-text\">ctx</code> object, and returns an object that instructs the Svelte component how to render into the DOM, that looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">create_fragment</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> t<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// create</span>\n    <span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n     t <span class=\"token operator\">=</span> <span class=\"token function\">text</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span>greeting<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// claim</span>\n    <span class=\"token function\">l</span><span class=\"token punctuation\">(</span>nodes<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n      t <span class=\"token operator\">=</span> <span class=\"token function\">claim_text</span><span class=\"token punctuation\">(</span>nodes<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span>greeting<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// hydrate</span>\n    h<span class=\"token punctuation\">:</span> noop<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// mount</span>\n    <span class=\"token function\">m</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> anchor<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">,</span> anchor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// update</span>\n    <span class=\"token function\">p</span><span class=\"token punctuation\">(</span>changed<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>changed<span class=\"token punctuation\">.</span>greeting<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">set_data</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span>greeting<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// measure</span>\n    r<span class=\"token punctuation\">:</span> noop<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// fix</span>\n    f<span class=\"token punctuation\">:</span> noop<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// animate</span>\n    a<span class=\"token punctuation\">:</span> noop<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// intro</span>\n    i<span class=\"token punctuation\">:</span> noop<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// outro</span>\n    o<span class=\"token punctuation\">:</span> noop<span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// destroy</span>\n    <span class=\"token function\">d</span><span class=\"token punctuation\">(</span>detaching<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>detaching<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">detach</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let’s take a closer look to what each function does:</p>\n<p><strong>- c <em>(create)</em></strong></p>\n<p>This function creates all the DOM nodes needed.</p>\n<p><strong>- l <em>(claim)</em></strong></p>\n<p>On the other hand, if you use a server-side rendering, and you want to hydrate the rendered DOM with the component, the <code class=\"language-text\">claim</code> function will be called instead of <code class=\"language-text\">create</code>. This will try to claim and assign reference to the DOM node.</p>\n<p><strong>- m <em>(mount)</em></strong></p>\n<p>With the references to the DOM nodes, the <code class=\"language-text\">mount</code> function will <code class=\"language-text\">insert</code> or <code class=\"language-text\">append</code> DOM nodes to the target accordingly.</p>\n<p><strong>- p <em>(update)</em></strong></p>\n<p>If there’s a change, say after a button click, the <code class=\"language-text\">update</code> function will be called with the changed mask and the new <code class=\"language-text\">ctx</code> object.</p>\n<p><strong>- r <em>(measure)</em></strong><br/>\n<strong>- f <em>(fix)</em></strong><br/>\n<strong>- a <em>(animate)</em></strong><br/>\n<strong>- i <em>(intro)</em></strong><br/>\n<strong>- o <em>(outro)</em></strong></p>\n<p>These are for animations, measuring and fixing the element before animation, <code class=\"language-text\">intro</code>s and <code class=\"language-text\">outro</code>s.</p>\n<p><strong>- d <em>(destroy)</em></strong></p>\n<p>Last but not least, the <code class=\"language-text\">destroy</code> function is called when the Svelte component unmounts from the target.</p>\n<h3 id=\"pieces-them-together\"><a href=\"#pieces-them-together\" aria-label=\"pieces them together permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pieces them together</h3>\n<p>With every pieces in mind, let’s summarise what we’ve learned so far:</p>\n<p>You create the component into DOM by create a new instance of the Svelte component:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> target<span class=\"token punctuation\">:</span> document<span class=\"token punctuation\">.</span>body <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Which in the constructor of <code class=\"language-text\">App</code>, it calls the <code class=\"language-text\">init</code> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">,</span> create_fragment<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Within the <code class=\"language-text\">init</code> function, the <code class=\"language-text\">instance</code> function is called:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">,</span> create_fragment<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> <span class=\"token function\">instance</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Which returns the <code class=\"language-text\">ctx</code>, and it is passed into the <code class=\"language-text\">create_fragment</code> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">,</span> create_fragment<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> <span class=\"token function\">instance</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> fragment <span class=\"token operator\">=</span> <span class=\"token function\">create_fragment</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Which returns instructions on how to create DOM nodes and mount the nodes into DOM:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">,</span> create_fragment<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> <span class=\"token function\">instance</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> fragment <span class=\"token operator\">=</span> <span class=\"token function\">create_fragment</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// create / claim the nodes</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span>hydratable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    fragment<span class=\"token punctuation\">.</span><span class=\"token function\">claim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    fragment<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">// mount the nodes</span></span><span class=\"gatsby-highlight-code-line\">  fragment<span class=\"token punctuation\">.</span><span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>But hey, when does the <code class=\"language-text\">fragment.update()</code> get called when something has changed?</p>\n<p>That my friend, is the secret 3rd argument of the <code class=\"language-text\">instance</code> function, <strong><code class=\"language-text\">$$invalidate</code></strong>.</p>\n<p>Whenever you reassign a value to your variable, Svelte will add an extra statement of <code class=\"language-text\">$$invalidate(...)</code> statement after your re-assignment.</p>\n<p><code class=\"language-text\">$$invalidate</code> takes 2 arguments, the name of the variable, and the new value of the variable:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> instance<span class=\"token punctuation\">,</span> create_fragment<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">$$invalidate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    ctx<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">// update the nodes</span></span><span class=\"gatsby-highlight-code-line\">    fragment<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> <span class=\"token function\">instance</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">,</span> $$invalidate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">const</span> fragment <span class=\"token operator\">=</span> <span class=\"token function\">create_fragment</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// create / claim the nodes</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span>hydratable<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    fragment<span class=\"token punctuation\">.</span><span class=\"token function\">claim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    fragment<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// mount the nodes</span>\n  fragment<span class=\"token punctuation\">.</span><span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"caption\">Of course, if you have consecutive <code class=\"language-text\">$$invalidate</code> calls, Svelte will batch all the <code class=\"language-text\">$$invalidate</code> changes, and call <code class=\"language-text\">fragment.update</code> only once with all the changes.</div>\n<p>Now that you have a clearer picture on how Svelte works, let’s go one level deeper, and take a look how the Svelte compiler works.</p>\n<h2 id=\"the-svelte-compiler\"><a href=\"#the-svelte-compiler\" aria-label=\"the svelte compiler permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Svelte compiler</h2>\n<p>— WIP —</p>","fields":{"slug":"/deep-dive-into-svelte/","wip":true},"frontmatter":{"title":"Deep dive into Svelte","date":"November 09, 2019","lastUpdated":"November 09, 2019","description":"wip","tags":"a,b,c"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/deep-dive-into-svelte/","type":"blog","noteDate":null,"noteTitle":null,"wip":true,"heroImageUrl":null,"heroTwitterImageUrl":null,"previous":null,"next":null}}}