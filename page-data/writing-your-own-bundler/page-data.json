{"componentChunkName":"component---src-templates-blog-post-js","path":"/writing-your-own-bundler/","webpackCompilationHash":"e88b129f2bd626831a14","result":{"data":{"site":{"siteMetadata":{"title":"Tan Li Hau","author":"Tan Li Hau"}},"markdownRemark":{"id":"8c7bf09e-e743-5a26-b3ae-183de2c007a3","excerpt":"","html":"<h1>Overview</h1>\n<p>\n  <a class=\"gatsby-resp-image-link\" href=\"/static/ece4b04e88f84e6d61abc84e759c0916/426f8/module-bundlers.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <figure class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 31.542056074766357%; position: relative; bottom: 0; left: 0; background-image: url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNElEQVQY03WRO0sDQRSF9/dY+APsrOwFK1PZiaII2sTCQrESNWinYqOCjQ+CoCCYxgTfRmVjEAMxCXGTjYHEbHbdnflcd5MYfAxMMeec+e7cOwo/lpSSvzRPb2zpi773I6vIXA65sop5GmmZhmEQjUaJ397gOKIVtpqABlSYFaSeQFTzmNojTr3iAo9cUG8HmUAXZjLlBROqyuLCPLPL66hpzYNdaRaDOynCT++tAubbC8mNUSIzfdyvDWGW0igkYlTGO3kd6EfWLf/yxTnBqWm2L/NktLKnHTzX6A5ds3Smf7/YsjgMDROe7CG+GcQyDRRRjFMYC1AdmYCaX72k6+zu7ZPNFxDCb7lmSx7KgqIpvca/Rvhh29zFjjnZmiOrxrDdrCJFc3JuyHH+/ZRf5zZNtHmfIQi5j0YdnM8AAAAASUVORK5CYII=&#x27;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"module bundlers\" title=\"Module Bundlers: (left to right) Rollup, FuseBox, webpack, parcel\" src=\"/static/ece4b04e88f84e6d61abc84e759c0916/623ee/module-bundlers.png\" srcset=\"/static/ece4b04e88f84e6d61abc84e759c0916/816c5/module-bundlers.png 148w, /static/ece4b04e88f84e6d61abc84e759c0916/c766b/module-bundlers.png 295w, /static/ece4b04e88f84e6d61abc84e759c0916/623ee/module-bundlers.png 590w, /static/ece4b04e88f84e6d61abc84e759c0916/426f8/module-bundlers.png 856w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  <figcaption>Module Bundlers: (left to right) Rollup, FuseBox, webpack, parcel</figcaption></figure>\n  \n  </a>\n    </p>\n<!-- Say you are writing a web application, and you -->\n<!-- TODO: -->\n<p>…WIP</p>\n<h1>Writing it</h1>\n<p>A basic module bundler has to do 2 things:</p>\n<ul>\n<li>Construct the dependency graph <strong>(Dependency Resolution)</strong></li>\n<li>Assembles the module in the graph into a single executable asset <strong>(Bundle)</strong></li>\n</ul>\n<blockquote>\n<p>A <strong>dependency graph</strong> is a graph representation of the dependency relationship between modules.</p>\n</blockquote>\n<p>So let’s create the main function of our module bundler, and let’s call it <code class=\"language-text\">build</code>.</p>\n<!-- prettier-ignore -->\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> entryFile<span class=\"token punctuation\">,</span> outputFolder<span class=\"token punctuation\">,</span> outputFile <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// build dependency graph</span>\n  <span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token function\">createModule</span><span class=\"token punctuation\">(</span>entryFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// bundle the asset</span>\n  <span class=\"token keyword\">const</span> output <span class=\"token operator\">=</span> <span class=\"token function\">bundle</span><span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// write the output to the outputFile</span>\n  fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span>\n    path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>outputFolder<span class=\"token punctuation\">,</span> outputFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    output<span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'utf-8'</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let’s start with implementing <code class=\"language-text\">createModule</code>, it would be create a new instance of <code class=\"language-text\">Module</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">createModule</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Module</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The class <code class=\"language-text\">Module</code> will be used to record module properties, such as the content, the dependencies, exported keys, etc.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Module</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filePath <span class=\"token operator\">=</span> filePath<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>content <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>While the <code class=\"language-text\">content</code> is the string content of the module, to understand what it actually means, we would need to <em>parse the content</em> into AST (Abstract Syntax Tree). Let’s use <a href=\"http://babeljs.io\">babel</a> to parse the code:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Module</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filePath <span class=\"token operator\">=</span> filePath<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>content <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ast <span class=\"token operator\">=</span> babel<span class=\"token punctuation\">.</span><span class=\"token function\">parseSync</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The next thing we are looking for, is the dependency of this module:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Module</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filePath <span class=\"token operator\">=</span> filePath<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>content <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ast <span class=\"token operator\">=</span> babel<span class=\"token punctuation\">.</span><span class=\"token function\">parseSync</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dependencies <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">findDependencies</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">findDependencies</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token comment\">//</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>So, how do we know what is the dependency of this module? Well we can find the <code class=\"language-text\">import</code> statement from the AST we just got. How do we know how does our AST look like, and how to find the <code class=\"language-text\">import</code> statement from our AST? Well, you can visualise it through <a href=\"https://lihautan.com/babel-ast-explorer/#?eyJiYWJlbFNldHRpbmdzIjp7InZlcnNpb24iOiI3LjQuNSJ9LCJ0cmVlU2V0dGluZ3MiOnsiaGlkZUVtcHR5Ijp0cnVlLCJoaWRlTG9jYXRpb24iOnRydWUsImhpZGVUeXBlIjp0cnVlfSwiY29kZSI6ImltcG9ydCBzcXVhcmVBcmVhIGZyb20gJy4vc3F1YXJlLmpzJztcbmltcG9ydCBjaXJjbGVBcmVhIGZyb20gJy4vY2lyY2xlLmpzJztcblxuY29uc29sZS5sb2coJ0FyZWEgb2Ygc3F1YXJlOiAnLCBzcXVhcmVBcmVhKDUpKTtcbmNvbnNvbGUubG9nKCdBcmVhIG9mIGNpcmNsZScsIGNpcmNsZUFyZWEoNSkpO1xuIn0=\">babel-ast-explorer</a>:</p>\n<p>\n  <a class=\"gatsby-resp-image-link\" href=\"/static/87b78a845870fcfa5bb6756e80815d95/bb144/ast-import.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <figure class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.67187499999999%; position: relative; bottom: 0; left: 0; background-image: url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNUlEQVQoz41Ry0rDQBSd0gqC4La49jtcVa0bEfwAv0hX+iP6MwWF9DFpO5OkaYtN2mQm93jzIE1RoQdOztzHnNybiNHQgTMaYjIaQ8spPM+DUqqm1gqfEw9SSozdORw5x2zq4ktqSNfluobv+wiCAIPBAGKmNJbaR+KHiMMVFsslsixDE8YQNivCeksw+B9KeRCpsaCU21iTNEUUxyAi8KNQIls0x9EH/PAe37sHfuEN53sNXnNHjyd9hMibqWITVBua3JvxjO1WwAvPoaMOLOVXBdea7FaG9eU99/lyScreYK3g6U4512G2OduuNI9brJeHhn+hNqRXROsOFqsu1unZgWF5brEeYcgft1r5BWYnEMYn2Njf65bxxTETlj8lMe/Y7K6Q2DuO+lzoc61fnEu9ZX3CD9ttQVhUpVN6AAAAAElFTkSuQmCC&#x27;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"babel-ast-explorer\" title=\"Visualizing AST through babel-ast-explorer\" src=\"/static/87b78a845870fcfa5bb6756e80815d95/623ee/ast-import.png\" srcset=\"/static/87b78a845870fcfa5bb6756e80815d95/816c5/ast-import.png 148w, /static/87b78a845870fcfa5bb6756e80815d95/c766b/ast-import.png 295w, /static/87b78a845870fcfa5bb6756e80815d95/623ee/ast-import.png 590w, /static/87b78a845870fcfa5bb6756e80815d95/e5345/ast-import.png 885w, /static/87b78a845870fcfa5bb6756e80815d95/7a439/ast-import.png 1180w, /static/87b78a845870fcfa5bb6756e80815d95/84fe0/ast-import.png 1770w, /static/87b78a845870fcfa5bb6756e80815d95/bb144/ast-import.png 2560w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  <figcaption>Visualizing AST through babel-ast-explorer</figcaption></figure>\n  \n  </a>\n    </p>\n<p>We can see that the node we are looking for is called <code class=\"language-text\">ImportDeclaration</code>, and the property that tells us where we are importing from is the <code class=\"language-text\">source.value</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">findDependencies</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ast<span class=\"token punctuation\">.</span>program<span class=\"token punctuation\">.</span>body</span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">=></span> node<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'ImportDeclaration'</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">=></span> node<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>So now we have the path that we are requesting, it could be relative to our current file, eg <em>”./foo/bar”</em>, or from our node*modules, eg: *“lodash”_, so how do we know what is the actual file path that we are requesting?</p>\n<p>The step that we need to do, to figure out the actual path based on the requested path, is called <strong>“Resolving”</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">findDependencies</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ast<span class=\"token punctuation\">.</span>program<span class=\"token punctuation\">.</span>body\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">=></span> node<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'ImportDeclaration'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">=></span> node<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>relativePath <span class=\"token operator\">=></span> <span class=\"token function\">resolveRequest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filePath<span class=\"token punctuation\">,</span> relativePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// resolving</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">function</span> <span class=\"token function\">resolveRequest</span><span class=\"token punctuation\">(</span>requester<span class=\"token punctuation\">,</span> requestedPath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\">//</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span></span></code></pre></div>\n<div class=\"caption\">Resolving path to the actual file path</div>\n<hr>\n<h2>Resolving</h2>\n<p>We know that “import”ing <code class=\"language-text\">./b.js</code> in the following examples will result in getting a different file, because when we specify <code class=\"language-text\">./</code>, we are “import”ing relative to the current file.</p>\n<p class=\"filename\"><root>/a.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token string\">'./b.js'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p class=\"filename\"><root>/foo/a.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token string\">'./b.js'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>So, what are the rules of resolving a module? <a href=\"http://nodejs.org/api/modules.html#modules_all_together\">Node.js Modules Resolving</a> list out the detail step of the Node.js resolving algorithm:</p>\n<p>When we specify a relative path, <code class=\"language-text\">./b</code>, Node.js will first assume that <code class=\"language-text\">./b</code> is a file, and tries the following extension if it doesn’t exactly match the file name:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">b\nb.js\nb.json\nb.node</code></pre></div>\n<p>If the file does not exist, Node.js will then try to treat <code class=\"language-text\">./b</code> as a directory, and try the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;main&quot; in b/package.json\nb/index.js\nb/index.json\nb/index.node</code></pre></div>\n<p>If we specify <code class=\"language-text\">import &#39;b&#39;</code> instead, Node.js will treat it as a package within <code class=\"language-text\">node_modules/</code>, and have a different resolving strategy.</p>\n<p>Through the above illustration, we can see that resolving <code class=\"language-text\">import &#39;./b&#39;</code> is not as simple as it seems. Besides the default Node.js resolving behaviour, <a href=\"webpack.js.org/configuration/resolve/\">webpack provides a lot more customisation options</a>, such as custom extensions, alias, modules folders, etc.</p>\n<hr>\n<p>To move things forward, we are going to handle resolving relative path for now:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token comment\">// resolving</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">function</span> <span class=\"token function\">resolveRequest</span><span class=\"token punctuation\">(</span>requester<span class=\"token punctuation\">,</span> requestedPath<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">return</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>requester<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> requestedPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Now we know the actual requested file path, let’s create a module out of them as well!</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">findDependencies</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ast<span class=\"token punctuation\">.</span>program<span class=\"token punctuation\">.</span>body\n    <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">=></span> node<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'ImportDeclaration'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">=></span> node<span class=\"token punctuation\">.</span>source<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>relativePath <span class=\"token operator\">=></span> <span class=\"token function\">resolveRequest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>filePath<span class=\"token punctuation\">,</span> relativePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>absolutePath <span class=\"token operator\">=></span> <span class=\"token function\">createModule</span><span class=\"token punctuation\">(</span>absolutePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>So, for each module, we find their dependency, parse them, and find each dependency’s dependencies recursively. At the end of the process, we will get a module dependency graph. With it, it’s time for us to output them as a bundled file.</p>\n<p>Let’s take a look how the final bundled file would look like.</p>\n<p>So now we would like to:</p>\n<ul>\n<li>Create the module map, wrapping each module in a “special” function</li>\n<li>Create the “runtime”, the glue that links each module together.</li>\n</ul>\n<p>For the module map, </p>\n<h1>Further Readings</h1>\n<ul>\n<li><a href=\"https://slides.com/lucianomammino/unbundling-the-javascript-module-bundler-dublinjs\">https://slides.com/lucianomammino/unbundling-the-javascript-module-bundler-dublinjs</a></li>\n</ul>","fields":{"wip":true},"frontmatter":{"title":"Writing your own bundler","date":"June 29, 2019","lastUpdated":null,"description":"understand how module bundler works"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/writing-your-own-bundler/","type":"blog","noteDate":null,"noteTitle":null,"wip":true,"previous":null,"next":null}}}