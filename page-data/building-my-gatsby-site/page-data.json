{"componentChunkName":"component---src-templates-blog-post-js","path":"/building-my-gatsby-site/","webpackCompilationHash":"ca55ff09baa8ce35b963","result":{"data":{"site":{"siteMetadata":{"title":"Tan Li Hau","author":"Tan Li Hau"}},"markdownRemark":{"id":"166f703f-71be-51fc-b6d2-fe1c9fa3d9a5","excerpt":"","html":"<p>After reading Dan’s <a href=\"https://overreacted.io\">Overreacted</a> & Wei’s <a href=\"https://dev.wgao19.cc/\">A Work in Progress</a> a while ago, I decided to have my <a href=\"https://lihautan.com/blogs\">own blog</a> as well! <em>(In case you still don’t know, it’s the very one you are reading right now!)</em></p>\n<p>I took it as an opportunity to learn <a href=\"https://www.gatsbyjs.org/\">Gatsby</a>, I’ve heard about it for a while, so I guess it’s to know how it works.</p>\n<p>This article is <strong>NOT about how to build a Gatsby site</strong>, there a lot resources about that you can go for. But I am here to share some of my customisations that I’ve added to my Gatsby site, and hopefully you would share yours too.</p>\n<h2>The boilerplate</h2>\n<p>I used the exact same Gatsby starter pack as Dan’s <a href=\"https://overreacted.io\">Overreacted</a>, because why not ¯_(ツ)_/¯. It looks sleek and simple and I like it.</p>\n<h2>The deployment</h2>\n<p>I use <a href=\"https://pages.github.com/\">Github Pages</a> to host this blog.</p>\n<p>\n  <a class=\"gatsby-resp-image-link\" href=\"/static/090513484ecbe0914b63f7312532afb7/9ab87/github-pages.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <figure class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 80.21390374331551%; position: relative; bottom: 0; left: 0; background-image: url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACL0lEQVQ4y52UC2+bMBDH8/0/27Ru0qTu0ZCE15JAAGP8xOa/80GztqomrUG/3J0x53vBrqwqHI9H5HmOpyzDHAI+8lvStSzYTcpBjBZSGohewFuP4OcVt8q0NrMeWH+2X0pE9opdrSb8GHrshxaHW459c0J2q4gaT01JazUObYF8qFGI32QXTCnOOHUVTn3FdusHyEVjV8Yzvrmf+Kq/42F6xIN6xGd1xCdVMV8MOUf9DhX2G8n+hQJZqLATk0R+rqC9gZktbHCEJd2wTOvKa2iyk56kmh3jov/L4mm/x85og8v5ilvb4XppWHa3Ds21ZZIuhhFylBBipHpP6KYIoSPX7FVjIjXFe4+uH9B1PW2WsNbBWHtnefvU1lNsXb1DV4wRu5GcZNkB2eGI8/lCznsMQjCCuHUdH9ZJh0YGWB9Xl8tyl886O3TO41RUyInDqYCiEgSaxXmeXxMiQVGkh5c30b10GOjPz4FxNHPLB0b6mUCH0mArlGXFtG0L59wdYyxjqZaaIjfGcF0tk/ZYCiJAOQoqbDVMG/OiRFnVuDYN1+5GNbs0LcZx3JAYhoG7nGwpJ2aaCENNVQGanC7JYYyBb2it70lMil5Dqf47eY7QkGdN4a9p6XuB/1mzd5qS4BpKE3HIa+z3GfY0PindnuaypYFO85nsJNNa0wm0w8TDPUq5pa2YNM/8tUknzjO9NtSEhFKaI12lQWqa0uua1PRl0mki1nrFuI5RSnXZ5B9dD9g03Y3uAwAAAABJRU5ErkJggg==&#x27;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"github pages settings\" title=\"Github Pages Settings\" src=\"/static/090513484ecbe0914b63f7312532afb7/623ee/github-pages.png\" srcset=\"/static/090513484ecbe0914b63f7312532afb7/816c5/github-pages.png 148w, /static/090513484ecbe0914b63f7312532afb7/c766b/github-pages.png 295w, /static/090513484ecbe0914b63f7312532afb7/623ee/github-pages.png 590w, /static/090513484ecbe0914b63f7312532afb7/e5345/github-pages.png 885w, /static/090513484ecbe0914b63f7312532afb7/7a439/github-pages.png 1180w, /static/090513484ecbe0914b63f7312532afb7/9ab87/github-pages.png 1496w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  <figcaption>Github Pages Settings</figcaption></figure>\n  \n  </a>\n    </p>\n<p>According to the settings, I am required to use <code class=\"language-text\">master</code> branch to serve the content, that’s why I am writing and developing in <code class=\"language-text\">dev</code> branch instead.</p>\n<p>To deploy, I added a <a href=\"https://github.com/tanhauhau/tanhauhau.github.io/blob/dev/scripts/publish.js\">publish.js</a> script. The script will clone the repo in a temporary folder, copy all the built files into the folder, make a commit and push it to the master branch.</p>\n<p>Lastly, I added the script to the <code class=\"language-text\">pre-push</code> git hook, so that every time when I am pushing changes to the <code class=\"language-text\">dev</code> branch, it will also build and “deploy” changes to the <code class=\"language-text\">master</code> branch.</p>\n<h2>The light & dark mode</h2>\n<p><a href=\"https://twitter.com/wgao19\">Wei</a> did a sharing on how mix blend mode works and how she <a href=\"https://dev.wgao19.cc/2019-05-04__sun-moon-blending-mode/\">added night mode using mix-blend-mode</a> on her site.</p>\n<p>So I decided to add my own <a href=\"https://github.com/tanhauhau/tanhauhau.github.io/commit/291663d10cc7838d67392acb6a28a04a655603a6#diff-4e34e842430a5e2977417f28e477e14d\">Dark Mode Switch</a> as well.</p>\n<p>The Dark Mode Switch was relatively easy. I added a pseudo-element <code class=\"language-text\">div#___gatsby::after</code> to cover over my entire Gatsby blog, so I don’t have to create another div element.</p>\n<p class=\"filename\">theme-mode.css</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">div#___gatsby<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>after <span class=\"token punctuation\">{</span>\n  content<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n  position<span class=\"token punctuation\">:</span> fixed<span class=\"token punctuation\">;</span>\n  top<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  bottom<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  left<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  right<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  pointer<span class=\"token operator\">-</span>events<span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n  background<span class=\"token punctuation\">:</span> white<span class=\"token punctuation\">;</span>\n  mix<span class=\"token operator\">-</span>blend<span class=\"token operator\">-</span>mode<span class=\"token punctuation\">:</span> difference<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It’s easy and it looks great, except, all my images and emojis are inverted. <span class=\"emoji\">😢</span></p>\n<p>\n  <a class=\"gatsby-resp-image-link\" href=\"/static/3f3504301d5247d08c52bd1b833aad25/d6d8d/inverted_emojis.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n  \n  <figure class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.67715458276334%; position: relative; bottom: 0; left: 0; background-image: url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABb0lEQVQoz4WS6XKCQBCE1wNUlBvkRhA1RmMq7/9yne1BqBhz/PhqDnaH3plRdmIhKF2ElQcn24jv5Tb8wkG08+EVvS+5koQwAhtzV8Hwpk8oXsgOCbJui6SNUBxTpPsYqY5JWPsS1+cSzWuJ/FjBjNzfC26Slb7kiULSKwvEUm3cBOAr1FrpwwoTzVBs7k6Eh4Jfg0UwhxUvhFVkwop6fxka8t30Z8JPyoYfqG0T4vTRCfSpYGo/M3P+RxT6pYP83kP6bEGPhXW8HOP1djnan+CLRGGg+9Zea5QvOSrN8X2P5lJj/7bTNOhuPYdbq8/1OdqdHhDP8Gynv9XnQlRKQRYqT5kU5jSplrnmUqEY84XAcyxW3QUwx5i9FoWcJqc7ddRDc2mH3vTTVDA9NQ6GAxx8MtxR7BOX1k4tWQ9aJ10LsvB6pWK9Rnbmwoi8cVW+M06ZjY708lIlCwSVKzHhwvNJ7bVC1OYwkkxfnPy5Np8THwbcwgdfRwAAAABJRU5ErkJggg==&#x27;); background-size: cover; display: block;\">\n      <img class=\"gatsby-resp-image-image\" style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\" alt=\"inverted emojis\" title=\"It looked like emojis going through X-Rays.. 😢\" src=\"/static/3f3504301d5247d08c52bd1b833aad25/623ee/inverted_emojis.png\" srcset=\"/static/3f3504301d5247d08c52bd1b833aad25/816c5/inverted_emojis.png 148w, /static/3f3504301d5247d08c52bd1b833aad25/c766b/inverted_emojis.png 295w, /static/3f3504301d5247d08c52bd1b833aad25/623ee/inverted_emojis.png 590w, /static/3f3504301d5247d08c52bd1b833aad25/e5345/inverted_emojis.png 885w, /static/3f3504301d5247d08c52bd1b833aad25/7a439/inverted_emojis.png 1180w, /static/3f3504301d5247d08c52bd1b833aad25/d6d8d/inverted_emojis.png 1462w\" sizes=\"(max-width: 590px) 100vw, 590px\">\n    </span>\n  <figcaption>It looked like emojis going through X-Rays.. 😢</figcaption></figure>\n  \n  </a>\n    </p>\n<p>I need to wrap all my emojis around a <code class=\"language-text\">&lt;span&gt;</code> so I can apply some css like <code class=\"language-text\">isolation: isolate</code> to exclude them from being blended. <a href=\"https://www.chenhuijing.com/blog/friends-dont-let-friends-implement-dark-mode-alone/#%F0%9F%92%BB\">Inspiration credits to huijing <span class=\"emoji\">👏</span><span class=\"emoji\">👏</span></a>. But I am lazy to wrap all my emojis with <code class=\"language-text\">&lt;span&gt;</code>, I want to use them anytime I want, without bothering much of the <code class=\"language-text\">&lt;span&gt;</code>, so I decided to write a gatsby remark plugin to do that for me. <span class=\"emoji\">😎</span></p>\n<p>Well, it turns out it’s not that hard.</p>\n<p><a href=\"https://github.com/remarkjs/remark\">Remark</a> provides a friendly api to tap into the AST and <a href=\"https://github.com/tanhauhau/tanhauhau.github.io/commit/291663d10cc7838d67392acb6a28a04a655603a6#diff-1be49bbded0fd920136646bdb37f5b91\">does transformation</a>. </p>\n<p class=\"filename\">remark-emoji.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> visit <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unist-util-visit'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> emojiRegex <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'emoji-regex'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> markdownAST <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">visit</span><span class=\"token punctuation\">(</span>markdownAST<span class=\"token punctuation\">,</span> <span class=\"token string\">'text'</span><span class=\"token punctuation\">,</span> node <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    node<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">'html'</span><span class=\"token punctuation\">;</span>\n    node<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">emojiRegex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      val <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token string\">`&lt;span class=\"emoji\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>val<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/span>`</span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"caption\">using emoji-regex find emojis and wrap them with a <span></div>\n<p>…and it works!</p>\n<!-- TODO: -->\n<p><img src=\"\"></p>\n<p>Although somewhere when I started writing the gatsby plugin, a weird error popped up, and after some digging, I noticed that </p>\n<!-- TODO: -->\n<p>I had to include <code class=\"language-text\">package.json</code> into the plugin folder, or else it will yell at me.</p>\n<h2>The Restructure</h2>\n<p>A while ago, I decided to add more categories to my blog, ie, <a href=\"https://lihautan.com/blogs\">my blogs</a>, <a href=\"https://lihautan.com/talks/\">my talks</a> and <a href=\"https://lihautan.com/notes\">my notes</a>. So I created different folders for them and <a href=\"https://github.com/tanhauhau/tanhauhau.github.io/commit/50c82259749f7608d1c81062eac1f357b9437485\">rewrote the GraphQL query</a></p>\n<p>The Graphql Editor in <code class=\"language-text\">http://localhost:8000/___graphql</code> is really helpful for me to understand how Gatsby and Gatsby plugins are creating all the objects.</p>","fields":{"wip":true},"frontmatter":{"title":"Building my Gatsby site","date":"July 02, 2019","lastUpdated":null,"description":"A work in progress"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/building-my-gatsby-site/","type":"blog","noteDate":null,"noteTitle":null,"wip":true,"previous":null,"next":null}}}