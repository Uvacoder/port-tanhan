{"componentChunkName":"component---src-templates-blog-post-js","path":"/implementing-feature-in-svelte/","result":{"data":{"site":{"siteMetadata":{"title":"Tan Li Hau","author":"Tan Li Hau","siteUrl":"https://lihautan.com"}},"markdownRemark":{"id":"7d202b11-dc57-5e03-a49a-f4cf583357b5","excerpt":"","html":"<p>Anyone who</p>\n<ul>\n<li>wants to get started in contributing to the Svelte source code</li>\n</ul>\n<h2 id=\"overview\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h2>\n<p>Today we are going to dive in and implmeent <code class=\"language-text\">{#range}</code> logic block in Svelte.</p>\n<p>We are going to look at how </p>\n<p>if you are unfamiliar with the Svelte compiler, I recommend you to read <a href=\"/the-svelte-compiler-handbook\">“The Svelte Compiler Handbook”</a>, which talks about the Svelte compiler at a high level.</p>\n<p>Armed with the overview of the compilation pipeline, let’s dive into the detail, by implementing a new logic block, <code class=\"language-text\">{#range}</code>.</p>\n<p>A quick idea of how <code class=\"language-text\">{#range}</code> behaves:</p>\n<p><strong>1. The syntax:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"svelte\"><pre class=\"language-svelte\"><code class=\"language-svelte\"><span class=\"token comment\">&lt;!-- loop `n` through 1, 2, 3, 4, 5 --></span>\n<span class=\"token language-javascript\"><span class=\"token punctuation\">{</span>#range <span class=\"token number\">1.</span><span class=\"token number\">.5</span> <span class=\"token keyword\">as</span> n<span class=\"token punctuation\">}</span></span>\n  <span class=\"token language-javascript\"><span class=\"token punctuation\">{</span>n<span class=\"token punctuation\">}</span></span>\n<span class=\"token language-javascript\"><span class=\"token punctuation\">{</span><span class=\"token operator\">/</span>range<span class=\"token punctuation\">}</span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"svelte\"><pre class=\"language-svelte\"><code class=\"language-svelte\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token keyword\">let</span> start <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> end <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- loop `n` through 1, 2, 3, 4, 5 --></span>\n<span class=\"token language-javascript\"><span class=\"token punctuation\">{</span>#range start<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>end <span class=\"token keyword\">as</span> n<span class=\"token punctuation\">}</span></span>\n  <span class=\"token language-javascript\"><span class=\"token punctuation\">{</span>n<span class=\"token punctuation\">}</span></span>\n<span class=\"token language-javascript\"><span class=\"token punctuation\">{</span><span class=\"token operator\">/</span>range<span class=\"token punctuation\">}</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">bind:</span>value=</span><span class=\"token language-javascript\"><span class=\"token punctuation\">{</span>start<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>number<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\"><span class=\"token namespace\">bind:</span>value=</span><span class=\"token language-javascript\"><span class=\"token punctuation\">{</span>end<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>number<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p><strong>2. The behavior:</strong></p>\n<p>The <code class=\"language-text\">{#range}</code> behaves like <a href=\"https://www.rubyguides.com/2016/06/ruby-ranges-how-do-they-work/\">Ruby range</a>:</p>\n<ul>\n<li><code class=\"language-text\">{#range}</code> loops from the start to end inclusively</li>\n<li>allow descending range too: <code class=\"language-text\">{#range 5..1 as n}</code></li>\n<li>allow ranging through characters: <code class=\"language-text\">{#range &#39;a&#39;..&#39;z&#39; as n}</code></li>\n</ul>\n<h2 id=\"start-implementation\"><a href=\"#start-implementation\" aria-label=\"start implementation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Start implementation</h2>\n<p>With an <a href=\"https://github.com/sveltejs/svelte/issues/2968\">https://github.com/sveltejs/svelte/issues/2968</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ParseError: Expected if, each or await\n  at error (compiler.js:6208:16)\n  at Parser.error (compiler.js:6336:3)\n  at mustache (compiler.js:5911:11)\n  at new Parser (compiler.js:6288:12)</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error: Not implemented: RangeBlock\n  at get_constructor (compiler.js:17451:18)\n  at children.map.child (compiler.js:17460:23)\n  at Array.map (&lt;anonymous&gt;)\n  at map_children (compiler.js:17459:18)\n  at new Element$1 (compiler.js:16523:19)</code></pre></div>\n<p>TODO: don’t add the dependencies yet\nNOTE: copy code from EachBlock, since they lookalike</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error: TODO implement RangeBlock\n  at new FragmentWrapper (compiler.js:12846:11)\n  at new ElementWrapper (compiler.js:10261:19)\n  at new FragmentWrapper (compiler.js:12888:21)\n  at new Renderer (compiler.js:12983:19)\n  at dom (compiler.js:13199:19)</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RangeBlockWrapper</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Wrapper</span> <span class=\"token punctuation\">{</span>\n\tblock<span class=\"token punctuation\">:</span> Block<span class=\"token punctuation\">;</span>\n\tnode<span class=\"token punctuation\">:</span> RangeBlock<span class=\"token punctuation\">;</span>\n\tfragment<span class=\"token punctuation\">:</span> FragmentWrapper<span class=\"token punctuation\">;</span>\n\n\tindex_name<span class=\"token punctuation\">:</span> Identifier<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n\t\t<span class=\"token parameter\">renderer<span class=\"token punctuation\">:</span> Renderer<span class=\"token punctuation\">,</span>\n\t\tblock<span class=\"token punctuation\">:</span> Block<span class=\"token punctuation\">,</span>\n\t\tparent<span class=\"token punctuation\">:</span> Wrapper<span class=\"token punctuation\">,</span>\n\t\tnode<span class=\"token punctuation\">:</span> RangeBlock<span class=\"token punctuation\">,</span>\n\t\tstrip_whitespace<span class=\"token punctuation\">:</span> boolean<span class=\"token punctuation\">,</span>\n\t\tnext_sibling<span class=\"token punctuation\">:</span> Wrapper</span>\n\t<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>renderer<span class=\"token punctuation\">,</span> block<span class=\"token punctuation\">,</span> parent<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">cannot_use_innerhtml</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">not_static_content</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token comment\">// const { dependencies } = node.expression;</span>\n\t\t<span class=\"token comment\">// block.add_dependencies(dependencies);</span>\n\n\t\trenderer<span class=\"token punctuation\">.</span><span class=\"token function\">add_to_context</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>block <span class=\"token operator\">=</span> block<span class=\"token punctuation\">.</span><span class=\"token function\">child</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t\t\tcomment<span class=\"token punctuation\">:</span> <span class=\"token function\">create_debugging_comment</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>renderer<span class=\"token punctuation\">.</span>component<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\tname<span class=\"token punctuation\">:</span> renderer<span class=\"token punctuation\">.</span>component<span class=\"token punctuation\">.</span><span class=\"token function\">get_unique_name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"create_range_block\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\ttype<span class=\"token punctuation\">:</span> <span class=\"token string\">\"range\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>index_name <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> type<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Identifier\"</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>index <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\t\trenderer<span class=\"token punctuation\">.</span>blocks<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>block<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fragment <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FragmentWrapper</span><span class=\"token punctuation\">(</span>\n\t\t\trenderer<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>block<span class=\"token punctuation\">,</span>\n\t\t\tnode<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>\n\t\t\tstrip_whitespace<span class=\"token punctuation\">,</span>\n\t\t\tnext_sibling\n\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">block<span class=\"token punctuation\">:</span> Block<span class=\"token punctuation\">,</span> parent_node<span class=\"token punctuation\">:</span> Identifier<span class=\"token punctuation\">,</span> parent_nodes<span class=\"token punctuation\">:</span> Identifier</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fragment<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>block<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> x<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">#nodes</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token keyword\">as</span> Identifier<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","fields":{"slug":"/implementing-feature-in-svelte/","wip":true},"frontmatter":{"title":"Implementing {#range} in Svelte","dateTimestamp":null,"date":null,"lastUpdatedTimestamp":null,"lastUpdated":null,"description":null,"tags":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/implementing-feature-in-svelte/","type":"blog","noteDate":null,"noteTitle":null,"wip":true,"heroImageUrl":null,"heroTwitterImageUrl":null,"previous":null,"next":null}}}