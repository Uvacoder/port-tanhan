{"componentChunkName":"component---src-templates-blog-post-js","path":"/%2Feslint-for-flow-explicit-type-argument-syntax%2F","webpackCompilationHash":"55c737d218941a204bb9","result":{"data":{"site":{"siteMetadata":{"title":"Tan Li Hau","author":"Tan Li Hau"}},"markdownRemark":{"id":"0f4c425a-86e4-54e8-b3ac-94cad582004a","excerpt":"","html":"<p>Today <a href=\"https://dev.wgao19.cc/\">Wei Gao</a> posed an interesting question:</p>\n<p>She was upgrading Flow to v0.85, <a href=\"https://medium.com/flow-type/asking-for-required-annotations-64d4f9c1edf8\">which requires her to explicitly type the argument of the function call</a>. However, when she saved the file, our <a href=\"https://github.com/prettier/prettier\">eslint-prettier</a> automatically format the code into a weird syntax:</p>\n<p>So, when she wrote:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">fooFunction<span class=\"token operator\">&lt;</span>Bar<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With <a href=\"https://github.com/prettier/eslint-plugin-prettier\">eslint-plugin-prettier</a>, eslint <em>“fixed”</em> the code into:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">fooFunction <span class=\"token operator\">&lt;</span> Bar <span class=\"token operator\">></span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>It felt like eslint sees <code class=\"language-text\">&lt;</code> and <code class=\"language-text\">&gt;</code> as the comparison operator, rather than <code class=\"language-text\">&lt;Type&gt;</code> as a whole!</p>\n<p>To confirm with my hypothesis, I opened up my favourite tool for inspecting <a href=\"https://en.wikipedia.org/wiki/Abstract_syntax_tree\">AST</a>: <a href=\"https://astexplorer.net/\">astexplorer.net</a></p>\n<hr>\n<p>You can paste your code into <a href=\"https://astexplorer.net/\">astexplorer.net</a> and see how different parser “sees” your code in terms of a AST (Abstract Syntax Tree).</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/17844d464c6fad0985e078b84dca8afd/940da/ast-explorer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 57.182576459684896%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABDklEQVQoz42R62rDMAyF+/6v15alGc1NtmTZsnuFsEDSKQl0+ZGyHAthjD8fSd51P93j9hyG4fXWtGXnqrLSfLteo4gBIMSmrpsa8gyyr6qpadd1Xdu2I6xrUt/3CgPA8XAozmcJQeEkEueIckljpCi71wepZ11VUaVACN77EEJaviJr8NwCNM0py2ZYzRu0hlB59l5DpYcfYSL6znPPnBQPAR0Rs2Ka3bQJq/Bf2WWZRufo2ZEpvCMgkqny9E/ZAGVRXJLORdSsNECO46LhdXiWdqV/o7BGkkCEfhpY3DIwtJhnJ+WtMWQte0be4PyGj/s9KuYcWbBQIuHWsh/3u36ujJdiYIdVxs5GiUv4F+Itbmu8PVBFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"You can choose different a parser!\"\n        title=\"\"\n        src=\"/static/17844d464c6fad0985e078b84dca8afd/623ee/ast-explorer.png\"\n        srcset=\"/static/17844d464c6fad0985e078b84dca8afd/816c5/ast-explorer.png 148w,\n/static/17844d464c6fad0985e078b84dca8afd/c766b/ast-explorer.png 295w,\n/static/17844d464c6fad0985e078b84dca8afd/623ee/ast-explorer.png 590w,\n/static/17844d464c6fad0985e078b84dca8afd/e5345/ast-explorer.png 885w,\n/static/17844d464c6fad0985e078b84dca8afd/940da/ast-explorer.png 1079w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>As you can see from the picture above, you can choose from different parsers:</p>\n<ul>\n<li><strong>acorn</strong> — the parser used by webpack after the loaders, webpack uses acorn’s AST to find <code class=\"language-text\">import</code> and <code class=\"language-text\">require()</code> syntax to know generate the dependency tree of your project, as well as provide an entry for plugins like <a href=\"https://webpack.js.org/plugins/define-plugin/\">DefinePlugin</a> to transform the transpiled code.</li>\n<li><strong>babylon</strong>— the <a href=\"https://github.com/babel/babel/\">babel</a> parser, now it’s called <a href=\"https://babeljs.io/docs/en/babel-parser\">@babel/parser</a>.</li>\n<li><strong>flow</strong>, <strong>typescript</strong>, <strong>uglify-js</strong>— the parsers that each of the library uses</li>\n<li><strong>esprima</strong> — the default eslint parser</li>\n<li><strong>babel-eslint</strong> — a wrapper of babel parser for eslint, which is also the one we used, because we have a ton of babel plugins configured, so by using babel-eslint we don’t have to reconfigure the same plugins for eslint.</li>\n</ul>\n<hr>\n<p>So I copied our code into astexplorer, and selected the “flow” parser:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ab7413e038ae94283f26d86d612275bc/e5345/flow-ast.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 28.926553672316384%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAA3ElEQVQY03WQ2U7DMBBF8/+/wi/wggqtKFuQkKBqmjrexsuM27RKwkNb4xqCBALP8X271hkXMZ4yse969J4QKY0FUZXN+u25am5f65eVcM4R+p9gEcfTd91YTpcUZ1JCI42Q4CwGaje0C4mQM1O0pNvWHo/vQz+gd19lJCPmwCeseVjzUqlS65RPCVCPSt6BvnemLLZU7ffscBjOZfdZ9ohBsSuxuAB+uaqvl/WUy7nIgJ4ZuHFmatTsb21vQQumFWgbCLeEZ+fNaEvf2vH0+8NSJn/0Jr2RF/H/8QF/4EmHPEuiHwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"flow ast\"\n        title=\"\"\n        src=\"/static/ab7413e038ae94283f26d86d612275bc/623ee/flow-ast.png\"\n        srcset=\"/static/ab7413e038ae94283f26d86d612275bc/816c5/flow-ast.png 148w,\n/static/ab7413e038ae94283f26d86d612275bc/c766b/flow-ast.png 295w,\n/static/ab7413e038ae94283f26d86d612275bc/623ee/flow-ast.png 590w,\n/static/ab7413e038ae94283f26d86d612275bc/e5345/flow-ast.png 885w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>I can see the type annotation is being parsed as “TypeParameterInstantiation”, however when I changed the parser to “babel-eslint8”,</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d80586ce912511f29235c3518598301c/bfa8e/babel-eslint-8-ast.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 39.44387229660144%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAA4UlEQVQY03WQ3W6DMAyFef9H2gOslXazq6lsDEISYju2oVJvgdXpj7Ru5ejISqLzRbarn7vWdZ2mSZhVREUhNH3vPppwaMOAJHJ9f3C1BQuB7+o2Dm5IPiX5R27DqmywqwFSRpjsfkmPN+zWRZWREcbxeFqW+fgLzgShaxqH3w4RpZjUKpFytlj5rprneVlX82Pbo7An/xLjK8Ab415ox1Sq0H7knXCwzObMBD0O74hfmRrOn3K3nZVrZbTMc9iEsQs+tEG7IDEpgE1XmqfLCJzZkn/hQjJzznpV2c1Tl4WdAeWrvB3eiGzDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"babel eslint 8 ast\"\n        title=\"\"\n        src=\"/static/d80586ce912511f29235c3518598301c/623ee/babel-eslint-8-ast.png\"\n        srcset=\"/static/d80586ce912511f29235c3518598301c/816c5/babel-eslint-8-ast.png 148w,\n/static/d80586ce912511f29235c3518598301c/c766b/babel-eslint-8-ast.png 295w,\n/static/d80586ce912511f29235c3518598301c/623ee/babel-eslint-8-ast.png 590w,\n/static/d80586ce912511f29235c3518598301c/e5345/babel-eslint-8-ast.png 885w,\n/static/d80586ce912511f29235c3518598301c/bfa8e/babel-eslint-8-ast.png 971w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>I get a Binary Expression and a SequenceExpression!</p>\n<hr>\n<p><strong>Binary Expression</strong> is a way to express logical expression and mathematical expression, eg: <code class=\"language-text\">a + b</code> , <code class=\"language-text\">a &amp;&amp; b</code> , <code class=\"language-text\">a &lt;= b</code>, etc.</p>\n<p><strong>Sequence Expression</strong> on the other hand is something you don’t see people write that often, you can look up how it works in <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Comma_Operator\">Comma operator (MDN)</a>, basically you can write expressions as a expression by joining them with a comma operator (<code class=\"language-text\">,</code>), and the expression returns the value of the last expression, eg: result = <code class=\"language-text\">(a++, b++, c -= 2, d.push(e), --f)</code>, you increment <code class=\"language-text\">a</code> , <code class=\"language-text\">b</code> , decrement <code class=\"language-text\">c</code> by 2, and pushed <code class=\"language-text\">e</code> into <code class=\"language-text\">d</code> and decrement <code class=\"language-text\">f</code> and set result to the new value of <code class=\"language-text\">f</code>. Wow, that’s a lot in one statement! It’s confusing to read, but you see this often in a minified code.</p>\n<hr>\n<p>Now this explains why prettier will try to add space in between <code class=\"language-text\">&lt;</code> and <code class=\"language-text\">&gt;</code> .</p>\n<p>I saw that there’s a babel-eslint9, and I gave it a try, and…</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ab7413e038ae94283f26d86d612275bc/e5345/babel-eslint-9-ast.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 28.926553672316384%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAA3ElEQVQY03WQ2U7DMBBF8/+/wi/wggqtKFuQkKBqmjrexsuM27RKwkNb4xqCBALP8X271hkXMZ4yse969J4QKY0FUZXN+u25am5f65eVcM4R+p9gEcfTd91YTpcUZ1JCI42Q4CwGaje0C4mQM1O0pNvWHo/vQz+gd19lJCPmwCeseVjzUqlS65RPCVCPSt6BvnemLLZU7ffscBjOZfdZ9ohBsSuxuAB+uaqvl/WUy7nIgJ4ZuHFmatTsb21vQQumFWgbCLeEZ+fNaEvf2vH0+8NSJn/0Jr2RF/H/8QF/4EmHPEuiHwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"babel eslint 9 ast\"\n        title=\"\"\n        src=\"/static/ab7413e038ae94283f26d86d612275bc/623ee/babel-eslint-9-ast.png\"\n        srcset=\"/static/ab7413e038ae94283f26d86d612275bc/816c5/babel-eslint-9-ast.png 148w,\n/static/ab7413e038ae94283f26d86d612275bc/c766b/babel-eslint-9-ast.png 295w,\n/static/ab7413e038ae94283f26d86d612275bc/623ee/babel-eslint-9-ast.png 590w,\n/static/ab7413e038ae94283f26d86d612275bc/e5345/babel-eslint-9-ast.png 885w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>It seems like the bug was fixed on <code class=\"language-text\">babel-eslint9</code>, so I plowed through the release notes of babel-eslint, and I found this <a href=\"https://github.com/babel/babel-eslint/pull/444\">merge commit</a>. So it seems like upgrading babel-eslint to v9 will solve the issue! <span class=\"emoji\">🎉</span></p>","fields":{"slug":"%2Feslint-for-flow-explicit-type-argument-syntax%2F","wip":false},"frontmatter":{"title":"My eslint doesn’t work with for flow 0.85’s explicit type argument syntax","date":"January 17, 2019","lastUpdated":null,"description":"and how I figured out why.","tags":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"%2Feslint-for-flow-explicit-type-argument-syntax%2F","type":"blog","noteDate":null,"noteTitle":null,"wip":false,"heroImageUrl":null,"heroTwitterImageUrl":null,"previous":{"id":"c417abb4-2bb9-5f89-a991-a0299cb6041c","fields":{"slug":"%2Fuglify-ascii-only%2F","type":"blog","noteDate":null,"noteTitle":null,"wip":false},"frontmatter":{"title":"The `ascii_only` option in uglify-js"}},"next":{"id":"9102142a-7caa-517f-be4d-88720e0f4876","fields":{"slug":"%2Fcodemod-with-babel%2F","type":"blog","noteDate":null,"noteTitle":null,"wip":false},"frontmatter":{"title":"Codemod with babel"}}}}}