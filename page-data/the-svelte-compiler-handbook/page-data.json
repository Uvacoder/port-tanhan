{"componentChunkName":"component---src-templates-blog-post-js","path":"/the-svelte-compiler-handbook/","result":{"data":{"site":{"siteMetadata":{"title":"Tan Li Hau","author":"Tan Li Hau","siteUrl":"https://lihautan.com"}},"markdownRemark":{"id":"7fc9542f-858a-593a-b85c-b29067438362","excerpt":"","html":"<h2 id=\"who-is-this-for\"><a href=\"#who-is-this-for\" aria-label=\"who is this for permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Who is this for?</h2>\n<p>Anyone who </p>\n<ul>\n<li>is interested in the Svelte compilation process</li>\n<li>wants to get started in reading Svelte source code</li>\n</ul>\n<h2 id=\"overview\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8ab733c6a095f91034a7e221221fcdb4/4f8eb/overview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.511708409692524%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAkElEQVQY0zWQCw6AIAxDuf9NEQwBRFE+M2/JlhBp7doGN+eUtZbUWqWUIntvxZzeu3jv5Xkexd/3CfrruiSEoHfOGEPe91XOYWRmECklXcg5y3Ecanaep2J4tPd9S2tNAwiFA6shyYgBLCBiMIIjiBY0t0EXY9TWNmgo4BBiQmVIxpZZIsw4ew60BPK1f/ZEP2waN1AJz79YAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Overview\"\n        title=\"Overview\"\n        src=\"/static/8ab733c6a095f91034a7e221221fcdb4/799d3/overview.png\"\n        srcset=\"/static/8ab733c6a095f91034a7e221221fcdb4/00d96/overview.png 148w,\n/static/8ab733c6a095f91034a7e221221fcdb4/0b23c/overview.png 295w,\n/static/8ab733c6a095f91034a7e221221fcdb4/799d3/overview.png 590w,\n/static/8ab733c6a095f91034a7e221221fcdb4/2a3d6/overview.png 885w,\n/static/8ab733c6a095f91034a7e221221fcdb4/ae92f/overview.png 1180w,\n/static/8ab733c6a095f91034a7e221221fcdb4/4f8eb/overview.png 4911w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The Svelte compilation process can be broken down into 4-steps</p>\n<ul>\n<li>Parsing source code into Abstract Syntax Tree (AST)</li>\n<li>Tracking references and dependencies</li>\n<li>Creating code blocks and fragments</li>\n<li>Generate code</li>\n</ul>\n<p>Which sums out by the following pseudocode:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> source <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'App.svelte'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// parse source code into AST</span>\n<span class=\"token keyword\">const</span> ast <span class=\"token operator\">=</span> <span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// tracking references and dependencies</span>\n<span class=\"token keyword\">const</span> component <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Component</span><span class=\"token punctuation\">(</span>ast<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// creating code blocks and fragments</span>\n<span class=\"token keyword\">const</span> renderer <span class=\"token operator\">=</span>\n  options<span class=\"token punctuation\">.</span>generate <span class=\"token operator\">===</span> <span class=\"token string\">'ssr'</span> <span class=\"token operator\">?</span> <span class=\"token function\">SSRRenderer</span><span class=\"token punctuation\">(</span>component<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token function\">DomRenderer</span><span class=\"token punctuation\">(</span>component<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Generate code</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> js<span class=\"token punctuation\">,</span> css <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'App.js'</span><span class=\"token punctuation\">,</span> js<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'App.css'</span><span class=\"token punctuation\">,</span> css<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"1-parsing-source-code-into-ast\"><a href=\"#1-parsing-source-code-into-ast\" aria-label=\"1 parsing source code into ast permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Parsing source code into AST</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6f446bed0985ebf8426f93d997165343/7ef2e/step-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.064669843430906%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABIElEQVQoz3WS26qDQAxF5/8/Tp/EPqiI1LtWW6mtWpuyAimewgmEuSU7azLjxnGUNE2laRp5vV6yrqu832/BGH8dI64sS7ndbn/iMHc+n6UoCkEYMYLu9/s38GiWOE2TJEkibduq+BHAQXc6nbQiQnmeq/hRYN93TRyGQeO6rpOqqqTve8myTOdG64IgEM/zvlSMVL5cLioOCSNrxOq6VmFimCMYRZGeKyG9swrLsigJ83me5Xq9qgj7GElG8ng8VJgYc27mqI4oG9u2qdOjX6O/XBVRMyjJZY8RLReGofi+r/iQ8kjHR8EpArElQsYayufzqfHmemWIDJuqR0LI4jjWnwABBemr7VHsaM5e8b8/xxlkVOfKCALBC9NfE7ScDz7fssRty0z7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Step 1\"\n        title=\"Step 1\"\n        src=\"/static/6f446bed0985ebf8426f93d997165343/799d3/step-1.png\"\n        srcset=\"/static/6f446bed0985ebf8426f93d997165343/00d96/step-1.png 148w,\n/static/6f446bed0985ebf8426f93d997165343/0b23c/step-1.png 295w,\n/static/6f446bed0985ebf8426f93d997165343/799d3/step-1.png 590w,\n/static/6f446bed0985ebf8426f93d997165343/2a3d6/step-1.png 885w,\n/static/6f446bed0985ebf8426f93d997165343/ae92f/step-1.png 1180w,\n/static/6f446bed0985ebf8426f93d997165343/7ef2e/step-1.png 1469w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// parse source code into AST</span>\n<span class=\"token keyword\">const</span> ast <span class=\"token operator\">=</span> <span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The Svelte syntax is a superset of HTML. Svelte implements its own parser for the Svelte syntax, which handles:</p>\n<ul>\n<li>HTML syntax <code class=\"language-text\">&lt;div&gt;</code></li>\n<li>Curly brackets <code class=\"language-text\">{ data }</code></li>\n<li>Logic blocks <code class=\"language-text\">{#each list as item}</code></li>\n</ul>\n<p>The Svelte parser handles specially for <code class=\"language-text\">&lt;script&gt;</code> and <code class=\"language-text\">&lt;style&gt;</code> tags.</p>\n<p>When the parser encounters a <code class=\"language-text\">&lt;script&gt;</code> tag, it uses <a href=\"https://www.npmjs.com/package/acorn\">acorn</a> to parse the content within the tag. When the parser sees a <code class=\"language-text\">&lt;style&gt;</code> tag, it uses <a href=\"https://www.npmjs.com/package/css-tree\">css-tree</a> to parse the CSS content.</p>\n<p>Besides, the Svelte parser differentiates instance script, <code class=\"language-text\">&lt;script&gt;</code>, and module script, <code class=\"language-text\">&lt;script context=&quot;module&quot;&gt;</code>.</p>\n<p>The Svelte AST look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  html<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> type<span class=\"token punctuation\">:</span> <span class=\"token string\">'Fragment'</span><span class=\"token punctuation\">,</span> children<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  css<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  instance<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> context<span class=\"token punctuation\">:</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  module<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> context<span class=\"token punctuation\">:</span> <span class=\"token string\">'context'</span><span class=\"token punctuation\">,</span> content<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You can try out the Svelte parser in <a href=\"https://astexplorer.net/#/gist/828907dd1600c208a4e315962c635b4a/e1c895d49e8899a3be849a137fc557ba66eb2423\">ASTExplorer</a>. You can find the Svelte parser under <strong>HTML > Svelte</strong>.</p>\n<h3 id=\"where-can-i-find-the-parser-in-the-source-code\"><a href=\"#where-can-i-find-the-parser-in-the-source-code\" aria-label=\"where can i find the parser in the source code permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Where can I find the parser in the source code?</h3>\n<p>The parsing <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/index.ts#L79\">starts here</a>, which the parser is implemented in <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/parse/index.ts\">src/compiler/parse/index.ts</a>.</p>\n<h3 id=\"where-can-i-learn-about-parsing-in-javascript\"><a href=\"#where-can-i-learn-about-parsing-in-javascript\" aria-label=\"where can i learn about parsing in javascript permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Where can I learn about parsing in JavaScript?</h3>\n<p>My previous article, <a href=\"/json-parser-with-javascript\">“JSON Parser with JavaScript”</a> introduces the terminology and guides you step-by-step on writing a parser for JSON in JavaScript.</p>\n<p>If this is the your first time learning about parser, I highly recommend you to read that.</p>\n<h2 id=\"2-tracking-references-and-dependencies\"><a href=\"#2-tracking-references-and-dependencies\" aria-label=\"2 tracking references and dependencies permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Tracking references and dependencies</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b72ac678bfbb893f0087ea4bafa5f264/b89e5/step-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.21894943544428%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7klEQVQoz3WRVwrEMAxEff/j5T8QSO+9kKblafFiDDsgZCNrZiSb932FAOd5yjiOYmFrfoD7viVJEimKQlwY28iDruskTVNZlkWO4/g1+9j3XeZ5lrIs9T1nep7n+RKu66pqdV1Lnue/uK5LHfd9r7WqqvSeZZk64wxp27aaMaCE27apO1wOwyBN0+h9miZVJtMMKc5pRsSCVYVhqMRKSBPqWKYBQoq4RMQFrhkTh9ToARhhdIMagXocx0qMov8xdjV2XFYURZGKurs2sBIQ4gp3uLRkbsYdNYhZCdl+ng0jf+CTuS4gC4JAx/Sn+ADq3mvbvi3e8gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Step 2\"\n        title=\"Step 2\"\n        src=\"/static/b72ac678bfbb893f0087ea4bafa5f264/799d3/step-2.png\"\n        srcset=\"/static/b72ac678bfbb893f0087ea4bafa5f264/00d96/step-2.png 148w,\n/static/b72ac678bfbb893f0087ea4bafa5f264/0b23c/step-2.png 295w,\n/static/b72ac678bfbb893f0087ea4bafa5f264/799d3/step-2.png 590w,\n/static/b72ac678bfbb893f0087ea4bafa5f264/2a3d6/step-2.png 885w,\n/static/b72ac678bfbb893f0087ea4bafa5f264/ae92f/step-2.png 1180w,\n/static/b72ac678bfbb893f0087ea4bafa5f264/b89e5/step-2.png 2037w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// tracking references and dependencies</span>\n<span class=\"token keyword\">const</span> component <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Component</span><span class=\"token punctuation\">(</span>ast<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this step, Svelte traverses through the AST to track all the variable declared and referenced and their depedencies.</p>\n<h3 id=\"a-svelte-creates-a-code-classlanguage-textcomponentcode-instance\"><a href=\"#a-svelte-creates-a-code-classlanguage-textcomponentcode-instance\" aria-label=\"a svelte creates a code classlanguage textcomponentcode instance permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>a. Svelte creates a <code class=\"language-text\">Component</code> instance.</h3>\n<p>The <code class=\"language-text\">Component</code> class stores information of the Svelte component, which includes:</p>\n<ul>\n<li>HTML fragment, <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L52\"><code class=\"language-text\">fragment</code></a></li>\n<li>instance script and module script AST and their lexical scopes, <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L54\"><code class=\"language-text\">instance_scope</code></a> and <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L53\"><code class=\"language-text\">module_scope</code></a></li>\n<li>instance variables, <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L62\"><code class=\"language-text\">vars</code></a></li>\n<li>reactive variables, <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L71\"><code class=\"language-text\">reactive_declarations</code></a></li>\n<li>slots, <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L94\"><code class=\"language-text\">slots</code></a></li>\n<li><a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L351\">used variable names</a> to prevent naming conflict when creating temporary variables</li>\n<li><a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L43\">warnings</a> and <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L396\">errors</a></li>\n<li><a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L51\">compile options</a> and <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts#L44\">ignored warnings</a></li>\n</ul>\n<h3 id=\"b-traverse-the-instance-script-and-module-script-ast\"><a href=\"#b-traverse-the-instance-script-and-module-script-ast\" aria-label=\"b traverse the instance script and module script ast permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>b. Traverse the instance script and module script AST</h3>\n<p><code class=\"language-text\">Component</code> traverses the instance script and module script AST to <strong>find out all the variables declared, referenced, and updated</strong> within the instance script and module script.</p>\n<p>Svelte identifies all the variables available before traversing the template. When encountering the variable during template traversal, Svelte will mark the variable as <code class=\"language-text\">referenced</code> from template.</p>\n<h3 id=\"c-traverse-the-template\"><a href=\"#c-traverse-the-template\" aria-label=\"c traverse the template permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>c. Traverse the template</h3>\n<p>Svelte traverses through the template AST and creates a <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/nodes/Fragment.ts\">Fragment</a> tree out of the template AST.</p>\n<p>Each fragment node contains information such as:</p>\n<p><strong>- expression and dependencies</strong></p>\n<p>Logic blocks, <code class=\"language-text\">{#if}</code>, and mustache tags, <code class=\"language-text\">{ data }</code>, contain expression and the dependencies of the expression.</p>\n<p><strong>- scope</strong></p>\n<p><code class=\"language-text\">{#each}</code> and <code class=\"language-text\">{#await}</code> logic block and <code class=\"language-text\">let:</code> binding create new variables for the children template.</p>\n<p>Svelte creates a different Fragment node for each type of node in the AST, as different kind of Fragment node handles things differently:</p>\n<ul>\n<li><a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/nodes/Element.ts\">Element node</a> validates the <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/nodes/Element.ts#L280\">attribute</a>, <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/nodes/Element.ts#L461\">bindings</a>, <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/nodes/Element.ts#L647\">content</a> and <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/nodes/Element.ts#L658\">event handlers</a>.</li>\n<li><a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/nodes/Slot.ts\">Slot node</a> registers the slot name to the <code class=\"language-text\">Component</code>.</li>\n<li><a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/nodes/EachBlock.ts\">EachBlock node</a> creates a new scope and tracks the <code class=\"language-text\">key</code>, <code class=\"language-text\">index</code> and the name of the list to be iterated.</li>\n<li>…</li>\n</ul>\n<h3 id=\"d-traverse-the-instance-script-ast\"><a href=\"#d-traverse-the-instance-script-ast\" aria-label=\"d traverse the instance script ast permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>d. Traverse the instance script AST</h3>\n<p>After traversing through the template, Svelte now knows whether a variable is ever being updated or referenced in the component.</p>\n<p>With this information, Svelte tries make preparations for optimising the output, for example:</p>\n<ul>\n<li>determine which variables or functions can be safely hoisted out of the <code class=\"language-text\">instance</code> function.</li>\n<li>determine reactive declarations that does not need to be reactive</li>\n</ul>\n<h3 id=\"e-update-css-selectors-to-make-style-declarations-component-scope\"><a href=\"#e-update-css-selectors-to-make-style-declarations-component-scope\" aria-label=\"e update css selectors to make style declarations component scope permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>e. Update CSS selectors to make style declarations component scope</h3>\n<p>Svelte updates the CSS selectors, by adding <code class=\"language-text\">.svelte-xxx</code> class to the selectors when necessary.</p>\n<p>At the end of this step, Svelte has enough information to generate the compiled code, which brings us to the next step.</p>\n<h3 id=\"where-can-i-find-this-in-the-source-code\"><a href=\"#where-can-i-find-this-in-the-source-code\" aria-label=\"where can i find this in the source code permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Where can I find this in the source code?</h3>\n<p>You can start reading <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/index.ts#L83-L90\">from here</a>, which the <code class=\"language-text\">Component</code> is implemented in <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/Component.ts\">src/compiler/compile/Component.ts</a>.</p>\n<h3 id=\"where-can-i-learn-about-traversing-in-javascript\"><a href=\"#where-can-i-learn-about-traversing-in-javascript\" aria-label=\"where can i learn about traversing in javascript permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Where can I learn about traversing in JavaScript?</h3>\n<p>Bear with my shameless plug, my previous article, <a href=\"/manipulating-ast-with-javascript#traversing-an-ast\">“Manipulating AST with JavaScript”</a> covers relevant knowledge you need to know about traversing AST in JavaScript.</p>\n<h2 id=\"3-creating-code-blocks-and-fragments\"><a href=\"#3-creating-code-blocks-and-fragments\" aria-label=\"3 creating code blocks and fragments permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Creating code blocks and fragments</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f3876e59140a31ded960358a9c5dfab8/363f6/step-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.49042938437661%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABAklEQVQoz32RB46DQAwA+f8XiegtCSW00PFpHC2KUDhLZheXcVlr33dBka7rxHVdKYpCjBj/lVZVJXmeS9M0Gm/x2bZNpmlS4/1+l+fzqfBhGI5ivwRflmXaBHkH8PV6ie/7UpalwugQxQ6UYO74wjDU/7ZtJQgCeTwesiyL5idJ8gHSjeM4Ms+zAsZx1ASC3u+39H2v3ZsJiKc7fMAQ8lAF1nWtQEBGCPQ8Tzv4T4Azjcm1WCoGxmUfaZpq0HlXZzUSx7HYtq3rUCAdAGN+YEAp8g06Q80/OeTyqEwYRdFnZJxUwIDzCnA+Kcx+uXMymQLXddUHuN1uxy5+jfe9giv5A9Thukc6vcH7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Step 3\"\n        title=\"Step 3\"\n        src=\"/static/f3876e59140a31ded960358a9c5dfab8/799d3/step-3.png\"\n        srcset=\"/static/f3876e59140a31ded960358a9c5dfab8/00d96/step-3.png 148w,\n/static/f3876e59140a31ded960358a9c5dfab8/0b23c/step-3.png 295w,\n/static/f3876e59140a31ded960358a9c5dfab8/799d3/step-3.png 590w,\n/static/f3876e59140a31ded960358a9c5dfab8/2a3d6/step-3.png 885w,\n/static/f3876e59140a31ded960358a9c5dfab8/ae92f/step-3.png 1180w,\n/static/f3876e59140a31ded960358a9c5dfab8/363f6/step-3.png 1933w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// creating code blocks and fragments</span>\n<span class=\"token keyword\">const</span> renderer <span class=\"token operator\">=</span>\n  options<span class=\"token punctuation\">.</span>generate <span class=\"token operator\">===</span> <span class=\"token string\">'ssr'</span> <span class=\"token operator\">?</span> <span class=\"token function\">SSRRenderer</span><span class=\"token punctuation\">(</span>component<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token function\">DomRenderer</span><span class=\"token punctuation\">(</span>component<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In this step, Svelte creates a <code class=\"language-text\">Renderer</code> instance which keeps track necessary information required to generate the compiled output. Depending on the whether to output DOM or SSR code <em>(<a href=\"https://svelte.dev/docs#svelte_compile\">see <code class=\"language-text\">generate</code> in compile options</a>)</em>, Svelte instantiates different <code class=\"language-text\">Renderer</code> respectively.</p>\n<h3 id=\"dom-renderer\"><a href=\"#dom-renderer\" aria-label=\"dom renderer permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DOM Renderer</h3>\n<p>DOM Renderer keeps track of <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/render_dom/Renderer.ts#L31\">a list of blocks</a> and <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/render_dom/Renderer.ts#L28\">context</a>.</p>\n<p>A <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/render_dom/Block.ts\">Block</a> contains code fragments for generate the <a href=\"/compile-svelte-in-your-head-part-1/#create_fragment\"><code class=\"language-text\">create_fragment</code></a> function.</p>\n<p>Context tracks a list of <a href=\"/compile-svelte-in-your-head-part-2/#ctx\">instance variables</a> which will be presented in the <code class=\"language-text\">$$.ctx</code> in the compiled output.</p>\n<p>In the renderer, Svelte creates a <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/render_dom/wrappers/Fragment.ts\">render tree</a> out of the Fragment tree.</p>\n<p>Each node in the render tree implements the <code class=\"language-text\">render</code> function which generate codes that create and update the DOM for the node.</p>\n<h3 id=\"ssr-renderer\"><a href=\"#ssr-renderer\" aria-label=\"ssr renderer permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSR Renderer</h3>\n<p>SSR Renderer provide helpers to generate <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals\">template literals</a> in the compiled output, such as <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/render_ssr/Renderer.ts#L63\"><code class=\"language-text\">add_string(str)</code></a> and <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/render_ssr/Renderer.ts#L67\"><code class=\"language-text\">add_expression(node)</code></a>.</p>\n<h3 id=\"where-can-i-find-the-code-classlanguage-textrenderercode-in-the-source-code\"><a href=\"#where-can-i-find-the-code-classlanguage-textrenderercode-in-the-source-code\" aria-label=\"where can i find the code classlanguage textrenderercode in the source code permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Where can I find the <code class=\"language-text\">Renderer</code> in the source code?</h3>\n<p>The DOM Renderer is implemented in <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/render_dom/Renderer.ts\">src/compiler/compile/render_dom/Renderer.ts</a>, and you can check out the SSR Renderer code in <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/render_ssr/Renderer.ts\">src/compiler/compile/render_ssr/Renderer.ts</a>.</p>\n<h2 id=\"4-generate-code\"><a href=\"#4-generate-code\" aria-label=\"4 generate code permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Generate code</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/adc36d2564cf00a8bb1e20058c100e29/6607e/step-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.889952153110045%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABEElEQVQoz5WSi46CQAxF5/8/UBKQR0BQAoggIPLq7mkyxhDNZpsUZvq43Nti5Nfu97skSSLn81nP2LZt8s1sLk1TuVwuen8+nzKOoxgSTdPI6XRSUM7vjd8cy/NcjsejuK4rYRhKlmViePi+L/M8S13XmiSGPR4PadtWWfd9r2yqqlIlwzAoo6IoFIxeag3Ft9tN1nVV2gRphgUx7u8OAPUYwNfr9eV8zOzl7WcF6LIs6pxxWwfjsixVwYshCb7oOI4EQSBd1/1rKVEUaT9gjMHYLSOFISP3r4VYQICYued5SoSZ61IYKpIoOBwOEsexSvvE1N5521lam6ZJDKhQpYBNw5DYHuATIL8YIDiEwPkBItG5fqCqCnkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Step 4\"\n        title=\"Step 4\"\n        src=\"/static/adc36d2564cf00a8bb1e20058c100e29/799d3/step-4.png\"\n        srcset=\"/static/adc36d2564cf00a8bb1e20058c100e29/00d96/step-4.png 148w,\n/static/adc36d2564cf00a8bb1e20058c100e29/0b23c/step-4.png 295w,\n/static/adc36d2564cf00a8bb1e20058c100e29/799d3/step-4.png 590w,\n/static/adc36d2564cf00a8bb1e20058c100e29/2a3d6/step-4.png 885w,\n/static/adc36d2564cf00a8bb1e20058c100e29/ae92f/step-4.png 1180w,\n/static/adc36d2564cf00a8bb1e20058c100e29/6607e/step-4.png 1672w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Generate code</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> js<span class=\"token punctuation\">,</span> css <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> renderer<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Different renderer renders differently.</p>\n<p><strong>The DOM Renderer</strong> traverses through the render tree and calls the <code class=\"language-text\">render</code> function of each node along the way. The <code class=\"language-text\">Block</code> instance is passed into the <code class=\"language-text\">render</code> function, so that each node inserts the code into the appropriate <code class=\"language-text\">create_fragment</code> function.</p>\n<p><strong>The SSR Renderer</strong>, on the other hand, relies on different <a href=\"https://github.com/sveltejs/svelte/blob/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/compiler/compile/render_ssr/Renderer.ts#L23-L40\">node handlers</a> to insert strings or expressions into the final template literal.</p>\n<p>The render function returns <code class=\"language-text\">js</code> and <code class=\"language-text\">css</code> which will be consumed by the bundler, via <a href=\"https://github.com/sveltejs/rollup-plugin-svelte\">rollup-plugin-svelte</a> for rollup and <a href=\"https://github.com/sveltejs/svelte-loader\">svelte-loader</a> for webpack respectively.</p>\n<h2 id=\"svelte-runtime\"><a href=\"#svelte-runtime\" aria-label=\"svelte runtime permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Svelte runtime</h2>\n<p>To remove duplicate code in the compiled output, Svelte provide util function which can be found in the <a href=\"https://github.com/sveltejs/svelte/tree/aa3dcc06d6b0fcb079ccd993fa6e3455242a2a96/src/runtime/internal\">src/runtime/internal</a>, such as:</p>\n<ul>\n<li>dom related utils, eg: <code class=\"language-text\">append</code>, <code class=\"language-text\">insert</code>, <code class=\"language-text\">detach</code></li>\n<li>scheduling utils, eg: <code class=\"language-text\">schedule_update</code>, <code class=\"language-text\">flush</code></li>\n<li>lifecycle utils, eg: <code class=\"language-text\">onMount</code>, <code class=\"language-text\">beforeUpdate</code></li>\n<li>animation utils, eg: <code class=\"language-text\">create_animation</code></li>\n</ul>","fields":{"slug":"/the-svelte-compiler-handbook/","wip":false},"frontmatter":{"title":"The Svelte Compiler Handbook","dateTimestamp":"2020-04-05T08:00:00UTC","date":"April 05, 2020","lastUpdatedTimestamp":null,"lastUpdated":null,"description":"The Svelte compilation process can be broken down into 4-steps, 1) parsing source code into AST, 2) tracking references and dependencies, 3) creating code blocks and fragments, and 4) generate code.","tags":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/the-svelte-compiler-handbook/","type":"blog","noteDate":null,"noteTitle":null,"wip":false,"heroImageUrl":null,"heroTwitterImageUrl":"/static/hero-twitter-10d380f88845b06a1c3c2bd056e87f91.jpg","previous":{"id":"e91eed41-75d0-5b87-9405-7f991b0b2e83","fields":{"slug":"/compile-svelte-in-your-head-part-2/","type":"blog","noteDate":null,"noteTitle":null,"wip":false},"frontmatter":{"title":"Compile Svelte in your head (Part 2)"}},"next":null}}}