import{S as H,i as T,s as D,C as j,w as M,x as O,y as V,z as J,A as N,q as K,o as P,B as Q,r as U,Y as R,e as u,t as g,k as B,c as h,a as x,h as q,d as l,m as C,b as m,g as f,H as r,J as Y}from"../../chunks/vendor-da4388d4.js";import{B as F}from"../../chunks/BlogLayout-d479b777.js";import{_ as G}from"../../chunks/twitter-card-image-a57df29d.js";import"../../chunks/stores-1fad7c36.js";import"../../chunks/ldjson-b0805387.js";/* empty css                                */function W(y){let s,o,i,p,a,e,v,d,$,w,c,z=`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// package.json</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">&quot;name&quot;</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;your-pkg&quot;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">&quot;exports&quot;</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-color-text)"> &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">&quot;.&quot;</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;./with-top-level-await.js&quot;</span><span style="color: var(--shiki-token-punctuation)">,</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">    </span><span style="color: var(--shiki-token-keyword)">&quot;./init&quot;</span><span style="color: var(--shiki-token-punctuation)">:</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;./without-top-level-await.js&quot;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  &#125;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;</span></span></code></pre>`,b,k,A=`<pre class="shiki" style="background-color: var(--shiki-color-background)"><code><span class="line"><span style="color: var(--shiki-token-comment)">// &gt;= node 14 (with top-level await support)</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> api </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;your-pkg&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-token-comment)">// &lt; node 14</span></span>
<span class="line"><span style="color: var(--shiki-token-keyword)">import</span><span style="color: var(--shiki-color-text)"> init </span><span style="color: var(--shiki-token-keyword)">from</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&#39;your-pkg/init&#39;</span><span style="color: var(--shiki-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-keyword)">async</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">function</span><span style="color: var(--shiki-color-text)">() &#123;</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">const</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">api</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-keyword)">await</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-function)">init</span><span style="color: var(--shiki-color-text)">();</span></span>
<span class="line"><span style="color: var(--shiki-color-text)">&#125;)();</span></span></code></pre>`;return{c(){s=u("blockquote"),o=u("p"),i=g("I have a library that needs to be called synchronously but has an async initialization step."),p=u("br"),a=u("br"),e=g("Can I use pkg.exports or something else to use top-level await when supported, and fallback to export the initialization promise so that Node.js 12-13 users can await it themselves?"),v=g("\u2014 Nicol\xF2 Ribaudo \u{1F3F3}\uFE0F\u200D\u{1F308} (@NicoloRibaudo) "),d=u("a"),$=g("September 12, 2020"),w=B(),c=u("div"),b=B(),k=u("div"),this.h()},l(t){s=h(t,"BLOCKQUOTE",{class:!0});var n=x(s);o=h(n,"P",{lang:!0,dir:!0});var _=x(o);i=q(_,"I have a library that needs to be called synchronously but has an async initialization step."),p=h(_,"BR",{}),a=h(_,"BR",{}),e=q(_,"Can I use pkg.exports or something else to use top-level await when supported, and fallback to export the initialization promise so that Node.js 12-13 users can await it themselves?"),_.forEach(l),v=q(n,"\u2014 Nicol\xF2 Ribaudo \u{1F3F3}\uFE0F\u200D\u{1F308} (@NicoloRibaudo) "),d=h(n,"A",{href:!0});var E=x(d);$=q(E,"September 12, 2020"),E.forEach(l),n.forEach(l),w=C(t),c=h(t,"DIV",{class:!0});var L=x(c);L.forEach(l),b=C(t),k=h(t,"DIV",{class:!0});var S=x(k);S.forEach(l),this.h()},h(){m(o,"lang","en"),m(o,"dir","ltr"),m(d,"href","https://twitter.com/NicoloRibaudo/status/1304710001982877697?ref_src=twsrc%5Etfw"),m(s,"class","twitter-tweet"),m(c,"class","code-section"),m(k,"class","code-section")},m(t,n){f(t,s,n),r(s,o),r(o,i),r(o,p),r(o,a),r(o,e),r(s,v),r(s,d),r(d,$),f(t,w,n),f(t,c,n),c.innerHTML=z,f(t,b,n),f(t,k,n),k.innerHTML=A},p:Y,d(t){t&&l(s),t&&l(w),t&&l(c),t&&l(b),t&&l(k)}}}function X(y){let s,o;const i=[y[0],I];let p={$$slots:{default:[W]},$$scope:{ctx:y}};for(let a=0;a<i.length;a+=1)p=j(p,i[a]);return s=new F({props:p}),{c(){M(s.$$.fragment)},l(a){O(s.$$.fragment,a)},m(a,e){V(s,a,e),o=!0},p(a,[e]){const v=e&1?J(i,[e&1&&N(a[0]),e&0&&N(I)]):{};e&2&&(v.$$scope={dirty:e,ctx:a}),s.$set(v)},i(a){o||(K(s.$$.fragment,a),o=!0)},o(a){P(s.$$.fragment,a),o=!1},d(a){Q(s,a)}}}const I={title:"Async initialisation of node lib",tags:["nodejs"],description:"..."};function Z(y,s,o){return U("blog",{image:G}),y.$$set=i=>{o(0,s=j(j({},s),R(i)))},s=R(s),[s]}class ls extends H{constructor(s){super();T(this,s,Z,X,D,{})}}export{ls as default,I as metadata};
