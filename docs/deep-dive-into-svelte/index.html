<!DOCTYPE html>
<html lang="en">

<head>
  <meta charSet="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="preconnect dns-prefetch" href="https://www.google-analytics.com" />
  <link rel="preconnect dns-prefetch" href="https://fonts.googleapis.com" />
  <link href="https://twitter.com/lihautan" rel="me" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#bd93f9" />
  <link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="icon" href="/icons/icon-48x48.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="preload"
    href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300&display=swap" as="style"
    onload="this.rel='stylesheet'">
  <link rel="preload" href="/main.js" as="script" />
  <link rel="webmention" href="https://webmention.io/lihautan.com/webmention" />
  <link rel="pingback" href="https://webmention.io/lihautan.com/xmlrpc" />
  <style>
    html {
      font-family: 'Lato', sans-serif;
      font-weight: 300;
      font-size: 19px;
      background: linear-gradient(0deg, transparent, #bd93f917, transparent);
    }

    html,
    body {
      margin: 0;
      padding: 0;
    }

    :root {
      --prism-padding: 20px;
      --margin: 1.62em;
      --box-shadow-size: 6px;
      --box-shadow: var(--box-shadow-size) var(--box-shadow-size) var(--primary-color);
      --box-shadow-hover: 10px 10px var(--primary-color);
      --easing: 200ms ease-in-out;
      --primary-color: #bd93f9;
      --secondary-color: #9547b7;
      --dark-color: #282936;
    }
  </style>

  
  <title>Deep dive into Svelte | Tan Li Hau</title><meta name="description" content="wip" data-svelte="svelte-n0q11s"><meta name="image" data-svelte="svelte-n0q11s"><meta name="og:image" data-svelte="svelte-n0q11s"><meta name="og:title" content="Deep dive into Svelte" data-svelte="svelte-n0q11s"><meta name="og:description" content="wip" data-svelte="svelte-n0q11s"><meta name="og:type" content="website" data-svelte="svelte-n0q11s"><meta name="twitter:card" content="summary_large_image" data-svelte="svelte-n0q11s"><meta name="twitter:creator" content="@lihautan" data-svelte="svelte-n0q11s"><meta name="twitter:title" content="Deep dive into Svelte" data-svelte="svelte-n0q11s"><meta name="twitter:description" content="wip" data-svelte="svelte-n0q11s"><meta name="twitter:image" data-svelte="svelte-n0q11s"><meta itemprop="url" content="https%3A%2F%2Flihautan.com%2Fdeep-dive-into-svelte" data-svelte="svelte-n0q11s"><meta itemprop="image" data-svelte="svelte-n0q11s"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Tan Li Hau"},"copyrightHolder":{"@type":"Person","name":"Tan Li Hau"},"copyrightYear":"2020","creator":{"@type":"Person","name":"Tan Li Hau"},"publisher":{"@type":"Person","name":"Tan Li Hau"},"description":"wip","headline":"Deep dive into Svelte","name":"Deep dive into Svelte","inLanguage":"en"}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","description":"Breadcrumbs list","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lihautan.com","name":"Homepage"},"position":1},{"@type":"ListItem","item":{"@id":"https%3A%2F%2Flihautan.com%2Fdeep-dive-into-svelte","name":"Deep dive into Svelte"},"position":2}]}</script><link as="script" rel="preload" href="./e4dadfd4.js"><link as="style" rel="preload" href="./assets/blog-base-ddb14eb9.css"><link as="style" rel="preload" href="./e4dadfd4.css"><link href="./assets/blog-base-ddb14eb9.css" rel="stylesheet"><link href="./e4dadfd4.css" rel="stylesheet">
</head>

<body>
  <div id="app">

<a href="#content" class="skip svelte-9tqnza">Skip to content</a>
<header class="svelte-f3e4uo"><nav><ul class="svelte-f3e4uo"><li class="svelte-f3e4uo"><a href="/" class="svelte-f3e4uo">Tan Li Hau</a></li>
    <li class="svelte-f3e4uo"><a href="/about" class="svelte-f3e4uo">About</a></li>
    <li class="svelte-f3e4uo"><a href="/blogs" class="svelte-f3e4uo">Writings</a></li>
    <li class="svelte-f3e4uo"><a href="/talks" class="svelte-f3e4uo">Talks</a></li>
    <li class="svelte-f3e4uo"><a href="/notes" class="svelte-f3e4uo">Notes</a></li>
    <li class="svelte-f3e4uo"><a href="/newsletter" class="svelte-f3e4uo">Newsletter</a></li>
    <li class="social svelte-f3e4uo"><a aria-label="Twitter account" href="https://twitter.com/lihautan" class="svelte-f3e4uo"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-f3e4uo"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66
    10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5
    4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
      <a aria-label="Github account" href="https://github.com/tanhauhau" class="svelte-f3e4uo"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-f3e4uo"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0
    0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07
    5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65
    5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42
    3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></li></ul></nav>
</header>

<main id="content" class="blog svelte-9tqnza"><h1>Deep dive into Svelte</h1>
  
  

  <article><section><ul class="sitemap" id="sitemap" role="navigation" aria-label="Table of Contents"></ul><li><a href="#what-is-svelte">What is Svelte?</a></li><ul><li><a href="#writing-vanilla-javascript">Writing vanilla JavaScript</a></li><li><a href="#conceptually-how-does-compiled-svelte-component-work">Conceptually, how does compiled Svelte component work?</a></li><li><a href="#how-the-compiled-svelte-component-works">How the compiled Svelte component works</a></li><ul><li><a href="#pieces-them-together">Pieces them together</a></li></ul><li><a href="#the-svelte-compiler">The Svelte compiler</a></li></ul></section>
<section><h1><a href="#what-is-svelte" id="what-is-svelte">[DRAFT] What is Svelte?</a></h1>
<p>-- this is a work in progress draft, you can read <a href="/compile-svelte-in-your-head-part-1">Compile Svelte in your Head</a> which is a more friendly version --</p>
<p><a href="http://svelte.dev/" rel="nofollow">Svelte</a> is a compiler for web applications. Svelte provides a framework for you to write your web apps declaratively, and it will compile them into efficient JavaScript.</p>
<p>In this article, I will be sharing how Svelte works.</p>
<p>If you are:</p>
<ul><li><p><strong>First time hearing Svelte?</strong></p>
<p>Please go and watch <a href="https://twitter.com/Rich_Harris" rel="nofollow">Rich Harris</a> inspiring talk on <a href="https://svelte.dev/blog/svelte-3-rethinking-reactivity" rel="nofollow">&quot;Rethinking reactivity&quot;</a> where he announces Svelte.</p></li>
<li><p><strong>Interested learning how to write Svelte application?</strong></p>
<p>Please follow along <a href="https://svelte.dev/tutorial/basics" rel="nofollow">Svelte&#39;s interactive tutorial</a>, I find it very helpful and it get me started in no time!</p></li></ul>
<p>Because, I will be going deep level by level, guiding you through the source code sometimes, explaining how Svelte works.</p>
<ul><li>look at code written in vanilla vs using framework<ul><li>compile time vs build time spectrum, svelte and react opposite side of the spectrum</li></ul></li>
<li>a picture of how a svelte component works<ul><li></li></ul></li></ul></section>
<section><h2><a href="#writing-vanilla-javascript" id="writing-vanilla-javascript">Writing vanilla JavaScript</a></h2>
<p>Before we get started, lets&#39; do an exercise.</p>
<p>Let&#39;s write a counter app like below, without using any framework:</p>
<div style="text-align:center;"><button id="ex1-decrement">-</button>
  <span id="ex1-count">0</span>
  <button id="ex1-increment">+</button>
  <script>let count = 0;
    const span = document.querySelector('#ex1-count');
    document.querySelector('#ex1-decrement').onclick = () => span.textContent = --count;
    document.querySelector('#ex1-increment').onclick = () => span.textContent = ++count;
  </script></div>
<p>There are generally 2 approaches to this:</p>
<p><strong>1. HTML + JS</strong></p>
<p>You build your app layout in HTML:</p>
<pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- filename: index.html --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>decrement<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>count<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>increment<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></code></pre>
<p>then in JS, you use id selector to query out the dynamic part of your HTML and attach event listeners to respond to user inputs:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// filename: script.js</span>
<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> span <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#count'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#decrement'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
  <span class="token punctuation">(</span>span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token operator">--</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#increment'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
  <span class="token punctuation">(</span>span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token operator">++</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><strong>2. JS only</strong></p>
<p>If you want to have more than 1 counter, the former approach may require you to <em>copy + paste</em> your HTML <em>n</em> times for <em>n</em> number of counters.</p>
<p>The alternative would be to build the HTML elements programatically:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// filename: script.js</span>
<span class="token keyword">function</span> <span class="token function">buildCounter</span><span class="token punctuation">(</span><span class="token parameter">parent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> span <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> decrementBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> incrementBtn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  decrementBtn<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">;</span>
  decrementBtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token operator">--</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

  incrementBtn<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'+'</span><span class="token punctuation">;</span>
  incrementBtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token operator">++</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

  parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>decrementBtn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
  parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>incrementBtn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// you can call &#96;buildCounter&#96; however times you want</span>
<span class="token comment">//  to get however many counters</span>
<span class="token function">buildCounter</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This is the least amount of code to be written for a counter app.</p>
<p><em>(One may argue that you can abstract out <code>document.createElement</code> or <code>parent.appendChild</code> to a function to make the code smaller, but that&#39;s besides the point.)</em></p>
<p>This is the least amount of code to be written <strong>and be executed by the browser</strong> for a counter app.</p>
<p>So why does this matter? Well, before we proceed to explain how this got to do with Svelte, let&#39;s first talk about React.</p>
<p><em>I chose to talk about React <strong>just because I am a React developer</strong>, I use React at my work and at this very blog site. I am most familiar with React than any other JS frameworks out there</em></p>
<p>In React, you can argubly write a much concise and declarative code:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// filename: Counter.jsx</span>
<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>That&#39;s because React has hidden all the <code>document.createElement</code>, <code>parent.appendChild</code>, ... under <a href="https://reactjs.org/docs/react-dom.html" rel="nofollow"><code>react-dom</code> renderer.</a></p>
<p>Everytime you click on a counter button, the function <code>Counter</code> is called to get the new <a href="https://github.com/acdlite/react-fiber-architecture" rel="nofollow">Fiber tree</a> with the new state value, and it is compared with the current Fiber tree. After the diffing between the 2 Fiber tree, React collects the necessary DOM operations, in this case is to update <code>span</code>&#39;s <code>textContent</code>.</p>
<p>If you feel this is overly complicated, wait, there is more.</p>
<p>When the <code>react-dom</code> <a href="https://github.com/facebook/react/blob/b8d079b41372290aa1846e3a780d85d05ab8ffc1/packages/react-dom/src/client/ReactDOMComponent.js#L372-L377" rel="nofollow">receives the DOM operations</a>, it receives <code>[&#39;span&#39;, { &#39;children&#39;: &#39;1&#39; }]</code>, the element and the update payload, and <code>react-dom</code> has to figure out that <code>children</code> meant <a href="https://github.com/facebook/react/blob/b8d079b41372290aa1846e3a780d85d05ab8ffc1/packages/react-dom/src/client/ReactDOMComponent.js#L386-L388" rel="nofollow">setting the <code>textContent</code></a>.</p>
<p>As you can see, there&#39;s a lot of code <strong>executed</strong> under the hood, which you may think is overkill for this contrived example. But with a much larger/complex application, you will soon appreciate the flexibilty React provides. to achieve that, react has to make sure it has code to capture all the different scenarios, without knowing what will be written by us, the developer.</p>
<p>Now, here is how Svelte is different. <strong>Svelte is a compiler</strong>. Svelte knows what we, the developer, has written, and generate only code that is needed for our application.</p>
<p>Here&#39;s what Svelte generated for our Counter app (<a href="https://svelte.dev/repl/2ed88da423f24cd980dad77e8a07e248?version=3.12.1" rel="nofollow">repl</a>):</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// import &#123; element, ... &#125; from "svelte/internal"</span>
<span class="token comment">// ...</span>
<span class="token keyword">function</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> button0<span class="token punctuation">,</span> span<span class="token punctuation">,</span> t<span class="token punctuation">,</span> button1<span class="token punctuation">,</span> dispose<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      button0 <span class="token operator">=</span> <span class="token function">element</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      button0<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">;</span>
      span <span class="token operator">=</span> <span class="token function">element</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      t <span class="token operator">=</span> <span class="token function">text</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
      button1 <span class="token operator">=</span> <span class="token function">element</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      button1<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'+'</span><span class="token punctuation">;</span>
      <span class="token function">listen</span><span class="token punctuation">(</span>button0<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>click_handler<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">listen</span><span class="token punctuation">(</span>button1<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>click_handler_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> button0<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> span<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">append</span><span class="token punctuation">(</span>span<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> button1<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">p</span><span class="token punctuation">(</span><span class="token parameter">changed<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>changed<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">set_data</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token parameter">$$self<span class="token punctuation">,</span> $$props<span class="token punctuation">,</span> $$invalidate</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">click_handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">$$invalidate</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>count <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">click_handler_1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">$$invalidate</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> count<span class="token punctuation">,</span> click_handler<span class="token punctuation">,</span> click_handler_1 <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// ...</span></code></pre>
<p><strong>Disclaimer:</strong> <em>There are parts of code deliberately removed to make the code more concise and readable, which should not affect the point I am trying to make here. Feel free to read the original code in the <a href="https://svelte.dev/repl/2ed88da423f24cd980dad77e8a07e248?version=3.12.1" rel="nofollow">repl</a>.</em></p>
<p>You see Svelte&#39;s generated code is much like the one we&#39;ve written in plain JavaScript just now. It generates the <code>.textContent</code> directly, because during compilation, Svelte knows exactly what you are trying to do. Therefore it can try to handle all the different scenarios, where React tries to handle in runtime, in build time.</p>
<p>Now you know the fundamental differences between Svelte and React, let&#39;s take a look how a Svelte component works.</p></section>
<section><h2><a href="#conceptually-how-does-compiled-svelte-component-work" id="conceptually-how-does-compiled-svelte-component-work">Conceptually, how does compiled Svelte component work?</a></h2>
<p>In this section, we are going to write Svelte component incrementally, and see how each changes ended up in the compiled Svelte component.</p>
<p>Let&#39;s start with a simple button and a text:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>Click Me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello Svelte<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre>
<p>When Svelte sees this, these HTML elements will translate into JavaScript statement to create the elements:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> button <span class="token operator">=</span> <span class="token function">element</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
button<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Click Me'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token function">element</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Hello Svelte'</span><span class="token punctuation">;</span>

<span class="token comment">// element('p') is short for &#96;document.createElement('p');</span></code></pre>
<p>If you inspect the Svelte compiled output, you would notice that these instruction lies in a function call <code>create_fragment</code>. <code>create_fragment</code> is the function where Svelte keeps the DOM instructions for the component.</p>
<p>Next, lets add some event listener to the button:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Greetings!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span>&#123;onClick&#125;</span><span class="token punctuation">></span></span>Click Me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello Svelte<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre>
</section>
<section><h2><a href="#how-the-compiled-svelte-component-works" id="how-the-compiled-svelte-component-works">How the compiled Svelte component works</a></h2>
<p>To differentiate between the component code you write, and the component code generated by Svelte, I will use <code>.svelte</code> component to refer the code you would write in a <code>.svelte</code> file, and Svelte component to refer the <code>.js</code> code, generated by Svelte from your <code>.svelte</code> component, that will be executed in your application.</p>
<p>The best way to understand how Svelte component works is to use the <a href="https://svelte.dev/repl" rel="nofollow">Svelte&#39;s REPL</a>. Try writing a component, and see how Svelte compiles the component into plain JavaScript.</p>
<p>Svelte compiles the <code>.svelte</code> file into a <code>.js</code> file, which the <code>export default</code> the compiled Svelte component.</p>
<p>The compiled Svelte component contains 3 main sections:</p>
<ul><li><code>create_fragment</code></li>
<li><code>instance</code></li>
<li>the Component itself</li></ul>
<pre class="language-js"><code class="language-js"><span class="token comment">// 1. create_fragment</span>
<span class="token keyword">function</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">p</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 2. instance</span>
<span class="token keyword">function</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token parameter">$$self<span class="token punctuation">,</span> $$props<span class="token punctuation">,</span> $$invalidate</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 3. the Component itself</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">SvelteComponent</span> <span class="token punctuation">&#123;</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> create_fragment<span class="token punctuation">,</span> safe_not_equal<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre>
<p>Let&#39;s explain what each section of the code is for, from the bottom up.</p>
<p><strong>3. The component itself</strong></p>
<p>Each compiled component, by default, is a subclass of <code>SvelteComponent</code>.</p>
<p>To create the component onto the DOM, you can create an instance of the component:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> target<span class="token punctuation">:</span> document<span class="token punctuation">.</span>body <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>In the constructor of <code>App</code>, as you can see, calls the <code>init</code> function, which takes in both <code>instance</code> and <code>create_fragment</code> function.</p>
<p>The <code>init</code> function, as the name suggests, will set things up, which lead us to the <code>instance</code> function.</p>
<p><strong>2. <code>instance</code></strong></p>
<p>The <code>instance</code> function is where all the business logic of your <code>.svelte</code> component lies.</p>
<p>That&#39;s why, if you take a closer look, the <code>instance</code> function contains most, if not all, the code you write in the <code>&lt;script&gt;</code> tag in the <code>.svelte</code> component.</p>
<hr>
<p>Code that you write in the <code>&lt;script&gt;</code> tag that will not be in the <code>instance</code> function are:</p>
<ul><li><strong><code>import</code> statement</strong><ul><li>These will be moved to the beginning of the compiled file.</li></ul></li>
<li><strong><code>export</code> statement</strong><ul><li>These are exported properties or methods of the Svelte component. It will be present in the former section, &quot;the component itself&quot; section.</li></ul></li>
<li><strong>constants</strong><ul><li>Since the value of a constant will not change throughout the lifetime of your application, so there&#39;s no point redeclaring a new constant for every instance of your Svelte component.</li>
<li>Therefore it is moved out from the <code>instance</code> function.</li>
<li><a href="https://svelte.dev/repl/hello-world" rel="nofollow">Check out the repl</a>.</li></ul></li>
<li><strong>pure functions</strong><ul><li>The same logic goes with pure functions. If the function does not rely on any variables within the scope other than it&#39;s own arguments, the function will be moved out from the <code>instance</code> function.</li>
<li><a href="https://svelte.dev/repl/d831c0e1387d4105b9bf4cbf6e321477?version=3.12.1" rel="nofollow">Check out this repl</a>.</li></ul></li></ul>
<hr>
<p>The <code>instance</code> function contains all of your business logic, and returns an object. The object contains all the variables and functions you&#39;ve declared and used in the HTML code. The object is referred as <code>ctx</code> in Svelte, and that brings us to the <code>create_fragment</code> function.</p>
<p><strong>1. <code>create_fragment</code></strong></p>
<p>The <code>create_fragment</code> function deals with the HTML code you&#39;ve written in a <code>.svelte</code> component. The <code>create_fragment</code> function takes in the <code>ctx</code> object, and returns an object that instructs the Svelte component how to render into the DOM, that looks like this:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> t<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// create</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
     t <span class="token operator">=</span> <span class="token function">text</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>greeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// claim</span>
    <span class="token function">l</span><span class="token punctuation">(</span><span class="token parameter">nodes</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
      t <span class="token operator">=</span> <span class="token function">claim_text</span><span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>greeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// hydrate</span>
    h<span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
    <span class="token comment">// mount</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> t<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// update</span>
    <span class="token function">p</span><span class="token punctuation">(</span><span class="token parameter">changed<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
      <span class="token keyword">if</span> <span class="token punctuation">(</span>changed<span class="token punctuation">.</span>greeting<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">set_data</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>greeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// measure</span>
    r<span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
    <span class="token comment">// fix</span>
    f<span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
    <span class="token comment">// animate</span>
    a<span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
    <span class="token comment">// intro</span>
    i<span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
    <span class="token comment">// outro</span>
    o<span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
    <span class="token comment">// destroy</span>
    <span class="token function">d</span><span class="token punctuation">(</span><span class="token parameter">detaching</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
      <span class="token keyword">if</span> <span class="token punctuation">(</span>detaching<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">detach</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>Let&#39;s take a closer look to what each function does:</p>
<p><strong>- c <em>(create)</em></strong></p>
<p>This function creates all the DOM nodes needed.</p>
<p><strong>- l <em>(claim)</em></strong></p>
<p>On the other hand, if you use a server-side rendering, and you want to hydrate the rendered DOM with the component, the <code>claim</code> function will be called instead of <code>create</code>. This will try to claim and assign reference to the DOM node.</p>
<p><strong>- m <em>(mount)</em></strong></p>
<p>With the references to the DOM nodes, the <code>mount</code> function will <code>insert</code> or <code>append</code> DOM nodes to the target accordingly.</p>
<p><strong>- p <em>(update)</em></strong></p>
<p>If there&#39;s a change, say after a button click, the <code>update</code> function will be called with the changed mask and the new <code>ctx</code> object.</p>
<p><strong>- r <em>(measure)</em></strong><br>
<strong>- f <em>(fix)</em></strong><br>
<strong>- a <em>(animate)</em></strong><br>
<strong>- i <em>(intro)</em></strong><br>
<strong>- o <em>(outro)</em></strong></p>
<p>These are for animations, measuring and fixing the element before animation, <code>intro</code>s and <code>outro</code>s.</p>
<p><strong>- d <em>(destroy)</em></strong></p>
<p>Last but not least, the <code>destroy</code> function is called when the Svelte component unmounts from the target.</p></section>
<section><h3><a href="#pieces-them-together" id="pieces-them-together">Pieces them together</a></h3>
<p>With every pieces in mind, let&#39;s summarise what we&#39;ve learned so far:</p>
<p>You create the component into DOM by create a new instance of the Svelte component:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> target<span class="token punctuation">:</span> document<span class="token punctuation">.</span>body <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Which in the constructor of <code>App</code>, it calls the <code>init</code> function:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> options<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> create_fragment</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre>
<p>Within the <code>init</code> function, the <code>instance</code> function is called:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> options<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> create_fragment</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// highlight-next-line</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token function">instance</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> options<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>Which returns the <code>ctx</code>, and it is passed into the <code>create_fragment</code> function:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> options<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> create_fragment</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token function">instance</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> options<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// highlight-next-line</span>
  <span class="token keyword">const</span> fragment <span class="token operator">=</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>Which returns instructions on how to create DOM nodes and mount the nodes into DOM:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> options<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> create_fragment</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token function">instance</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> options<span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fragment <span class="token operator">=</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// highlight-start</span>
  <span class="token comment">// create / claim the nodes</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>hydratable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    fragment<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    fragment<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// mount the nodes</span>
  fragment<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// highlight-end</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>But hey, when does the <code>fragment.update()</code> get called when something has changed?</p>
<p>That my friend, is the secret 3rd argument of the <code>instance</code> function, <strong><code>$$invalidate</code></strong>.</p>
<p>Whenever you reassign a value to your variable, Svelte will add an extra statement of <code>$$invalidate(...)</code> statement after your re-assignment.</p>
<p><code>$$invalidate</code> takes 2 arguments, the name of the variable, and the new value of the variable:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> options<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> create_fragment</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// highlight-start</span>
  <span class="token keyword">const</span> <span class="token function-variable function">$$invalidate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    ctx<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token comment">// update the nodes</span>
    fragment<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token function">instance</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> options<span class="token punctuation">.</span>props<span class="token punctuation">,</span> $$invalidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// highlight-end</span>
  <span class="token keyword">const</span> fragment <span class="token operator">=</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// create / claim the nodes</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>hydratable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    fragment<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    fragment<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// mount the nodes</span>
  fragment<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p><em>Of course, if you have consecutive <code>$$invalidate</code> calls, Svelte will batch all the <code>$$invalidate</code> changes, and call <code>fragment.update</code> only once with all the changes.</em></p>
<p>Now that you have a clearer picture on how Svelte works, let&#39;s go one level deeper, and take a look how the Svelte compiler works.</p></section>
<section><h2><a href="#the-svelte-compiler" id="the-svelte-compiler">The Svelte compiler</a></h2>
<p>-- WIP --</p></section></article></main>

<footer class="svelte-9tqnza"><div class="form svelte-1k1s1co"><h1>Subscribe to my newsletter</h1>
  <h2 class="svelte-1k1s1co">Get the latest blog posts and project updates delivered right to your inbox</h2>
  <form action="https://buttondown.email/api/emails/embed-subscribe/lihautan" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/lihautan', 'popupwindow')" class="embeddable-buttondown-form"><div class="form-item svelte-1k1s1co"><input type="email" name="email" id="bd-email" aria-label="email address" placeholder="youremail@example.com" class="svelte-1k1s1co">
      <input type="submit" value="Subscribe" disabled class="svelte-1k1s1co"></div>
    <input type="hidden" value="1" name="embed" class="svelte-1k1s1co">
    <p class="svelte-1k1s1co">Powered by Buttondown.</p></form>
</div>
  </footer>

<script async defer src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><script src="./e4dadfd4.js" async></script></div>
  

  <script async defer src="/main.js"></script>
</body>

</html>