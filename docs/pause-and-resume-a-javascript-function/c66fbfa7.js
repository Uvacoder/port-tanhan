function n(){}function a(n,a){for(const s in a)n[s]=a[s];return n}function s(n){return n()}function t(){return Object.create(null)}function e(n){n.forEach(s)}function o(n){return"function"==typeof n}function c(n,a){return n!=n?a==a:n!==a||n&&"object"==typeof n||"function"==typeof n}function p(n,s,t,e){return n[1]&&e?a(t.ctx.slice(),n[1](e(s))):t.ctx}function i(n,a,s,t,e,o,c){const i=function(n,a,s,t){if(n[2]&&t){const e=n[2](t(s));if(void 0===a.dirty)return e;if("object"==typeof e){const n=[],s=Math.max(a.dirty.length,e.length);for(let t=0;t<s;t+=1)n[t]=a.dirty[t]|e[t];return n}return a.dirty|e}return a.dirty}(a,t,e,o);if(i){const e=p(a,s,t,c);n.p(e,i)}}function r(n,a){n.appendChild(a)}function u(n,a,s){n.insertBefore(a,s||null)}function l(n){n.parentNode.removeChild(n)}function h(n,a){for(let s=0;s<n.length;s+=1)n[s]&&n[s].d(a)}function k(n){return document.createElement(n)}function f(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function d(n){return document.createTextNode(n)}function m(){return d(" ")}function g(){return d("")}function w(n,a,s){null==s?n.removeAttribute(a):n.getAttribute(a)!==s&&n.setAttribute(a,s)}function y(n){return Array.from(n.childNodes)}function v(n,a,s,t){for(let t=0;t<n.length;t+=1){const e=n[t];if(e.nodeName===a){let a=0;const o=[];for(;a<e.attributes.length;){const n=e.attributes[a++];s[n.name]||o.push(n.name)}for(let n=0;n<o.length;n++)e.removeAttribute(o[n]);return n.splice(t,1)[0]}}return t?f(a):k(a)}function E(n,a){for(let s=0;s<n.length;s+=1){const t=n[s];if(3===t.nodeType)return t.data=""+a,n.splice(s,1)[0]}return d(a)}function b(n){return E(n," ")}function I(n,a){a=""+a,n.wholeText!==a&&(n.data=a)}function S(n,a){n.value=null==a?"":a}function T(n,a,s,t){n.style.setProperty(a,s,t?"important":"")}class ${constructor(n=null){this.a=n,this.e=this.n=null}m(n,a,s=null){this.e||(this.e=k(a.nodeName),this.t=a,this.h(n)),this.i(s)}h(n){this.e.innerHTML=n,this.n=Array.from(this.e.childNodes)}i(n){for(let a=0;a<this.n.length;a+=1)u(this.t,this.n[a],n)}p(n){this.d(),this.h(n),this.i(this.a)}d(){this.n.forEach(l)}}let P;function A(n){P=n}function O(n){(function(){if(!P)throw new Error("Function called outside component initialization");return P})().$$.on_mount.push(n)}const x=[],L=[],C=[],j=[],D=Promise.resolve();let N=!1;function R(n){C.push(n)}let M=!1;const W=new Set;function F(){if(!M){M=!0;do{for(let n=0;n<x.length;n+=1){const a=x[n];A(a),H(a.$$)}for(x.length=0;L.length;)L.pop()();for(let n=0;n<C.length;n+=1){const a=C[n];W.has(a)||(W.add(a),a())}C.length=0}while(x.length);for(;j.length;)j.pop()();N=!1,M=!1,W.clear()}}function H(n){if(null!==n.fragment){n.update(),e(n.before_update);const a=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,a),n.after_update.forEach(R)}}const J=new Set;function _(n,a){n&&n.i&&(J.delete(n),n.i(a))}function B(n,a,s,t){if(n&&n.o){if(J.has(n))return;J.add(n),(void 0).c.push(()=>{J.delete(n),t&&(s&&n.d(1),t())}),n.o(a)}}function U(n){n&&n.c()}function G(n,a){n&&n.l(a)}function Y(n,a,t){const{fragment:c,on_mount:p,on_destroy:i,after_update:r}=n.$$;c&&c.m(a,t),R(()=>{const a=p.map(s).filter(o);i?i.push(...a):e(a),n.$$.on_mount=[]}),r.forEach(R)}function q(n,a){const s=n.$$;null!==s.fragment&&(e(s.on_destroy),s.fragment&&s.fragment.d(a),s.on_destroy=s.fragment=null,s.ctx=[])}function z(n,a){-1===n.$$.dirty[0]&&(x.push(n),N||(N=!0,D.then(F)),n.$$.dirty.fill(0)),n.$$.dirty[a/31|0]|=1<<a%31}function V(a,s,o,c,p,i,r=[-1]){const u=P;A(a);const h=s.props||{},k=a.$$={fragment:null,ctx:null,props:i,update:n,not_equal:p,bound:t(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:t(),dirty:r};let f=!1;if(k.ctx=o?o(a,h,(n,s,...t)=>{const e=t.length?t[0]:s;return k.ctx&&p(k.ctx[n],k.ctx[n]=e)&&(k.bound[n]&&k.bound[n](e),f&&z(a,n)),s}):[],k.update(),f=!0,e(k.before_update),k.fragment=!!c&&c(k.ctx),s.target){if(s.hydrate){const n=y(s.target);k.fragment&&k.fragment.l(n),n.forEach(l)}else k.fragment&&k.fragment.c();s.intro&&_(a.$$.fragment),Y(a,s.target,s.anchor),F()}A(u)}class K{$destroy(){q(this,1),this.$destroy=n}$on(n,a){const s=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return s.push(a),()=>{const n=s.indexOf(a);-1!==n&&s.splice(n,1)}}$set(){}}function Z(a){let s,t,e,o,c,p,i,h,g,I,S,T,$,P,A,O,x,L,C,j,D,N,R,M,W,F,H,J,_,B,U,G,Y,q,z;return{c(){s=k("header"),t=k("nav"),e=k("ul"),o=k("li"),c=k("a"),p=d("Tan Li Hau"),i=m(),h=k("li"),g=k("a"),I=d("About"),S=m(),T=k("li"),$=k("a"),P=d("Writings"),A=m(),O=k("li"),x=k("a"),L=d("Talks"),C=m(),j=k("li"),D=k("a"),N=d("Notes"),R=m(),M=k("li"),W=k("a"),F=d("Newsletter"),H=m(),J=k("li"),_=k("a"),B=f("svg"),U=f("path"),G=m(),Y=k("a"),q=f("svg"),z=f("path"),this.h()},l(n){s=v(n,"HEADER",{class:!0});var a=y(s);t=v(a,"NAV",{});var r=y(t);e=v(r,"UL",{class:!0});var u=y(e);o=v(u,"LI",{class:!0});var k=y(o);c=v(k,"A",{href:!0,class:!0});var f=y(c);p=E(f,"Tan Li Hau"),f.forEach(l),k.forEach(l),i=b(u),h=v(u,"LI",{class:!0});var d=y(h);g=v(d,"A",{href:!0,class:!0});var m=y(g);I=E(m,"About"),m.forEach(l),d.forEach(l),S=b(u),T=v(u,"LI",{class:!0});var w=y(T);$=v(w,"A",{href:!0,class:!0});var V=y($);P=E(V,"Writings"),V.forEach(l),w.forEach(l),A=b(u),O=v(u,"LI",{class:!0});var K=y(O);x=v(K,"A",{href:!0,class:!0});var Z=y(x);L=E(Z,"Talks"),Z.forEach(l),K.forEach(l),C=b(u),j=v(u,"LI",{class:!0});var Q=y(j);D=v(Q,"A",{href:!0,class:!0});var X=y(D);N=E(X,"Notes"),X.forEach(l),Q.forEach(l),R=b(u),M=v(u,"LI",{class:!0});var nn=y(M);W=v(nn,"A",{href:!0,class:!0});var an=y(W);F=E(an,"Newsletter"),an.forEach(l),nn.forEach(l),H=b(u),J=v(u,"LI",{class:!0});var sn=y(J);_=v(sn,"A",{"aria-label":!0,href:!0,class:!0});var tn=y(_);B=v(tn,"svg",{viewBox:!0,width:!0,height:!0,class:!0},1);var en=y(B);U=v(en,"path",{d:!0},1),y(U).forEach(l),en.forEach(l),tn.forEach(l),G=b(sn),Y=v(sn,"A",{"aria-label":!0,href:!0,class:!0});var on=y(Y);q=v(on,"svg",{viewBox:!0,width:!0,height:!0,class:!0},1);var cn=y(q);z=v(cn,"path",{d:!0},1),y(z).forEach(l),cn.forEach(l),on.forEach(l),sn.forEach(l),u.forEach(l),r.forEach(l),a.forEach(l),this.h()},h(){w(c,"href","/"),w(c,"class","svelte-f3e4uo"),w(o,"class","svelte-f3e4uo"),w(g,"href","/about"),w(g,"class","svelte-f3e4uo"),w(h,"class","svelte-f3e4uo"),w($,"href","/blogs"),w($,"class","svelte-f3e4uo"),w(T,"class","svelte-f3e4uo"),w(x,"href","/talks"),w(x,"class","svelte-f3e4uo"),w(O,"class","svelte-f3e4uo"),w(D,"href","/notes"),w(D,"class","svelte-f3e4uo"),w(j,"class","svelte-f3e4uo"),w(W,"href","/newsletter"),w(W,"class","svelte-f3e4uo"),w(M,"class","svelte-f3e4uo"),w(U,"d","M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66\n    10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5\n    4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"),w(B,"viewBox","0 0 24 24"),w(B,"width","1em"),w(B,"height","1em"),w(B,"class","svelte-f3e4uo"),w(_,"aria-label","Twitter account"),w(_,"href","https://twitter.com/lihautan"),w(_,"class","svelte-f3e4uo"),w(z,"d","M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0\n    0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07\n    5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65\n    5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42\n    3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"),w(q,"viewBox","0 0 24 24"),w(q,"width","1em"),w(q,"height","1em"),w(q,"class","svelte-f3e4uo"),w(Y,"aria-label","Github account"),w(Y,"href","https://github.com/tanhauhau"),w(Y,"class","svelte-f3e4uo"),w(J,"class","social svelte-f3e4uo"),w(e,"class","svelte-f3e4uo"),w(s,"class","svelte-f3e4uo")},m(n,a){u(n,s,a),r(s,t),r(t,e),r(e,o),r(o,c),r(c,p),r(e,i),r(e,h),r(h,g),r(g,I),r(e,S),r(e,T),r(T,$),r($,P),r(e,A),r(e,O),r(O,x),r(x,L),r(e,C),r(e,j),r(j,D),r(D,N),r(e,R),r(e,M),r(M,W),r(W,F),r(e,H),r(e,J),r(J,_),r(_,B),r(B,U),r(J,G),r(J,Y),r(Y,q),r(q,z)},p:n,i:n,o:n,d(n){n&&l(s)}}}class Q extends K{constructor(n){super(),V(this,n,null,Z,c,{})}}function X(a){let s,t,e,o,c,p,i,h,f,g,I,T,$,P,A,O,x,L,C,j;return{c(){s=k("div"),t=k("h1"),e=d("Subscribe to my newsletter"),o=m(),c=k("h2"),p=d("Get the latest blog posts and project updates delivered right to your inbox"),i=m(),h=k("form"),f=k("div"),g=k("input"),I=m(),T=k("input"),P=m(),A=k("input"),O=m(),x=k("p"),L=d("Powered by Buttondown."),this.h()},l(n){s=v(n,"DIV",{class:!0});var a=y(s);t=v(a,"H1",{});var r=y(t);e=E(r,"Subscribe to my newsletter"),r.forEach(l),o=b(a),c=v(a,"H2",{class:!0});var u=y(c);p=E(u,"Get the latest blog posts and project updates delivered right to your inbox"),u.forEach(l),i=b(a),h=v(a,"FORM",{action:!0,method:!0,target:!0,onsubmit:!0,class:!0});var k=y(h);f=v(k,"DIV",{class:!0});var d=y(f);g=v(d,"INPUT",{type:!0,name:!0,id:!0,"aria-label":!0,placeholder:!0,class:!0}),I=b(d),T=v(d,"INPUT",{type:!0,value:!0,disabled:!0,class:!0}),d.forEach(l),P=b(k),A=v(k,"INPUT",{type:!0,value:!0,name:!0,class:!0}),O=b(k),x=v(k,"P",{class:!0});var m=y(x);L=E(m,"Powered by Buttondown."),m.forEach(l),k.forEach(l),a.forEach(l),this.h()},h(){w(c,"class","svelte-1k1s1co"),w(g,"type","email"),w(g,"name","email"),w(g,"id","bd-email"),w(g,"aria-label","email address"),w(g,"placeholder","youremail@example.com"),w(g,"class","svelte-1k1s1co"),w(T,"type","submit"),T.value="Subscribe",T.disabled=$=!a[0],w(T,"class","svelte-1k1s1co"),w(f,"class","form-item svelte-1k1s1co"),w(A,"type","hidden"),A.value="1",w(A,"name","embed"),w(A,"class","svelte-1k1s1co"),w(x,"class","svelte-1k1s1co"),w(h,"action","https://buttondown.email/api/emails/embed-subscribe/lihautan"),w(h,"method","post"),w(h,"target","popupwindow"),w(h,"onsubmit","window.open('https://buttondown.email/lihautan', 'popupwindow')"),w(h,"class","embeddable-buttondown-form"),w(s,"class","form svelte-1k1s1co")},m(n,l){var k,d,m,w;u(n,s,l),r(s,t),r(t,e),r(s,o),r(s,c),r(c,p),r(s,i),r(s,h),r(h,f),r(f,g),S(g,a[0]),r(f,I),r(f,T),r(h,P),r(h,A),r(h,O),r(h,x),r(x,L),C||(k=g,d="input",m=a[1],k.addEventListener(d,m,w),j=()=>k.removeEventListener(d,m,w),C=!0)},p(n,[a]){1&a&&g.value!==n[0]&&S(g,n[0]),1&a&&$!==($=!n[0])&&(T.disabled=$)},i:n,o:n,d(n){n&&l(s),C=!1,j()}}}function nn(n,a,s){let t;return[t,function(){t=this.value,s(0,t)}]}class an extends K{constructor(n){super(),V(this,n,nn,X,c,{})}}function sn(n){return O(()=>(setTimeout(()=>{if(window.innerWidth>1080){const n=document.createElement("script");n.async=!0,n.type="text/javascript",n.src="//cdn.carbonads.com/carbon.js?serve=CE7ITK3E&placement=lihautancom",n.id="_carbonads_js",document.body.appendChild(n)}},5e3),()=>{try{const n=document.getElementById("carbonads");n.parentNode.removeChild(n)}catch(n){}})),[]}class tn extends K{constructor(n){super(),V(this,n,sn,null,c,{})}}function en(n,a,s){const t=n.slice();return t[6]=a[s],t}function on(n,a,s){const t=n.slice();return t[6]=a[s],t}function cn(n){let a,s;return{c(){a=k("meta"),this.h()},l(n){a=v(n,"META",{name:!0,content:!0}),this.h()},h(){w(a,"name","keywords"),w(a,"content",s=n[6])},m(n,s){u(n,a,s)},p(n,t){4&t&&s!==(s=n[6])&&w(a,"content",s)},d(n){n&&l(a)}}}function pn(n){let a,s,t=n[6]+"";return{c(){a=k("span"),s=d(t),this.h()},l(n){a=v(n,"SPAN",{class:!0});var e=y(a);s=E(e,t),e.forEach(l),this.h()},h(){w(a,"class","svelte-9tqnza")},m(n,t){u(n,a,t),r(a,s)},p(n,a){4&a&&t!==(t=n[6]+"")&&I(s,t)},d(n){n&&l(a)}}}function rn(n){let a,s,t,e,o,c,f,S,T,P,A,O,x,L,C,j,D,N,R,M,W,F,H,J,z,V,K,Z,X,nn,sn,rn,un,ln,hn,kn,fn,dn,mn,gn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"Article",author:n[3],copyrightHolder:n[3],copyrightYear:"2020",creator:n[3],publisher:n[3],description:n[1],headline:n[0],name:n[0],inLanguage:"en"})}<\/script>`,wn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"BreadcrumbList",description:"Breadcrumbs list",name:"Breadcrumbs",itemListElement:[{"@type":"ListItem",item:{"@id":"https://lihautan.com",name:"Homepage"},position:1},{"@type":"ListItem",item:{"@id":"https%3A%2F%2Flihautan.com%2Fpause-and-resume-a-javascript-function",name:n[0]},position:2}]})}<\/script>`;document.title=a=n[0]+" | Tan Li Hau";let yn=n[2],vn=[];for(let a=0;a<yn.length;a+=1)vn[a]=cn(on(n,yn,a));H=new Q({});let En=n[2],bn=[];for(let a=0;a<En.length;a+=1)bn[a]=pn(en(n,En,a));const In=n[5].default,Sn=function(n,a,s,t){if(n){const e=p(n,a,s,t);return n[0](e)}}(In,n,n[4],null);return un=new an({}),hn=new tn({}),{c(){s=k("meta"),t=k("meta"),e=k("meta"),o=k("meta"),c=k("meta"),f=k("meta"),S=k("meta"),T=k("meta"),P=k("meta"),A=k("meta"),O=k("meta");for(let n=0;n<vn.length;n+=1)vn[n].c();x=k("meta"),L=k("meta"),j=g(),N=g(),R=m(),M=k("a"),W=d("Skip to content"),F=m(),U(H.$$.fragment),J=m(),z=k("main"),V=k("h1"),K=d(n[0]),Z=m();for(let n=0;n<bn.length;n+=1)bn[n].c();X=m(),nn=k("article"),Sn&&Sn.c(),sn=m(),rn=k("footer"),U(un.$$.fragment),ln=m(),U(hn.$$.fragment),kn=m(),dn=g(),this.h()},l(a){const p=function(n,a=document.body){return Array.from(a.querySelectorAll(n))}('[data-svelte="svelte-n0q11s"]',document.head);s=v(p,"META",{name:!0,content:!0}),t=v(p,"META",{name:!0,content:!0}),e=v(p,"META",{name:!0,content:!0}),o=v(p,"META",{name:!0,content:!0}),c=v(p,"META",{name:!0,content:!0}),f=v(p,"META",{name:!0,content:!0}),S=v(p,"META",{name:!0,content:!0}),T=v(p,"META",{name:!0,content:!0}),P=v(p,"META",{name:!0,content:!0}),A=v(p,"META",{name:!0,content:!0}),O=v(p,"META",{name:!0,content:!0});for(let n=0;n<vn.length;n+=1)vn[n].l(p);x=v(p,"META",{itemprop:!0,content:!0}),L=v(p,"META",{itemprop:!0,content:!0}),j=g(),N=g(),p.forEach(l),R=b(a),M=v(a,"A",{href:!0,class:!0});var i=y(M);W=E(i,"Skip to content"),i.forEach(l),F=b(a),G(H.$$.fragment,a),J=b(a),z=v(a,"MAIN",{id:!0,class:!0});var r=y(z);V=v(r,"H1",{});var u=y(V);K=E(u,n[0]),u.forEach(l),Z=b(r);for(let n=0;n<bn.length;n+=1)bn[n].l(r);X=b(r),nn=v(r,"ARTICLE",{});var h=y(nn);Sn&&Sn.l(h),h.forEach(l),r.forEach(l),sn=b(a),rn=v(a,"FOOTER",{class:!0});var k=y(rn);G(un.$$.fragment,k),ln=b(k),G(hn.$$.fragment,k),k.forEach(l),kn=b(a),dn=g(),this.h()},h(){w(s,"name","description"),w(s,"content",n[1]),w(t,"name","image"),w(t,"content",null),w(e,"name","og:image"),w(e,"content",null),w(o,"name","og:title"),w(o,"content",n[0]),w(c,"name","og:description"),w(c,"content",n[1]),w(f,"name","og:type"),w(f,"content","website"),w(S,"name","twitter:card"),w(S,"content","summary_large_image"),w(T,"name","twitter:creator"),w(T,"content","@lihautan"),w(P,"name","twitter:title"),w(P,"content",n[0]),w(A,"name","twitter:description"),w(A,"content",n[1]),w(O,"name","twitter:image"),w(O,"content",null),w(x,"itemprop","url"),w(x,"content","https%3A%2F%2Flihautan.com%2Fpause-and-resume-a-javascript-function"),w(L,"itemprop","image"),w(L,"content",null),C=new $(j),D=new $(N),w(M,"href","#content"),w(M,"class","skip svelte-9tqnza"),w(z,"id","content"),w(z,"class","blog svelte-9tqnza"),w(rn,"class","svelte-9tqnza"),fn=new $(dn)},m(n,a){r(document.head,s),r(document.head,t),r(document.head,e),r(document.head,o),r(document.head,c),r(document.head,f),r(document.head,S),r(document.head,T),r(document.head,P),r(document.head,A),r(document.head,O);for(let n=0;n<vn.length;n+=1)vn[n].m(document.head,null);r(document.head,x),r(document.head,L),C.m(gn,document.head),r(document.head,j),D.m(wn,document.head),r(document.head,N),u(n,R,a),u(n,M,a),r(M,W),u(n,F,a),Y(H,n,a),u(n,J,a),u(n,z,a),r(z,V),r(V,K),r(z,Z);for(let n=0;n<bn.length;n+=1)bn[n].m(z,null);r(z,X),r(z,nn),Sn&&Sn.m(nn,null),u(n,sn,a),u(n,rn,a),Y(un,rn,null),r(rn,ln),Y(hn,rn,null),u(n,kn,a),fn.m('<script async defer src="https://platform.twitter.com/widgets.js" charset="utf-8"><\/script>',n,a),u(n,dn,a),mn=!0},p(n,[t]){if((!mn||1&t)&&a!==(a=n[0]+" | Tan Li Hau")&&(document.title=a),(!mn||2&t)&&w(s,"content",n[1]),(!mn||1&t)&&w(o,"content",n[0]),(!mn||2&t)&&w(c,"content",n[1]),(!mn||1&t)&&w(P,"content",n[0]),(!mn||2&t)&&w(A,"content",n[1]),4&t){let a;for(yn=n[2],a=0;a<yn.length;a+=1){const s=on(n,yn,a);vn[a]?vn[a].p(s,t):(vn[a]=cn(s),vn[a].c(),vn[a].m(x.parentNode,x))}for(;a<vn.length;a+=1)vn[a].d(1);vn.length=yn.length}if((!mn||3&t)&&gn!==(gn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"Article",author:n[3],copyrightHolder:n[3],copyrightYear:"2020",creator:n[3],publisher:n[3],description:n[1],headline:n[0],name:n[0],inLanguage:"en"})}<\/script>`)&&C.p(gn),(!mn||1&t)&&wn!==(wn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"BreadcrumbList",description:"Breadcrumbs list",name:"Breadcrumbs",itemListElement:[{"@type":"ListItem",item:{"@id":"https://lihautan.com",name:"Homepage"},position:1},{"@type":"ListItem",item:{"@id":"https%3A%2F%2Flihautan.com%2Fpause-and-resume-a-javascript-function",name:n[0]},position:2}]})}<\/script>`)&&D.p(wn),(!mn||1&t)&&I(K,n[0]),4&t){let a;for(En=n[2],a=0;a<En.length;a+=1){const s=en(n,En,a);bn[a]?bn[a].p(s,t):(bn[a]=pn(s),bn[a].c(),bn[a].m(z,X))}for(;a<bn.length;a+=1)bn[a].d(1);bn.length=En.length}Sn&&Sn.p&&16&t&&i(Sn,In,n,n[4],t,null,null)},i(n){mn||(_(H.$$.fragment,n),_(Sn,n),_(un.$$.fragment,n),_(hn.$$.fragment,n),mn=!0)},o(n){B(H.$$.fragment,n),B(Sn,n),B(un.$$.fragment,n),B(hn.$$.fragment,n),mn=!1},d(n){l(s),l(t),l(e),l(o),l(c),l(f),l(S),l(T),l(P),l(A),l(O),h(vn,n),l(x),l(L),l(j),n&&C.d(),l(N),n&&D.d(),n&&l(R),n&&l(M),n&&l(F),q(H,n),n&&l(J),n&&l(z),h(bn,n),Sn&&Sn.d(n),n&&l(sn),n&&l(rn),q(un),q(hn),n&&l(kn),n&&l(dn),n&&fn.d()}}}function un(n,a,s){let{title:t=""}=a,{description:e=""}=a,{tags:o=[]}=a;const c={"@type":"Person",name:"Tan Li Hau"};let{$$slots:p={},$$scope:i}=a;return n.$set=n=>{"title"in n&&s(0,t=n.title),"description"in n&&s(1,e=n.description),"tags"in n&&s(2,o=n.tags),"$$scope"in n&&s(4,i=n.$$scope)},[t,e,o,c,i,p]}class ln extends K{constructor(n){super(),V(this,n,un,rn,c,{title:0,description:1,tags:2})}}function hn(a){let s,t,e,o,c,p,i,h,f,g,I,S,$,P,A,O,x,L,C,j,D,N,R,M,W,F,H,J,_,B,U,G,Y,q,z,V,K,Z,Q,X,nn,an,sn,tn,en,on,cn,pn,rn,un,ln,hn,kn,fn,dn,mn,gn,wn,yn,vn,En,bn,In,Sn,Tn,$n,Pn,An,On,xn,Ln,Cn,jn,Dn,Nn,Rn,Mn,Wn,Fn,Hn,Jn,_n,Bn,Un,Gn,Yn,qn,zn,Vn,Kn,Zn,Qn,Xn,na,aa,sa,ta,ea,oa,ca,pa,ia,ra,ua,la,ha,ka,fa,da,ma,ga,wa,ya,va,Ea,ba,Ia,Sa,Ta,$a,Pa,Aa,Oa,xa,La,Ca,ja,Da,Na,Ra,Ma,Wa,Fa,Ha,Ja,_a,Ba,Ua,Ga,Ya,qa,za,Va,Ka,Za,Qa,Xa,ns,as,ss,ts,es,os,cs,ps,is,rs,us,ls,hs,ks,fs,ds,ms,gs,ws,ys,vs,Es,bs,Is,Ss,Ts,$s,Ps,As,Os,xs,Ls,Cs,js,Ds,Ns,Rs,Ms,Ws,Fs,Hs,Js,_s,Bs,Us,Gs,Ys,qs,zs,Vs,Ks,Zs,Qs,Xs,nt,at,st,tt,et,ot,ct,pt,it,rt,ut,lt,ht,kt,ft,dt,mt,gt,wt,yt,vt,Et,bt,It,St,Tt,$t,Pt,At,Ot,xt,Lt,Ct,jt,Dt,Nt,Rt,Mt,Wt,Ft,Ht,Jt,_t,Bt,Ut,Gt,Yt,qt,zt,Vt,Kt,Zt,Qt,Xt,ne,ae,se,te,ee,oe,ce,pe,ie,re,ue,le,he,ke,fe,de,me,ge,we,ye,ve,Ee,be,Ie,Se,Te,$e,Pe,Ae,Oe,xe,Le,Ce,je,De,Ne,Re,Me,We,Fe,He,Je,_e,Be,Ue,Ge,Ye,qe,ze,Ve,Ke,Ze,Qe,Xe,no,ao,so,to,eo,oo,co,po,io,ro,uo,lo,ho,ko,fo,mo,go,wo,yo,vo,Eo,bo,Io,So,To,$o,Po,Ao,Oo,xo,Lo,Co,jo,Do,No,Ro,Mo,Wo,Fo,Ho,Jo,_o,Bo,Uo,Go,Yo,qo,zo,Vo,Ko,Zo,Qo,Xo,nc,ac,sc,tc,ec,oc,cc,pc,ic,rc,uc,lc,hc,kc,fc,dc,mc,gc,wc,yc,vc,Ec,bc,Ic,Sc,Tc,$c,Pc,Ac,Oc,xc,Lc,Cc,jc;return{c(){s=k("section"),t=k("ul"),e=k("ul"),o=k("li"),c=k("a"),p=d("Every function has a color"),i=k("li"),h=k("a"),f=d('Writing "the runtime"'),g=k("ul"),I=k("li"),S=k("a"),$=d("The first constraint: entry point"),P=k("li"),A=k("a"),O=k("li"),x=k("a"),L=d("What have we done so far?"),C=k("li"),j=k("a"),D=d("Okay cool. Why are we doing this?"),N=k("ul"),R=k("li"),M=k("a"),W=d("Yet, this is not Suspense."),F=k("li"),H=k("a"),J=d("Closing Note"),_=m(),B=k("p"),U=d("In JavaScript, IO (eg Filesystem IO, Network IO) is "),G=k("strong"),Y=d("asynchronous"),q=d(". That means when you are calling a function that involves IO, you got to have a callback function passed in to be notified when the IO is done."),z=m(),V=k("pre"),K=m(),Z=k("p"),Q=d("It may seemed innocent at first, but once we start to chain multiple asynchronous calls, we end up in a situation known as the "),X=k("strong"),nn=d("callback hell"),an=d(", which without a doubt, is something really not nice to work with:"),sn=m(),tn=k("pre"),en=m(),on=k("p"),cn=d("So we came up with "),pn=k("a"),rn=d("Promise"),un=d(" and "),ln=k("a"),hn=k("code"),kn=d("async-await"),fn=d(", to make life easier."),dn=m(),mn=k("p"),gn=k("code"),wn=d("async-await"),yn=d(" allows us to write asynchronous code like a synchronous one, using "),vn=k("code"),En=d("await"),bn=d(", you can pause the function, wait for the IO, and continue the execution."),In=m(),Sn=k("pre"),Tn=m(),$n=k("p"),Pn=d("What's more, you can catch all the error at once, magical right?"),An=m(),On=k("section"),xn=k("h3"),Ln=k("a"),Cn=d("Every function has a color"),jn=m(),Dn=k("p"),Nn=d("Still, "),Rn=k("code"),Mn=d("async-await"),Wn=d(" has its short-coming. Things go wrong when you forgot to use "),Fn=k("code"),Hn=d("await"),Jn=d("."),_n=m(),Bn=k("p"),Un=d("This could happen if you didn't know the implementation detail of "),Gn=k("code"),Yn=d("getProfile"),qn=d(" where "),zn=k("code"),Vn=d("getProfile"),Kn=d(" is asynchronous, because it makes an asynchronous IO call."),Zn=m(),Qn=k("p"),Xn=d("This leads to another problem, which is "),na=k("a"),aa=d("every function has a color"),sa=d(". As soon as you make an asynchronous call in a function, you have to make the function itself asynchronous, and the caller of this function to be asynchronous, and its caller too, ...!"),ta=m(),ea=k("p"),oa=d("So, is there another way to pause a JavaScript function, without having to "),ca=k("code"),pa=d("await"),ia=d("?"),ra=m(),ua=k("pre"),la=m(),ha=k("p"),ka=d('This would be arguably much simpler, making everything seemingly "synchronous".'),fa=m(),da=k("p"),ma=d("So, is this possible?"),ga=m(),wa=k("p"),ya=d("To be able to pause a JavaScript function, is something decided in the JavaScript runtime."),va=m(),Ea=k("p"),ba=k("strong"),Ia=d("So are we diving into the JavaScript runtime engine today?"),Sa=m(),Ta=k("p"),$a=d("Not really, I don't know much about C++ or whatever language the JavaScript runtime is implemented. 🙈"),Pa=m(),Aa=k("p"),Oa=d("But we are going to write a simple runtime in JavaScript, with some constraints. "),xa=k("em"),La=d("(Come on, it is hard to write a full blown runtime, adding constraints will make it easier for me to finish it in one blog post)"),Ca=m(),ja=k("section"),Da=k("h2"),Na=k("a"),Ra=d('Writing "the runtime"'),Ma=m(),Wa=k("section"),Fa=k("h3"),Ha=k("a"),Ja=d("The first constraint: entry point"),_a=m(),Ba=k("p"),Ua=d("The first constraint for the runtime, is to have an entry point."),Ga=m(),Ya=k("p"),qa=d("In our case, we are going to make "),za=k("code"),Va=d("main"),Ka=d(" our entry point:"),Za=m(),Qa=k("pre"),Xa=m(),ns=k("p"),as=d("So our runtime looks something like this:"),ss=m(),ts=k("pre"),es=m(),os=k("p"),cs=d("Ok, so we have our basic structure, what's next?"),ps=m(),is=k("p"),rs=d("Firstly, we need to figure how to pause a JS function midway, without using "),us=k("code"),ls=d("await"),hs=d("."),ks=m(),fs=k("p"),ds=d("Well, there's "),ms=k("code"),gs=d("throw"),ws=d(" or "),ys=k("code"),vs=d("return"),Es=d(", which is able to exit the JS function midway. I gonna choose "),bs=k("code"),Is=d("throw"),Ss=d(', which is more suited to exit the function "unexpectedly", rather than '),Ts=k("code"),$s=d("return"),Ps=d(" which is more for exit normally:"),As=m(),Os=k("pre"),xs=m(),Ls=k("p"),Cs=d('But in both cases, there\'s no way to "resume" the function. However, it is still a good starting point.'),js=m(),Ds=k("p"),Ns=d('One way of "resuming" the function is to rerun the '),Rs=k("code"),Ms=d("main"),Ws=d(" function again."),Fs=m(),Hs=k("pre"),Js=m(),_s=k("p"),Bs=d("Ignore all the doubts you have for why rerunning the entire "),Us=k("code"),Gs=d("main"),Ys=d(' function is a bad idea for "resuming" the function for now.'),qs=m(),zs=k("p"),Vs=d('The current implementation is inaccurate, and will lead us to an infinite loop, because we "resumed" the "paused" function immediately, which should be only after the '),Ks=k("code"),Zs=d("window.fetch"),Qs=d(" had succeeded:"),Xs=m(),nt=k("pre"),at=m(),st=k("p"),tt=d("Still the infinite-loop still happened, that's because "),et=k("code"),ot=d("window.fetch"),ct=d(' should return the response object when "resumed":'),pt=m(),it=k("pre"),rt=m(),ut=k("p"),lt=d("How do we throw Error when the "),ht=k("code"),kt=d("fetch"),ft=d(" is called the 1st time, and return the response for the subsequent calls?"),dt=m(),mt=k("p"),gt=d("One can achieve it by caching the response:"),wt=m(),yt=k("pre"),vt=m(),Et=k("p"),bt=d("It works!"),It=m(),St=k("p"),Tt=d('After running the main function a few times, by "pausing" and "resuming", or shall I say, "early exit" and "rerun", we finally hit the last statement of the main function and finish the function.'),$t=m(),Pt=k("p"),At=d("Except, if you look at the console, because of rerunning multiple times, we see the "),Ot=k("code"),xt=d('"Getting wedding: 123"'),Lt=d(" multiple times!"),Ct=m(),jt=k("p"),Dt=d("That is because, "),Nt=k("code"),Rt=d("console.log"),Mt=d(" has side effects!"),Wt=m(),Ft=k("section"),Ht=k("h3"),Jt=k("a"),_t=k("strong"),Bt=d("The second constraint: pure functions"),Ut=m(),Gt=k("p"),Yt=d("The second constraint of our runtime is to use only pure functions. If you wish to call functions with side effects, you have to use our special construct, "),qt=k("code"),zt=d("runSideEffects()"),Vt=d(":"),Kt=m(),Zt=k("pre"),Qt=m(),Xt=k("p"),ne=d("So, how is "),ae=k("code"),se=d("runSideEffects"),te=d(" implemented?"),ee=m(),oe=k("pre"),ce=m(),pe=k("p"),ie=d("What we are trying to do here is that, we push all the side effects into an array, and only run all of them when we finally finish our "),re=k("code"),ue=d("main"),le=d(" function."),he=m(),ke=k("p"),fe=d('And if we "paused" our function, before rerunning the '),de=k("code"),me=d("main"),ge=d(' function to "resume", we clear all the side effects, since the same side effects will be pushed into the array again.'),we=m(),ye=k("p"),ve=d("Run it again, and yes it works!"),Ee=m(),be=k("p"),Ie=d("You can try out the complete code in the CodeSandbox:"),Se=m(),Te=k("iframe"),Pe=m(),Ae=k("section"),Oe=k("h2"),xe=k("a"),Le=d("What have we done so far?"),Ce=m(),je=k("p"),De=d('To mimic a pause and resume a function in JavaScript, we can throw an error to "pause" the execution of the function halfway, and "resume" it by reruning the function.'),Ne=m(),Re=k("p"),Me=d('To "resuming" from where it left off, the point of where we threw an error should now returning a value instead, so that it feels like we are picking up and resuming from that point. To achieve this, we can use some caching mechanism.'),We=m(),Fe=k("p"),He=d("Lastly, to safely reruning the function multiple times, we need to make sure that the function is pure. If we have side effects, we need to collect them and only apply them when the function has successfully reach the end."),Je=m(),_e=k("section"),Be=k("h2"),Ue=k("a"),Ge=d("Okay cool. Why are we doing this?"),Ye=m(),qe=k("p"),ze=d("Well, the idea of how to pause and resume a JavaScript function comes when I was reading about "),Ve=k("a"),Ke=d("React Suspense"),Ze=d(". With Suspense, fetching / getting data can be written declaratively:"),Qe=m(),Xe=k("pre"),no=m(),ao=k("p"),so=k("code"),to=d("getDataFromNetwork"),eo=d(" will get actually get the data from the network, which is asynchronous, but how did React make it look like it is synchronous?"),oo=m(),co=k("p"),po=d("Think of how you would have written in React:"),io=m(),ro=k("ul"),uo=k("li"),lo=d("Instead of providing an entry point, your "),ho=k("code"),ko=d("render"),fo=d(' function is the entry point for React. To "resume" each "pause" the render, React calls the '),mo=k("code"),go=d("render"),wo=d(" function multiple times."),yo=m(),vo=k("li"),Eo=d("Your render function has to be pure and side-effects free"),bo=m(),Io=k("li"),So=d("To "),To=k("code"),$o=d("runSideEffects"),Po=d(", you use "),Ao=k("code"),Oo=d("React.useEffect"),xo=d(" instead."),Lo=m(),Co=k("li"),jo=d("To fetch + cache, you use "),Do=k("code"),No=d("react-cache"),Ro=d(" to create a resource."),Mo=m(),Wo=k("li"),Fo=d('Except, instead of "pause" and do nothing, React handles the "pause" with the nearest '),Ho=k("code"),Jo=d("<Suspense />"),_o=d(' componnet to render some fallback content. When the promise is resolve, React "resumes" the render and render the content with the data.'),Bo=m(),Uo=k("section"),Go=k("h3"),Yo=k("a"),qo=d("Yet, this is not Suspense."),zo=m(),Vo=k("p"),Ko=d("No, I dont think so."),Zo=m(),Qo=k("p"),Xo=d('Suspense is based on some function programming concept, called the "one-shot delimited continuation", which is explained in Dan Abramov\'s '),nc=k("a"),ac=d('"Algebraic Effects for the Rest of Us"'),sc=d("."),tc=m(),ec=k("section"),oc=k("h2"),cc=k("a"),pc=d("Closing Note"),ic=m(),rc=k("p"),uc=d("This whole article is based on a thought experiment I had when I was trying to understand the mechanics of "),lc=k("a"),hc=d("React Suspense"),kc=d(". So, pardon me if the flow of the content is a bit awkward or crude."),fc=m(),dc=k("p"),mc=d('Yet, after writing my thought process out, I did more research, and realised that "pausing and resuming execution" is a concept called '),gc=k("a"),wc=d('"continuations"'),yc=d(" in functional programming."),vc=m(),Ec=k("p"),bc=d("So, if you are interested to learn more, here are some starting points:"),Ic=m(),Sc=k("ul"),Tc=k("li"),$c=d("James Long's "),Pc=k("a"),Ac=d("What's in a Continuation"),Oc=m(),xc=k("li"),Lc=d("Florian Loitsch's "),Cc=k("a"),jc=d("Exceptional Continuations in JavaScript"),this.h()},l(n){s=v(n,"SECTION",{});var a=y(s);t=v(a,"UL",{class:!0,id:!0,role:!0,"aria-label":!0});var r=y(t);e=v(r,"UL",{});var u=y(e);o=v(u,"LI",{});var k=y(o);c=v(k,"A",{href:!0});var d=y(c);p=E(d,"Every function has a color"),d.forEach(l),k.forEach(l),u.forEach(l),i=v(r,"LI",{});var m=y(i);h=v(m,"A",{href:!0});var w=y(h);f=E(w,'Writing "the runtime"'),w.forEach(l),m.forEach(l),g=v(r,"UL",{});var T=y(g);I=v(T,"LI",{});var $e=y(I);S=v($e,"A",{href:!0});var Dc=y(S);$=E(Dc,"The first constraint: entry point"),Dc.forEach(l),$e.forEach(l),P=v(T,"LI",{});var Nc=y(P);A=v(Nc,"A",{href:!0}),y(A).forEach(l),Nc.forEach(l),T.forEach(l),O=v(r,"LI",{});var Rc=y(O);x=v(Rc,"A",{href:!0});var Mc=y(x);L=E(Mc,"What have we done so far?"),Mc.forEach(l),Rc.forEach(l),C=v(r,"LI",{});var Wc=y(C);j=v(Wc,"A",{href:!0});var Fc=y(j);D=E(Fc,"Okay cool. Why are we doing this?"),Fc.forEach(l),Wc.forEach(l),N=v(r,"UL",{});var Hc=y(N);R=v(Hc,"LI",{});var Jc=y(R);M=v(Jc,"A",{href:!0});var _c=y(M);W=E(_c,"Yet, this is not Suspense."),_c.forEach(l),Jc.forEach(l),Hc.forEach(l),F=v(r,"LI",{});var Bc=y(F);H=v(Bc,"A",{href:!0});var Uc=y(H);J=E(Uc,"Closing Note"),Uc.forEach(l),Bc.forEach(l),r.forEach(l),a.forEach(l),_=b(n),B=v(n,"P",{});var Gc=y(B);U=E(Gc,"In JavaScript, IO (eg Filesystem IO, Network IO) is "),G=v(Gc,"STRONG",{});var Yc=y(G);Y=E(Yc,"asynchronous"),Yc.forEach(l),q=E(Gc,". That means when you are calling a function that involves IO, you got to have a callback function passed in to be notified when the IO is done."),Gc.forEach(l),z=b(n),V=v(n,"PRE",{class:!0}),y(V).forEach(l),K=b(n),Z=v(n,"P",{});var qc=y(Z);Q=E(qc,"It may seemed innocent at first, but once we start to chain multiple asynchronous calls, we end up in a situation known as the "),X=v(qc,"STRONG",{});var zc=y(X);nn=E(zc,"callback hell"),zc.forEach(l),an=E(qc,", which without a doubt, is something really not nice to work with:"),qc.forEach(l),sn=b(n),tn=v(n,"PRE",{class:!0}),y(tn).forEach(l),en=b(n),on=v(n,"P",{});var Vc=y(on);cn=E(Vc,"So we came up with "),pn=v(Vc,"A",{href:!0,rel:!0});var Kc=y(pn);rn=E(Kc,"Promise"),Kc.forEach(l),un=E(Vc," and "),ln=v(Vc,"A",{href:!0,rel:!0});var Zc=y(ln);hn=v(Zc,"CODE",{});var Qc=y(hn);kn=E(Qc,"async-await"),Qc.forEach(l),Zc.forEach(l),fn=E(Vc,", to make life easier."),Vc.forEach(l),dn=b(n),mn=v(n,"P",{});var Xc=y(mn);gn=v(Xc,"CODE",{});var np=y(gn);wn=E(np,"async-await"),np.forEach(l),yn=E(Xc," allows us to write asynchronous code like a synchronous one, using "),vn=v(Xc,"CODE",{});var ap=y(vn);En=E(ap,"await"),ap.forEach(l),bn=E(Xc,", you can pause the function, wait for the IO, and continue the execution."),Xc.forEach(l),In=b(n),Sn=v(n,"PRE",{class:!0}),y(Sn).forEach(l),Tn=b(n),$n=v(n,"P",{});var sp=y($n);Pn=E(sp,"What's more, you can catch all the error at once, magical right?"),sp.forEach(l),An=b(n),On=v(n,"SECTION",{});var tp=y(On);xn=v(tp,"H3",{});var ep=y(xn);Ln=v(ep,"A",{href:!0,id:!0});var op=y(Ln);Cn=E(op,"Every function has a color"),op.forEach(l),ep.forEach(l),jn=b(tp),Dn=v(tp,"P",{});var cp=y(Dn);Nn=E(cp,"Still, "),Rn=v(cp,"CODE",{});var pp=y(Rn);Mn=E(pp,"async-await"),pp.forEach(l),Wn=E(cp," has its short-coming. Things go wrong when you forgot to use "),Fn=v(cp,"CODE",{});var ip=y(Fn);Hn=E(ip,"await"),ip.forEach(l),Jn=E(cp,"."),cp.forEach(l),_n=b(tp),Bn=v(tp,"P",{});var rp=y(Bn);Un=E(rp,"This could happen if you didn't know the implementation detail of "),Gn=v(rp,"CODE",{});var up=y(Gn);Yn=E(up,"getProfile"),up.forEach(l),qn=E(rp," where "),zn=v(rp,"CODE",{});var lp=y(zn);Vn=E(lp,"getProfile"),lp.forEach(l),Kn=E(rp," is asynchronous, because it makes an asynchronous IO call."),rp.forEach(l),Zn=b(tp),Qn=v(tp,"P",{});var hp=y(Qn);Xn=E(hp,"This leads to another problem, which is "),na=v(hp,"A",{href:!0,rel:!0});var kp=y(na);aa=E(kp,"every function has a color"),kp.forEach(l),sa=E(hp,". As soon as you make an asynchronous call in a function, you have to make the function itself asynchronous, and the caller of this function to be asynchronous, and its caller too, ...!"),hp.forEach(l),ta=b(tp),ea=v(tp,"P",{});var fp=y(ea);oa=E(fp,"So, is there another way to pause a JavaScript function, without having to "),ca=v(fp,"CODE",{});var dp=y(ca);pa=E(dp,"await"),dp.forEach(l),ia=E(fp,"?"),fp.forEach(l),ra=b(tp),ua=v(tp,"PRE",{class:!0}),y(ua).forEach(l),la=b(tp),ha=v(tp,"P",{});var mp=y(ha);ka=E(mp,'This would be arguably much simpler, making everything seemingly "synchronous".'),mp.forEach(l),fa=b(tp),da=v(tp,"P",{});var gp=y(da);ma=E(gp,"So, is this possible?"),gp.forEach(l),ga=b(tp),wa=v(tp,"P",{});var wp=y(wa);ya=E(wp,"To be able to pause a JavaScript function, is something decided in the JavaScript runtime."),wp.forEach(l),va=b(tp),Ea=v(tp,"P",{});var yp=y(Ea);ba=v(yp,"STRONG",{});var vp=y(ba);Ia=E(vp,"So are we diving into the JavaScript runtime engine today?"),vp.forEach(l),yp.forEach(l),Sa=b(tp),Ta=v(tp,"P",{});var Ep=y(Ta);$a=E(Ep,"Not really, I don't know much about C++ or whatever language the JavaScript runtime is implemented. 🙈"),Ep.forEach(l),Pa=b(tp),Aa=v(tp,"P",{});var bp=y(Aa);Oa=E(bp,"But we are going to write a simple runtime in JavaScript, with some constraints. "),xa=v(bp,"EM",{});var Ip=y(xa);La=E(Ip,"(Come on, it is hard to write a full blown runtime, adding constraints will make it easier for me to finish it in one blog post)"),Ip.forEach(l),bp.forEach(l),tp.forEach(l),Ca=b(n),ja=v(n,"SECTION",{});var Sp=y(ja);Da=v(Sp,"H2",{});var Tp=y(Da);Na=v(Tp,"A",{href:!0,id:!0});var $p=y(Na);Ra=E($p,'Writing "the runtime"'),$p.forEach(l),Tp.forEach(l),Sp.forEach(l),Ma=b(n),Wa=v(n,"SECTION",{});var Pp=y(Wa);Fa=v(Pp,"H3",{});var Ap=y(Fa);Ha=v(Ap,"A",{href:!0,id:!0});var Op=y(Ha);Ja=E(Op,"The first constraint: entry point"),Op.forEach(l),Ap.forEach(l),_a=b(Pp),Ba=v(Pp,"P",{});var xp=y(Ba);Ua=E(xp,"The first constraint for the runtime, is to have an entry point."),xp.forEach(l),Ga=b(Pp),Ya=v(Pp,"P",{});var Lp=y(Ya);qa=E(Lp,"In our case, we are going to make "),za=v(Lp,"CODE",{});var Cp=y(za);Va=E(Cp,"main"),Cp.forEach(l),Ka=E(Lp," our entry point:"),Lp.forEach(l),Za=b(Pp),Qa=v(Pp,"PRE",{class:!0}),y(Qa).forEach(l),Xa=b(Pp),ns=v(Pp,"P",{});var jp=y(ns);as=E(jp,"So our runtime looks something like this:"),jp.forEach(l),ss=b(Pp),ts=v(Pp,"PRE",{class:!0}),y(ts).forEach(l),es=b(Pp),os=v(Pp,"P",{});var Dp=y(os);cs=E(Dp,"Ok, so we have our basic structure, what's next?"),Dp.forEach(l),ps=b(Pp),is=v(Pp,"P",{});var Np=y(is);rs=E(Np,"Firstly, we need to figure how to pause a JS function midway, without using "),us=v(Np,"CODE",{});var Rp=y(us);ls=E(Rp,"await"),Rp.forEach(l),hs=E(Np,"."),Np.forEach(l),ks=b(Pp),fs=v(Pp,"P",{});var Mp=y(fs);ds=E(Mp,"Well, there's "),ms=v(Mp,"CODE",{});var Wp=y(ms);gs=E(Wp,"throw"),Wp.forEach(l),ws=E(Mp," or "),ys=v(Mp,"CODE",{});var Fp=y(ys);vs=E(Fp,"return"),Fp.forEach(l),Es=E(Mp,", which is able to exit the JS function midway. I gonna choose "),bs=v(Mp,"CODE",{});var Hp=y(bs);Is=E(Hp,"throw"),Hp.forEach(l),Ss=E(Mp,', which is more suited to exit the function "unexpectedly", rather than '),Ts=v(Mp,"CODE",{});var Jp=y(Ts);$s=E(Jp,"return"),Jp.forEach(l),Ps=E(Mp," which is more for exit normally:"),Mp.forEach(l),As=b(Pp),Os=v(Pp,"PRE",{class:!0}),y(Os).forEach(l),xs=b(Pp),Ls=v(Pp,"P",{});var _p=y(Ls);Cs=E(_p,'But in both cases, there\'s no way to "resume" the function. However, it is still a good starting point.'),_p.forEach(l),js=b(Pp),Ds=v(Pp,"P",{});var Bp=y(Ds);Ns=E(Bp,'One way of "resuming" the function is to rerun the '),Rs=v(Bp,"CODE",{});var Up=y(Rs);Ms=E(Up,"main"),Up.forEach(l),Ws=E(Bp," function again."),Bp.forEach(l),Fs=b(Pp),Hs=v(Pp,"PRE",{class:!0}),y(Hs).forEach(l),Js=b(Pp),_s=v(Pp,"P",{});var Gp=y(_s);Bs=E(Gp,"Ignore all the doubts you have for why rerunning the entire "),Us=v(Gp,"CODE",{});var Yp=y(Us);Gs=E(Yp,"main"),Yp.forEach(l),Ys=E(Gp,' function is a bad idea for "resuming" the function for now.'),Gp.forEach(l),qs=b(Pp),zs=v(Pp,"P",{});var qp=y(zs);Vs=E(qp,'The current implementation is inaccurate, and will lead us to an infinite loop, because we "resumed" the "paused" function immediately, which should be only after the '),Ks=v(qp,"CODE",{});var zp=y(Ks);Zs=E(zp,"window.fetch"),zp.forEach(l),Qs=E(qp," had succeeded:"),qp.forEach(l),Xs=b(Pp),nt=v(Pp,"PRE",{class:!0}),y(nt).forEach(l),at=b(Pp),st=v(Pp,"P",{});var Vp=y(st);tt=E(Vp,"Still the infinite-loop still happened, that's because "),et=v(Vp,"CODE",{});var Kp=y(et);ot=E(Kp,"window.fetch"),Kp.forEach(l),ct=E(Vp,' should return the response object when "resumed":'),Vp.forEach(l),pt=b(Pp),it=v(Pp,"PRE",{class:!0}),y(it).forEach(l),rt=b(Pp),ut=v(Pp,"P",{});var Zp=y(ut);lt=E(Zp,"How do we throw Error when the "),ht=v(Zp,"CODE",{});var Qp=y(ht);kt=E(Qp,"fetch"),Qp.forEach(l),ft=E(Zp," is called the 1st time, and return the response for the subsequent calls?"),Zp.forEach(l),dt=b(Pp),mt=v(Pp,"P",{});var Xp=y(mt);gt=E(Xp,"One can achieve it by caching the response:"),Xp.forEach(l),wt=b(Pp),yt=v(Pp,"PRE",{class:!0}),y(yt).forEach(l),vt=b(Pp),Et=v(Pp,"P",{});var ni=y(Et);bt=E(ni,"It works!"),ni.forEach(l),It=b(Pp),St=v(Pp,"P",{});var ai=y(St);Tt=E(ai,'After running the main function a few times, by "pausing" and "resuming", or shall I say, "early exit" and "rerun", we finally hit the last statement of the main function and finish the function.'),ai.forEach(l),$t=b(Pp),Pt=v(Pp,"P",{});var si=y(Pt);At=E(si,"Except, if you look at the console, because of rerunning multiple times, we see the "),Ot=v(si,"CODE",{});var ti=y(Ot);xt=E(ti,'"Getting wedding: 123"'),ti.forEach(l),Lt=E(si," multiple times!"),si.forEach(l),Ct=b(Pp),jt=v(Pp,"P",{});var ei=y(jt);Dt=E(ei,"That is because, "),Nt=v(ei,"CODE",{});var oi=y(Nt);Rt=E(oi,"console.log"),oi.forEach(l),Mt=E(ei," has side effects!"),ei.forEach(l),Pp.forEach(l),Wt=b(n),Ft=v(n,"SECTION",{});var ci=y(Ft);Ht=v(ci,"H3",{});var pi=y(Ht);Jt=v(pi,"A",{href:!0,id:!0});var ii=y(Jt);_t=v(ii,"STRONG",{});var ri=y(_t);Bt=E(ri,"The second constraint: pure functions"),ri.forEach(l),ii.forEach(l),pi.forEach(l),Ut=b(ci),Gt=v(ci,"P",{});var ui=y(Gt);Yt=E(ui,"The second constraint of our runtime is to use only pure functions. If you wish to call functions with side effects, you have to use our special construct, "),qt=v(ui,"CODE",{});var li=y(qt);zt=E(li,"runSideEffects()"),li.forEach(l),Vt=E(ui,":"),ui.forEach(l),Kt=b(ci),Zt=v(ci,"PRE",{class:!0}),y(Zt).forEach(l),Qt=b(ci),Xt=v(ci,"P",{});var hi=y(Xt);ne=E(hi,"So, how is "),ae=v(hi,"CODE",{});var ki=y(ae);se=E(ki,"runSideEffects"),ki.forEach(l),te=E(hi," implemented?"),hi.forEach(l),ee=b(ci),oe=v(ci,"PRE",{class:!0}),y(oe).forEach(l),ce=b(ci),pe=v(ci,"P",{});var fi=y(pe);ie=E(fi,"What we are trying to do here is that, we push all the side effects into an array, and only run all of them when we finally finish our "),re=v(fi,"CODE",{});var di=y(re);ue=E(di,"main"),di.forEach(l),le=E(fi," function."),fi.forEach(l),he=b(ci),ke=v(ci,"P",{});var mi=y(ke);fe=E(mi,'And if we "paused" our function, before rerunning the '),de=v(mi,"CODE",{});var gi=y(de);me=E(gi,"main"),gi.forEach(l),ge=E(mi,' function to "resume", we clear all the side effects, since the same side effects will be pushed into the array again.'),mi.forEach(l),we=b(ci),ye=v(ci,"P",{});var wi=y(ye);ve=E(wi,"Run it again, and yes it works!"),wi.forEach(l),Ee=b(ci),be=v(ci,"P",{});var yi=y(be);Ie=E(yi,"You can try out the complete code in the CodeSandbox:"),yi.forEach(l),Se=b(ci),Te=v(ci,"IFRAME",{src:!0,style:!0,title:!0,allow:!0,sandbox:!0}),y(Te).forEach(l),ci.forEach(l),Pe=b(n),Ae=v(n,"SECTION",{});var vi=y(Ae);Oe=v(vi,"H2",{});var Ei=y(Oe);xe=v(Ei,"A",{href:!0,id:!0});var bi=y(xe);Le=E(bi,"What have we done so far?"),bi.forEach(l),Ei.forEach(l),Ce=b(vi),je=v(vi,"P",{});var Ii=y(je);De=E(Ii,'To mimic a pause and resume a function in JavaScript, we can throw an error to "pause" the execution of the function halfway, and "resume" it by reruning the function.'),Ii.forEach(l),Ne=b(vi),Re=v(vi,"P",{});var Si=y(Re);Me=E(Si,'To "resuming" from where it left off, the point of where we threw an error should now returning a value instead, so that it feels like we are picking up and resuming from that point. To achieve this, we can use some caching mechanism.'),Si.forEach(l),We=b(vi),Fe=v(vi,"P",{});var Ti=y(Fe);He=E(Ti,"Lastly, to safely reruning the function multiple times, we need to make sure that the function is pure. If we have side effects, we need to collect them and only apply them when the function has successfully reach the end."),Ti.forEach(l),vi.forEach(l),Je=b(n),_e=v(n,"SECTION",{});var $i=y(_e);Be=v($i,"H2",{});var Pi=y(Be);Ue=v(Pi,"A",{href:!0,id:!0});var Ai=y(Ue);Ge=E(Ai,"Okay cool. Why are we doing this?"),Ai.forEach(l),Pi.forEach(l),Ye=b($i),qe=v($i,"P",{});var Oi=y(qe);ze=E(Oi,"Well, the idea of how to pause and resume a JavaScript function comes when I was reading about "),Ve=v(Oi,"A",{href:!0,rel:!0});var xi=y(Ve);Ke=E(xi,"React Suspense"),xi.forEach(l),Ze=E(Oi,". With Suspense, fetching / getting data can be written declaratively:"),Oi.forEach(l),Qe=b($i),Xe=v($i,"PRE",{class:!0}),y(Xe).forEach(l),no=b($i),ao=v($i,"P",{});var Li=y(ao);so=v(Li,"CODE",{});var Ci=y(so);to=E(Ci,"getDataFromNetwork"),Ci.forEach(l),eo=E(Li," will get actually get the data from the network, which is asynchronous, but how did React make it look like it is synchronous?"),Li.forEach(l),oo=b($i),co=v($i,"P",{});var ji=y(co);po=E(ji,"Think of how you would have written in React:"),ji.forEach(l),io=b($i),ro=v($i,"UL",{});var Di=y(ro);uo=v(Di,"LI",{});var Ni=y(uo);lo=E(Ni,"Instead of providing an entry point, your "),ho=v(Ni,"CODE",{});var Ri=y(ho);ko=E(Ri,"render"),Ri.forEach(l),fo=E(Ni,' function is the entry point for React. To "resume" each "pause" the render, React calls the '),mo=v(Ni,"CODE",{});var Mi=y(mo);go=E(Mi,"render"),Mi.forEach(l),wo=E(Ni," function multiple times."),Ni.forEach(l),yo=b(Di),vo=v(Di,"LI",{});var Wi=y(vo);Eo=E(Wi,"Your render function has to be pure and side-effects free"),Wi.forEach(l),bo=b(Di),Io=v(Di,"LI",{});var Fi=y(Io);So=E(Fi,"To "),To=v(Fi,"CODE",{});var Hi=y(To);$o=E(Hi,"runSideEffects"),Hi.forEach(l),Po=E(Fi,", you use "),Ao=v(Fi,"CODE",{});var Ji=y(Ao);Oo=E(Ji,"React.useEffect"),Ji.forEach(l),xo=E(Fi," instead."),Fi.forEach(l),Lo=b(Di),Co=v(Di,"LI",{});var _i=y(Co);jo=E(_i,"To fetch + cache, you use "),Do=v(_i,"CODE",{});var Bi=y(Do);No=E(Bi,"react-cache"),Bi.forEach(l),Ro=E(_i," to create a resource."),_i.forEach(l),Mo=b(Di),Wo=v(Di,"LI",{});var Ui=y(Wo);Fo=E(Ui,'Except, instead of "pause" and do nothing, React handles the "pause" with the nearest '),Ho=v(Ui,"CODE",{});var Gi=y(Ho);Jo=E(Gi,"<Suspense />"),Gi.forEach(l),_o=E(Ui,' componnet to render some fallback content. When the promise is resolve, React "resumes" the render and render the content with the data.'),Ui.forEach(l),Di.forEach(l),$i.forEach(l),Bo=b(n),Uo=v(n,"SECTION",{});var Yi=y(Uo);Go=v(Yi,"H3",{});var qi=y(Go);Yo=v(qi,"A",{href:!0,id:!0});var zi=y(Yo);qo=E(zi,"Yet, this is not Suspense."),zi.forEach(l),qi.forEach(l),zo=b(Yi),Vo=v(Yi,"P",{});var Vi=y(Vo);Ko=E(Vi,"No, I dont think so."),Vi.forEach(l),Zo=b(Yi),Qo=v(Yi,"P",{});var Ki=y(Qo);Xo=E(Ki,'Suspense is based on some function programming concept, called the "one-shot delimited continuation", which is explained in Dan Abramov\'s '),nc=v(Ki,"A",{href:!0,rel:!0});var Zi=y(nc);ac=E(Zi,'"Algebraic Effects for the Rest of Us"'),Zi.forEach(l),sc=E(Ki,"."),Ki.forEach(l),Yi.forEach(l),tc=b(n),ec=v(n,"SECTION",{});var Qi=y(ec);oc=v(Qi,"H2",{});var Xi=y(oc);cc=v(Xi,"A",{href:!0,id:!0});var nr=y(cc);pc=E(nr,"Closing Note"),nr.forEach(l),Xi.forEach(l),ic=b(Qi),rc=v(Qi,"P",{});var ar=y(rc);uc=E(ar,"This whole article is based on a thought experiment I had when I was trying to understand the mechanics of "),lc=v(ar,"A",{href:!0,rel:!0});var sr=y(lc);hc=E(sr,"React Suspense"),sr.forEach(l),kc=E(ar,". So, pardon me if the flow of the content is a bit awkward or crude."),ar.forEach(l),fc=b(Qi),dc=v(Qi,"P",{});var tr=y(dc);mc=E(tr,'Yet, after writing my thought process out, I did more research, and realised that "pausing and resuming execution" is a concept called '),gc=v(tr,"A",{href:!0,rel:!0});var er=y(gc);wc=E(er,'"continuations"'),er.forEach(l),yc=E(tr," in functional programming."),tr.forEach(l),vc=b(Qi),Ec=v(Qi,"P",{});var or=y(Ec);bc=E(or,"So, if you are interested to learn more, here are some starting points:"),or.forEach(l),Ic=b(Qi),Sc=v(Qi,"UL",{});var cr=y(Sc);Tc=v(cr,"LI",{});var pr=y(Tc);$c=E(pr,"James Long's "),Pc=v(pr,"A",{href:!0,rel:!0});var ir=y(Pc);Ac=E(ir,"What's in a Continuation"),ir.forEach(l),pr.forEach(l),Oc=b(cr),xc=v(cr,"LI",{});var rr=y(xc);Lc=E(rr,"Florian Loitsch's "),Cc=v(rr,"A",{href:!0,rel:!0});var ur=y(Cc);jc=E(ur,"Exceptional Continuations in JavaScript"),ur.forEach(l),rr.forEach(l),cr.forEach(l),Qi.forEach(l),this.h()},h(){w(c,"href","#every-function-has-a-color"),w(h,"href","#writing-the-runtime"),w(S,"href","#the-first-constraint-entry-point"),w(A,"href","#"),w(x,"href","#what-have-we-done-so-far"),w(j,"href","#okay-cool-why-are-we-doing-this"),w(M,"href","#yet-this-is-not-suspense"),w(H,"href","#closing-note"),w(t,"class","sitemap"),w(t,"id","sitemap"),w(t,"role","navigation"),w(t,"aria-label","Table of Contents"),w(V,"class","language-js"),w(tn,"class","language-js"),w(pn,"href","https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"),w(pn,"rel","nofollow"),w(ln,"href","https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function"),w(ln,"rel","nofollow"),w(Sn,"class","language-js"),w(Ln,"href","#every-function-has-a-color"),w(Ln,"id","every-function-has-a-color"),w(na,"href","https://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/"),w(na,"rel","nofollow"),w(ua,"class","language-js"),w(Na,"href","#writing-the-runtime"),w(Na,"id","writing-the-runtime"),w(Ha,"href","#the-first-constraint-entry-point"),w(Ha,"id","the-first-constraint-entry-point"),w(Qa,"class","language-js"),w(ts,"class","language-js"),w(Os,"class","language-js"),w(Hs,"class","language-js"),w(nt,"class","language-js"),w(it,"class","language-js"),w(yt,"class","language-js"),w(Jt,"href","#"),w(Jt,"id",""),w(Zt,"class","language-js"),w(oe,"class","language-js"),Te.src!==($e="https://codesandbox.io/embed/pausing-a-javascript-function-dh0mw?expanddevtools=1&fontsize=14&hidenavigation=1&theme=dark&view=editor")&&w(Te,"src","https://codesandbox.io/embed/pausing-a-javascript-function-dh0mw?expanddevtools=1&fontsize=14&hidenavigation=1&theme=dark&view=editor"),T(Te,"width","100%"),T(Te,"height","500px"),T(Te,"border","0"),T(Te,"border-radius","4px"),T(Te,"overflow","hidden"),w(Te,"title","Pausing a JavaScript function"),w(Te,"allow","geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb"),w(Te,"sandbox","allow-modals allow-forms allow-popups allow-scripts allow-same-origin"),w(xe,"href","#what-have-we-done-so-far"),w(xe,"id","what-have-we-done-so-far"),w(Ue,"href","#okay-cool-why-are-we-doing-this"),w(Ue,"id","okay-cool-why-are-we-doing-this"),w(Ve,"href","https://reactjs.org/docs/concurrent-mode-suspense.html#what-suspense-lets-you-do"),w(Ve,"rel","nofollow"),w(Xe,"class","language-js"),w(Yo,"href","#yet-this-is-not-suspense"),w(Yo,"id","yet-this-is-not-suspense"),w(nc,"href","https://overreacted.io/algebraic-effects-for-the-rest-of-us/"),w(nc,"rel","nofollow"),w(cc,"href","#closing-note"),w(cc,"id","closing-note"),w(lc,"href","https://reactjs.org/docs/concurrent-mode-suspense.html"),w(lc,"rel","nofollow"),w(gc,"href","https://en.wikipedia.org/wiki/Continuation"),w(gc,"rel","nofollow"),w(Pc,"href","https://jlongster.com/Whats-in-a-Continuation"),w(Pc,"rel","nofollow"),w(Cc,"href","http://www.schemeworkshop.org/2007/procPaper4.pdf"),w(Cc,"rel","nofollow")},m(n,a){u(n,s,a),r(s,t),r(t,e),r(e,o),r(o,c),r(c,p),r(t,i),r(i,h),r(h,f),r(t,g),r(g,I),r(I,S),r(S,$),r(g,P),r(P,A),r(t,O),r(O,x),r(x,L),r(t,C),r(C,j),r(j,D),r(t,N),r(N,R),r(R,M),r(M,W),r(t,F),r(F,H),r(H,J),u(n,_,a),u(n,B,a),r(B,U),r(B,G),r(G,Y),r(B,q),u(n,z,a),u(n,V,a),V.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">getWeddingDetail</span><span class="token punctuation">(</span><span class="token parameter">itemId<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// call IO</span>\n  window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">https://api.com/wedding/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>itemId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span>\n    <span class="token parameter">error<span class="token punctuation">,</span>\n    wedding</span>\n  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// get notified when the result is back</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">callback</span><span class="token punctuation">(</span>wedding<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',u(n,K,a),u(n,Z,a),r(Z,Q),r(Z,X),r(X,nn),r(Z,an),u(n,sn,a),u(n,tn,a),tn.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">getProfile</span><span class="token punctuation">(</span><span class="token parameter">userId<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">https://api.com/user/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>userId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token keyword">function</span> <span class="token function">getWeddingDetail</span><span class="token punctuation">(</span><span class="token parameter">itemId<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// call IO</span>\n  window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">https://api.com/wedding/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>itemId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span>\n    <span class="token parameter">error<span class="token punctuation">,</span>\n    wedding</span>\n  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// get notified when the result is back</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">getProfile</span><span class="token punctuation">(</span>wedding<span class="token punctuation">.</span>groomId<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">groomError<span class="token punctuation">,</span> groom</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>groomError<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n          <span class="token function">handleError</span><span class="token punctuation">(</span>groomError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n          <span class="token function">getProfile</span><span class="token punctuation">(</span>wedding<span class="token punctuation">.</span>brideId<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">brideError<span class="token punctuation">,</span> bride</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>brideError<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n              <span class="token function">handleError</span><span class="token punctuation">(</span>brideError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> wedding<span class="token punctuation">,</span> bride<span class="token punctuation">,</span> groom <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">&#125;</span>\n          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">&#125;</span>\n      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',u(n,en,a),u(n,on,a),r(on,cn),r(on,pn),r(pn,rn),r(on,un),r(on,ln),r(ln,hn),r(hn,kn),r(on,fn),u(n,dn,a),u(n,mn,a),r(mn,gn),r(gn,wn),r(mn,yn),r(mn,vn),r(vn,En),r(mn,bn),u(n,In,a),u(n,Sn,a),Sn.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">getProfile</span><span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">https://api.com/user/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>userId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getWeddingDetail</span><span class="token punctuation">(</span><span class="token parameter">weddingId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// pause to get detail through IO</span>\n    <span class="token keyword">const</span> wedding <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">https://api.com/wedding/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>weddingId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// and resume when the result is back, and pause again...</span>\n    <span class="token keyword">const</span> groom <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getProfile</span><span class="token punctuation">(</span>wedding<span class="token punctuation">.</span>groomId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// ... and resume and pause ...</span>\n    <span class="token keyword">const</span> bride <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getProfile</span><span class="token punctuation">(</span>wedding<span class="token punctuation">.</span>brideId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// ... and resume</span>\n    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> wedding<span class="token punctuation">,</span> bride<span class="token punctuation">,</span> groom <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token function">handleError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',u(n,Tn,a),u(n,$n,a),r($n,Pn),u(n,An,a),u(n,On,a),r(On,xn),r(xn,Ln),r(Ln,Cn),r(On,jn),r(On,Dn),r(Dn,Nn),r(Dn,Rn),r(Rn,Mn),r(Dn,Wn),r(Dn,Fn),r(Fn,Hn),r(Dn,Jn),r(On,_n),r(On,Bn),r(Bn,Un),r(Bn,Gn),r(Gn,Yn),r(Bn,qn),r(Bn,zn),r(zn,Vn),r(Bn,Kn),r(On,Zn),r(On,Qn),r(Qn,Xn),r(Qn,na),r(na,aa),r(Qn,sa),r(On,ta),r(On,ea),r(ea,oa),r(ea,ca),r(ca,pa),r(ea,ia),r(On,ra),r(On,ua),ua.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">getWeddingDetail</span><span class="token punctuation">(</span><span class="token parameter">weddingId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// dont need await</span>\n  <span class="token keyword">const</span> wedding <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">https://api.com/wedding/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>weddingId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// &#96;getProfile&#96; could be synchronous or asynchronous</span>\n  <span class="token comment">// but &#96;getWeddingDetail&#96; shouldn\'t care</span>\n  <span class="token keyword">const</span> groom <span class="token operator">=</span> <span class="token function">getProfile</span><span class="token punctuation">(</span>wedding<span class="token punctuation">.</span>groomId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> bride <span class="token operator">=</span> <span class="token function">getProfile</span><span class="token punctuation">(</span>wedding<span class="token punctuation">.</span>brideId<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> wedding<span class="token punctuation">,</span> bride<span class="token punctuation">,</span> groom <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',r(On,la),r(On,ha),r(ha,ka),r(On,fa),r(On,da),r(da,ma),r(On,ga),r(On,wa),r(wa,ya),r(On,va),r(On,Ea),r(Ea,ba),r(ba,Ia),r(On,Sa),r(On,Ta),r(Ta,$a),r(On,Pa),r(On,Aa),r(Aa,Oa),r(Aa,xa),r(xa,La),u(n,Ca,a),u(n,ja,a),r(ja,Da),r(Da,Na),r(Na,Ra),u(n,Ma,a),u(n,Wa,a),r(Wa,Fa),r(Fa,Ha),r(Ha,Ja),r(Wa,_a),r(Wa,Ba),r(Ba,Ua),r(Wa,Ga),r(Wa,Ya),r(Ya,qa),r(Ya,za),r(za,Va),r(Ya,Ka),r(Wa,Za),r(Wa,Qa),Qa.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Getting wedding:\'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> wedding<span class="token punctuation">,</span> bride<span class="token punctuation">,</span> groom <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">getWeddingDetail</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Wedding detail:\'</span><span class="token punctuation">,</span> wedding<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',r(Wa,Xa),r(Wa,ns),r(ns,as),r(Wa,ss),r(Wa,ts),ts.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">runtime</span><span class="token punctuation">(</span><span class="token parameter">mainFn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// run our entry point</span>\n  <span class="token function">mainFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token comment">// start runtime</span>\n<span class="token function">runtime</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">;</span></code>',r(Wa,es),r(Wa,os),r(os,cs),r(Wa,ps),r(Wa,is),r(is,rs),r(is,us),r(us,ls),r(is,hs),r(Wa,ks),r(Wa,fs),r(fs,ds),r(fs,ms),r(ms,gs),r(fs,ws),r(fs,ys),r(ys,vs),r(fs,Es),r(fs,bs),r(bs,Is),r(fs,Ss),r(fs,Ts),r(Ts,$s),r(fs,Ps),r(Wa,As),r(Wa,Os),Os.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">runtime</span><span class="token punctuation">(</span><span class="token parameter">mainFn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// highlight-start</span>\n  <span class="token comment">// patch the &#96;window.fetch&#96; to make it "pause" the function</span>\n  <span class="token keyword">const</span> _originalFetch <span class="token operator">=</span> window<span class="token punctuation">.</span>fetch<span class="token punctuation">;</span>\n  window<span class="token punctuation">.</span><span class="token function-variable function">fetch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// "pause" the function</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// run our entry point</span>\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n    <span class="token function">mainFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// function "paused"</span>\n  <span class="token punctuation">&#125;</span>\n  <span class="token comment">// highlight-end</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token keyword">function</span> <span class="token function">getWeddingDetail</span><span class="token punctuation">(</span><span class="token parameter">weddingId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// calling &#96;window.fetch&#96; will "pause" the function and stop executing the next line.</span>\n  <span class="token keyword">const</span> wedding <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">https://api.com/wedding/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>weddingId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">&#125;</span></code>',r(Wa,xs),r(Wa,Ls),r(Ls,Cs),r(Wa,js),r(Wa,Ds),r(Ds,Ns),r(Ds,Rs),r(Rs,Ms),r(Ds,Ws),r(Wa,Fs),r(Wa,Hs),Hs.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">runtime</span><span class="token punctuation">(</span><span class="token parameter">mainFn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// patch the &#96;window.fetch&#96; to make it "pause" the function</span>\n  <span class="token keyword">const</span> _originalFetch <span class="token operator">=</span> window<span class="token punctuation">.</span>fetch<span class="token punctuation">;</span>\n  window<span class="token punctuation">.</span><span class="token function-variable function">fetch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// "pause" the function</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// run our entry point</span>\n  <span class="token keyword">function</span> <span class="token function">runMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">mainFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// function "paused"</span>\n      <span class="token comment">// highlight-start</span>\n      <span class="token comment">// resumed by rerun the &#96;mainFn&#96;</span>\n      <span class="token function">runMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// highlight-end</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n  <span class="token function">runMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',r(Wa,Js),r(Wa,_s),r(_s,Bs),r(_s,Us),r(Us,Gs),r(_s,Ys),r(Wa,qs),r(Wa,zs),r(zs,Vs),r(zs,Ks),r(Ks,Zs),r(zs,Qs),r(Wa,Xs),r(Wa,nt),nt.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">runtime</span><span class="token punctuation">(</span><span class="token parameter">mainFn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// patch the &#96;window.fetch&#96; to make it "pause" the function</span>\n  <span class="token keyword">const</span> _originalFetch <span class="token operator">=</span> window<span class="token punctuation">.</span>fetch<span class="token punctuation">;</span>\n  window<span class="token punctuation">.</span><span class="token function-variable function">fetch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    <span class="token function">_originalFetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// highlight-start</span>\n      <span class="token comment">// resume only when the result is back</span>\n      <span class="token function">runMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// highlight-end</span>\n    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// run our entry point</span>\n  <span class="token keyword">function</span> <span class="token function">runMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">mainFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// function "paused"</span>\n      <span class="token comment">// highlight-next-line</span>\n      <span class="token comment">// no rerun</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n  <span class="token function">runMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',r(Wa,at),r(Wa,st),r(st,tt),r(st,et),r(et,ot),r(st,ct),r(Wa,pt),r(Wa,it),it.innerHTML='<code class="language-js"><span class="token comment">// ...</span>\n<span class="token comment">// 1st time running &#96;getWeddingDetail&#96;</span>\n<span class="token comment">// call &#96;window.fetch&#96;, throw Error and "paused"</span>\n<span class="token keyword">const</span> wedding <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">https://api.com/wedding/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>weddingId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token comment">// when fetch response returns, rerun the main function</span>\n<span class="token comment">// 2nd time running &#96;getWeddingDetail&#96;</span>\n<span class="token comment">// call &#96;window.fetch&#96;, and should return the response to "resume"</span>\n<span class="token keyword">const</span> wedding <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">https://api.com/wedding/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>weddingId<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span></code>',r(Wa,rt),r(Wa,ut),r(ut,lt),r(ut,ht),r(ht,kt),r(ut,ft),r(Wa,dt),r(Wa,mt),r(mt,gt),r(Wa,wt),r(Wa,yt),yt.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">runtime</span><span class="token punctuation">(</span><span class="token parameter">mainFn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// patch the &#96;window.fetch&#96; to make it "pause" the function</span>\n  <span class="token keyword">const</span> _originalFetch <span class="token operator">=</span> window<span class="token punctuation">.</span>fetch<span class="token punctuation">;</span>\n  window<span class="token punctuation">.</span><span class="token function-variable function">fetch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// highlight-start</span>\n    <span class="token comment">// return immediately if response is cached.</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token punctuation">[</span>url<span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span>url<span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n\n    <span class="token function">_originalFetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n      cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>url<span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// resume only when the result is back</span>\n      <span class="token function">runMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// highlight-end</span>\n\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// run our entry point ...</span>\n<span class="token punctuation">&#125;</span></code>',r(Wa,vt),r(Wa,Et),r(Et,bt),r(Wa,It),r(Wa,St),r(St,Tt),r(Wa,$t),r(Wa,Pt),r(Pt,At),r(Pt,Ot),r(Ot,xt),r(Pt,Lt),r(Wa,Ct),r(Wa,jt),r(jt,Dt),r(jt,Nt),r(Nt,Rt),r(jt,Mt),u(n,Wt,a),u(n,Ft,a),r(Ft,Ht),r(Ht,Jt),r(Jt,_t),r(_t,Bt),r(Ft,Ut),r(Ft,Gt),r(Gt,Yt),r(Gt,qt),r(qt,zt),r(Gt,Vt),r(Ft,Kt),r(Ft,Zt),Zt.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>\n  <span class="token comment">// highlight-next-line</span>\n  <span class="token function">runSideEffects</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Getting wedding:\'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> wedding<span class="token punctuation">,</span> bride<span class="token punctuation">,</span> groom <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">getWeddingDetail</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// highlight-next-line</span>\n  <span class="token function">runSideEffects</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Wedding detail:\'</span><span class="token punctuation">,</span> wedding<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',r(Ft,Qt),r(Ft,Xt),r(Xt,ne),r(Xt,ae),r(ae,se),r(Xt,te),r(Ft,ee),r(Ft,oe),oe.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">runtime</span><span class="token punctuation">(</span><span class="token parameter">mainFn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// patch the &#96;window.fetch&#96; to make it "pause" the function...</span>\n\n  <span class="token comment">// highlight-start</span>\n  <span class="token comment">// provide &#96;runSideEffects&#96;</span>\n  <span class="token keyword">const</span> sideEffects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  window<span class="token punctuation">.</span><span class="token function-variable function">runSideEffects</span> <span class="token operator">=</span> <span class="token parameter">fn</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    sideEffects<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n  <span class="token comment">// highlight-end</span>\n\n  <span class="token comment">// run our entry point</span>\n  <span class="token keyword">function</span> <span class="token function">runMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">mainFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// highlight-next-line</span>\n      sideEffects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// highlight-start</span>\n      <span class="token comment">// clear side effects</span>\n      sideEffects<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> sideEffects<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// highlight-end</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n  <span class="token function">runMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',r(Ft,ce),r(Ft,pe),r(pe,ie),r(pe,re),r(re,ue),r(pe,le),r(Ft,he),r(Ft,ke),r(ke,fe),r(ke,de),r(de,me),r(ke,ge),r(Ft,we),r(Ft,ye),r(ye,ve),r(Ft,Ee),r(Ft,be),r(be,Ie),r(Ft,Se),r(Ft,Te),u(n,Pe,a),u(n,Ae,a),r(Ae,Oe),r(Oe,xe),r(xe,Le),r(Ae,Ce),r(Ae,je),r(je,De),r(Ae,Ne),r(Ae,Re),r(Re,Me),r(Ae,We),r(Ae,Fe),r(Fe,He),u(n,Je,a),u(n,_e,a),r(_e,Be),r(Be,Ue),r(Ue,Ge),r(_e,Ye),r(_e,qe),r(qe,ze),r(qe,Ve),r(Ve,Ke),r(qe,Ze),r(_e,Qe),r(_e,Xe),Xe.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">getDataFromNetwork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',r(_e,no),r(_e,ao),r(ao,so),r(so,to),r(ao,eo),r(_e,oo),r(_e,co),r(co,po),r(_e,io),r(_e,ro),r(ro,uo),r(uo,lo),r(uo,ho),r(ho,ko),r(uo,fo),r(uo,mo),r(mo,go),r(uo,wo),r(ro,yo),r(ro,vo),r(vo,Eo),r(ro,bo),r(ro,Io),r(Io,So),r(Io,To),r(To,$o),r(Io,Po),r(Io,Ao),r(Ao,Oo),r(Io,xo),r(ro,Lo),r(ro,Co),r(Co,jo),r(Co,Do),r(Do,No),r(Co,Ro),r(ro,Mo),r(ro,Wo),r(Wo,Fo),r(Wo,Ho),r(Ho,Jo),r(Wo,_o),u(n,Bo,a),u(n,Uo,a),r(Uo,Go),r(Go,Yo),r(Yo,qo),r(Uo,zo),r(Uo,Vo),r(Vo,Ko),r(Uo,Zo),r(Uo,Qo),r(Qo,Xo),r(Qo,nc),r(nc,ac),r(Qo,sc),u(n,tc,a),u(n,ec,a),r(ec,oc),r(oc,cc),r(cc,pc),r(ec,ic),r(ec,rc),r(rc,uc),r(rc,lc),r(lc,hc),r(rc,kc),r(ec,fc),r(ec,dc),r(dc,mc),r(dc,gc),r(gc,wc),r(dc,yc),r(ec,vc),r(ec,Ec),r(Ec,bc),r(ec,Ic),r(ec,Sc),r(Sc,Tc),r(Tc,$c),r(Tc,Pc),r(Pc,Ac),r(Sc,Oc),r(Sc,xc),r(xc,Lc),r(xc,Cc),r(Cc,jc)},p:n,d(n){n&&l(s),n&&l(_),n&&l(B),n&&l(z),n&&l(V),n&&l(K),n&&l(Z),n&&l(sn),n&&l(tn),n&&l(en),n&&l(on),n&&l(dn),n&&l(mn),n&&l(In),n&&l(Sn),n&&l(Tn),n&&l($n),n&&l(An),n&&l(On),n&&l(Ca),n&&l(ja),n&&l(Ma),n&&l(Wa),n&&l(Wt),n&&l(Ft),n&&l(Pe),n&&l(Ae),n&&l(Je),n&&l(_e),n&&l(Bo),n&&l(Uo),n&&l(tc),n&&l(ec)}}}function kn(n){let s,t;const e=[fn];let o={$$slots:{default:[hn]},$$scope:{ctx:n}};for(let n=0;n<e.length;n+=1)o=a(o,e[n]);return s=new ln({props:o}),{c(){U(s.$$.fragment)},l(n){G(s.$$.fragment,n)},m(n,a){Y(s,n,a),t=!0},p(n,[a]){const t=0&a?function(n,a){const s={},t={},e={$$scope:1};let o=n.length;for(;o--;){const c=n[o],p=a[o];if(p){for(const n in c)n in p||(t[n]=1);for(const n in p)e[n]||(s[n]=p[n],e[n]=1);n[o]=p}else for(const n in c)e[n]=1}for(const n in t)n in s||(s[n]=void 0);return s}(e,[(o=fn,"object"==typeof o&&null!==o?o:{})]):{};var o;1&a&&(t.$$scope={dirty:a,ctx:n}),s.$set(t)},i(n){t||(_(s.$$.fragment,n),t=!0)},o(n){B(s.$$.fragment,n),t=!1},d(n){q(s,n)}}}const fn={title:"Pause and resume a JavaScript function",date:"2019-12-09T08:00:00Z",description:"A thought experiment on how you can pause and resume the execution of a JavaScript function",tags:["JavaScript","React"],slug:"pause-and-resume-a-javascript-function",type:"blog"};class dn extends K{constructor(n){super(),V(this,n,null,kn,c,{})}}setTimeout(()=>{new dn({target:document.querySelector("#app"),hydrate:!0})},3e3);
