<!DOCTYPE html>
<html lang="en">

<head>
  <meta charSet="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="preconnect dns-prefetch" href="https://www.google-analytics.com" />
  <link rel="preconnect dns-prefetch" href="https://fonts.googleapis.com" />
  <link href="https://twitter.com/lihautan" rel="me" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#bd93f9" />
  <link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="icon" href="/icons/icon-48x48.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="preload"
    href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300&display=swap" as="style"
    onload="this.rel='stylesheet'">
  <link rel="preload" href="/main.js" as="script" />
  <link rel="webmention" href="https://webmention.io/lihautan.com/webmention" />
  <link rel="pingback" href="https://webmention.io/lihautan.com/xmlrpc" />
  <style>
    html {
      font-family: 'Lato', sans-serif;
      font-weight: 300;
      font-size: 19px;
      background: linear-gradient(0deg, transparent, #bd93f917, transparent);
    }

    html,
    body {
      margin: 0;
      padding: 0;
    }

    :root {
      --prism-padding: 20px;
      --margin: 1.62em;
      --box-shadow-size: 6px;
      --box-shadow: var(--box-shadow-size) var(--box-shadow-size) var(--primary-color);
      --box-shadow-hover: 10px 10px var(--primary-color);
      --easing: 200ms ease-in-out;
      --primary-color: #bd93f9;
      --secondary-color: #9547b7;
      --dark-color: #282936;
    }
  </style>

  
  <title>Compile Svelte in your head (Part 3) | Tan Li Hau</title><meta name="description" content="" data-svelte="svelte-n0q11s"><meta name="image" content="https://lihautan.com/compile-svelte-in-your-head-part-3/assets/hero-twitter-e9eff02b.jpg" data-svelte="svelte-n0q11s"><meta name="og:image" content="https://lihautan.com/compile-svelte-in-your-head-part-3/assets/hero-twitter-e9eff02b.jpg" data-svelte="svelte-n0q11s"><meta name="og:title" content="Compile Svelte in your head (Part 3)" data-svelte="svelte-n0q11s"><meta name="og:description" content="" data-svelte="svelte-n0q11s"><meta name="og:type" content="website" data-svelte="svelte-n0q11s"><meta name="twitter:card" content="summary_large_image" data-svelte="svelte-n0q11s"><meta name="twitter:creator" content="@lihautan" data-svelte="svelte-n0q11s"><meta name="twitter:title" content="Compile Svelte in your head (Part 3)" data-svelte="svelte-n0q11s"><meta name="twitter:description" content="" data-svelte="svelte-n0q11s"><meta name="twitter:image" content="https://lihautan.com/compile-svelte-in-your-head-part-3/assets/hero-twitter-e9eff02b.jpg" data-svelte="svelte-n0q11s"><meta name="keywords" content="Svelte" data-svelte="svelte-n0q11s"><meta name="keywords" content="JavaScript" data-svelte="svelte-n0q11s"><meta itemprop="url" content="https%3A%2F%2Flihautan.com%2Fcompile-svelte-in-your-head-part-3" data-svelte="svelte-n0q11s"><meta itemprop="image" content="https://lihautan.com/compile-svelte-in-your-head-part-3/assets/hero-twitter-e9eff02b.jpg" data-svelte="svelte-n0q11s"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Tan Li Hau"},"copyrightHolder":{"@type":"Person","name":"Tan Li Hau"},"copyrightYear":"2020","creator":{"@type":"Person","name":"Tan Li Hau"},"publisher":{"@type":"Person","name":"Tan Li Hau"},"description":"","headline":"Compile Svelte in your head (Part 3)","name":"Compile Svelte in your head (Part 3)","inLanguage":"en"}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","description":"Breadcrumbs list","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lihautan.com","name":"Homepage"},"position":1},{"@type":"ListItem","item":{"@id":"https%3A%2F%2Flihautan.com%2Fcompile-svelte-in-your-head-part-3","name":"Compile Svelte in your head (Part 3)"},"position":2}]}</script><link as="script" rel="preload" href="./6180aa40.js"><link as="style" rel="preload" href="./assets/blog-base-ddb14eb9.css"><link as="style" rel="preload" href="./6180aa40.css"><link href="./assets/blog-base-ddb14eb9.css" rel="stylesheet"><link href="./6180aa40.css" rel="stylesheet">
</head>

<body>
  <div id="app">

<a href="#content" class="skip svelte-9tqnza">Skip to content</a>
<header class="svelte-f3e4uo"><nav><ul class="svelte-f3e4uo"><li class="svelte-f3e4uo"><a href="/" class="svelte-f3e4uo">Tan Li Hau</a></li>
    <li class="svelte-f3e4uo"><a href="/about" class="svelte-f3e4uo">About</a></li>
    <li class="svelte-f3e4uo"><a href="/blogs" class="svelte-f3e4uo">Writings</a></li>
    <li class="svelte-f3e4uo"><a href="/talks" class="svelte-f3e4uo">Talks</a></li>
    <li class="svelte-f3e4uo"><a href="/notes" class="svelte-f3e4uo">Notes</a></li>
    <li class="svelte-f3e4uo"><a href="/newsletter" class="svelte-f3e4uo">Newsletter</a></li>
    <li class="social svelte-f3e4uo"><a aria-label="Twitter account" href="https://twitter.com/lihautan" class="svelte-f3e4uo"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-f3e4uo"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66
    10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5
    4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
      <a aria-label="Github account" href="https://github.com/tanhauhau" class="svelte-f3e4uo"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-f3e4uo"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0
    0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07
    5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65
    5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42
    3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></li></ul></nav>
</header>

<main id="content" class="blog svelte-9tqnza"><h1>Compile Svelte in your head (Part 3)</h1>
  
  <span class="svelte-9tqnza">Svelte</span><span class="svelte-9tqnza">JavaScript</span>

  <article><section><ul class="sitemap" id="sitemap" role="navigation" aria-label="Table of Contents"><li><a href="#the-on-bind-and-use">The  on: ,  bind:  and  use:</a></li><ul><li><a href="#on-event-handlers">on:  event handlers</a></li><li><a href="#bind-bindings">bind:  bindings</a></li><li><a href="#use-actions">use:  actions</a></li></ul><li><a href="#the-vanilla-js">The Vanilla JS</a></li><ul><li><a href="#event-handler">Event handler</a></li><ul><li><a href="#event-preventdefault">event.preventDefault</a></li><li><a href="#event-stoppropagation">event.stopPropagation</a></li></ul><li><a href="#bindings">Bindings</a></li><li><a href="#actions">Actions</a></li></ul><li><a href="#the-compiled-js">The Compiled JS</a></li><ul><li><a href="#on-directive">on:  directive</a></li><ul><li><a href="#event-modifiers">Event modifiers</a></li></ul><li><a href="#bind-directive">bind:  directive</a></li><li><a href="#use-directive">use:  directive</a></li><li><a href="#the-order-of-directives">The order of directives</a></li></ul><li><a href="#closing-note">Closing Note</a></li></ul></section>
<p><strong>⬅ ⬅  Previously in <a href="/compile-svelte-in-your-head-part-2/">Part 2</a>.</strong></p>
<p><a href="/compile-svelte-in-your-head-part-2/">Previously</a>, I detailed how <code>$$invalidate</code> works, described how bitmask was used in <code>$$invalidate</code>, and explained how reactive declarations work as well.</p>
<p>In this article, we are going to look into 3 DOM related directives:</p>
<ul><li><code>on:</code> for event handlers</li>
<li><code>bind:</code> for bindings</li>
<li><code>use:</code> for actions</li></ul>
<p>To make sure we are on the same page, let&#39;s first explain how these 3 directives work.</p>
<section><h2><a href="#the-on-bind-and-use" id="the-on-bind-and-use">The <code>on:</code>, <code>bind:</code> and <code>use:</code></a></h2></section>
<section><h3><a href="#on-event-handlers" id="on-event-handlers"><code>on:</code> event handlers</a></h3>
<p>You can use the <code>on:</code> directive to listen to any event on an element:</p>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
  function handleMouseMove(event) &#123;&#125;

  function handleClick(event) &#123;&#125;
&lt;/script&gt;

&lt;!-- You can pass in as variable --&gt;
&lt;div on:mousemove=&#123;handleMouseMove&#125; /&gt;

&lt;!-- or you can inline the event handler --&gt;
&lt;div on:mousemove=&#123;event =&gt; &#123; /*...*/ &#125;&#125; /&gt;

&lt;!-- You can modify event handler with modifiers  --&gt;
&lt;div on:click|stopPropagation|once=&#123;handleClick&#125;&gt;</code></pre></section>
<section><h3><a href="#bind-bindings" id="bind-bindings"><code>bind:</code> bindings</a></h3>
<p>The <code>bind:</code> directive allows you to bind a variable to a property of an element.</p>
<p>Updating the variable will modifying the property of the element, conversely, modifying the property of the element via interacting with the element will, in turn, update the variable.</p>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
  let name, yes;
&lt;/script&gt;

&lt;!-- You can bind &#96;name&#96; to input.value --&gt;
&lt;!-- Changing &#96;name&#96; will update input.value to be the value of &#96;name&#96; and --&gt;
&lt;!-- changing input.value will update &#96;name&#96; to be input.value --&gt;
&lt;input bind:value=&#123;name&#125; /&gt;

&lt;!-- You can bind input.checked for a checkbox input --&gt;
&lt;input type=&quot;checkbox&quot; bind:checked=&#123;yes&#125; /&gt;</code></pre></section>
<section><h3><a href="#use-actions" id="use-actions"><code>use:</code> actions</a></h3>
<p>The <code>use:</code> directive is called <strong><a href="https://svelte.dev/tutorial/actions" rel="nofollow">&quot;Action&quot;</a></strong>. It provides you an interface to enhance your element.</p>
<p>You pass a function to the <code>use:</code> directive of an element and the function will be called when your element is mounted.</p>
<p>The function should return an object in which the <code>destroy</code> method of the object will be called when the element is unmounted.</p>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
  function doSomething(element) &#123;
    // do something with the element
    return &#123;
      destroy() &#123;
        // cleanup
      &#125;
    &#125;
  &#125;
&lt;/script&gt;

&lt;div use:doSomething /&gt;</code></pre>
<p>This is useful when you want to interface with 3rd-party libraries:</p>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
  import Draggable from &#39;the-draggable-library&#39;;

  function doSomething(element) &#123;
    // highlight-start
    const draggable = new Draggable(element);
    draggable.start();
    // highlight-end
    return &#123;
      destroy() &#123;
        // highlight-next-line
        draggable.stop();
      &#125;
    &#125;
  &#125;
&lt;/script&gt;

&lt;div use:doSomething /&gt;</code></pre>
<p>You can pass in parameters to the <code>use:</code> directive, to bring in reactivity into your actions</p>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
  import Draggable from &#39;the-draggable-library&#39;;

  let options = &#123; foo: true, bar: true &#125;;

  // highlight-next-line
  function doSomething(element, options) &#123;
    // highlight-next-line
    const draggable = new Draggable(element, options);
    draggable.start();

    return &#123;
      // highlight-start
      update(options) &#123;
        draggable.update(options);
      &#125;,
      // highlight-end
      destroy() &#123;
        draggable.stop();
      &#125;
    &#125;
  &#125;
&lt;/script&gt;

&lt;div use:doSomething=&#123;options&#125; /&gt;

&lt;label&gt;
  &lt;input type=&quot;checkbox&quot; bind:checked=&#123;options.foo&#125; /&gt;
  Foo
&lt;/label&gt;
&lt;label&gt;
  &lt;input type=&quot;checkbox&quot; bind:checked=&#123;options.bar&#125; /&gt;
  Bar
&lt;/label&gt;</code></pre>
<p>You can visit Svelte&#39;s interactive tutorial to learn more about:</p>
<ul><li><a href="https://svelte.dev/tutorial/dom-events" rel="nofollow">event handlers with <code>on:</code></a></li>
<li><a href="https://svelte.dev/tutorial/text-inputs" rel="nofollow">bindings with <code>bind:</code></a></li>
<li><a href="https://svelte.dev/tutorial/actions" rel="nofollow">actions with <code>use:</code></a></li></ul></section>
<section><h2><a href="#the-vanilla-js" id="the-vanilla-js">The Vanilla JS</a></h2>
<p>Now, let&#39;s refresh ourselves with how we can implement an event handler, bindings, and actions without using any framework.</p></section>
<section><h3><a href="#event-handler" id="event-handler">Event handler</a></h3>
<p>As <a href="/compile-svelte-in-your-head-part-1/#listen-for-click-events-on-an-element">mentioned in the Part 1 of the series</a>, we can use <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" rel="nofollow">element.addEventListener</a> to listen to events.</p>
<pre class="language-js"><code class="language-js">element<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The event listener takes in an optional 3rd argument, which allows you to specifies the characteristics of the event handler:</p>
<pre class="language-js"><code class="language-js">element<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  capture<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// triggered before any child element</span>
  once<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// triggered at most once</span>
  passive<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// indicates that will never call &#96;preventDefault&#96; to improve performance</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section>
<section><h4><a href="#event-preventdefault" id="event-preventdefault">event.preventDefault</a></h4>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Event/preventDefault" rel="nofollow">event.preventDefault</a> allows you to prevent the default behavior of the event, for example submitting form for <code>&lt;button type=&quot;submit&quot; /&gt;</code> or navigating to the target for <code>&lt;a href=&quot;...&quot;&gt;</code>.</p>
<pre class="language-js"><code class="language-js">element<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token punctuation">&#123;</span>
  event<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section>
<section><h4><a href="#event-stoppropagation" id="event-stoppropagation">event.stopPropagation</a></h4>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Event/stopPropagation" rel="nofollow">event.stopPropagation</a> allows you to prevent event to continue propagate.</p>
<pre class="language-svelte"><code class="language-svelte">&lt;div on:click=&#123;event =&gt; &#123;
  console.log(&#39;click not triggered&#39;);
&#125;&#125;&gt;
  &lt;div on:click=&#123;event =&gt; &#123;
    // highlight-next-line
    event.stopPropagation();
    console.log(&#39;click&#39;);
  &#125;&#125;&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>To remove the event listener, you need to call <code>element.removeEventListener</code> with the same event <code>type</code>, <code>listener</code> and <code>capture</code>/<code>useCapture</code> flag. You can check out the <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener#Matching_event_listeners_for_removal" rel="nofollow">MDN docs on &quot;Matching event listeners for removal&quot;</a>.</p>
<pre class="language-js"><code class="language-js">element<span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section>
<section><h3><a href="#bindings" id="bindings">Bindings</a></h3>
<p>Binding is to synchronise between the value of a variable and a property of an element.</p>
<p>To synchronise the variable to a property of an element, we need to observe the value of the variable. When it changes, apply it to the property of the element.</p>
<p><em>You can check out my previous article <a href="/reactivity-in-web-frameworks-the-when/">&quot;Reactivity in Web Frameworks&quot;</a> on how we get notified when the value of a variable changed.</em></p>
<p>On the other hand, to synchronise the property of an element to a variable, we <strong>listen to an event of the element</strong>, depending on the property, and update the value of the variable when it happens.</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// binding variable &#96;checked&#96; with the checkbox &#96;checked&#96; property</span>
<span class="token keyword">let</span> checked<span class="token punctuation">;</span>
<span class="token keyword">let</span> input <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'#checkbox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// synchronise variable &#96;checked&#96; to checkbox &#96;checked&#96; property</span>
<span class="token function">observe</span><span class="token punctuation">(</span>checked<span class="token punctuation">,</span> <span class="token parameter">newValue</span> <span class="token arrow operator">=></span> <span class="token punctuation">&#123;</span>
  input<span class="token punctuation">.</span><span class="token property-access">checked</span> <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// synchronise checkbox &#96;checked&#96; property to variable &#96;checked&#96;</span>
<span class="token comment">// listen to &#96;change&#96; event for &#96;checked&#96; property</span>
input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token punctuation">&#123;</span>
  checked <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Some observations:</p>
<p><strong>- The name of the event and the property name of the element may not be the same.</strong></p>
<p>In this example, we listen to <code>&quot;change&quot;</code> event for the checkbox <code>checked</code> property.</p>
<p><strong>- It is almost impossible to bind a property of an element, if there&#39;s no event fired from the element to indicate the property has changed</strong></p>
<p>A recent example I found out is the <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement" rel="nofollow">HTMLDialogElement</a>. It has <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement/close_event" rel="nofollow"><code>&quot;close&quot;</code></a> but not <code>&quot;open&quot;</code> event, which makes it hard to implement <code>bind:open</code> on the dialog element.</p>
<p>Maybe an alternative would be using <a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver" rel="nofollow">MutationObserver</a>, which I haven&#39;t seen any usage of it in Svelte codebase yet.</p></section>
<section><h3><a href="#actions" id="actions">Actions</a></h3>
<p>Action is a function that gets called when your element is created and mounted onto the DOM.</p>
<p>The function returns an object, with 2 methods:</p>
<ul><li><code>update</code>, which gets called when the parameters change</li>
<li><code>destroy</code>, which gets called when the element is removed from the DOM</li></ul>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">actionFn</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> parameter</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">newParameter</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// When element is mounted onto the DOM</span>
<span class="token keyword">let</span> parameter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> actionObj <span class="token operator">=</span> <span class="token function">actionFn</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// When parameter changes</span>
parameter <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
actionObj<span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// When element is removed from the DOM</span>
actionObj<span class="token punctuation">.</span><span class="token method function property-access">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section>
<section><h2><a href="#the-compiled-js" id="the-compiled-js">The Compiled JS</a></h2>
<p>Now let&#39;s take look at how Svelte compiles <code>on:</code>, <code>bind:</code> and <code>use:</code> directives into output JavaScript.</p></section>
<section><h3><a href="#on-directive" id="on-directive"><code>on:</code> directive</a></h3>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
  function onChange() &#123;&#125;
&lt;/script&gt;

&lt;input on:change=&#123;onChange&#125; /&gt;</code></pre>
<p><a href="https://svelte.dev/repl/0ea0c22e9fd648518cfc1231835b0f05" rel="nofollow">Svelte REPL</a></p>
<p>The output code:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">/* App.svelte generated by Svelte v3.22.2 */</span>
<span class="token comment">// ...</span>
<span class="token keyword">function</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> input<span class="token punctuation">;</span>
  <span class="token keyword">let</span> dispose<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      input <span class="token operator">=</span> <span class="token function">element</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> remount</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> input<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-start</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>remount<span class="token punctuation">)</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      dispose <span class="token operator">=</span> <span class="token function">listen</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token comment">/*onChange*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-end</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">d</span><span class="token punctuation">(</span><span class="token parameter">detaching</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>detaching<span class="token punctuation">)</span> <span class="token function">detach</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-next-line</span>
      <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token parameter">$$self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// highlight-next-line</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>onChange<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ...</span></code></pre>
<p>Some observations:</p>
<ul><li>Svelte adds event handler, <code>listen(...)</code>, in the <strong>_m_ount</strong> method.</li>
<li>Svelte removes event handler, <code>dispose()</code>, in the <strong>_d_estroy</strong> method.</li></ul>
<p>As pointed out in <a href="https://lihautan.com/compile-svelte-in-your-head-part-1/#listen-and-dispose" rel="nofollow">Part 1 #listen and dispose</a>, to optimise for minification, the <code>dispose</code> variable could be a function or an array of functions, depending on having one or many event handlers.</p>
<p>We will discuss <code>remount</code> in the future, as it is related to remounting elements while reordering items within each block.</p></section>
<section><h4><a href="#event-modifiers" id="event-modifiers">Event modifiers</a></h4>
<p>Event handlers can have modifiers that alter their behavior.</p>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
	let i=0;
	function onClick() &#123;
		i++;
	&#125;
&lt;/script&gt;

&lt;button on:click|preventDefault=&#123;onClick&#125; /&gt;
&lt;button on:change|stopPropagation=&#123;onClick&#125; /&gt;
&lt;button on:change|once=&#123;onClick&#125; /&gt;
&lt;button on:change|capture=&#123;onClick&#125; /&gt;

&lt;!-- Chain multiple modifiers --&gt;
&lt;button on:click|preventDefault|stopPropagation|once|capture=&#123;onClick&#125; /&gt;</code></pre>
<p><a href="https://svelte.dev/repl/11fffa988c1f49239c005619c3b506c5" rel="nofollow">Svelte REPL</a></p>
<p>The output code:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">/* App.svelte generated by Svelte v3.22.2 */</span>
<span class="token comment">// ...</span>
<span class="token keyword">function</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> remount</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// ...</span>
      <span class="token comment">// highlight-start</span>
      dispose <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token function">listen</span><span class="token punctuation">(</span>button0<span class="token punctuation">,</span> <span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token function">prevent_default</span><span class="token punctuation">(</span><span class="token comment">/*onClick*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">listen</span><span class="token punctuation">(</span>button1<span class="token punctuation">,</span> <span class="token string">"change"</span><span class="token punctuation">,</span> <span class="token function">stop_propagation</span><span class="token punctuation">(</span><span class="token comment">/*onClick*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">listen</span><span class="token punctuation">(</span>button2<span class="token punctuation">,</span> <span class="token string">"change"</span><span class="token punctuation">,</span> <span class="token comment">/*onClick*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> once<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">listen</span><span class="token punctuation">(</span>button3<span class="token punctuation">,</span> <span class="token string">"change"</span><span class="token punctuation">,</span> <span class="token comment">/*onClick*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">listen</span><span class="token punctuation">(</span>
          button4<span class="token punctuation">,</span>
          <span class="token string">"click"</span><span class="token punctuation">,</span>
          <span class="token function">stop_propagation</span><span class="token punctuation">(</span><span class="token function">prevent_default</span><span class="token punctuation">(</span><span class="token comment">/*onClick*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span> once<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> capture<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-end</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>Some observations:</p>
<ul><li>Svelte handles different modifiers differently.</li>
<li>For <code>capture</code>, <code>once</code>, and <code>passive</code> modifiers, which they are part of the options for <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener" rel="nofollow">element.addEventListener</a>, they will be passed as options into the <code>listen</code> function.</li>
<li>For <code>stopPropagation</code>, <code>preventDefault</code>, and <code>self</code> modifiers, the event handler is decorated with respective decorator functions.</li></ul>
<p>An example implementation of the <code>prevent_default</code> decorator function:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">prevent_default</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    event<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> fn<span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></section>
<section><h3><a href="#bind-directive" id="bind-directive"><code>bind:</code> directive</a></h3>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
	let checked = false;
	function updateChecked() &#123;
		checked = true;
	&#125;
&lt;/script&gt;

&lt;input type=&quot;checkbox&quot; bind:checked /&gt;</code></pre>
<p><a href="https://svelte.dev/repl/22ff0420e32f427c8b20e878a44170d3" rel="nofollow">Svelte REPL</a></p>
<p>The output code:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">/* App.svelte generated by Svelte v3.22.2 */</span>
<span class="token comment">// ...</span>
<span class="token keyword">function</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> input<span class="token punctuation">;</span>
  <span class="token keyword">let</span> dispose<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> remount</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> input<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
      input<span class="token punctuation">.</span><span class="token property-access">checked</span> <span class="token operator">=</span> <span class="token comment">/*checked*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-start</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>remount<span class="token punctuation">)</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      dispose <span class="token operator">=</span> <span class="token function">listen</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token comment">/*input_change_handler*/</span> ctx<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-end</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">p</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> <span class="token punctuation">[</span>dirty<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// highlight-start</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dirty <span class="token operator">&amp;</span> <span class="token comment">/*checked*/</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        input<span class="token punctuation">.</span><span class="token property-access">checked</span> <span class="token operator">=</span> <span class="token comment">/*checked*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token comment">// highlight-end</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">d</span><span class="token punctuation">(</span><span class="token parameter">detaching</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>detaching<span class="token punctuation">)</span> <span class="token function">detach</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-next-line</span>
      <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token parameter">$$self<span class="token punctuation">,</span> $$props<span class="token punctuation">,</span> $$invalidate</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> checked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">updateChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// highlight-next-line</span>
    <span class="token function">$$invalidate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>checked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// highlight-start</span>
  <span class="token keyword">function</span> <span class="token function">input_change_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    checked <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">checked</span><span class="token punctuation">;</span>
    <span class="token function">$$invalidate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> checked<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// highlight-end</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>checked<span class="token punctuation">,</span> input_change_handler<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>Some observations:</p>
<ul><li>To synchronise the value of the variable to the property of the element:<ul><li>Svelte wraps the update of the variable <code>checked</code> with <code>$$invalidate(...)</code></li>
<li>In the <strong>u_p_date</strong> method, if the variable <code>checked</code> is updated, Svelte sets <code>input.checked</code> to the value of the variable <code>checked</code>.</li></ul></li>
<li>To syncrhonise the property of the element to the variable<ul><li>Svelte creates an input handler that reads the <code>this.checked</code> property of the input and calls <code>$$invalidate(...)</code> to update it.</li>
<li>Svelte sets up <code>listen(...)</code> in the <strong>_m_ount</strong> method and <code>dispose(...)</code> in the <strong>_d_estroy</strong> method for the input handler</li></ul></li></ul></section>
<section><h3><a href="#use-directive" id="use-directive"><code>use:</code> directive</a></h3>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
	let i = &#39;&#39;;
	function action() &#123;&#125;
  function updateI() &#123;
    i++;
  &#125;
&lt;/script&gt;

&lt;div use:action=&#123;i&#125; /&gt;</code></pre>
<p><a href="https://svelte.dev/repl/88bbecb8b86943fd80d9d428961251ae" rel="nofollow">Svelte REPL</a></p>
<p>The output code:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">/* App.svelte generated by Svelte v3.22.2 */</span>
<span class="token comment">// ...</span>
<span class="token keyword">function</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">let</span> action_action<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> remount</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> div<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-start</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>remount<span class="token punctuation">)</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      dispose <span class="token operator">=</span> <span class="token function">action_destroyer</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>action_action <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> div<span class="token punctuation">,</span> <span class="token comment">/*i*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-end</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">p</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> <span class="token punctuation">[</span>dirty<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// highlight-start</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>action_action <span class="token operator">&amp;&amp;</span> <span class="token function">is_function</span><span class="token punctuation">(</span><span class="token parameter">action_action<span class="token punctuation">.</span><span class="token property-access">update</span></span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> dirty <span class="token operator">&amp;</span> <span class="token comment">/*i*/</span> <span class="token number">1</span><span class="token punctuation">)</span>
        action_action<span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token comment">/*i*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-end</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">d</span><span class="token punctuation">(</span><span class="token parameter">detaching</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>detaching<span class="token punctuation">)</span> <span class="token function">detach</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-next-line</span>
      <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>Some observations:</p>
<ul><li>Creating <code>action_action</code> object by calling the <code>action</code> function in the <strong>_m_out</strong> method</li>
<li>When the paramter change, call the <code>action_action.update</code> method with the updated parameter in the <strong>u_p_date</strong> method</li>
<li><code>action_destroyer</code> returns the <code>dispose</code> function. The <code>dispose</code> function makes sure that <code>action_action.destroy</code> is a function before calling it.</li></ul></section>
<section><h3><a href="#the-order-of-directives" id="the-order-of-directives">The order of directives</a></h3>
<p>As both the <code>bind:</code> and the <code>on:</code> directives add event listeners to the element, the order of adding event listener may have nuance side effects.</p>
<p>Imagine the following scenario:</p>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
  let before = &#39;&#39;
  let after = &#39;&#39;;
  function uppercase(event) &#123;
    // modifying the input.value
    event.target.value = event.target.value.toUpperCase();
  &#125;
&lt;/script&gt;

&lt;!-- bind after adding input listener --&gt;
&lt;input on:input=&#123;uppercase&#125; bind:value=&#123;after&#125; /&gt; &#123;after&#125;

&lt;!-- bind before adding input listener --&gt;
&lt;input bind:value=&#123;before&#125; on:input=&#123;uppercase&#125; /&gt; &#123;before&#125;</code></pre>
<p>The <code>input.value</code> accessed by the implicit event handler of the <code>bind:</code> directive depends on whether <code>on:input</code> handler gets called before or after.</p>
<p>If the implicit event handler of the <code>bind:</code> directive is called before the event handler, the bound value is the value of the input before applying the <code>toUpperCase()</code> transformation.</p>
<p>Although <code>action:</code> directive itself does not add event listener to the element, but it is possible to be added by the user code:</p>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
  let before = &#39;&#39;
  let after = &#39;&#39;;
  function uppercaseAction(element) &#123;
    function fn(event) &#123;
      event.target.value = event.target.value.toUpperCase()
    &#125;
    element.addEventListener(&#39;input&#39;, fn);
    return &#123;
      destroy() &#123;
        element.removeEventListener(&#39;input&#39;, fn);
      &#125;
    &#125;;
  &#125;
&lt;/script&gt;

&lt;!-- bind after adding action --&gt;
&lt;input use:uppercase bind:value=&#123;after&#125; /&gt; &#123;after&#125;

&lt;!-- bind before adding action --&gt;
&lt;input bind:value=&#123;before&#125; use:uppercase /&gt; &#123;before&#125;</code></pre>
<p>Although it is not officially documented, <em>(I couldn&#39;t find it on the docs)</em>, <strong>the order of declaring the directives <code>on:</code>, <code>bind:</code> and <code>use:</code> on an element does matter</strong> to provide a consistent behavior.</p>
<p>Try out the following example in the REPL:</p>
<pre class="language-svelte"><code class="language-svelte">&lt;script&gt;
  let checked;
  function onChange() &#123;&#125;
  function action() &#123;&#125;
&lt;/script&gt;

&lt;input
  type=checkbox
  bind:checked
  on:change=&#123;onChange&#125;
  use:action
/&gt;</code></pre>
<p><a href="https://svelte.dev/repl/f06a8a59840c418b86c43c2875d4b274" rel="nofollow">Svelte REPL</a></p>
<p>Try reordering the <code>bind:</code>, <code>on:</code> and <code>use:</code> directives and see how it affects the output JS:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// ...</span>
<span class="token keyword">function</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> input<span class="token punctuation">;</span>
  <span class="token keyword">let</span> action_action<span class="token punctuation">;</span>
  <span class="token keyword">let</span> dispose<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> remount</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// ...</span>
      <span class="token comment">// highlight-start</span>
      dispose <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token comment">// bind:checked</span>
        <span class="token function">listen</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token comment">/*input_change_handler*/</span> ctx<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// on:change=&#123;onChange&#125;</span>
        <span class="token function">listen</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token string">'change'</span><span class="token punctuation">,</span> onChange<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// use:action</span>
        <span class="token function">action_destroyer</span><span class="token punctuation">(</span><span class="token punctuation">(</span>action_action <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// highlight-end</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>If you are interested to learn more about ordering directives, the edge cases it fixed and the regression bugs it caused, you can start with <a href="https://github.com/sveltejs/svelte/issues/2446" rel="nofollow">this Github issue</a>.</p></section>
<section><h2><a href="#closing-note" id="closing-note">Closing Note</a></h2>
<p>In this article, we explored how <code>on:</code>, <code>bind:</code> and <code>use:</code> directives work.</p>
<p>We first looked at how we can implement them without using any framework. After that, we walked through how Svelte compiles the directives into JavaScript.</p>
<p>We&#39;ve also talked about how the order of declaring directives on an element matters.</p>
<p>If you wish to know more, <a href="https://twitter.com/lihautan" rel="nofollow">follow me on Twitter</a>.</p>
<p>I&#39;ll post it on Twitter when the next part is ready, where I&#39;ll be covering <a href="https://svelte.dev/tutorial/if-blocks" rel="nofollow">logic blocks</a>, <a href="https://svelte.dev/tutorial/slots" rel="nofollow">slots</a>, <a href="https://svelte.dev/tutorial/context-api" rel="nofollow">context</a>, and many others.</p>
<p><strong>⬅ ⬅  Previously in <a href="/compile-svelte-in-your-head-part-2/">Part 2</a>.</strong></p></section></article></main>

<footer class="svelte-9tqnza"><div class="form svelte-1k1s1co"><h1>Subscribe to my newsletter</h1>
  <h2 class="svelte-1k1s1co">Get the latest blog posts and project updates delivered right to your inbox</h2>
  <form action="https://buttondown.email/api/emails/embed-subscribe/lihautan" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/lihautan', 'popupwindow')" class="embeddable-buttondown-form"><div class="form-item svelte-1k1s1co"><input type="email" name="email" id="bd-email" aria-label="email address" placeholder="youremail@example.com" class="svelte-1k1s1co">
      <input type="submit" value="Subscribe" disabled class="svelte-1k1s1co"></div>
    <input type="hidden" value="1" name="embed" class="svelte-1k1s1co">
    <p class="svelte-1k1s1co">Powered by Buttondown.</p></form>
</div>
  </footer>

<script async defer src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><script src="./6180aa40.js" async></script></div>
  

  <script async defer src="/main.js"></script>
</body>

</html>