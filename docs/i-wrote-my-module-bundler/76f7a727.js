function n(){}function a(n,a){for(const s in a)n[s]=a[s];return n}function s(n){return n()}function t(){return Object.create(null)}function e(n){n.forEach(s)}function o(n){return"function"==typeof n}function p(n,a){return n!=n?a==a:n!==a||n&&"object"==typeof n||"function"==typeof n}function c(n,s,t,e){return n[1]&&e?a(t.ctx.slice(),n[1](e(s))):t.ctx}function l(n,a,s,t,e,o,p){const l=function(n,a,s,t){if(n[2]&&t){const e=n[2](t(s));if(void 0===a.dirty)return e;if("object"==typeof e){const n=[],s=Math.max(a.dirty.length,e.length);for(let t=0;t<s;t+=1)n[t]=a.dirty[t]|e[t];return n}return a.dirty|e}return a.dirty}(a,t,e,o);if(l){const e=c(a,s,t,p);n.p(e,l)}}function u(n,a){n.appendChild(a)}function r(n,a,s){n.insertBefore(a,s||null)}function i(n){n.parentNode.removeChild(n)}function k(n,a){for(let s=0;s<n.length;s+=1)n[s]&&n[s].d(a)}function d(n){return document.createElement(n)}function h(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function f(n){return document.createTextNode(n)}function m(){return f(" ")}function g(){return f("")}function w(n,a,s){null==s?n.removeAttribute(a):n.getAttribute(a)!==s&&n.setAttribute(a,s)}function y(n){return Array.from(n.childNodes)}function v(n,a,s,t){for(let t=0;t<n.length;t+=1){const e=n[t];if(e.nodeName===a){let a=0;const o=[];for(;a<e.attributes.length;){const n=e.attributes[a++];s[n.name]||o.push(n.name)}for(let n=0;n<o.length;n++)e.removeAttribute(o[n]);return n.splice(t,1)[0]}}return t?h(a):d(a)}function E(n,a){for(let s=0;s<n.length;s+=1){const t=n[s];if(3===t.nodeType)return t.data=""+a,n.splice(s,1)[0]}return f(a)}function b(n){return E(n," ")}function I(n,a){a=""+a,n.wholeText!==a&&(n.data=a)}function x(n,a){n.value=null==a?"":a}class P{constructor(n=null){this.a=n,this.e=this.n=null}m(n,a,s=null){this.e||(this.e=d(a.nodeName),this.t=a,this.h(n)),this.i(s)}h(n){this.e.innerHTML=n,this.n=Array.from(this.e.childNodes)}i(n){for(let a=0;a<this.n.length;a+=1)r(this.t,this.n[a],n)}p(n){this.d(),this.h(n),this.i(this.a)}d(){this.n.forEach(i)}}let j;function A(n){j=n}function T(n){(function(){if(!j)throw new Error("Function called outside component initialization");return j})().$$.on_mount.push(n)}const S=[],L=[],O=[],M=[],C=Promise.resolve();let q=!1;function N(n){O.push(n)}let R=!1;const $=new Set;function H(){if(!R){R=!0;do{for(let n=0;n<S.length;n+=1){const a=S[n];A(a),D(a.$$)}for(S.length=0;L.length;)L.pop()();for(let n=0;n<O.length;n+=1){const a=O[n];$.has(a)||($.add(a),a())}O.length=0}while(S.length);for(;M.length;)M.pop()();q=!1,R=!1,$.clear()}}function D(n){if(null!==n.fragment){n.update(),e(n.before_update);const a=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,a),n.after_update.forEach(N)}}const G=new Set;function B(n,a){n&&n.i&&(G.delete(n),n.i(a))}function F(n,a,s,t){if(n&&n.o){if(G.has(n))return;G.add(n),(void 0).c.push(()=>{G.delete(n),t&&(s&&n.d(1),t())}),n.o(a)}}function J(n){n&&n.c()}function U(n,a){n&&n.l(a)}function W(n,a,t){const{fragment:p,on_mount:c,on_destroy:l,after_update:u}=n.$$;p&&p.m(a,t),N(()=>{const a=c.map(s).filter(o);l?l.push(...a):e(a),n.$$.on_mount=[]}),u.forEach(N)}function _(n,a){const s=n.$$;null!==s.fragment&&(e(s.on_destroy),s.fragment&&s.fragment.d(a),s.on_destroy=s.fragment=null,s.ctx=[])}function z(n,a){-1===n.$$.dirty[0]&&(S.push(n),q||(q=!0,C.then(H)),n.$$.dirty.fill(0)),n.$$.dirty[a/31|0]|=1<<a%31}function V(a,s,o,p,c,l,u=[-1]){const r=j;A(a);const k=s.props||{},d=a.$$={fragment:null,ctx:null,props:l,update:n,not_equal:c,bound:t(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(r?r.$$.context:[]),callbacks:t(),dirty:u};let h=!1;if(d.ctx=o?o(a,k,(n,s,...t)=>{const e=t.length?t[0]:s;return d.ctx&&c(d.ctx[n],d.ctx[n]=e)&&(d.bound[n]&&d.bound[n](e),h&&z(a,n)),s}):[],d.update(),h=!0,e(d.before_update),d.fragment=!!p&&p(d.ctx),s.target){if(s.hydrate){const n=y(s.target);d.fragment&&d.fragment.l(n),n.forEach(i)}else d.fragment&&d.fragment.c();s.intro&&B(a.$$.fragment),W(a,s.target,s.anchor),H()}A(r)}class Y{$destroy(){_(this,1),this.$destroy=n}$on(n,a){const s=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return s.push(a),()=>{const n=s.indexOf(a);-1!==n&&s.splice(n,1)}}$set(){}}function K(a){let s,t,e,o,p,c,l,k,g,I,x,P,j,A,T,S,L,O,M,C,q,N,R,$,H,D,G,B,F,J,U,W,_,z,V;return{c(){s=d("header"),t=d("nav"),e=d("ul"),o=d("li"),p=d("a"),c=f("Tan Li Hau"),l=m(),k=d("li"),g=d("a"),I=f("About"),x=m(),P=d("li"),j=d("a"),A=f("Writings"),T=m(),S=d("li"),L=d("a"),O=f("Talks"),M=m(),C=d("li"),q=d("a"),N=f("Notes"),R=m(),$=d("li"),H=d("a"),D=f("Newsletter"),G=m(),B=d("li"),F=d("a"),J=h("svg"),U=h("path"),W=m(),_=d("a"),z=h("svg"),V=h("path"),this.h()},l(n){s=v(n,"HEADER",{class:!0});var a=y(s);t=v(a,"NAV",{});var u=y(t);e=v(u,"UL",{class:!0});var r=y(e);o=v(r,"LI",{class:!0});var d=y(o);p=v(d,"A",{href:!0,class:!0});var h=y(p);c=E(h,"Tan Li Hau"),h.forEach(i),d.forEach(i),l=b(r),k=v(r,"LI",{class:!0});var f=y(k);g=v(f,"A",{href:!0,class:!0});var m=y(g);I=E(m,"About"),m.forEach(i),f.forEach(i),x=b(r),P=v(r,"LI",{class:!0});var w=y(P);j=v(w,"A",{href:!0,class:!0});var Y=y(j);A=E(Y,"Writings"),Y.forEach(i),w.forEach(i),T=b(r),S=v(r,"LI",{class:!0});var K=y(S);L=v(K,"A",{href:!0,class:!0});var Z=y(L);O=E(Z,"Talks"),Z.forEach(i),K.forEach(i),M=b(r),C=v(r,"LI",{class:!0});var Q=y(C);q=v(Q,"A",{href:!0,class:!0});var X=y(q);N=E(X,"Notes"),X.forEach(i),Q.forEach(i),R=b(r),$=v(r,"LI",{class:!0});var nn=y($);H=v(nn,"A",{href:!0,class:!0});var an=y(H);D=E(an,"Newsletter"),an.forEach(i),nn.forEach(i),G=b(r),B=v(r,"LI",{class:!0});var sn=y(B);F=v(sn,"A",{"aria-label":!0,href:!0,class:!0});var tn=y(F);J=v(tn,"svg",{viewBox:!0,width:!0,height:!0,class:!0},1);var en=y(J);U=v(en,"path",{d:!0},1),y(U).forEach(i),en.forEach(i),tn.forEach(i),W=b(sn),_=v(sn,"A",{"aria-label":!0,href:!0,class:!0});var on=y(_);z=v(on,"svg",{viewBox:!0,width:!0,height:!0,class:!0},1);var pn=y(z);V=v(pn,"path",{d:!0},1),y(V).forEach(i),pn.forEach(i),on.forEach(i),sn.forEach(i),r.forEach(i),u.forEach(i),a.forEach(i),this.h()},h(){w(p,"href","/"),w(p,"class","svelte-f3e4uo"),w(o,"class","svelte-f3e4uo"),w(g,"href","/about"),w(g,"class","svelte-f3e4uo"),w(k,"class","svelte-f3e4uo"),w(j,"href","/blogs"),w(j,"class","svelte-f3e4uo"),w(P,"class","svelte-f3e4uo"),w(L,"href","/talks"),w(L,"class","svelte-f3e4uo"),w(S,"class","svelte-f3e4uo"),w(q,"href","/notes"),w(q,"class","svelte-f3e4uo"),w(C,"class","svelte-f3e4uo"),w(H,"href","/newsletter"),w(H,"class","svelte-f3e4uo"),w($,"class","svelte-f3e4uo"),w(U,"d","M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66\n    10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5\n    4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"),w(J,"viewBox","0 0 24 24"),w(J,"width","1em"),w(J,"height","1em"),w(J,"class","svelte-f3e4uo"),w(F,"aria-label","Twitter account"),w(F,"href","https://twitter.com/lihautan"),w(F,"class","svelte-f3e4uo"),w(V,"d","M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0\n    0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07\n    5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65\n    5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42\n    3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"),w(z,"viewBox","0 0 24 24"),w(z,"width","1em"),w(z,"height","1em"),w(z,"class","svelte-f3e4uo"),w(_,"aria-label","Github account"),w(_,"href","https://github.com/tanhauhau"),w(_,"class","svelte-f3e4uo"),w(B,"class","social svelte-f3e4uo"),w(e,"class","svelte-f3e4uo"),w(s,"class","svelte-f3e4uo")},m(n,a){r(n,s,a),u(s,t),u(t,e),u(e,o),u(o,p),u(p,c),u(e,l),u(e,k),u(k,g),u(g,I),u(e,x),u(e,P),u(P,j),u(j,A),u(e,T),u(e,S),u(S,L),u(L,O),u(e,M),u(e,C),u(C,q),u(q,N),u(e,R),u(e,$),u($,H),u(H,D),u(e,G),u(e,B),u(B,F),u(F,J),u(J,U),u(B,W),u(B,_),u(_,z),u(z,V)},p:n,i:n,o:n,d(n){n&&i(s)}}}class Z extends Y{constructor(n){super(),V(this,n,null,K,p,{})}}function Q(a){let s,t,e,o,p,c,l,k,h,g,I,P,j,A,T,S,L,O,M,C;return{c(){s=d("div"),t=d("h1"),e=f("Subscribe to my newsletter"),o=m(),p=d("h2"),c=f("Get the latest blog posts and project updates delivered right to your inbox"),l=m(),k=d("form"),h=d("div"),g=d("input"),I=m(),P=d("input"),A=m(),T=d("input"),S=m(),L=d("p"),O=f("Powered by Buttondown."),this.h()},l(n){s=v(n,"DIV",{class:!0});var a=y(s);t=v(a,"H1",{});var u=y(t);e=E(u,"Subscribe to my newsletter"),u.forEach(i),o=b(a),p=v(a,"H2",{class:!0});var r=y(p);c=E(r,"Get the latest blog posts and project updates delivered right to your inbox"),r.forEach(i),l=b(a),k=v(a,"FORM",{action:!0,method:!0,target:!0,onsubmit:!0,class:!0});var d=y(k);h=v(d,"DIV",{class:!0});var f=y(h);g=v(f,"INPUT",{type:!0,name:!0,id:!0,"aria-label":!0,placeholder:!0,class:!0}),I=b(f),P=v(f,"INPUT",{type:!0,value:!0,disabled:!0,class:!0}),f.forEach(i),A=b(d),T=v(d,"INPUT",{type:!0,value:!0,name:!0,class:!0}),S=b(d),L=v(d,"P",{class:!0});var m=y(L);O=E(m,"Powered by Buttondown."),m.forEach(i),d.forEach(i),a.forEach(i),this.h()},h(){w(p,"class","svelte-1k1s1co"),w(g,"type","email"),w(g,"name","email"),w(g,"id","bd-email"),w(g,"aria-label","email address"),w(g,"placeholder","youremail@example.com"),w(g,"class","svelte-1k1s1co"),w(P,"type","submit"),P.value="Subscribe",P.disabled=j=!a[0],w(P,"class","svelte-1k1s1co"),w(h,"class","form-item svelte-1k1s1co"),w(T,"type","hidden"),T.value="1",w(T,"name","embed"),w(T,"class","svelte-1k1s1co"),w(L,"class","svelte-1k1s1co"),w(k,"action","https://buttondown.email/api/emails/embed-subscribe/lihautan"),w(k,"method","post"),w(k,"target","popupwindow"),w(k,"onsubmit","window.open('https://buttondown.email/lihautan', 'popupwindow')"),w(k,"class","embeddable-buttondown-form"),w(s,"class","form svelte-1k1s1co")},m(n,i){var d,f,m,w;r(n,s,i),u(s,t),u(t,e),u(s,o),u(s,p),u(p,c),u(s,l),u(s,k),u(k,h),u(h,g),x(g,a[0]),u(h,I),u(h,P),u(k,A),u(k,T),u(k,S),u(k,L),u(L,O),M||(d=g,f="input",m=a[1],d.addEventListener(f,m,w),C=()=>d.removeEventListener(f,m,w),M=!0)},p(n,[a]){1&a&&g.value!==n[0]&&x(g,n[0]),1&a&&j!==(j=!n[0])&&(P.disabled=j)},i:n,o:n,d(n){n&&i(s),M=!1,C()}}}function X(n,a,s){let t;return[t,function(){t=this.value,s(0,t)}]}class nn extends Y{constructor(n){super(),V(this,n,X,Q,p,{})}}function an(n){return T(()=>(setTimeout(()=>{if(window.innerWidth>1080){const n=document.createElement("script");n.async=!0,n.type="text/javascript",n.src="//cdn.carbonads.com/carbon.js?serve=CE7ITK3E&placement=lihautancom",n.id="_carbonads_js",document.body.appendChild(n)}},5e3),()=>{try{const n=document.getElementById("carbonads");n.parentNode.removeChild(n)}catch(n){}})),[]}class sn extends Y{constructor(n){super(),V(this,n,an,null,p,{})}}var tn="https://lihautan.com/i-wrote-my-module-bundler/assets/hero-twitter-01456022.jpg";function en(n,a,s){const t=n.slice();return t[6]=a[s],t}function on(n,a,s){const t=n.slice();return t[6]=a[s],t}function pn(n){let a,s;return{c(){a=d("meta"),this.h()},l(n){a=v(n,"META",{name:!0,content:!0}),this.h()},h(){w(a,"name","keywords"),w(a,"content",s=n[6])},m(n,s){r(n,a,s)},p(n,t){4&t&&s!==(s=n[6])&&w(a,"content",s)},d(n){n&&i(a)}}}function cn(n){let a,s,t=n[6]+"";return{c(){a=d("span"),s=f(t),this.h()},l(n){a=v(n,"SPAN",{class:!0});var e=y(a);s=E(e,t),e.forEach(i),this.h()},h(){w(a,"class","svelte-9tqnza")},m(n,t){r(n,a,t),u(a,s)},p(n,a){4&a&&t!==(t=n[6]+"")&&I(s,t)},d(n){n&&i(a)}}}function ln(n){let a,s,t,e,o,p,h,x,j,A,T,S,L,O,M,C,q,N,R,$,H,D,G,z,V,Y,K,Q,X,an,ln,un,rn,kn,dn,hn,fn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"Article",author:n[3],copyrightHolder:n[3],copyrightYear:"2020",creator:n[3],publisher:n[3],description:n[1],headline:n[0],name:n[0],inLanguage:"en"})}<\/script>`,mn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"BreadcrumbList",description:"Breadcrumbs list",name:"Breadcrumbs",itemListElement:[{"@type":"ListItem",item:{"@id":"https://lihautan.com",name:"Homepage"},name:"Homepage",position:1},{"@type":"ListItem",item:{"@id":"https%3A%2F%2Flihautan.com%2Fi-wrote-my-module-bundler",name:n[0]},name:n[0],position:2}]})}<\/script>`;document.title=a=n[0]+" | Tan Li Hau";let gn=n[2],wn=[];for(let a=0;a<gn.length;a+=1)wn[a]=pn(on(n,gn,a));G=new Z({});let yn=n[2],vn=[];for(let a=0;a<yn.length;a+=1)vn[a]=cn(en(n,yn,a));const En=n[5].default,bn=function(n,a,s,t){if(n){const e=c(n,a,s,t);return n[0](e)}}(En,n,n[4],null);return rn=new nn({}),dn=new sn({}),{c(){s=d("meta"),t=d("meta"),e=d("meta"),o=d("meta"),p=d("meta"),h=d("meta"),x=d("meta"),j=d("meta"),A=d("meta"),T=d("meta"),S=d("meta");for(let n=0;n<wn.length;n+=1)wn[n].c();L=d("meta"),O=d("meta"),C=g(),N=g(),R=m(),$=d("a"),H=f("Skip to content"),D=m(),J(G.$$.fragment),z=m(),V=d("main"),Y=d("h1"),K=f(n[0]),Q=m();for(let n=0;n<vn.length;n+=1)vn[n].c();X=m(),an=d("article"),bn&&bn.c(),ln=m(),un=d("footer"),J(rn.$$.fragment),kn=m(),J(dn.$$.fragment),this.h()},l(a){const c=function(n,a=document.body){return Array.from(a.querySelectorAll(n))}('[data-svelte="svelte-15e3uyc"]',document.head);s=v(c,"META",{name:!0,content:!0}),t=v(c,"META",{name:!0,content:!0}),e=v(c,"META",{name:!0,content:!0}),o=v(c,"META",{name:!0,content:!0}),p=v(c,"META",{name:!0,content:!0}),h=v(c,"META",{name:!0,content:!0}),x=v(c,"META",{name:!0,content:!0}),j=v(c,"META",{name:!0,content:!0}),A=v(c,"META",{name:!0,content:!0}),T=v(c,"META",{name:!0,content:!0}),S=v(c,"META",{name:!0,content:!0});for(let n=0;n<wn.length;n+=1)wn[n].l(c);L=v(c,"META",{itemprop:!0,content:!0}),O=v(c,"META",{itemprop:!0,content:!0}),C=g(),N=g(),c.forEach(i),R=b(a),$=v(a,"A",{href:!0,class:!0});var l=y($);H=E(l,"Skip to content"),l.forEach(i),D=b(a),U(G.$$.fragment,a),z=b(a),V=v(a,"MAIN",{id:!0,class:!0});var u=y(V);Y=v(u,"H1",{});var r=y(Y);K=E(r,n[0]),r.forEach(i),Q=b(u);for(let n=0;n<vn.length;n+=1)vn[n].l(u);X=b(u),an=v(u,"ARTICLE",{});var k=y(an);bn&&bn.l(k),k.forEach(i),u.forEach(i),ln=b(a),un=v(a,"FOOTER",{class:!0});var d=y(un);U(rn.$$.fragment,d),kn=b(d),U(dn.$$.fragment,d),d.forEach(i),this.h()},h(){w(s,"name","description"),w(s,"content",n[1]),w(t,"name","image"),w(t,"content",tn),w(e,"name","og:image"),w(e,"content",tn),w(o,"name","og:title"),w(o,"content",n[0]),w(p,"name","og:description"),w(p,"content",n[1]),w(h,"name","og:type"),w(h,"content","website"),w(x,"name","twitter:card"),w(x,"content","summary_large_image"),w(j,"name","twitter:creator"),w(j,"content","@lihautan"),w(A,"name","twitter:title"),w(A,"content",n[0]),w(T,"name","twitter:description"),w(T,"content",n[1]),w(S,"name","twitter:image"),w(S,"content",tn),w(L,"itemprop","url"),w(L,"content","https%3A%2F%2Flihautan.com%2Fi-wrote-my-module-bundler"),w(O,"itemprop","image"),w(O,"content",tn),M=new P(C),q=new P(N),w($,"href","#content"),w($,"class","skip svelte-9tqnza"),w(V,"id","content"),w(V,"class","blog svelte-9tqnza"),w(un,"class","svelte-9tqnza")},m(n,a){u(document.head,s),u(document.head,t),u(document.head,e),u(document.head,o),u(document.head,p),u(document.head,h),u(document.head,x),u(document.head,j),u(document.head,A),u(document.head,T),u(document.head,S);for(let n=0;n<wn.length;n+=1)wn[n].m(document.head,null);u(document.head,L),u(document.head,O),M.m(fn,document.head),u(document.head,C),q.m(mn,document.head),u(document.head,N),r(n,R,a),r(n,$,a),u($,H),r(n,D,a),W(G,n,a),r(n,z,a),r(n,V,a),u(V,Y),u(Y,K),u(V,Q);for(let n=0;n<vn.length;n+=1)vn[n].m(V,null);u(V,X),u(V,an),bn&&bn.m(an,null),r(n,ln,a),r(n,un,a),W(rn,un,null),u(un,kn),W(dn,un,null),hn=!0},p(n,[t]){if((!hn||1&t)&&a!==(a=n[0]+" | Tan Li Hau")&&(document.title=a),(!hn||2&t)&&w(s,"content",n[1]),(!hn||1&t)&&w(o,"content",n[0]),(!hn||2&t)&&w(p,"content",n[1]),(!hn||1&t)&&w(A,"content",n[0]),(!hn||2&t)&&w(T,"content",n[1]),4&t){let a;for(gn=n[2],a=0;a<gn.length;a+=1){const s=on(n,gn,a);wn[a]?wn[a].p(s,t):(wn[a]=pn(s),wn[a].c(),wn[a].m(L.parentNode,L))}for(;a<wn.length;a+=1)wn[a].d(1);wn.length=gn.length}if((!hn||3&t)&&fn!==(fn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"Article",author:n[3],copyrightHolder:n[3],copyrightYear:"2020",creator:n[3],publisher:n[3],description:n[1],headline:n[0],name:n[0],inLanguage:"en"})}<\/script>`)&&M.p(fn),(!hn||1&t)&&mn!==(mn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"BreadcrumbList",description:"Breadcrumbs list",name:"Breadcrumbs",itemListElement:[{"@type":"ListItem",item:{"@id":"https://lihautan.com",name:"Homepage"},name:"Homepage",position:1},{"@type":"ListItem",item:{"@id":"https%3A%2F%2Flihautan.com%2Fi-wrote-my-module-bundler",name:n[0]},name:n[0],position:2}]})}<\/script>`)&&q.p(mn),(!hn||1&t)&&I(K,n[0]),4&t){let a;for(yn=n[2],a=0;a<yn.length;a+=1){const s=en(n,yn,a);vn[a]?vn[a].p(s,t):(vn[a]=cn(s),vn[a].c(),vn[a].m(V,X))}for(;a<vn.length;a+=1)vn[a].d(1);vn.length=yn.length}bn&&bn.p&&16&t&&l(bn,En,n,n[4],t,null,null)},i(n){hn||(B(G.$$.fragment,n),B(bn,n),B(rn.$$.fragment,n),B(dn.$$.fragment,n),hn=!0)},o(n){F(G.$$.fragment,n),F(bn,n),F(rn.$$.fragment,n),F(dn.$$.fragment,n),hn=!1},d(n){i(s),i(t),i(e),i(o),i(p),i(h),i(x),i(j),i(A),i(T),i(S),k(wn,n),i(L),i(O),i(C),n&&M.d(),i(N),n&&q.d(),n&&i(R),n&&i($),n&&i(D),_(G,n),n&&i(z),n&&i(V),k(vn,n),bn&&bn.d(n),n&&i(ln),n&&i(un),_(rn),_(dn)}}}function un(n,a,s){let{title:t=""}=a,{description:e=""}=a,{tags:o=[]}=a;const p={"@type":"Person",name:"Tan Li Hau"};let{$$slots:c={},$$scope:l}=a;return n.$set=n=>{"title"in n&&s(0,t=n.title),"description"in n&&s(1,e=n.description),"tags"in n&&s(2,o=n.tags),"$$scope"in n&&s(4,l=n.$$scope)},[t,e,o,p,l,c]}class rn extends Y{constructor(n){super(),V(this,n,un,ln,p,{title:0,description:1,tags:2})}}function kn(a){let s,t,e,o,p,c,l,k,h,g,I,x,P,j,A,T,S,L,O,M,C,q,N,R,$,H,D,G,B,F,J,U,W,_,z,V,Y,K,Z,Q,X,nn,an,sn,tn,en,on,pn,cn,ln,un,rn,kn,dn,hn,fn,mn,gn,wn,yn,vn,En,bn,In,xn,Pn,jn,An,Tn,Sn,Ln,On,Mn,Cn,qn,Nn,Rn,$n,Hn,Dn,Gn,Bn,Fn,Jn,Un,Wn,_n,zn,Vn,Yn,Kn,Zn,Qn,Xn,na,aa,sa,ta,ea,oa,pa,ca,la,ua,ra,ia,ka,da,ha,fa,ma,ga,wa,ya,va,Ea,ba,Ia,xa,Pa,ja,Aa,Ta,Sa,La,Oa,Ma,Ca,qa,Na,Ra,$a,Ha,Da,Ga,Ba,Fa,Ja,Ua,Wa,_a,za,Va,Ya,Ka,Za,Qa,Xa,ns,as,ss,ts,es,os,ps,cs,ls,us,rs,is,ks,ds,hs,fs,ms,gs,ws,ys,vs,Es,bs,Is,xs,Ps,js,As,Ts,Ss,Ls,Os,Ms,Cs,qs,Ns,Rs,$s,Hs,Ds,Gs,Bs,Fs,Js,Us,Ws,_s,zs,Vs,Ys,Ks,Zs,Qs,Xs,nt,at,st,tt,et,ot,pt,ct,lt,ut,rt,it,kt,dt,ht,ft,mt,gt,wt,yt,vt,Et,bt,It,xt,Pt,jt,At,Tt,St,Lt,Ot,Mt,Ct,qt,Nt,Rt,$t,Ht,Dt,Gt,Bt,Ft,Jt,Ut,Wt,_t,zt,Vt,Yt,Kt,Zt,Qt,Xt,ne,ae,se,te,ee,oe,pe,ce,le,ue,re,ie,ke,de,he,fe,me,ge,we,ye,ve,Ee,be,Ie,xe,Pe,je,Ae,Te,Se,Le,Oe,Me,Ce,qe,Ne,Re,$e,He,De,Ge,Be,Fe,Je,Ue,We,_e,ze,Ve,Ye,Ke,Ze,Qe,Xe,no,ao,so,to,eo,oo,po,co,lo,uo,ro,io,ko,ho,fo,mo,go,wo,yo,vo,Eo,bo,Io,xo,Po,jo,Ao,To,So,Lo,Oo,Mo,Co,qo,No,Ro,$o,Ho,Do,Go,Bo,Fo,Jo,Uo,Wo,_o,zo,Vo,Yo,Ko,Zo,Qo,Xo,np,ap,sp,tp,ep,op,pp,cp,lp,up,rp,ip,kp,dp,hp,fp,mp,gp,wp,yp,vp,Ep,bp,Ip,xp,Pp,jp,Ap,Tp,Sp,Lp,Op,Mp,Cp,qp,Np,Rp,$p,Hp,Dp,Gp,Bp,Fp,Jp,Up,Wp,_p,zp,Vp,Yp,Kp,Zp,Qp,Xp,nc,ac,sc,tc,ec,oc,pc,cc,lc,uc,rc,ic,kc,dc,hc,fc,mc,gc,wc,yc,vc,Ec,bc,Ic,xc,Pc,jc,Ac,Tc,Sc,Lc,Oc,Mc,Cc,qc,Nc,Rc,$c,Hc,Dc,Gc,Bc,Fc,Jc,Uc,Wc,_c,zc,Vc,Yc,Kc,Zc,Qc,Xc,nl,al,sl,tl,el,ol,pl,cl,ll,ul,rl,il,kl,dl,hl,fl,ml,gl,wl,yl,vl,El,bl,Il,xl,Pl,jl,Al,Tl,Sl,Ll,Ol,Ml,Cl,ql,Nl,Rl,$l,Hl,Dl,Gl,Bl,Fl,Jl,Ul,Wl,_l,zl,Vl,Yl,Kl,Zl,Ql,Xl,nu,au,su,tu,eu,ou,pu,cu,lu,uu,ru,iu,ku,du,hu,fu,mu,gu,wu,yu,vu,Eu,bu,Iu,xu,Pu,ju,Au,Tu,Su,Lu,Ou,Mu,Cu,qu,Nu,Ru,$u,Hu,Du,Gu,Bu,Fu,Ju,Uu,Wu,_u,zu,Vu,Yu,Ku,Zu,Qu,Xu,nr,ar,sr,tr,er,or,pr,cr,lr,ur,rr,ir,kr,dr,hr,fr,mr,gr,wr,yr,vr,Er,br,Ir,xr,Pr,jr,Ar,Tr,Sr,Lr,Or,Mr,Cr,qr,Nr,Rr,$r,Hr,Dr,Gr,Br,Fr,Jr,Ur,Wr,_r,zr,Vr,Yr,Kr,Zr,Qr,Xr,ni,ai,si,ti,ei,oi,pi,ci,li,ui,ri,ii,ki,di,hi,fi,mi,gi,wi,yi,vi,Ei,bi,Ii,xi,Pi,ji,Ai,Ti,Si,Li,Oi,Mi,Ci,qi,Ni,Ri,$i,Hi,Di,Gi,Bi,Fi,Ji,Ui,Wi,_i,zi,Vi,Yi,Ki,Zi,Qi,Xi,nk,ak,sk,tk,ek,ok,pk,ck,lk,uk,rk,ik,kk,dk,hk,fk,mk,gk,wk,yk,vk,Ek,bk,Ik,xk,Pk,jk,Ak,Tk,Sk,Lk,Ok,Mk,Ck,qk,Nk,Rk,$k,Hk,Dk,Gk,Bk,Fk,Jk,Uk,Wk,_k,zk,Vk,Yk,Kk,Zk,Qk,Xk,nd,ad,sd,td,ed,od,pd,cd,ld,ud,rd,id,kd,dd,hd,fd,md,gd,wd,yd,vd;return{c(){s=d("section"),t=d("ul"),e=d("li"),o=d("a"),p=f("Getting Started"),c=d("ul"),l=d("li"),k=d("a"),h=f("The Input"),g=d("li"),I=d("a"),x=f("Writing"),P=d("li"),j=d("a"),A=f("Resolving"),T=d("li"),S=d("a"),L=f("Bundling"),O=d("ul"),M=d("li"),C=d("a"),q=f("Grouping modules into files"),N=d("li"),R=d("a"),$=f("Creating module map"),H=d("li"),D=d("a"),G=d("li"),B=d("a"),F=f("Optimisation"),J=d("ul"),U=d("li"),W=d("a"),_=f("Circular dependency"),z=d("li"),V=d("a"),Y=f("Summary"),K=d("ul"),Z=d("li"),Q=d("a"),X=f("Whats next?"),nn=d("li"),an=d("a"),sn=f("Further Readings"),tn=m(),en=d("p"),on=f("In my "),pn=d("a"),cn=f("previous article"),ln=f(", I explained how module bundler works. I used "),un=d("a"),rn=f("webpack"),kn=f(" and "),dn=d("a"),hn=f("rollup"),fn=f(" as example, how each of them gave us a different perspective on how we can bundle our JavaScript application."),mn=m(),gn=d("p"),wn=f("In this article, I am going to show you how I wrote my module bundler. The module bundler itself is not production-ready, yet I learned a ton through the exercise, and I am ever more appreciative of what modern module bundlers have provided."),yn=m(),vn=d("hr"),En=m(),bn=d("p"),In=f("⚠️ "),xn=d("strong"),Pn=f("Warning: Tons of JavaScript code ahead. 🙈😱😨"),jn=f(" ⚠️"),An=m(),Tn=d("hr"),Sn=m(),Ln=d("section"),On=d("h2"),Mn=d("a"),Cn=f("Getting Started"),qn=m(),Nn=d("p"),Rn=f("I talked about the input (the JavaScript modules) and the output (the bundled JavaScript file) of a module bundler in "),$n=d("a"),Hn=f("my previous article"),Dn=f(". Now it's time to write a module bundler that takes in the input and produces the output."),Gn=m(),Bn=d("p"),Fn=f("A "),Jn=d("em"),Un=f("basic"),Wn=f(" module bundler can be broken down into 2 parts:"),_n=m(),zn=d("ul"),Vn=d("li"),Yn=f("Understands the code and constructs the dependency graph "),Kn=d("strong"),Zn=f("(Dependency Resolution)"),Qn=m(),Xn=d("li"),na=f("Assembles the module into a single (or multiple) JavaScript file "),aa=d("strong"),sa=f("(Bundle)"),ta=m(),ea=d("blockquote"),oa=d("p"),pa=f("A "),ca=d("strong"),la=f("dependency graph"),ua=f(" is a graph representation of the dependency relationship between modules."),ra=m(),ia=d("section"),ka=d("h3"),da=d("a"),ha=f("The Input"),fa=m(),ma=d("p"),ga=f("In this article, I will be using following files as my input to the bundler:"),wa=m(),ya=d("pre"),va=m(),Ea=d("pre"),ba=m(),Ia=d("pre"),xa=m(),Pa=d("p"),ja=f("I've created the project on "),Aa=d("a"),Ta=f("Github"),Sa=f(", so if you are interested to try out yourself, you can clone it and checkout the "),La=d("code"),Oa=f("fixture-1"),Ma=f(" tag. The input files are in the "),Ca=d("code"),qa=f("fixture/"),Na=f(" folder."),Ra=m(),$a=d("section"),Ha=d("h2"),Da=d("a"),Ga=f("Writing"),Ba=m(),Fa=d("p"),Ja=f("I started with the main structure of the module bundler:"),Ua=m(),Wa=d("pre"),_a=m(),za=d("blockquote"),Va=d("p"),Ya=f("The "),Ka=d("strong"),Za=f("dependency graph"),Qa=f(" is a "),Xa=d("a"),ns=f("directed graph"),as=f(", where the vertex is the module, and the directed edge is the dependency relationship between the modules."),ss=m(),ts=d("pre"),es=m(),os=d("p"),ps=f('So, the entry module is "the root" of the graph.'),cs=m(),ls=d("p"),us=f("In "),rs=d("code"),is=f("createModule"),ks=f(", I instantiate a new "),ds=d("code"),hs=f("Module"),fs=f(" instance:"),ms=m(),gs=d("pre"),ws=m(),ys=d("p"),vs=f("The class "),Es=d("code"),bs=f("Module"),Is=f(" will be used to record module properties, such as the content, the dependencies, exported keys, etc."),xs=m(),Ps=d("pre"),js=m(),As=d("p"),Ts=f("While the "),Ss=d("code"),Ls=f("content"),Os=f(" is the string content of the module, to understand what it actually means, I used "),Ms=d("a"),Cs=f("babel"),qs=f(" to "),Ns=d("em"),Rs=f("parse the content"),$s=f(" into AST (Abstract Syntax Tree):"),Hs=m(),Ds=d("pre"),Gs=m(),Bs=d("p"),Fs=f("Next, I need to find out the dependency of this module:"),Js=m(),Us=d("pre"),Ws=m(),_s=d("p"),zs=f("So, how can I know what are the dependencies of this module?"),Vs=m(),Ys=d("p"),Ks=f("I can look for the "),Zs=d("code"),Qs=f("import"),Xs=f(" statement from the AST with the help of the\n"),nt=d("a"),at=f("babel-ast-explorer"),st=f("."),tt=m(),et=d("p"),ot=d("picture"),pt=d("source"),ct=d("source"),lt=d("img"),ut=m(),rt=d("p"),it=f("I found out that the "),kt=d("code"),dt=f("import"),ht=f(" statement in the AST is called the "),ft=d("code"),mt=f("ImportDeclaration"),gt=f(". It has "),wt=d("code"),yt=f("specifiers"),vt=f(" and "),Et=d("code"),bt=f("source"),It=f(", which the "),xt=d("code"),Pt=f("source.value"),jt=f(" tells us what this module is importing from:"),At=m(),Tt=d("pre"),St=m(),Lt=d("p"),Ot=f("So I had the path that the module is requesting, but it could be relative to the current file, eg "),Mt=d("code"),Ct=f('"./foo/bar"'),qt=f(", or from the "),Nt=d("code"),Rt=f("node_modules"),$t=f(", eg: "),Ht=d("code"),Dt=f('"lodash"'),Gt=f(". How do I know what is the "),Bt=d("strong"),Ft=f("actual file path"),Jt=f(" that the module is requesting?"),Ut=m(),Wt=d("p"),_t=f("The step of figuring out the actual path based on the requested path, is called "),zt=d("strong"),Vt=f('"Resolving"'),Yt=f(":"),Kt=m(),Zt=d("pre"),Qt=m(),Xt=d("p"),ne=d("em"),ae=f("Resolving path to the actual file path"),se=m(),te=d("section"),ee=d("h2"),oe=d("a"),pe=f("Resolving"),ce=m(),le=d("p"),ue=f('Let\'s talk about resolving. We know that "import"ing '),re=d("code"),ie=f("./b.js"),ke=f(" in the following examples will result in getting a different file, because when we specify "),de=d("code"),he=f("./"),fe=f(', we are "import"ing relative to the current file.'),me=m(),ge=d("pre"),we=m(),ye=d("pre"),ve=m(),Ee=d("p"),be=f("So, what are the rules of resolving a module?"),Ie=m(),xe=d("p"),Pe=f("The Node.js documentation has listed out the "),je=d("a"),Ae=f("detailed step of the module resolving algorithm"),Te=f(":"),Se=m(),Le=d("p"),Oe=f("When we specify a relative path, "),Me=d("code"),Ce=f("./b"),qe=f(", Node.js will first assume that "),Ne=d("code"),Re=f("./b"),$e=f(" is a file, and tries the following extension if it doesn't exactly match the file name:"),He=m(),De=d("pre"),Ge=m(),Be=d("p"),Fe=f("If the file does not exist, Node.js will then try to treat "),Je=d("code"),Ue=f("./b"),We=f(" as a directory, and try the following:"),_e=m(),ze=d("pre"),Ve=m(),Ye=d("p"),Ke=f("If we specify "),Ze=d("code"),Qe=f("import 'b'"),Xe=f(" instead, Node.js will treat it as a package within "),no=d("code"),ao=f("node_modules/"),so=f(", and have a different resolving strategy."),to=m(),eo=d("p"),oo=f("Through the above illustration, we can see that resolving "),po=d("code"),co=f("import './b'"),lo=f(" is not as simple as it seems. Besides the default Node.js resolving behaviour, "),uo=d("a"),ro=f("webpack provides a lot more customisation options"),io=f(", such as custom extensions, alias, modules folders, etc."),ko=m(),ho=d("p"),fo=f("Here, I am showing you the "),mo=d("em"),go=f('"simplest"'),wo=f(" resolver, which is to resolve relative path only:"),yo=m(),vo=d("pre"),Eo=m(),bo=d("blockquote"),Io=d("small"),xo=f("**Note:** You should try out writing a full node resolvers that resolve relatively as well as absolutely from `node_modules/`"),Po=m(),jo=d("p"),Ao=f("Now I know the actual requested file paths, I then create modules out of them."),To=m(),So=d("pre"),Lo=m(),Oo=d("p"),Mo=f("So, for each module, I find their dependencies, parse them, and find each dependency's dependencies, parse them as well, and find their dependencies, and so forth recursively. At the end of the process, I get a module dependency graph that looks something like this:"),Co=m(),qo=d("pre"),No=m(),Ro=d("p"),$o=f("The root of the graph is our entry module, and you can traverse the graph through the "),Ho=d("code"),Do=f("dependencies"),Go=f(" of the module. As you can see, the "),Bo=d("code"),Fo=f("index.js"),Jo=f(" has 2 dependencies, the "),Uo=d("code"),Wo=f("square.js"),_o=f(" and the "),zo=d("code"),Vo=f("circle.js"),Yo=f("."),Ko=m(),Zo=d("blockquote"),Qo=d("small"),Xo=f("**Note:** If you are following along, you can checkout the tag `feat-1-module-dependency-graph`, to see the code that I had written up till this point."),np=m(),ap=d("section"),sp=d("h2"),tp=d("a"),ep=f("Bundling"),op=m(),pp=d("p"),cp=f("With the module dependency graph, it's time to bundle them into a file!"),lp=m(),up=d("p"),rp=f("At this point in time, we can choose whether we want to bundle it in the "),ip=d("strong"),kp=f('"webpack way"'),dp=f(" or the "),hp=d("strong"),fp=f('"rollup way"'),mp=f(". In this article I am showing you how I did it the "),gp=d("strong"),wp=f('"webpack way"'),yp=f(". I'll write about bundling in the "),vp=d("strong"),Ep=f('"rollup way"'),bp=f(" in the coming article."),Ip=m(),xp=d("blockquote"),Pp=d("p"),jp=f("If you have no idea about what is the "),Ap=d("strong"),Tp=f('"webpack way"'),Sp=f(" or "),Lp=d("strong"),Op=f('"rollup way"'),Mp=f(', I have "coined" the term in my '),Cp=d("a"),qp=f("previous article"),Np=f(" and have detailed explanation about them!"),Rp=m(),$p=d("p"),Hp=f("Let's take a look how the final bundled file would look like:"),Dp=m(),Gp=d("pre"),Bp=m(),Fp=d("p"),Jp=f("Let's break it down to a few steps:"),Up=m(),Wp=d("ul"),_p=d("li"),zp=d("strong"),Vp=f("Group modules into files"),Yp=m(),Kp=d("li"),Zp=d("strong"),Qp=f("Create the module map"),Xp=f(' and wrapping each module in a "special" module factory function'),nc=m(),ac=d("li"),sc=d("strong"),tc=f('Create the "runtime"'),ec=f(", the glue that links each module together."),oc=m(),pc=d("section"),cc=d("h3"),lc=d("a"),uc=f("Grouping modules into files"),rc=m(),ic=d("p"),kc=f("This step is to decide which modules goes to which file. We can split modules into different files because of "),dc=d("a"),hc=f("code splitting"),fc=f(" due to dynamic import as well as optimisation, such as the webpack's "),mc=d("a"),gc=f("Chunk Splitting"),wc=f("."),yc=m(),vc=d("p"),Ec=f("I will support code splitting in the future. For now, I grouped all modules into 1 file."),bc=m(),Ic=d("p"),xc=f("To collect all the modules from module graph into a list of modules, I did a graph traversal:"),Pc=m(),jc=d("pre"),Ac=m(),Tc=d("p"),Sc=f("...and I used the list of modules to create a module map."),Lc=m(),Oc=d("section"),Mc=d("h3"),Cc=d("a"),qc=f("Creating module map"),Nc=m(),Rc=d("p"),$c=f("The module map I created is a string, that would be inlined into the final bundle file."),Hc=m(),Dc=d("p"),Gc=f("I looped through each module, and used "),Bc=d("code"),Fc=f("module.filePath"),Jc=f(" as the key, and "),Uc=d("code"),Wc=f("module.content"),_c=f(" as the value."),zc=m(),Vc=d("p"),Yc=f("The reason I dont use "),Kc=d("code"),Zc=f("JSON.stringify(moduleMap)"),Qc=f(" instead of manually concatenating to build up the module map, is because JSON can only takes in "),Xc=d("a"),nl=f("JSON primitive data type"),al=f(" as value, but what I built here is a JavaScript map, with "),sl=d("code"),tl=f("function"),el=f(" as value, but in string."),ol=m(),pl=d("pre"),cl=m(),ll=d("p"),ul=f("The function that wraps around the "),rl=d("code"),il=f("module.content"),kl=f(" is called the module factory function. It provides 2 parameter to the module:"),dl=m(),hl=d("ul"),fl=d("li"),ml=d("code"),gl=f("exports"),wl=f(", an object that the module can assign its exported value onto"),yl=m(),vl=d("li"),El=d("code"),bl=f("require"),Il=f(", a function that the module can invoke with module path to import exported value from another module"),xl=m(),Pl=d("p"),jl=f("The module map right now is not something that can be executed:"),Al=m(),Tl=d("pre"),Sl=m(),Ll=d("p"),Ol=f("because it still uses "),Ml=d("code"),Cl=f("import"),ql=f(" and "),Nl=d("code"),Rl=f("export"),$l=f(". I had to transform them to use the "),Hl=d("code"),Dl=f("exports"),Gl=f(" and "),Bl=d("code"),Fl=f("require"),Jl=f(" that we pass in."),Ul=m(),Wl=d("p"),_l=f("To transform the code, I used the AST of the module again: trasform the ast and generate the new code from the transformed ast."),zl=m(),Vl=d("p"),Yl=f('What I need is to trasform the "from" to "to" of the following:'),Kl=m(),Zl=d("pre"),Ql=m(),Xl=d("blockquote"),nu=d("p"),au=f("I wrote a "),su=d("a"),tu=f("step by step guide"),eu=f(" on how to write babel transformation, please do check it out."),ou=m(),pu=d("p"),cu=f("Knowing "),lu=d("strong"),uu=f("what to target on AST"),ru=f(" and "),iu=d("strong"),ku=f("how the transformed AST look like"),du=f(", I wrote my transformation code:"),hu=m(),fu=d("pre"),mu=m(),gu=d("p"),wu=f("I omitted the actual babel transformation code, because it is lengthy. If you are interested to read about it, you can check out "),yu=d("a"),vu=f("from my Github repo"),Eu=m(),bu=d("p"),Iu=f("So, now the module map looks ready:"),xu=m(),Pu=d("pre"),ju=m(),Au=d("p"),Tu=f("One thing to take note is that, for the "),Su=d("code"),Lu=f("require"),Ou=f(" statements, I replaced the requested path to the actual resolved path, because I used the actual resolved path as the key to the module map."),Mu=m(),Cu=d("section"),qu=d("h3"),Nu=d("a"),Ru=d("strong"),$u=f('Create the "runtime"'),Hu=m(),Du=d("p"),Gu=f("Now it's time to create the runtime. The runtime is a piece of code that is part of the output bundle, that runs when the application code is running, therefore, the runtime."),Bu=m(),Fu=d("p"),Ju=f("The runtime code can be from a template file, but for simplicity sake, I kept the runtime code as a string:"),Uu=m(),Wu=d("pre"),_u=m(),zu=d("p"),Vu=f("The code above is self explanatory, except if you have no idea what does the "),Yu=d("code"),Ku=f("webpackStart()"),Zu=f(" do, you can read more about it in "),Qu=d("a"),Xu=f("my previous post"),nr=f("."),ar=m(),sr=d("p"),tr=f("Finally, I returned the module code from the "),er=d("code"),or=f("bundle"),pr=f(" function:"),cr=m(),lr=d("pre"),ur=m(),rr=d("p"),ir=f("Now I run my bundler, it generates a "),kr=d("code"),dr=f("output/bundle.js"),hr=f(" file. I run the generated file with node and I see:"),fr=m(),mr=d("pre"),gr=m(),wr=d("p"),yr=f("That's it! A working module bundler!"),vr=m(),Er=d("p"),br=f("Of course, the module bundler I've shown here is "),Ir=d("strong"),xr=f("nowhere near webpack"),Pr=f(". Webpack supports more module system, resolving strategies, loading strategies, plugin system, optimisation, and many many more."),jr=m(),Ar=d("section"),Tr=d("h2"),Sr=d("a"),Lr=f("Optimisation"),Or=m(),Mr=d("p"),Cr=f("I played around my module bundler, and I quickly noticed a bug: "),qr=d("strong"),Nr=f("Circular Dependency"),Rr=f("."),$r=m(),Hr=d("p"),Dr=f("Here's my input files that I've tweaked:"),Gr=m(),Br=d("pre"),Fr=m(),Jr=d("pre"),Ur=m(),Wr=d("p"),_r=f("When I ran it through my module bunlder, immediately it ran into a stack overflow:"),zr=m(),Vr=d("pre"),Yr=m(),Kr=d("section"),Zr=d("h3"),Qr=d("a"),Xr=f("Circular dependency"),ni=m(),ai=d("p"),si=f("There were 2 junctures that the code did recursive traversal which have led to the endless loop:"),ti=m(),ei=d("ul"),oi=d("li"),pi=f("Generating dependency graphs"),ci=m(),li=d("li"),ui=f("Traversing module graph for bundling"),ri=m(),ii=d("pre"),ki=m(),di=d("p"),hi=f("Bundle with the latest code, the stack overflow is gone. However when I executed the output bundle, I saw"),fi=m(),mi=d("pre"),gi=m(),wi=d("p"),yi=f("So I took a look at the output bundle:"),vi=m(),Ei=d("pre"),bi=m(),Ii=d("p"),xi=f("So, the problem is that I destructed "),Pi=d("code"),ji=f("PI"),Ai=f(" from the exports of "),Ti=d("code"),Si=f("index.js"),Li=f(" before it is defined, so naturally "),Oi=d("code"),Mi=f("PI"),Ci=f(" within "),qi=d("code"),Ni=f("circle.js"),Ri=f(" would stay as "),$i=d("code"),Hi=f("undefined"),Di=f(" throughout the application. However before I called "),Gi=d("code"),Bi=f("circleArea"),Fi=f(", we defined "),Ji=d("code"),Ui=f("PI"),Wi=f(" on the "),_i=d("code"),zi=f("index.js"),Vi=f("'s export, I am expecting it to be available."),Yi=m(),Ki=d("p"),Zi=f("So I built my application with webpack and took a look at how webpack solved this problem."),Qi=m(),Xi=d("pre"),nk=m(),ak=d("p"),sk=f("Brilliant! The key is to lazily get the value of "),tk=d("code"),ek=f("PI"),ok=f(" when needed!"),pk=m(),ck=d("p"),lk=f("I changed my babel transformation code, which I am not showing it here. If you are curious enough, you can check out "),uk=d("a"),rk=f("the changes I made from Github"),ik=f("."),kk=m(),dk=d("section"),hk=d("h2"),fk=d("a"),mk=f("Summary"),gk=m(),wk=d("p"),yk=f("There's two phases in module bundling: "),vk=d("strong"),Ek=f("Dependency Resolution"),bk=f(" and "),Ik=d("strong"),xk=f("Bundling"),Pk=f("."),jk=m(),Ak=d("p"),Tk=f("I showed you how I constructed the dependency graph, by finding import statements and resolving modules. I shared how I created module maps and transformed the imports / exports syntax during "),Sk=d("strong"),Lk=f("bundling"),Ok=f(". Lastly, I fixed the circular dependency bug that was in the first version of my module bundler."),Mk=m(),Ck=d("section"),qk=d("h3"),Nk=d("a"),Rk=f("Whats next?"),$k=m(),Hk=d("p"),Dk=f("I have a few ideas that I will add to my module bundler, such as:"),Gk=m(),Bk=d("ul"),Fk=d("li"),Jk=f("code spliting"),Uk=m(),Wk=d("li"),_k=f("watch mode and reloading"),zk=m(),Vk=d("p"),Yk=f("which I will cover them in my next article when they are ready."),Kk=m(),Zk=d("p"),Qk=f("Till then. Cheers. 😎"),Xk=m(),nd=d("section"),ad=d("h2"),sd=d("a"),td=f("Further Readings"),ed=m(),od=d("ul"),pd=d("li"),cd=d("a"),ld=f("Ronen Amiel, Build Your Own Webpack - You Gotta Love Frontend 2018"),ud=m(),rd=d("li"),id=d("a"),kd=f("Luciano Mammino, Unbundling the JavaScript module bundler - DublinJS July 2018"),dd=m(),hd=d("li"),fd=d("a"),md=f("Adam Kelly, Let’s learn how module bundlers work and then write one ourselves"),gd=m(),wd=d("li"),yd=d("a"),vd=f("Webpack founder Tobias Koppers demos bundling live by hand"),this.h()},l(n){s=v(n,"SECTION",{});var a=y(s);t=v(a,"UL",{class:!0,id:!0,role:!0,"aria-label":!0});var u=y(t);e=v(u,"LI",{});var r=y(e);o=v(r,"A",{href:!0});var d=y(o);p=E(d,"Getting Started"),d.forEach(i),r.forEach(i),c=v(u,"UL",{});var f=y(c);l=v(f,"LI",{});var m=y(l);k=v(m,"A",{href:!0});var w=y(k);h=E(w,"The Input"),w.forEach(i),m.forEach(i),f.forEach(i),g=v(u,"LI",{});var Ed=y(g);I=v(Ed,"A",{href:!0});var bd=y(I);x=E(bd,"Writing"),bd.forEach(i),Ed.forEach(i),P=v(u,"LI",{});var Id=y(P);j=v(Id,"A",{href:!0});var xd=y(j);A=E(xd,"Resolving"),xd.forEach(i),Id.forEach(i),T=v(u,"LI",{});var Pd=y(T);S=v(Pd,"A",{href:!0});var jd=y(S);L=E(jd,"Bundling"),jd.forEach(i),Pd.forEach(i),O=v(u,"UL",{});var Ad=y(O);M=v(Ad,"LI",{});var Td=y(M);C=v(Td,"A",{href:!0});var Sd=y(C);q=E(Sd,"Grouping modules into files"),Sd.forEach(i),Td.forEach(i),N=v(Ad,"LI",{});var Ld=y(N);R=v(Ld,"A",{href:!0});var Od=y(R);$=E(Od,"Creating module map"),Od.forEach(i),Ld.forEach(i),H=v(Ad,"LI",{});var Md=y(H);D=v(Md,"A",{href:!0}),y(D).forEach(i),Md.forEach(i),Ad.forEach(i),G=v(u,"LI",{});var Cd=y(G);B=v(Cd,"A",{href:!0});var qd=y(B);F=E(qd,"Optimisation"),qd.forEach(i),Cd.forEach(i),J=v(u,"UL",{});var Nd=y(J);U=v(Nd,"LI",{});var Rd=y(U);W=v(Rd,"A",{href:!0});var $d=y(W);_=E($d,"Circular dependency"),$d.forEach(i),Rd.forEach(i),Nd.forEach(i),z=v(u,"LI",{});var Hd=y(z);V=v(Hd,"A",{href:!0});var Dd=y(V);Y=E(Dd,"Summary"),Dd.forEach(i),Hd.forEach(i),K=v(u,"UL",{});var Gd=y(K);Z=v(Gd,"LI",{});var Bd=y(Z);Q=v(Bd,"A",{href:!0});var Fd=y(Q);X=E(Fd,"Whats next?"),Fd.forEach(i),Bd.forEach(i),Gd.forEach(i),nn=v(u,"LI",{});var Jd=y(nn);an=v(Jd,"A",{href:!0});var Ud=y(an);sn=E(Ud,"Further Readings"),Ud.forEach(i),Jd.forEach(i),u.forEach(i),a.forEach(i),tn=b(n),en=v(n,"P",{});var Wd=y(en);on=E(Wd,"In my "),pn=v(Wd,"A",{href:!0});var _d=y(pn);cn=E(_d,"previous article"),_d.forEach(i),ln=E(Wd,", I explained how module bundler works. I used "),un=v(Wd,"A",{href:!0,rel:!0});var zd=y(un);rn=E(zd,"webpack"),zd.forEach(i),kn=E(Wd," and "),dn=v(Wd,"A",{href:!0,rel:!0});var Vd=y(dn);hn=E(Vd,"rollup"),Vd.forEach(i),fn=E(Wd," as example, how each of them gave us a different perspective on how we can bundle our JavaScript application."),Wd.forEach(i),mn=b(n),gn=v(n,"P",{});var Yd=y(gn);wn=E(Yd,"In this article, I am going to show you how I wrote my module bundler. The module bundler itself is not production-ready, yet I learned a ton through the exercise, and I am ever more appreciative of what modern module bundlers have provided."),Yd.forEach(i),yn=b(n),vn=v(n,"HR",{}),En=b(n),bn=v(n,"P",{});var Kd=y(bn);In=E(Kd,"⚠️ "),xn=v(Kd,"STRONG",{});var Zd=y(xn);Pn=E(Zd,"Warning: Tons of JavaScript code ahead. 🙈😱😨"),Zd.forEach(i),jn=E(Kd," ⚠️"),Kd.forEach(i),An=b(n),Tn=v(n,"HR",{}),Sn=b(n),Ln=v(n,"SECTION",{});var Qd=y(Ln);On=v(Qd,"H2",{});var Xd=y(On);Mn=v(Xd,"A",{href:!0,id:!0});var nh=y(Mn);Cn=E(nh,"Getting Started"),nh.forEach(i),Xd.forEach(i),qn=b(Qd),Nn=v(Qd,"P",{});var ah=y(Nn);Rn=E(ah,"I talked about the input (the JavaScript modules) and the output (the bundled JavaScript file) of a module bundler in "),$n=v(ah,"A",{href:!0});var sh=y($n);Hn=E(sh,"my previous article"),sh.forEach(i),Dn=E(ah,". Now it's time to write a module bundler that takes in the input and produces the output."),ah.forEach(i),Gn=b(Qd),Bn=v(Qd,"P",{});var th=y(Bn);Fn=E(th,"A "),Jn=v(th,"EM",{});var eh=y(Jn);Un=E(eh,"basic"),eh.forEach(i),Wn=E(th," module bundler can be broken down into 2 parts:"),th.forEach(i),_n=b(Qd),zn=v(Qd,"UL",{});var oh=y(zn);Vn=v(oh,"LI",{});var ph=y(Vn);Yn=E(ph,"Understands the code and constructs the dependency graph "),Kn=v(ph,"STRONG",{});var ch=y(Kn);Zn=E(ch,"(Dependency Resolution)"),ch.forEach(i),ph.forEach(i),Qn=b(oh),Xn=v(oh,"LI",{});var lh=y(Xn);na=E(lh,"Assembles the module into a single (or multiple) JavaScript file "),aa=v(lh,"STRONG",{});var uh=y(aa);sa=E(uh,"(Bundle)"),uh.forEach(i),lh.forEach(i),oh.forEach(i),ta=b(Qd),ea=v(Qd,"BLOCKQUOTE",{});var rh=y(ea);oa=v(rh,"P",{});var ih=y(oa);pa=E(ih,"A "),ca=v(ih,"STRONG",{});var kh=y(ca);la=E(kh,"dependency graph"),kh.forEach(i),ua=E(ih," is a graph representation of the dependency relationship between modules."),ih.forEach(i),rh.forEach(i),Qd.forEach(i),ra=b(n),ia=v(n,"SECTION",{});var dh=y(ia);ka=v(dh,"H3",{});var hh=y(ka);da=v(hh,"A",{href:!0,id:!0});var fh=y(da);ha=E(fh,"The Input"),fh.forEach(i),hh.forEach(i),fa=b(dh),ma=v(dh,"P",{});var mh=y(ma);ga=E(mh,"In this article, I will be using following files as my input to the bundler:"),mh.forEach(i),wa=b(dh),ya=v(dh,"PRE",{class:!0}),y(ya).forEach(i),va=b(dh),Ea=v(dh,"PRE",{class:!0}),y(Ea).forEach(i),ba=b(dh),Ia=v(dh,"PRE",{class:!0}),y(Ia).forEach(i),xa=b(dh),Pa=v(dh,"P",{});var gh=y(Pa);ja=E(gh,"I've created the project on "),Aa=v(gh,"A",{href:!0,rel:!0});var wh=y(Aa);Ta=E(wh,"Github"),wh.forEach(i),Sa=E(gh,", so if you are interested to try out yourself, you can clone it and checkout the "),La=v(gh,"CODE",{});var yh=y(La);Oa=E(yh,"fixture-1"),yh.forEach(i),Ma=E(gh," tag. The input files are in the "),Ca=v(gh,"CODE",{});var vh=y(Ca);qa=E(vh,"fixture/"),vh.forEach(i),Na=E(gh," folder."),gh.forEach(i),dh.forEach(i),Ra=b(n),$a=v(n,"SECTION",{});var Eh=y($a);Ha=v(Eh,"H2",{});var bh=y(Ha);Da=v(bh,"A",{href:!0,id:!0});var Ih=y(Da);Ga=E(Ih,"Writing"),Ih.forEach(i),bh.forEach(i),Ba=b(Eh),Fa=v(Eh,"P",{});var xh=y(Fa);Ja=E(xh,"I started with the main structure of the module bundler:"),xh.forEach(i),Ua=b(Eh),Wa=v(Eh,"PRE",{class:!0}),y(Wa).forEach(i),_a=b(Eh),za=v(Eh,"BLOCKQUOTE",{});var Ph=y(za);Va=v(Ph,"P",{});var jh=y(Va);Ya=E(jh,"The "),Ka=v(jh,"STRONG",{});var Ah=y(Ka);Za=E(Ah,"dependency graph"),Ah.forEach(i),Qa=E(jh," is a "),Xa=v(jh,"A",{href:!0,rel:!0});var Th=y(Xa);ns=E(Th,"directed graph"),Th.forEach(i),as=E(jh,", where the vertex is the module, and the directed edge is the dependency relationship between the modules."),jh.forEach(i),Ph.forEach(i),ss=b(Eh),ts=v(Eh,"PRE",{class:!0}),y(ts).forEach(i),es=b(Eh),os=v(Eh,"P",{});var Sh=y(os);ps=E(Sh,'So, the entry module is "the root" of the graph.'),Sh.forEach(i),cs=b(Eh),ls=v(Eh,"P",{});var Lh=y(ls);us=E(Lh,"In "),rs=v(Lh,"CODE",{});var Oh=y(rs);is=E(Oh,"createModule"),Oh.forEach(i),ks=E(Lh,", I instantiate a new "),ds=v(Lh,"CODE",{});var Mh=y(ds);hs=E(Mh,"Module"),Mh.forEach(i),fs=E(Lh," instance:"),Lh.forEach(i),ms=b(Eh),gs=v(Eh,"PRE",{class:!0}),y(gs).forEach(i),ws=b(Eh),ys=v(Eh,"P",{});var Ch=y(ys);vs=E(Ch,"The class "),Es=v(Ch,"CODE",{});var qh=y(Es);bs=E(qh,"Module"),qh.forEach(i),Is=E(Ch," will be used to record module properties, such as the content, the dependencies, exported keys, etc."),Ch.forEach(i),xs=b(Eh),Ps=v(Eh,"PRE",{class:!0}),y(Ps).forEach(i),js=b(Eh),As=v(Eh,"P",{});var Nh=y(As);Ts=E(Nh,"While the "),Ss=v(Nh,"CODE",{});var Rh=y(Ss);Ls=E(Rh,"content"),Rh.forEach(i),Os=E(Nh," is the string content of the module, to understand what it actually means, I used "),Ms=v(Nh,"A",{href:!0,rel:!0});var $h=y(Ms);Cs=E($h,"babel"),$h.forEach(i),qs=E(Nh," to "),Ns=v(Nh,"EM",{});var Hh=y(Ns);Rs=E(Hh,"parse the content"),Hh.forEach(i),$s=E(Nh," into AST (Abstract Syntax Tree):"),Nh.forEach(i),Hs=b(Eh),Ds=v(Eh,"PRE",{class:!0}),y(Ds).forEach(i),Gs=b(Eh),Bs=v(Eh,"P",{});var Dh=y(Bs);Fs=E(Dh,"Next, I need to find out the dependency of this module:"),Dh.forEach(i),Js=b(Eh),Us=v(Eh,"PRE",{class:!0}),y(Us).forEach(i),Ws=b(Eh),_s=v(Eh,"P",{});var Gh=y(_s);zs=E(Gh,"So, how can I know what are the dependencies of this module?"),Gh.forEach(i),Vs=b(Eh),Ys=v(Eh,"P",{});var Bh=y(Ys);Ks=E(Bh,"I can look for the "),Zs=v(Bh,"CODE",{});var Fh=y(Zs);Qs=E(Fh,"import"),Fh.forEach(i),Xs=E(Bh," statement from the AST with the help of the\n"),nt=v(Bh,"A",{href:!0,rel:!0});var Jh=y(nt);at=E(Jh,"babel-ast-explorer"),Jh.forEach(i),st=E(Bh,"."),Bh.forEach(i),tt=b(Eh),et=v(Eh,"P",{});var Uh=y(et);ot=v(Uh,"PICTURE",{});var Wh=y(ot);pt=v(Wh,"SOURCE",{type:!0,srcset:!0}),ct=v(Wh,"SOURCE",{type:!0,srcset:!0}),lt=v(Wh,"IMG",{title:!0,alt:!0,"data-src":!0,loading:!0}),Wh.forEach(i),Uh.forEach(i),ut=b(Eh),rt=v(Eh,"P",{});var _h=y(rt);it=E(_h,"I found out that the "),kt=v(_h,"CODE",{});var zh=y(kt);dt=E(zh,"import"),zh.forEach(i),ht=E(_h," statement in the AST is called the "),ft=v(_h,"CODE",{});var Vh=y(ft);mt=E(Vh,"ImportDeclaration"),Vh.forEach(i),gt=E(_h,". It has "),wt=v(_h,"CODE",{});var Yh=y(wt);yt=E(Yh,"specifiers"),Yh.forEach(i),vt=E(_h," and "),Et=v(_h,"CODE",{});var Kh=y(Et);bt=E(Kh,"source"),Kh.forEach(i),It=E(_h,", which the "),xt=v(_h,"CODE",{});var Zh=y(xt);Pt=E(Zh,"source.value"),Zh.forEach(i),jt=E(_h," tells us what this module is importing from:"),_h.forEach(i),At=b(Eh),Tt=v(Eh,"PRE",{class:!0}),y(Tt).forEach(i),St=b(Eh),Lt=v(Eh,"P",{});var Qh=y(Lt);Ot=E(Qh,"So I had the path that the module is requesting, but it could be relative to the current file, eg "),Mt=v(Qh,"CODE",{});var Xh=y(Mt);Ct=E(Xh,'"./foo/bar"'),Xh.forEach(i),qt=E(Qh,", or from the "),Nt=v(Qh,"CODE",{});var nf=y(Nt);Rt=E(nf,"node_modules"),nf.forEach(i),$t=E(Qh,", eg: "),Ht=v(Qh,"CODE",{});var af=y(Ht);Dt=E(af,'"lodash"'),af.forEach(i),Gt=E(Qh,". How do I know what is the "),Bt=v(Qh,"STRONG",{});var sf=y(Bt);Ft=E(sf,"actual file path"),sf.forEach(i),Jt=E(Qh," that the module is requesting?"),Qh.forEach(i),Ut=b(Eh),Wt=v(Eh,"P",{});var tf=y(Wt);_t=E(tf,"The step of figuring out the actual path based on the requested path, is called "),zt=v(tf,"STRONG",{});var ef=y(zt);Vt=E(ef,'"Resolving"'),ef.forEach(i),Yt=E(tf,":"),tf.forEach(i),Kt=b(Eh),Zt=v(Eh,"PRE",{class:!0}),y(Zt).forEach(i),Qt=b(Eh),Xt=v(Eh,"P",{});var of=y(Xt);ne=v(of,"EM",{});var pf=y(ne);ae=E(pf,"Resolving path to the actual file path"),pf.forEach(i),of.forEach(i),Eh.forEach(i),se=b(n),te=v(n,"SECTION",{});var cf=y(te);ee=v(cf,"H2",{});var lf=y(ee);oe=v(lf,"A",{href:!0,id:!0});var uf=y(oe);pe=E(uf,"Resolving"),uf.forEach(i),lf.forEach(i),ce=b(cf),le=v(cf,"P",{});var rf=y(le);ue=E(rf,'Let\'s talk about resolving. We know that "import"ing '),re=v(rf,"CODE",{});var kf=y(re);ie=E(kf,"./b.js"),kf.forEach(i),ke=E(rf," in the following examples will result in getting a different file, because when we specify "),de=v(rf,"CODE",{});var df=y(de);he=E(df,"./"),df.forEach(i),fe=E(rf,', we are "import"ing relative to the current file.'),rf.forEach(i),me=b(cf),ge=v(cf,"PRE",{class:!0}),y(ge).forEach(i),we=b(cf),ye=v(cf,"PRE",{class:!0}),y(ye).forEach(i),ve=b(cf),Ee=v(cf,"P",{});var hf=y(Ee);be=E(hf,"So, what are the rules of resolving a module?"),hf.forEach(i),Ie=b(cf),xe=v(cf,"P",{});var ff=y(xe);Pe=E(ff,"The Node.js documentation has listed out the "),je=v(ff,"A",{href:!0,rel:!0});var mf=y(je);Ae=E(mf,"detailed step of the module resolving algorithm"),mf.forEach(i),Te=E(ff,":"),ff.forEach(i),Se=b(cf),Le=v(cf,"P",{});var gf=y(Le);Oe=E(gf,"When we specify a relative path, "),Me=v(gf,"CODE",{});var wf=y(Me);Ce=E(wf,"./b"),wf.forEach(i),qe=E(gf,", Node.js will first assume that "),Ne=v(gf,"CODE",{});var yf=y(Ne);Re=E(yf,"./b"),yf.forEach(i),$e=E(gf," is a file, and tries the following extension if it doesn't exactly match the file name:"),gf.forEach(i),He=b(cf),De=v(cf,"PRE",{class:!0}),y(De).forEach(i),Ge=b(cf),Be=v(cf,"P",{});var vf=y(Be);Fe=E(vf,"If the file does not exist, Node.js will then try to treat "),Je=v(vf,"CODE",{});var Ef=y(Je);Ue=E(Ef,"./b"),Ef.forEach(i),We=E(vf," as a directory, and try the following:"),vf.forEach(i),_e=b(cf),ze=v(cf,"PRE",{class:!0}),y(ze).forEach(i),Ve=b(cf),Ye=v(cf,"P",{});var bf=y(Ye);Ke=E(bf,"If we specify "),Ze=v(bf,"CODE",{});var If=y(Ze);Qe=E(If,"import 'b'"),If.forEach(i),Xe=E(bf," instead, Node.js will treat it as a package within "),no=v(bf,"CODE",{});var xf=y(no);ao=E(xf,"node_modules/"),xf.forEach(i),so=E(bf,", and have a different resolving strategy."),bf.forEach(i),to=b(cf),eo=v(cf,"P",{});var Pf=y(eo);oo=E(Pf,"Through the above illustration, we can see that resolving "),po=v(Pf,"CODE",{});var jf=y(po);co=E(jf,"import './b'"),jf.forEach(i),lo=E(Pf," is not as simple as it seems. Besides the default Node.js resolving behaviour, "),uo=v(Pf,"A",{href:!0,rel:!0});var Af=y(uo);ro=E(Af,"webpack provides a lot more customisation options"),Af.forEach(i),io=E(Pf,", such as custom extensions, alias, modules folders, etc."),Pf.forEach(i),ko=b(cf),ho=v(cf,"P",{});var Tf=y(ho);fo=E(Tf,"Here, I am showing you the "),mo=v(Tf,"EM",{});var Sf=y(mo);go=E(Sf,'"simplest"'),Sf.forEach(i),wo=E(Tf," resolver, which is to resolve relative path only:"),Tf.forEach(i),yo=b(cf),vo=v(cf,"PRE",{class:!0}),y(vo).forEach(i),Eo=b(cf),bo=v(cf,"BLOCKQUOTE",{});var Lf=y(bo);Io=v(Lf,"SMALL",{});var Of=y(Io);xo=E(Of,"**Note:** You should try out writing a full node resolvers that resolve relatively as well as absolutely from `node_modules/`"),Of.forEach(i),Lf.forEach(i),Po=b(cf),jo=v(cf,"P",{});var Mf=y(jo);Ao=E(Mf,"Now I know the actual requested file paths, I then create modules out of them."),Mf.forEach(i),To=b(cf),So=v(cf,"PRE",{class:!0}),y(So).forEach(i),Lo=b(cf),Oo=v(cf,"P",{});var Cf=y(Oo);Mo=E(Cf,"So, for each module, I find their dependencies, parse them, and find each dependency's dependencies, parse them as well, and find their dependencies, and so forth recursively. At the end of the process, I get a module dependency graph that looks something like this:"),Cf.forEach(i),Co=b(cf),qo=v(cf,"PRE",{class:!0}),y(qo).forEach(i),No=b(cf),Ro=v(cf,"P",{});var qf=y(Ro);$o=E(qf,"The root of the graph is our entry module, and you can traverse the graph through the "),Ho=v(qf,"CODE",{});var Nf=y(Ho);Do=E(Nf,"dependencies"),Nf.forEach(i),Go=E(qf," of the module. As you can see, the "),Bo=v(qf,"CODE",{});var Rf=y(Bo);Fo=E(Rf,"index.js"),Rf.forEach(i),Jo=E(qf," has 2 dependencies, the "),Uo=v(qf,"CODE",{});var $f=y(Uo);Wo=E($f,"square.js"),$f.forEach(i),_o=E(qf," and the "),zo=v(qf,"CODE",{});var Hf=y(zo);Vo=E(Hf,"circle.js"),Hf.forEach(i),Yo=E(qf,"."),qf.forEach(i),Ko=b(cf),Zo=v(cf,"BLOCKQUOTE",{});var Df=y(Zo);Qo=v(Df,"SMALL",{});var Gf=y(Qo);Xo=E(Gf,"**Note:** If you are following along, you can checkout the tag `feat-1-module-dependency-graph`, to see the code that I had written up till this point."),Gf.forEach(i),Df.forEach(i),cf.forEach(i),np=b(n),ap=v(n,"SECTION",{});var Bf=y(ap);sp=v(Bf,"H2",{});var Ff=y(sp);tp=v(Ff,"A",{href:!0,id:!0});var Jf=y(tp);ep=E(Jf,"Bundling"),Jf.forEach(i),Ff.forEach(i),op=b(Bf),pp=v(Bf,"P",{});var Uf=y(pp);cp=E(Uf,"With the module dependency graph, it's time to bundle them into a file!"),Uf.forEach(i),lp=b(Bf),up=v(Bf,"P",{});var Wf=y(up);rp=E(Wf,"At this point in time, we can choose whether we want to bundle it in the "),ip=v(Wf,"STRONG",{});var _f=y(ip);kp=E(_f,'"webpack way"'),_f.forEach(i),dp=E(Wf," or the "),hp=v(Wf,"STRONG",{});var zf=y(hp);fp=E(zf,'"rollup way"'),zf.forEach(i),mp=E(Wf,". In this article I am showing you how I did it the "),gp=v(Wf,"STRONG",{});var Vf=y(gp);wp=E(Vf,'"webpack way"'),Vf.forEach(i),yp=E(Wf,". I'll write about bundling in the "),vp=v(Wf,"STRONG",{});var Yf=y(vp);Ep=E(Yf,'"rollup way"'),Yf.forEach(i),bp=E(Wf," in the coming article."),Wf.forEach(i),Ip=b(Bf),xp=v(Bf,"BLOCKQUOTE",{});var Kf=y(xp);Pp=v(Kf,"P",{});var Zf=y(Pp);jp=E(Zf,"If you have no idea about what is the "),Ap=v(Zf,"STRONG",{});var Qf=y(Ap);Tp=E(Qf,'"webpack way"'),Qf.forEach(i),Sp=E(Zf," or "),Lp=v(Zf,"STRONG",{});var Xf=y(Lp);Op=E(Xf,'"rollup way"'),Xf.forEach(i),Mp=E(Zf,', I have "coined" the term in my '),Cp=v(Zf,"A",{href:!0});var nm=y(Cp);qp=E(nm,"previous article"),nm.forEach(i),Np=E(Zf," and have detailed explanation about them!"),Zf.forEach(i),Kf.forEach(i),Rp=b(Bf),$p=v(Bf,"P",{});var am=y($p);Hp=E(am,"Let's take a look how the final bundled file would look like:"),am.forEach(i),Dp=b(Bf),Gp=v(Bf,"PRE",{class:!0}),y(Gp).forEach(i),Bp=b(Bf),Fp=v(Bf,"P",{});var sm=y(Fp);Jp=E(sm,"Let's break it down to a few steps:"),sm.forEach(i),Up=b(Bf),Wp=v(Bf,"UL",{});var tm=y(Wp);_p=v(tm,"LI",{});var em=y(_p);zp=v(em,"STRONG",{});var om=y(zp);Vp=E(om,"Group modules into files"),om.forEach(i),em.forEach(i),Yp=b(tm),Kp=v(tm,"LI",{});var pm=y(Kp);Zp=v(pm,"STRONG",{});var cm=y(Zp);Qp=E(cm,"Create the module map"),cm.forEach(i),Xp=E(pm,' and wrapping each module in a "special" module factory function'),pm.forEach(i),nc=b(tm),ac=v(tm,"LI",{});var lm=y(ac);sc=v(lm,"STRONG",{});var um=y(sc);tc=E(um,'Create the "runtime"'),um.forEach(i),ec=E(lm,", the glue that links each module together."),lm.forEach(i),tm.forEach(i),Bf.forEach(i),oc=b(n),pc=v(n,"SECTION",{});var rm=y(pc);cc=v(rm,"H3",{});var im=y(cc);lc=v(im,"A",{href:!0,id:!0});var km=y(lc);uc=E(km,"Grouping modules into files"),km.forEach(i),im.forEach(i),rc=b(rm),ic=v(rm,"P",{});var dm=y(ic);kc=E(dm,"This step is to decide which modules goes to which file. We can split modules into different files because of "),dc=v(dm,"A",{href:!0,rel:!0});var hm=y(dc);hc=E(hm,"code splitting"),hm.forEach(i),fc=E(dm," due to dynamic import as well as optimisation, such as the webpack's "),mc=v(dm,"A",{href:!0,rel:!0});var fm=y(mc);gc=E(fm,"Chunk Splitting"),fm.forEach(i),wc=E(dm,"."),dm.forEach(i),yc=b(rm),vc=v(rm,"P",{});var mm=y(vc);Ec=E(mm,"I will support code splitting in the future. For now, I grouped all modules into 1 file."),mm.forEach(i),bc=b(rm),Ic=v(rm,"P",{});var gm=y(Ic);xc=E(gm,"To collect all the modules from module graph into a list of modules, I did a graph traversal:"),gm.forEach(i),Pc=b(rm),jc=v(rm,"PRE",{class:!0}),y(jc).forEach(i),Ac=b(rm),Tc=v(rm,"P",{});var wm=y(Tc);Sc=E(wm,"...and I used the list of modules to create a module map."),wm.forEach(i),rm.forEach(i),Lc=b(n),Oc=v(n,"SECTION",{});var ym=y(Oc);Mc=v(ym,"H3",{});var vm=y(Mc);Cc=v(vm,"A",{href:!0,id:!0});var Em=y(Cc);qc=E(Em,"Creating module map"),Em.forEach(i),vm.forEach(i),Nc=b(ym),Rc=v(ym,"P",{});var bm=y(Rc);$c=E(bm,"The module map I created is a string, that would be inlined into the final bundle file."),bm.forEach(i),Hc=b(ym),Dc=v(ym,"P",{});var Im=y(Dc);Gc=E(Im,"I looped through each module, and used "),Bc=v(Im,"CODE",{});var xm=y(Bc);Fc=E(xm,"module.filePath"),xm.forEach(i),Jc=E(Im," as the key, and "),Uc=v(Im,"CODE",{});var Pm=y(Uc);Wc=E(Pm,"module.content"),Pm.forEach(i),_c=E(Im," as the value."),Im.forEach(i),zc=b(ym),Vc=v(ym,"P",{});var jm=y(Vc);Yc=E(jm,"The reason I dont use "),Kc=v(jm,"CODE",{});var Am=y(Kc);Zc=E(Am,"JSON.stringify(moduleMap)"),Am.forEach(i),Qc=E(jm," instead of manually concatenating to build up the module map, is because JSON can only takes in "),Xc=v(jm,"A",{href:!0,rel:!0});var Tm=y(Xc);nl=E(Tm,"JSON primitive data type"),Tm.forEach(i),al=E(jm," as value, but what I built here is a JavaScript map, with "),sl=v(jm,"CODE",{});var Sm=y(sl);tl=E(Sm,"function"),Sm.forEach(i),el=E(jm," as value, but in string."),jm.forEach(i),ol=b(ym),pl=v(ym,"PRE",{class:!0}),y(pl).forEach(i),cl=b(ym),ll=v(ym,"P",{});var Lm=y(ll);ul=E(Lm,"The function that wraps around the "),rl=v(Lm,"CODE",{});var Om=y(rl);il=E(Om,"module.content"),Om.forEach(i),kl=E(Lm," is called the module factory function. It provides 2 parameter to the module:"),Lm.forEach(i),dl=b(ym),hl=v(ym,"UL",{});var Mm=y(hl);fl=v(Mm,"LI",{});var Cm=y(fl);ml=v(Cm,"CODE",{});var qm=y(ml);gl=E(qm,"exports"),qm.forEach(i),wl=E(Cm,", an object that the module can assign its exported value onto"),Cm.forEach(i),yl=b(Mm),vl=v(Mm,"LI",{});var Nm=y(vl);El=v(Nm,"CODE",{});var Rm=y(El);bl=E(Rm,"require"),Rm.forEach(i),Il=E(Nm,", a function that the module can invoke with module path to import exported value from another module"),Nm.forEach(i),Mm.forEach(i),xl=b(ym),Pl=v(ym,"P",{});var $m=y(Pl);jl=E($m,"The module map right now is not something that can be executed:"),$m.forEach(i),Al=b(ym),Tl=v(ym,"PRE",{class:!0}),y(Tl).forEach(i),Sl=b(ym),Ll=v(ym,"P",{});var Hm=y(Ll);Ol=E(Hm,"because it still uses "),Ml=v(Hm,"CODE",{});var Dm=y(Ml);Cl=E(Dm,"import"),Dm.forEach(i),ql=E(Hm," and "),Nl=v(Hm,"CODE",{});var Gm=y(Nl);Rl=E(Gm,"export"),Gm.forEach(i),$l=E(Hm,". I had to transform them to use the "),Hl=v(Hm,"CODE",{});var Bm=y(Hl);Dl=E(Bm,"exports"),Bm.forEach(i),Gl=E(Hm," and "),Bl=v(Hm,"CODE",{});var Fm=y(Bl);Fl=E(Fm,"require"),Fm.forEach(i),Jl=E(Hm," that we pass in."),Hm.forEach(i),Ul=b(ym),Wl=v(ym,"P",{});var Jm=y(Wl);_l=E(Jm,"To transform the code, I used the AST of the module again: trasform the ast and generate the new code from the transformed ast."),Jm.forEach(i),zl=b(ym),Vl=v(ym,"P",{});var Um=y(Vl);Yl=E(Um,'What I need is to trasform the "from" to "to" of the following:'),Um.forEach(i),Kl=b(ym),Zl=v(ym,"PRE",{class:!0}),y(Zl).forEach(i),Ql=b(ym),Xl=v(ym,"BLOCKQUOTE",{});var Wm=y(Xl);nu=v(Wm,"P",{});var _m=y(nu);au=E(_m,"I wrote a "),su=v(_m,"A",{href:!0});var zm=y(su);tu=E(zm,"step by step guide"),zm.forEach(i),eu=E(_m," on how to write babel transformation, please do check it out."),_m.forEach(i),Wm.forEach(i),ou=b(ym),pu=v(ym,"P",{});var Vm=y(pu);cu=E(Vm,"Knowing "),lu=v(Vm,"STRONG",{});var Ym=y(lu);uu=E(Ym,"what to target on AST"),Ym.forEach(i),ru=E(Vm," and "),iu=v(Vm,"STRONG",{});var Km=y(iu);ku=E(Km,"how the transformed AST look like"),Km.forEach(i),du=E(Vm,", I wrote my transformation code:"),Vm.forEach(i),hu=b(ym),fu=v(ym,"PRE",{class:!0}),y(fu).forEach(i),mu=b(ym),gu=v(ym,"P",{});var Zm=y(gu);wu=E(Zm,"I omitted the actual babel transformation code, because it is lengthy. If you are interested to read about it, you can check out "),yu=v(Zm,"A",{href:!0,rel:!0});var Qm=y(yu);vu=E(Qm,"from my Github repo"),Qm.forEach(i),Zm.forEach(i),Eu=b(ym),bu=v(ym,"P",{});var Xm=y(bu);Iu=E(Xm,"So, now the module map looks ready:"),Xm.forEach(i),xu=b(ym),Pu=v(ym,"PRE",{class:!0}),y(Pu).forEach(i),ju=b(ym),Au=v(ym,"P",{});var ng=y(Au);Tu=E(ng,"One thing to take note is that, for the "),Su=v(ng,"CODE",{});var ag=y(Su);Lu=E(ag,"require"),ag.forEach(i),Ou=E(ng," statements, I replaced the requested path to the actual resolved path, because I used the actual resolved path as the key to the module map."),ng.forEach(i),ym.forEach(i),Mu=b(n),Cu=v(n,"SECTION",{});var sg=y(Cu);qu=v(sg,"H3",{});var tg=y(qu);Nu=v(tg,"A",{href:!0,id:!0});var eg=y(Nu);Ru=v(eg,"STRONG",{});var og=y(Ru);$u=E(og,'Create the "runtime"'),og.forEach(i),eg.forEach(i),tg.forEach(i),Hu=b(sg),Du=v(sg,"P",{});var pg=y(Du);Gu=E(pg,"Now it's time to create the runtime. The runtime is a piece of code that is part of the output bundle, that runs when the application code is running, therefore, the runtime."),pg.forEach(i),Bu=b(sg),Fu=v(sg,"P",{});var cg=y(Fu);Ju=E(cg,"The runtime code can be from a template file, but for simplicity sake, I kept the runtime code as a string:"),cg.forEach(i),Uu=b(sg),Wu=v(sg,"PRE",{class:!0}),y(Wu).forEach(i),_u=b(sg),zu=v(sg,"P",{});var lg=y(zu);Vu=E(lg,"The code above is self explanatory, except if you have no idea what does the "),Yu=v(lg,"CODE",{});var ug=y(Yu);Ku=E(ug,"webpackStart()"),ug.forEach(i),Zu=E(lg," do, you can read more about it in "),Qu=v(lg,"A",{href:!0});var rg=y(Qu);Xu=E(rg,"my previous post"),rg.forEach(i),nr=E(lg,"."),lg.forEach(i),ar=b(sg),sr=v(sg,"P",{});var ig=y(sr);tr=E(ig,"Finally, I returned the module code from the "),er=v(ig,"CODE",{});var kg=y(er);or=E(kg,"bundle"),kg.forEach(i),pr=E(ig," function:"),ig.forEach(i),cr=b(sg),lr=v(sg,"PRE",{class:!0}),y(lr).forEach(i),ur=b(sg),rr=v(sg,"P",{});var dg=y(rr);ir=E(dg,"Now I run my bundler, it generates a "),kr=v(dg,"CODE",{});var hg=y(kr);dr=E(hg,"output/bundle.js"),hg.forEach(i),hr=E(dg," file. I run the generated file with node and I see:"),dg.forEach(i),fr=b(sg),mr=v(sg,"PRE",{class:!0}),y(mr).forEach(i),gr=b(sg),wr=v(sg,"P",{});var fg=y(wr);yr=E(fg,"That's it! A working module bundler!"),fg.forEach(i),vr=b(sg),Er=v(sg,"P",{});var mg=y(Er);br=E(mg,"Of course, the module bundler I've shown here is "),Ir=v(mg,"STRONG",{});var gg=y(Ir);xr=E(gg,"nowhere near webpack"),gg.forEach(i),Pr=E(mg,". Webpack supports more module system, resolving strategies, loading strategies, plugin system, optimisation, and many many more."),mg.forEach(i),sg.forEach(i),jr=b(n),Ar=v(n,"SECTION",{});var wg=y(Ar);Tr=v(wg,"H2",{});var yg=y(Tr);Sr=v(yg,"A",{href:!0,id:!0});var vg=y(Sr);Lr=E(vg,"Optimisation"),vg.forEach(i),yg.forEach(i),Or=b(wg),Mr=v(wg,"P",{});var Eg=y(Mr);Cr=E(Eg,"I played around my module bundler, and I quickly noticed a bug: "),qr=v(Eg,"STRONG",{});var bg=y(qr);Nr=E(bg,"Circular Dependency"),bg.forEach(i),Rr=E(Eg,"."),Eg.forEach(i),$r=b(wg),Hr=v(wg,"P",{});var Ig=y(Hr);Dr=E(Ig,"Here's my input files that I've tweaked:"),Ig.forEach(i),Gr=b(wg),Br=v(wg,"PRE",{class:!0}),y(Br).forEach(i),Fr=b(wg),Jr=v(wg,"PRE",{class:!0}),y(Jr).forEach(i),Ur=b(wg),Wr=v(wg,"P",{});var xg=y(Wr);_r=E(xg,"When I ran it through my module bunlder, immediately it ran into a stack overflow:"),xg.forEach(i),zr=b(wg),Vr=v(wg,"PRE",{class:!0}),y(Vr).forEach(i),wg.forEach(i),Yr=b(n),Kr=v(n,"SECTION",{});var Pg=y(Kr);Zr=v(Pg,"H3",{});var jg=y(Zr);Qr=v(jg,"A",{href:!0,id:!0});var Ag=y(Qr);Xr=E(Ag,"Circular dependency"),Ag.forEach(i),jg.forEach(i),ni=b(Pg),ai=v(Pg,"P",{});var Tg=y(ai);si=E(Tg,"There were 2 junctures that the code did recursive traversal which have led to the endless loop:"),Tg.forEach(i),ti=b(Pg),ei=v(Pg,"UL",{});var Sg=y(ei);oi=v(Sg,"LI",{});var Lg=y(oi);pi=E(Lg,"Generating dependency graphs"),Lg.forEach(i),ci=b(Sg),li=v(Sg,"LI",{});var Og=y(li);ui=E(Og,"Traversing module graph for bundling"),Og.forEach(i),Sg.forEach(i),ri=b(Pg),ii=v(Pg,"PRE",{class:!0}),y(ii).forEach(i),ki=b(Pg),di=v(Pg,"P",{});var Mg=y(di);hi=E(Mg,"Bundle with the latest code, the stack overflow is gone. However when I executed the output bundle, I saw"),Mg.forEach(i),fi=b(Pg),mi=v(Pg,"PRE",{class:!0}),y(mi).forEach(i),gi=b(Pg),wi=v(Pg,"P",{});var Cg=y(wi);yi=E(Cg,"So I took a look at the output bundle:"),Cg.forEach(i),vi=b(Pg),Ei=v(Pg,"PRE",{class:!0}),y(Ei).forEach(i),bi=b(Pg),Ii=v(Pg,"P",{});var qg=y(Ii);xi=E(qg,"So, the problem is that I destructed "),Pi=v(qg,"CODE",{});var Ng=y(Pi);ji=E(Ng,"PI"),Ng.forEach(i),Ai=E(qg," from the exports of "),Ti=v(qg,"CODE",{});var Rg=y(Ti);Si=E(Rg,"index.js"),Rg.forEach(i),Li=E(qg," before it is defined, so naturally "),Oi=v(qg,"CODE",{});var $g=y(Oi);Mi=E($g,"PI"),$g.forEach(i),Ci=E(qg," within "),qi=v(qg,"CODE",{});var Hg=y(qi);Ni=E(Hg,"circle.js"),Hg.forEach(i),Ri=E(qg," would stay as "),$i=v(qg,"CODE",{});var Dg=y($i);Hi=E(Dg,"undefined"),Dg.forEach(i),Di=E(qg," throughout the application. However before I called "),Gi=v(qg,"CODE",{});var Gg=y(Gi);Bi=E(Gg,"circleArea"),Gg.forEach(i),Fi=E(qg,", we defined "),Ji=v(qg,"CODE",{});var Bg=y(Ji);Ui=E(Bg,"PI"),Bg.forEach(i),Wi=E(qg," on the "),_i=v(qg,"CODE",{});var Fg=y(_i);zi=E(Fg,"index.js"),Fg.forEach(i),Vi=E(qg,"'s export, I am expecting it to be available."),qg.forEach(i),Yi=b(Pg),Ki=v(Pg,"P",{});var Jg=y(Ki);Zi=E(Jg,"So I built my application with webpack and took a look at how webpack solved this problem."),Jg.forEach(i),Qi=b(Pg),Xi=v(Pg,"PRE",{class:!0}),y(Xi).forEach(i),nk=b(Pg),ak=v(Pg,"P",{});var Ug=y(ak);sk=E(Ug,"Brilliant! The key is to lazily get the value of "),tk=v(Ug,"CODE",{});var Wg=y(tk);ek=E(Wg,"PI"),Wg.forEach(i),ok=E(Ug," when needed!"),Ug.forEach(i),pk=b(Pg),ck=v(Pg,"P",{});var _g=y(ck);lk=E(_g,"I changed my babel transformation code, which I am not showing it here. If you are curious enough, you can check out "),uk=v(_g,"A",{href:!0,rel:!0});var zg=y(uk);rk=E(zg,"the changes I made from Github"),zg.forEach(i),ik=E(_g,"."),_g.forEach(i),Pg.forEach(i),kk=b(n),dk=v(n,"SECTION",{});var Vg=y(dk);hk=v(Vg,"H2",{});var Yg=y(hk);fk=v(Yg,"A",{href:!0,id:!0});var Kg=y(fk);mk=E(Kg,"Summary"),Kg.forEach(i),Yg.forEach(i),gk=b(Vg),wk=v(Vg,"P",{});var Zg=y(wk);yk=E(Zg,"There's two phases in module bundling: "),vk=v(Zg,"STRONG",{});var Qg=y(vk);Ek=E(Qg,"Dependency Resolution"),Qg.forEach(i),bk=E(Zg," and "),Ik=v(Zg,"STRONG",{});var Xg=y(Ik);xk=E(Xg,"Bundling"),Xg.forEach(i),Pk=E(Zg,"."),Zg.forEach(i),jk=b(Vg),Ak=v(Vg,"P",{});var nw=y(Ak);Tk=E(nw,"I showed you how I constructed the dependency graph, by finding import statements and resolving modules. I shared how I created module maps and transformed the imports / exports syntax during "),Sk=v(nw,"STRONG",{});var aw=y(Sk);Lk=E(aw,"bundling"),aw.forEach(i),Ok=E(nw,". Lastly, I fixed the circular dependency bug that was in the first version of my module bundler."),nw.forEach(i),Vg.forEach(i),Mk=b(n),Ck=v(n,"SECTION",{});var sw=y(Ck);qk=v(sw,"H3",{});var tw=y(qk);Nk=v(tw,"A",{href:!0,id:!0});var ew=y(Nk);Rk=E(ew,"Whats next?"),ew.forEach(i),tw.forEach(i),$k=b(sw),Hk=v(sw,"P",{});var ow=y(Hk);Dk=E(ow,"I have a few ideas that I will add to my module bundler, such as:"),ow.forEach(i),Gk=b(sw),Bk=v(sw,"UL",{});var pw=y(Bk);Fk=v(pw,"LI",{});var cw=y(Fk);Jk=E(cw,"code spliting"),cw.forEach(i),Uk=b(pw),Wk=v(pw,"LI",{});var lw=y(Wk);_k=E(lw,"watch mode and reloading"),lw.forEach(i),pw.forEach(i),zk=b(sw),Vk=v(sw,"P",{});var uw=y(Vk);Yk=E(uw,"which I will cover them in my next article when they are ready."),uw.forEach(i),Kk=b(sw),Zk=v(sw,"P",{});var rw=y(Zk);Qk=E(rw,"Till then. Cheers. 😎"),rw.forEach(i),sw.forEach(i),Xk=b(n),nd=v(n,"SECTION",{});var iw=y(nd);ad=v(iw,"H2",{});var kw=y(ad);sd=v(kw,"A",{href:!0,id:!0});var dw=y(sd);td=E(dw,"Further Readings"),dw.forEach(i),kw.forEach(i),ed=b(iw),od=v(iw,"UL",{});var hw=y(od);pd=v(hw,"LI",{});var fw=y(pd);cd=v(fw,"A",{href:!0,rel:!0});var mw=y(cd);ld=E(mw,"Ronen Amiel, Build Your Own Webpack - You Gotta Love Frontend 2018"),mw.forEach(i),fw.forEach(i),ud=b(hw),rd=v(hw,"LI",{});var gw=y(rd);id=v(gw,"A",{href:!0,rel:!0});var ww=y(id);kd=E(ww,"Luciano Mammino, Unbundling the JavaScript module bundler - DublinJS July 2018"),ww.forEach(i),gw.forEach(i),dd=b(hw),hd=v(hw,"LI",{});var yw=y(hd);fd=v(yw,"A",{href:!0,rel:!0});var vw=y(fd);md=E(vw,"Adam Kelly, Let’s learn how module bundlers work and then write one ourselves"),vw.forEach(i),yw.forEach(i),gd=b(hw),wd=v(hw,"LI",{});var Ew=y(wd);yd=v(Ew,"A",{href:!0,rel:!0});var bw=y(yd);vd=E(bw,"Webpack founder Tobias Koppers demos bundling live by hand"),bw.forEach(i),Ew.forEach(i),hw.forEach(i),iw.forEach(i),this.h()},h(){w(o,"href","#getting-started"),w(k,"href","#the-input"),w(I,"href","#writing"),w(j,"href","#resolving"),w(S,"href","#bundling"),w(C,"href","#grouping-modules-into-files"),w(R,"href","#creating-module-map"),w(D,"href","#"),w(B,"href","#optimisation"),w(W,"href","#circular-dependency"),w(V,"href","#summary"),w(Q,"href","#whats-next"),w(an,"href","#further-readings"),w(t,"class","sitemap"),w(t,"id","sitemap"),w(t,"role","navigation"),w(t,"aria-label","Table of Contents"),w(pn,"href","/what-is-module-bundler-and-how-does-it-work/"),w(un,"href","https://webpack.js.org"),w(un,"rel","nofollow"),w(dn,"href","https://rollupjs.org"),w(dn,"rel","nofollow"),w(Mn,"href","#getting-started"),w(Mn,"id","getting-started"),w($n,"href","/what-is-module-bundler-and-how-does-it-work/"),w(da,"href","#the-input"),w(da,"id","the-input"),w(ya,"class","language-js"),w(Ea,"class","language-js"),w(Ia,"class","language-js"),w(Aa,"href","https://github.com/tanhauhau/byo-bundler/tree/master/fixture"),w(Aa,"rel","nofollow"),w(Da,"href","#writing"),w(Da,"id","writing"),w(Wa,"class","language-js"),w(Xa,"href","https://en.wikipedia.org/wiki/Directed_graph"),w(Xa,"rel","nofollow"),w(ts,"class","language-js"),w(gs,"class","language-js"),w(Ps,"class","language-js"),w(Ms,"href","http://babeljs.io"),w(Ms,"rel","nofollow"),w(Ds,"class","language-js"),w(Us,"class","language-js"),w(nt,"href","https://lihautan.com/babel-ast-explorer/#?eyJiYWJlbFNldHRpbmdzIjp7InZlcnNpb24iOiI3LjQuNSJ9LCJ0cmVlU2V0dGluZ3MiOnsiaGlkZUVtcHR5Ijp0cnVlLCJoaWRlTG9jYXRpb24iOnRydWUsImhpZGVUeXBlIjp0cnVlfSwiY29kZSI6ImltcG9ydCBzcXVhcmVBcmVhIGZyb20gJy4vc3F1YXJlLmpzJztcbmltcG9ydCBjaXJjbGVBcmVhIGZyb20gJy4vY2lyY2xlLmpzJztcblxuY29uc29sZS5sb2coJ0FyZWEgb2Ygc3F1YXJlOiAnLCBzcXVhcmVBcmVhKDUpKTtcbmNvbnNvbGUubG9nKCdBcmVhIG9mIGNpcmNsZScsIGNpcmNsZUFyZWEoNSkpO1xuIn0="),w(nt,"rel","nofollow"),w(pt,"type","image/webp"),w(pt,"srcset","f635154d6a84f142.webp"),w(ct,"type","image/jpeg"),w(ct,"srcset","f635154d6a84f142.png"),w(lt,"title","Visualizing AST through babel-ast-explorer"),w(lt,"alt","babel-ast-explorer"),w(lt,"data-src","f635154d6a84f142.png"),w(lt,"loading","lazy"),w(Tt,"class","language-js"),w(Zt,"class","language-js"),w(oe,"href","#resolving"),w(oe,"id","resolving"),w(ge,"class","language-js"),w(ye,"class","language-js"),w(je,"href","http://nodejs.org/api/modules.html#modules_all_together"),w(je,"rel","nofollow"),w(De,"class","language-null"),w(ze,"class","language-null"),w(uo,"href","https://webpack.js.org/configuration/resolve/"),w(uo,"rel","nofollow"),w(vo,"class","language-js"),w(So,"class","language-js"),w(qo,"class","language-js"),w(tp,"href","#bundling"),w(tp,"id","bundling"),w(Cp,"href","/what-is-module-bundler-and-how-does-it-work/"),w(Gp,"class","language-js"),w(lc,"href","#grouping-modules-into-files"),w(lc,"id","grouping-modules-into-files"),w(dc,"href","https://webpack.js.org/guides/code-splitting/"),w(dc,"rel","nofollow"),w(mc,"href","https://webpack.js.org/plugins/split-chunks-plugin/"),w(mc,"rel","nofollow"),w(jc,"class","language-js"),w(Cc,"href","#creating-module-map"),w(Cc,"id","creating-module-map"),w(Xc,"href","https://documentation.progress.com/output/ua/OpenEdge_latest/index.html#page/dvjsn/json-data-types.html"),w(Xc,"rel","nofollow"),w(pl,"class","language-js"),w(Tl,"class","language-js"),w(Zl,"class","language-js"),w(su,"href","/step-by-step-guide-for-writing-a-babel-transformation"),w(fu,"class","language-js"),w(yu,"href","https://github.com/tanhauhau/byo-bundler/blob/feat-2-bundling/src/index.js#L46-L138"),w(yu,"rel","nofollow"),w(Pu,"class","language-js"),w(Nu,"href","#"),w(Nu,"id",""),w(Wu,"class","language-js"),w(Qu,"href","/what-is-module-bundler-and-how-does-it-work/"),w(lr,"class","language-js"),w(mr,"class","language-null"),w(Sr,"href","#optimisation"),w(Sr,"id","optimisation"),w(Br,"class","language-js"),w(Jr,"class","language-js"),w(Vr,"class","language-null"),w(Qr,"href","#circular-dependency"),w(Qr,"id","circular-dependency"),w(ii,"class","language-js"),w(mi,"class","language-sh"),w(Ei,"class","language-js"),w(Xi,"class","language-js"),w(uk,"href","https://github.com/tanhauhau/byo-bundler/compare/feat-2-bundling...feat-3-circular-dependency"),w(uk,"rel","nofollow"),w(fk,"href","#summary"),w(fk,"id","summary"),w(Nk,"href","#whats-next"),w(Nk,"id","whats-next"),w(sd,"href","#further-readings"),w(sd,"id","further-readings"),w(cd,"href","https://www.youtube.com/watch?v=Gc9-7PBqOC8"),w(cd,"rel","nofollow"),w(id,"href","https://slides.com/lucianomammino/unbundling-the-javascript-module-bundler-dublinjs"),w(id,"rel","nofollow"),w(fd,"href","https://www.freecodecamp.org/news/lets-learn-how-module-bundlers-work-and-then-write-one-ourselves-b2e3fe6c88ae/"),w(fd,"rel","nofollow"),w(yd,"href","https://www.youtube.com/watch?v=UNMkLHzofQI"),w(yd,"rel","nofollow")},m(n,a){r(n,s,a),u(s,t),u(t,e),u(e,o),u(o,p),u(t,c),u(c,l),u(l,k),u(k,h),u(t,g),u(g,I),u(I,x),u(t,P),u(P,j),u(j,A),u(t,T),u(T,S),u(S,L),u(t,O),u(O,M),u(M,C),u(C,q),u(O,N),u(N,R),u(R,$),u(O,H),u(H,D),u(t,G),u(G,B),u(B,F),u(t,J),u(J,U),u(U,W),u(W,_),u(t,z),u(z,V),u(V,Y),u(t,K),u(K,Z),u(Z,Q),u(Q,X),u(t,nn),u(nn,an),u(an,sn),r(n,tn,a),r(n,en,a),u(en,on),u(en,pn),u(pn,cn),u(en,ln),u(en,un),u(un,rn),u(en,kn),u(en,dn),u(dn,hn),u(en,fn),r(n,mn,a),r(n,gn,a),u(gn,wn),r(n,yn,a),r(n,vn,a),r(n,En,a),r(n,bn,a),u(bn,In),u(bn,xn),u(xn,Pn),u(bn,jn),r(n,An,a),r(n,Tn,a),r(n,Sn,a),r(n,Ln,a),u(Ln,On),u(On,Mn),u(Mn,Cn),u(Ln,qn),u(Ln,Nn),u(Nn,Rn),u(Nn,$n),u($n,Hn),u(Nn,Dn),u(Ln,Gn),u(Ln,Bn),u(Bn,Fn),u(Bn,Jn),u(Jn,Un),u(Bn,Wn),u(Ln,_n),u(Ln,zn),u(zn,Vn),u(Vn,Yn),u(Vn,Kn),u(Kn,Zn),u(zn,Qn),u(zn,Xn),u(Xn,na),u(Xn,aa),u(aa,sa),u(Ln,ta),u(Ln,ea),u(ea,oa),u(oa,pa),u(oa,ca),u(ca,la),u(oa,ua),r(n,ra,a),r(n,ia,a),u(ia,ka),u(ka,da),u(da,ha),u(ia,fa),u(ia,ma),u(ma,ga),u(ia,wa),u(ia,ya),ya.innerHTML='<code class="language-js"><span class="token comment">// filename: index.js</span>\n<span class="token keyword">import</span> squareArea <span class="token keyword">from</span> <span class="token string">\'./square.js\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> circleArea <span class="token keyword">from</span> <span class="token string">\'./circle.js\'</span><span class="token punctuation">;</span>\n\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of square: \'</span><span class="token punctuation">,</span> <span class="token function">squareArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of circle\'</span><span class="token punctuation">,</span> <span class="token function">circleArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>',u(ia,va),u(ia,Ea),Ea.innerHTML='<code class="language-js"><span class="token comment">// filename: square.js</span>\n<span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">side</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> side <span class="token operator">*</span> side<span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> area<span class="token punctuation">;</span></code>',u(ia,ba),u(ia,Ia),Ia.innerHTML='<code class="language-js"><span class="token comment">// filename: circle.js</span>\n<span class="token keyword">const</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.141</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> <span class="token constant">PI</span> <span class="token operator">*</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> area<span class="token punctuation">;</span></code>',u(ia,xa),u(ia,Pa),u(Pa,ja),u(Pa,Aa),u(Aa,Ta),u(Pa,Sa),u(Pa,La),u(La,Oa),u(Pa,Ma),u(Pa,Ca),u(Ca,qa),u(Pa,Na),r(n,Ra,a),r(n,$a,a),u($a,Ha),u(Ha,Da),u(Da,Ga),u($a,Ba),u($a,Fa),u(Fa,Ja),u($a,Ua),u($a,Wa),Wa.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> entryFile<span class="token punctuation">,</span> outputFolder <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// build dependency graph</span>\n  <span class="token keyword">const</span> graph <span class="token operator">=</span> <span class="token function">createDependencyGraph</span><span class="token punctuation">(</span>entryFile<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// bundle the asset</span>\n  <span class="token keyword">const</span> outputFiles <span class="token operator">=</span> <span class="token function">bundle</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// write to output folder</span>\n  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> outputFile <span class="token keyword">of</span> outputFiles<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>\n      path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>outputFolder<span class="token punctuation">,</span> outputFile<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      outputFile<span class="token punctuation">.</span>content<span class="token punctuation">,</span>\n      <span class="token string">\'utf-8\'</span>\n    <span class="token punctuation">)</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',u($a,_a),u($a,za),u(za,Va),u(Va,Ya),u(Va,Ka),u(Ka,Za),u(Va,Qa),u(Va,Xa),u(Xa,ns),u(Va,as),u($a,ss),u($a,ts),ts.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">createDependencyGraph</span><span class="token punctuation">(</span><span class="token parameter">entryFile</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> rootModule <span class="token operator">=</span> <span class="token function">createModule</span><span class="token punctuation">(</span>entryFile<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> rootModule<span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',u($a,es),u($a,os),u(os,ps),u($a,cs),u($a,ls),u(ls,us),u(ls,rs),u(rs,is),u(ls,ks),u(ls,ds),u(ds,hs),u(ls,fs),u($a,ms),u($a,gs),gs.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">createModule</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Module</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',u($a,ws),u($a,ys),u(ys,vs),u(ys,Es),u(Es,bs),u(ys,Is),u($a,xs),u($a,Ps),Ps.innerHTML='<code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Module</span> <span class="token punctuation">&#123;</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>filePath <span class="token operator">=</span> filePath<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',u($a,js),u($a,As),u(As,Ts),u(As,Ss),u(Ss,Ls),u(As,Os),u(As,Ms),u(Ms,Cs),u(As,qs),u(As,Ns),u(Ns,Rs),u(As,$s),u($a,Hs),u($a,Ds),Ds.innerHTML='<code class="language-js"><span class="token comment">// highlight-next-line</span>\n<span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'@babel/core\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Module</span> <span class="token punctuation">&#123;</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>filePath <span class="token operator">=</span> filePath<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// highlight-next-line</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>ast <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">parseSync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',u($a,Gs),u($a,Bs),u(Bs,Fs),u($a,Js),u($a,Us),Us.innerHTML='<code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Module</span> <span class="token punctuation">&#123;</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>filePath <span class="token operator">=</span> filePath<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>ast <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">parseSync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// highlight-start</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span>\n  <span class="token function">findDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">//</span>\n  <span class="token punctuation">&#125;</span>\n  <span class="token comment">// highlight-end</span>\n<span class="token punctuation">&#125;</span></code>',u($a,Ws),u($a,_s),u(_s,zs),u($a,Vs),u($a,Ys),u(Ys,Ks),u(Ys,Zs),u(Zs,Qs),u(Ys,Xs),u(Ys,nt),u(nt,at),u(Ys,st),u($a,tt),u($a,et),u(et,ot),u(ot,pt),u(ot,ct),u(ot,lt),u($a,ut),u($a,rt),u(rt,it),u(rt,kt),u(kt,dt),u(rt,ht),u(rt,ft),u(ft,mt),u(rt,gt),u(rt,wt),u(wt,yt),u(rt,vt),u(rt,Et),u(Et,bt),u(rt,It),u(rt,xt),u(xt,Pt),u(rt,jt),u($a,At),u($a,Tt),Tt.innerHTML='<code class="language-js"><span class="token function">findDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// highlight-start</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ast<span class="token punctuation">.</span>program<span class="token punctuation">.</span>body\n    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=></span> node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'ImportDeclaration\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=></span> node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n  <span class="token comment">// highlight-end</span>\n<span class="token punctuation">&#125;</span></code>',u($a,St),u($a,Lt),u(Lt,Ot),u(Lt,Mt),u(Mt,Ct),u(Lt,qt),u(Lt,Nt),u(Nt,Rt),u(Lt,$t),u(Lt,Ht),u(Ht,Dt),u(Lt,Gt),u(Lt,Bt),u(Bt,Ft),u(Lt,Jt),u($a,Ut),u($a,Wt),u(Wt,_t),u(Wt,zt),u(zt,Vt),u(Wt,Yt),u($a,Kt),u($a,Zt),Zt.innerHTML='<code class="language-js"><span class="token function">findDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ast<span class="token punctuation">.</span>program<span class="token punctuation">.</span>body\n    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=></span> node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'ImportDeclaration\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=></span> node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n  <span class="token comment">// highlight-next-line</span>\n    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">relativePath</span> <span class="token operator">=></span> <span class="token function">resolveRequest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filePath<span class="token punctuation">,</span> relativePath<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token comment">// highlight-start</span>\n<span class="token comment">// resolving</span>\n<span class="token keyword">function</span> <span class="token function">resolveRequest</span><span class="token punctuation">(</span><span class="token parameter">requester<span class="token punctuation">,</span> requestedPath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">//</span>\n<span class="token punctuation">&#125;</span></code>',u($a,Qt),u($a,Xt),u(Xt,ne),u(ne,ae),r(n,se,a),r(n,te,a),u(te,ee),u(ee,oe),u(oe,pe),u(te,ce),u(te,le),u(le,ue),u(le,re),u(re,ie),u(le,ke),u(le,de),u(de,he),u(le,fe),u(te,me),u(te,ge),ge.innerHTML='<code class="language-js"><span class="token comment">// filename: project/a.js</span>\n<span class="token keyword">import</span> <span class="token string">\'./b.js\'</span><span class="token punctuation">;</span></code>',u(te,we),u(te,ye),ye.innerHTML='<code class="language-js"><span class="token comment">// filename: project/foo/a.js</span>\n<span class="token keyword">import</span> <span class="token string">\'./b.js\'</span><span class="token punctuation">;</span></code>',u(te,ve),u(te,Ee),u(Ee,be),u(te,Ie),u(te,xe),u(xe,Pe),u(xe,je),u(je,Ae),u(xe,Te),u(te,Se),u(te,Le),u(Le,Oe),u(Le,Me),u(Me,Ce),u(Le,qe),u(Le,Ne),u(Ne,Re),u(Le,$e),u(te,He),u(te,De),De.innerHTML='\n<code class="language-">b\nb.js\nb.json\nb.node</code>',u(te,Ge),u(te,Be),u(Be,Fe),u(Be,Je),u(Je,Ue),u(Be,We),u(te,_e),u(te,ze),ze.innerHTML='\n<code class="language-">&quot;main&quot; in b/package.json\nb/index.js\nb/index.json\nb/index.node</code>',u(te,Ve),u(te,Ye),u(Ye,Ke),u(Ye,Ze),u(Ze,Qe),u(Ye,Xe),u(Ye,no),u(no,ao),u(Ye,so),u(te,to),u(te,eo),u(eo,oo),u(eo,po),u(po,co),u(eo,lo),u(eo,uo),u(uo,ro),u(eo,io),u(te,ko),u(te,ho),u(ho,fo),u(ho,mo),u(mo,go),u(ho,wo),u(te,yo),u(te,vo),vo.innerHTML='<code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// highlight-start</span>\n<span class="token comment">// resolving</span>\n<span class="token keyword">function</span> <span class="token function">resolveRequest</span><span class="token punctuation">(</span><span class="token parameter">requester<span class="token punctuation">,</span> requestedPath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>requester<span class="token punctuation">)</span><span class="token punctuation">,</span> requestedPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',u(te,Eo),u(te,bo),u(bo,Io),u(Io,xo),u(te,Po),u(te,jo),u(jo,Ao),u(te,To),u(te,So),So.innerHTML='<code class="language-js"><span class="token function">findDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ast<span class="token punctuation">.</span>program<span class="token punctuation">.</span>body\n    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=></span> node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'ImportDeclaration\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token operator">=></span> node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">relativePath</span> <span class="token operator">=></span> <span class="token function">resolveRequest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>filePath<span class="token punctuation">,</span> relativePath<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token comment">// highlight-next-line</span>\n    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">absolutePath</span> <span class="token operator">=></span> <span class="token function">createModule</span><span class="token punctuation">(</span>absolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">&#125;</span></code>',u(te,Lo),u(te,Oo),u(Oo,Mo),u(te,Co),u(te,qo),qo.innerHTML='<code class="language-js">Module <span class="token punctuation">&#123;</span>\n  filePath<span class="token punctuation">:</span> <span class="token string">\'/Projects/byo-bundler/fixture/index.js\'</span><span class="token punctuation">,</span>\n  content<span class="token punctuation">:</span>\n   <span class="token string">\'import squareArea from \'./square.js\';&#92;nimport circleArea from \'./circle.js\';&#92;n&#92;nconsole.log(\'Area of square: \', squareArea(5));&#92;nconsole.log(\'Area of circle\', circleArea(5));&#92;n\'</span><span class="token punctuation">,</span>\n  ast<span class="token punctuation">:</span>\n   Node <span class="token punctuation">&#123;</span> <span class="token comment">/*...*/</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n  dependencies<span class="token punctuation">:</span>\n   <span class="token punctuation">[</span> Module <span class="token punctuation">&#123;</span>\n       filePath<span class="token punctuation">:</span> <span class="token string">\'/Projects/byo-bundler/fixture/square.js\'</span><span class="token punctuation">,</span>\n       content<span class="token punctuation">:</span>\n        <span class="token string">\'function area(side) &#123;&#92;n  return side * side;&#92;n&#125;&#92;nexport default area;&#92;n\'</span><span class="token punctuation">,</span>\n       ast<span class="token punctuation">:</span> Node <span class="token punctuation">&#123;</span><span class="token comment">/* ... */</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n       dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n     Module <span class="token punctuation">&#123;</span>\n       filePath<span class="token punctuation">:</span> <span class="token string">\'/Projects/byo-bundler/fixture/circle.js\'</span><span class="token punctuation">,</span>\n       content<span class="token punctuation">:</span>\n        <span class="token string">\'const PI = 3.141;&#92;nfunction area(radius) &#123;&#92;n    return PI * radius * radius;&#92;n&#125;&#92;nexport default area;&#92;n\'</span><span class="token punctuation">,</span>\n       ast<span class="token punctuation">:</span> Node <span class="token punctuation">&#123;</span><span class="token comment">/* ... */</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n       dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n      <span class="token punctuation">&#125;</span>\n   <span class="token punctuation">]</span>\n<span class="token punctuation">&#125;</span></code>',u(te,No),u(te,Ro),u(Ro,$o),u(Ro,Ho),u(Ho,Do),u(Ro,Go),u(Ro,Bo),u(Bo,Fo),u(Ro,Jo),u(Ro,Uo),u(Uo,Wo),u(Ro,_o),u(Ro,zo),u(zo,Vo),u(Ro,Yo),u(te,Ko),u(te,Zo),u(Zo,Qo),u(Qo,Xo),r(n,np,a),r(n,ap,a),u(ap,sp),u(sp,tp),u(tp,ep),u(ap,op),u(ap,pp),u(pp,cp),u(ap,lp),u(ap,up),u(up,rp),u(up,ip),u(ip,kp),u(up,dp),u(up,hp),u(hp,fp),u(up,mp),u(up,gp),u(gp,wp),u(up,yp),u(up,vp),u(vp,Ep),u(up,bp),u(ap,Ip),u(ap,xp),u(xp,Pp),u(Pp,jp),u(Pp,Ap),u(Ap,Tp),u(Pp,Sp),u(Pp,Lp),u(Lp,Op),u(Pp,Mp),u(Pp,Cp),u(Cp,qp),u(Pp,Np),u(ap,Rp),u(ap,$p),u($p,Hp),u(ap,Dp),u(ap,Gp),Gp.innerHTML='<code class="language-js"><span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">&#123;</span>\n  <span class="token string">\'circle.js\'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">const</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.141</span><span class="token punctuation">;</span>\n    exports<span class="token punctuation">.</span><span class="token function-variable function">default</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> <span class="token constant">PI</span> <span class="token operator">*</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n  <span class="token string">\'square.js\'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    exports<span class="token punctuation">.</span><span class="token function-variable function">default</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">side</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> side <span class="token operator">*</span> side<span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n  <span class="token string">\'app.js\'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">const</span> squareArea <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'square.js\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> circleArea <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'circle.js\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of square: \'</span><span class="token punctuation">,</span> <span class="token function">squareArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of circle\'</span><span class="token punctuation">,</span> <span class="token function">circleArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n\n<span class="token function">webpackStart</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>\n  modules<span class="token punctuation">,</span>\n  entry<span class="token punctuation">:</span> <span class="token string">\'app.js\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>',u(ap,Bp),u(ap,Fp),u(Fp,Jp),u(ap,Up),u(ap,Wp),u(Wp,_p),u(_p,zp),u(zp,Vp),u(Wp,Yp),u(Wp,Kp),u(Kp,Zp),u(Zp,Qp),u(Kp,Xp),u(Wp,nc),u(Wp,ac),u(ac,sc),u(sc,tc),u(ac,ec),r(n,oc,a),r(n,pc,a),u(pc,cc),u(cc,lc),u(lc,uc),u(pc,rc),u(pc,ic),u(ic,kc),u(ic,dc),u(dc,hc),u(ic,fc),u(ic,mc),u(mc,gc),u(ic,wc),u(pc,yc),u(pc,vc),u(vc,Ec),u(pc,bc),u(pc,Ic),u(Ic,xc),u(pc,Pc),u(pc,jc),jc.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">bundle</span><span class="token punctuation">(</span><span class="token parameter">graph</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// highlight-next-line</span>\n  <span class="token function">collectModules</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token comment">// highlight-start</span>\n<span class="token keyword">function</span> <span class="token function">collectModules</span><span class="token punctuation">(</span><span class="token parameter">graph</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token function">collect</span><span class="token punctuation">(</span>graph<span class="token punctuation">,</span> modules<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> modules<span class="token punctuation">;</span>\n\n  <span class="token keyword">function</span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> modules</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    modules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    module<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">dependency</span> <span class="token operator">=></span> <span class="token function">collect</span><span class="token punctuation">(</span>dependency<span class="token punctuation">,</span> modules<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',u(pc,Ac),u(pc,Tc),u(Tc,Sc),r(n,Lc,a),r(n,Oc,a),u(Oc,Mc),u(Mc,Cc),u(Cc,qc),u(Oc,Nc),u(Oc,Rc),u(Rc,$c),u(Oc,Hc),u(Oc,Dc),u(Dc,Gc),u(Dc,Bc),u(Bc,Fc),u(Dc,Jc),u(Dc,Uc),u(Uc,Wc),u(Dc,_c),u(Oc,zc),u(Oc,Vc),u(Vc,Yc),u(Vc,Kc),u(Kc,Zc),u(Vc,Qc),u(Vc,Xc),u(Xc,nl),u(Vc,al),u(Vc,sl),u(sl,tl),u(Vc,el),u(Oc,ol),u(Oc,pl),pl.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">bundle</span><span class="token punctuation">(</span><span class="token parameter">graph</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token function">collectModules</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// highlight-next-line</span>\n  <span class="token keyword">const</span> moduleMap <span class="token operator">=</span> <span class="token function">toModuleMap</span><span class="token punctuation">(</span>modules<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token comment">// highlight-start</span>\n<span class="token keyword">function</span> <span class="token function">toModuleMap</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">let</span> moduleMap <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n  moduleMap <span class="token operator">+=</span> <span class="token string">\'&#123;\'</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> module <span class="token keyword">of</span> modules<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    moduleMap <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>module<span class="token punctuation">.</span>filePath<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">": </span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">;</span>\n    moduleMap <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">function(exports, require) &#123; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>module<span class="token punctuation">.</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> &#125;,</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span>\n\n  moduleMap <span class="token operator">+=</span> <span class="token string">\'&#125;\'</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> moduleMap<span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',u(Oc,cl),u(Oc,ll),u(ll,ul),u(ll,rl),u(rl,il),u(ll,kl),u(Oc,dl),u(Oc,hl),u(hl,fl),u(fl,ml),u(ml,gl),u(fl,wl),u(hl,yl),u(hl,vl),u(vl,El),u(El,bl),u(vl,Il),u(Oc,xl),u(Oc,Pl),u(Pl,jl),u(Oc,Al),u(Oc,Tl),Tl.innerHTML='<code class="language-js"><span class="token punctuation">&#123;</span>\n  <span class="token string">"index.js"</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">import</span> squareArea <span class="token keyword">from</span> <span class="token string">\'./square.js\'</span><span class="token punctuation">;</span>\n    <span class="token keyword">import</span> circleArea <span class="token keyword">from</span> <span class="token string">\'./circle.js\'</span><span class="token punctuation">;</span>\n\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of square: \'</span><span class="token punctuation">,</span> <span class="token function">squareArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of circle\'</span><span class="token punctuation">,</span> <span class="token function">circleArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n  <span class="token string">"square.js"</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">side</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> side <span class="token operator">*</span> side<span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n    <span class="token keyword">export</span> <span class="token keyword">default</span> area<span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n  <span class="token string">"circle.js"</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">const</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.141</span><span class="token punctuation">;</span>\n    <span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> <span class="token constant">PI</span> <span class="token operator">*</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n    <span class="token keyword">export</span> <span class="token keyword">default</span> area<span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n<span class="token punctuation">&#125;</span></code>',u(Oc,Sl),u(Oc,Ll),u(Ll,Ol),u(Ll,Ml),u(Ml,Cl),u(Ll,ql),u(Ll,Nl),u(Nl,Rl),u(Ll,$l),u(Ll,Hl),u(Hl,Dl),u(Ll,Gl),u(Ll,Bl),u(Bl,Fl),u(Ll,Jl),u(Oc,Ul),u(Oc,Wl),u(Wl,_l),u(Oc,zl),u(Oc,Vl),u(Vl,Yl),u(Oc,Kl),u(Oc,Zl),Zl.innerHTML='<code class="language-js"><span class="token comment">// #1</span>\n<span class="token comment">// from</span>\n<span class="token keyword">import</span> a<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> b<span class="token punctuation">,</span> c <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">\'foo\'</span><span class="token punctuation">;</span>\n<span class="token comment">// to</span>\n<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token punctuation">:</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'foo\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// #2</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> a<span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token punctuation">&#123;</span> c <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n<span class="token comment">// to</span>\nexports<span class="token punctuation">.</span>default <span class="token operator">=</span> a<span class="token punctuation">;</span>\nexports<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\nexports<span class="token punctuation">.</span>c <span class="token operator">=</span> c<span class="token punctuation">;</span></code>',u(Oc,Ql),u(Oc,Xl),u(Xl,nu),u(nu,au),u(nu,su),u(su,tu),u(nu,eu),u(Oc,ou),u(Oc,pu),u(pu,cu),u(pu,lu),u(lu,uu),u(pu,ru),u(pu,iu),u(iu,ku),u(pu,du),u(Oc,hu),u(Oc,fu),fu.innerHTML='<code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> module <span class="token keyword">of</span> modules<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// highlight-next-line</span>\n  module<span class="token punctuation">.</span><span class="token function">transformModuleInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  moduleMap <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>module<span class="token punctuation">.</span>filePath<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">": function(exports, require) &#123; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>module<span class="token punctuation">.</span>content<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> &#125;,</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">class</span> <span class="token class-name">Module</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// highlight-start</span>\n  <span class="token function">transformModuleInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> ast<span class="token punctuation">,</span> code <span class="token punctuation">&#125;</span> <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transformFromAstSync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ast<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>ast <span class="token operator">=</span> ast<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> code<span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span>\n  <span class="token comment">// highlight-end</span>\n<span class="token punctuation">&#125;</span></code>',u(Oc,mu),u(Oc,gu),u(gu,wu),u(gu,yu),u(yu,vu),u(Oc,Eu),u(Oc,bu),u(bu,Iu),u(Oc,xu),u(Oc,Pu),Pu.innerHTML='<code class="language-js"><span class="token punctuation">&#123;</span>\n  <span class="token string">"index.js"</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token punctuation">:</span> squareArea <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'square.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token punctuation">:</span> circleArea <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'circle.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of square: \'</span><span class="token punctuation">,</span> <span class="token function">squareArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of circle\'</span><span class="token punctuation">,</span> <span class="token function">circleArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n  <span class="token string">"square.js"</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">side</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> side <span class="token operator">*</span> side<span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n    exports<span class="token punctuation">.</span>default <span class="token operator">=</span> area<span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n  <span class="token string">"circle.js"</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">const</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.141</span><span class="token punctuation">;</span>\n    <span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> <span class="token constant">PI</span> <span class="token operator">*</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n    exports<span class="token punctuation">.</span>default <span class="token operator">=</span> area<span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n<span class="token punctuation">&#125;</span></code>',u(Oc,ju),u(Oc,Au),u(Au,Tu),u(Au,Su),u(Su,Lu),u(Au,Ou),r(n,Mu,a),r(n,Cu,a),u(Cu,qu),u(qu,Nu),u(Nu,Ru),u(Ru,$u),u(Cu,Hu),u(Cu,Du),u(Du,Gu),u(Cu,Bu),u(Cu,Fu),u(Fu,Ju),u(Cu,Uu),u(Cu,Wu),Wu.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">bundle</span><span class="token punctuation">(</span><span class="token parameter">graph</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token function">collectModules</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> moduleMap <span class="token operator">=</span> <span class="token function">toModuleMap</span><span class="token punctuation">(</span>modules<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// highlight-next-line</span>\n  <span class="token keyword">const</span> moduleCode <span class="token operator">=</span> <span class="token function">addRuntime</span><span class="token punctuation">(</span>moduleMap<span class="token punctuation">,</span> modules<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n<span class="token comment">// highlight-start</span>\n<span class="token keyword">function</span> <span class="token function">addRuntime</span><span class="token punctuation">(</span><span class="token parameter">moduleMap<span class="token punctuation">,</span> entryPoint</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">\n    const modules = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>moduleMap<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">;\n    const entry = "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>entryPoint<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">";\n    function webpackStart(&#123; modules, entry &#125;) &#123;\n      const moduleCache = &#123;&#125;;\n      const require = moduleName => &#123;\n        // if in cache, return the cached version\n        if (moduleCache[moduleName]) &#123;\n          return moduleCache[moduleName];\n        &#125;\n        const exports = &#123;&#125;;\n        // this will prevent infinite "require" loop\n        // from circular dependencies\n        moduleCache[moduleName] = exports;\n    \n        // "require"-ing the module,\n        // exported stuff will assigned to "exports"\n        modules[moduleName](exports, require);\n        return moduleCache[moduleName];\n      &#125;;\n    \n      // start the program\n      require(entry);\n    &#125;\n\n    webpackStart(&#123; modules, entry &#125;);</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token comment">// trim away spaces before the line</span>\n<span class="token keyword">function</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> lines <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'&#92;n\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> padLength <span class="token operator">=</span> lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">-</span> lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trimLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n  <span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">^\\s&#123;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>padLength<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&#125;</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> lines<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">line</span> <span class="token operator">=></span> line<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>regex<span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'&#92;n\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',u(Cu,_u),u(Cu,zu),u(zu,Vu),u(zu,Yu),u(Yu,Ku),u(zu,Zu),u(zu,Qu),u(Qu,Xu),u(zu,nr),u(Cu,ar),u(Cu,sr),u(sr,tr),u(sr,er),u(er,or),u(sr,pr),u(Cu,cr),u(Cu,lr),lr.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">bundle</span><span class="token punctuation">(</span><span class="token parameter">graph</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token function">collectModules</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> moduleMap <span class="token operator">=</span> <span class="token function">toModuleMap</span><span class="token punctuation">(</span>modules<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> moduleCode <span class="token operator">=</span> <span class="token function">addRuntime</span><span class="token punctuation">(</span>moduleMap<span class="token punctuation">,</span> modules<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// highlight-next-line</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> name<span class="token punctuation">:</span> <span class="token string">\'bundle.js\'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> moduleCode <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',u(Cu,ur),u(Cu,rr),u(rr,ir),u(rr,kr),u(kr,dr),u(rr,hr),u(Cu,fr),u(Cu,mr),mr.innerHTML='\n<code class="language-">Area of square:  25\nArea of circle 78.525</code>',u(Cu,gr),u(Cu,wr),u(wr,yr),u(Cu,vr),u(Cu,Er),u(Er,br),u(Er,Ir),u(Ir,xr),u(Er,Pr),r(n,jr,a),r(n,Ar,a),u(Ar,Tr),u(Tr,Sr),u(Sr,Lr),u(Ar,Or),u(Ar,Mr),u(Mr,Cr),u(Mr,qr),u(qr,Nr),u(Mr,Rr),u(Ar,$r),u(Ar,Hr),u(Hr,Dr),u(Ar,Gr),u(Ar,Br),Br.innerHTML='<code class="language-js"><span class="token comment">// filename: index.js</span>\n<span class="token keyword">import</span> squareArea <span class="token keyword">from</span> <span class="token string">\'./square.js\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> circleArea <span class="token keyword">from</span> <span class="token string">\'./circle.js\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// highlight-next-line</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.141</span><span class="token punctuation">;</span>\n\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of square: \'</span><span class="token punctuation">,</span> <span class="token function">squareArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of circle\'</span><span class="token punctuation">,</span> <span class="token function">circleArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>',u(Ar,Fr),u(Ar,Jr),Jr.innerHTML='<code class="language-js"><span class="token comment">// filename: circle.js</span>\n<span class="token comment">// highlight-start</span>\n<span class="token comment">// const PI = 3.141;</span>\n<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> <span class="token constant">PI</span> <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">\'./index.js\'</span><span class="token punctuation">;</span>\n<span class="token comment">// highlight-end</span>\n\n<span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> <span class="token constant">PI</span> <span class="token operator">*</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> area<span class="token punctuation">;</span></code>',u(Ar,Ur),u(Ar,Wr),u(Wr,_r),u(Ar,zr),u(Ar,Vr),Vr.innerHTML='\n<code class="language-">RangeError: Maximum call stack size exceeded</code>',r(n,Yr,a),r(n,Kr,a),u(Kr,Zr),u(Zr,Qr),u(Qr,Xr),u(Kr,ni),u(Kr,ai),u(ai,si),u(Kr,ti),u(Kr,ei),u(ei,oi),u(oi,pi),u(ei,ci),u(ei,li),u(li,ui),u(Kr,ri),u(Kr,ii),ii.innerHTML='<code class="language-js"><span class="token comment">// fixing circular dependencies when generating module graph</span>\n<span class="token comment">// highlight-next-line</span>\n<span class="token keyword">const</span> <span class="token constant">MODULE_CACHE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">createModule</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n <span class="token comment">// highlight-next-line</span>\n <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">MODULE_CACHE</span><span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n   <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Module</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// highlight-next-line</span>\n   <span class="token constant">MODULE_CACHE</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// highlight-next-line</span>\n   module<span class="token punctuation">.</span><span class="token function">initDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token punctuation">&#125;</span>\n <span class="token comment">// highlight-next-line</span>\n <span class="token keyword">return</span> <span class="token constant">MODULE_CACHE</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Module</span> <span class="token punctuation">&#123;</span>\n  <span class="token operator">...</span>\n  <span class="token comment">// highlight-next-line</span>\n  <span class="token function">initDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// highlight-next-line</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>dependencies <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// highlight-next-line</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token comment">// fixing circular dependencies when traversing module graph</span>\n<span class="token keyword">function</span> <span class="token function">collectModules</span><span class="token punctuation">(</span><span class="token parameter">graph</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// highlight-next-line</span>\n  <span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">collect</span><span class="token punctuation">(</span>graph<span class="token punctuation">,</span> modules<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// highlight-next-line</span>\n  <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>modules<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// highlight-start</span>\n  <span class="token keyword">function</span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> modules</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>modules<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      modules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      module<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">dependency</span> <span class="token operator">=></span> <span class="token function">collect</span><span class="token punctuation">(</span>dependency<span class="token punctuation">,</span> modules<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',u(Kr,ki),u(Kr,di),u(di,hi),u(Kr,fi),u(Kr,mi),mi.innerHTML='<code class="language-sh">$ node output/bundle.js\nArea of square:  25\nArea of circle NaN</code>',u(Kr,gi),u(Kr,wi),u(wi,yi),u(Kr,vi),u(Kr,Ei),Ei.innerHTML='<code class="language-js"><span class="token punctuation">&#123;</span>\n  <span class="token string">\'index.js\'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token punctuation">:</span> squareArea <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'square.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 1. require circle.js</span>\n    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token punctuation">:</span> circleArea <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'circle.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 3. define PI on exports</span>\n    exports<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.141</span><span class="token punctuation">;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of square: \'</span><span class="token punctuation">,</span> <span class="token function">squareArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 4. call &#96;circleArea&#96;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of circle\'</span><span class="token punctuation">,</span> <span class="token function">circleArea</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n  <span class="token string">\'circle.js\'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// 2. at the point of executing this, PI is not yet defined</span>\n    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token constant">PI</span><span class="token punctuation">:</span> <span class="token constant">PI</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'index.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// 5. PI is undefined</span>\n      <span class="token keyword">return</span> <span class="token constant">PI</span> <span class="token operator">*</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n    exports<span class="token punctuation">.</span>default <span class="token operator">=</span> area<span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n<span class="token punctuation">&#125;</span></code>',u(Kr,bi),u(Kr,Ii),u(Ii,xi),u(Ii,Pi),u(Pi,ji),u(Ii,Ai),u(Ii,Ti),u(Ti,Si),u(Ii,Li),u(Ii,Oi),u(Oi,Mi),u(Ii,Ci),u(Ii,qi),u(qi,Ni),u(Ii,Ri),u(Ii,$i),u($i,Hi),u(Ii,Di),u(Ii,Gi),u(Gi,Bi),u(Ii,Fi),u(Ii,Ji),u(Ji,Ui),u(Ii,Wi),u(Ii,_i),u(_i,zi),u(Ii,Vi),u(Kr,Yi),u(Kr,Ki),u(Ki,Zi),u(Kr,Qi),u(Kr,Xi),Xi.innerHTML='<code class="language-js"><span class="token punctuation">&#123;</span>\n  <span class="token string">\'index.js\'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">const</span> square_import <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'square.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 1. require circle.js</span>\n    <span class="token keyword">const</span> circle_import <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'circle.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 3. define PI on exports</span>\n    exports<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.141</span><span class="token punctuation">;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of square: \'</span><span class="token punctuation">,</span> square_import<span class="token punctuation">[</span><span class="token string">\'default\'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 4. call &#96;circleArea&#96;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Area of circle\'</span><span class="token punctuation">,</span> circle_import<span class="token punctuation">[</span><span class="token string">\'default\'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n  <span class="token string">\'circle.js\'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// 2. we keep a reference of the &#96;index.js&#96;\'s &#96;exports&#96; object</span>\n    <span class="token keyword">const</span> index_import <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'index.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// 5. we get PI from the &#96;exports&#96;</span>\n      <span class="token keyword">return</span> index_import<span class="token punctuation">[</span><span class="token string">\'PI\'</span><span class="token punctuation">]</span> <span class="token operator">*</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n    exports<span class="token punctuation">.</span>default <span class="token operator">=</span> area<span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n<span class="token punctuation">&#125;</span></code>',u(Kr,nk),u(Kr,ak),u(ak,sk),u(ak,tk),u(tk,ek),u(ak,ok),u(Kr,pk),u(Kr,ck),u(ck,lk),u(ck,uk),u(uk,rk),u(ck,ik),r(n,kk,a),r(n,dk,a),u(dk,hk),u(hk,fk),u(fk,mk),u(dk,gk),u(dk,wk),u(wk,yk),u(wk,vk),u(vk,Ek),u(wk,bk),u(wk,Ik),u(Ik,xk),u(wk,Pk),u(dk,jk),u(dk,Ak),u(Ak,Tk),u(Ak,Sk),u(Sk,Lk),u(Ak,Ok),r(n,Mk,a),r(n,Ck,a),u(Ck,qk),u(qk,Nk),u(Nk,Rk),u(Ck,$k),u(Ck,Hk),u(Hk,Dk),u(Ck,Gk),u(Ck,Bk),u(Bk,Fk),u(Fk,Jk),u(Bk,Uk),u(Bk,Wk),u(Wk,_k),u(Ck,zk),u(Ck,Vk),u(Vk,Yk),u(Ck,Kk),u(Ck,Zk),u(Zk,Qk),r(n,Xk,a),r(n,nd,a),u(nd,ad),u(ad,sd),u(sd,td),u(nd,ed),u(nd,od),u(od,pd),u(pd,cd),u(cd,ld),u(od,ud),u(od,rd),u(rd,id),u(id,kd),u(od,dd),u(od,hd),u(hd,fd),u(fd,md),u(od,gd),u(od,wd),u(wd,yd),u(yd,vd)},p:n,d(n){n&&i(s),n&&i(tn),n&&i(en),n&&i(mn),n&&i(gn),n&&i(yn),n&&i(vn),n&&i(En),n&&i(bn),n&&i(An),n&&i(Tn),n&&i(Sn),n&&i(Ln),n&&i(ra),n&&i(ia),n&&i(Ra),n&&i($a),n&&i(se),n&&i(te),n&&i(np),n&&i(ap),n&&i(oc),n&&i(pc),n&&i(Lc),n&&i(Oc),n&&i(Mu),n&&i(Cu),n&&i(jr),n&&i(Ar),n&&i(Yr),n&&i(Kr),n&&i(kk),n&&i(dk),n&&i(Mk),n&&i(Ck),n&&i(Xk),n&&i(nd)}}}function dn(n){let s,t;const e=[hn];let o={$$slots:{default:[kn]},$$scope:{ctx:n}};for(let n=0;n<e.length;n+=1)o=a(o,e[n]);return s=new rn({props:o}),{c(){J(s.$$.fragment)},l(n){U(s.$$.fragment,n)},m(n,a){W(s,n,a),t=!0},p(n,[a]){const t=0&a?function(n,a){const s={},t={},e={$$scope:1};let o=n.length;for(;o--;){const p=n[o],c=a[o];if(c){for(const n in p)n in c||(t[n]=1);for(const n in c)e[n]||(s[n]=c[n],e[n]=1);n[o]=c}else for(const n in p)e[n]=1}for(const n in t)n in s||(s[n]=void 0);return s}(e,[(o=hn,"object"==typeof o&&null!==o?o:{})]):{};var o;1&a&&(t.$$scope={dirty:a,ctx:n}),s.$set(t)},i(n){t||(B(s.$$.fragment,n),t=!0)},o(n){F(s.$$.fragment,n),t=!1},d(n){_(s,n)}}}const hn={title:"I wrote my module bundler",date:"2019-09-18T08:00:00Z",tags:["JavaScript","module bundler","dev tool","webpack"],description:"In my previous article, I explained how module bundler works. In this article, I am going to show you how I wrote my module bundler...",series:"Write a module bundler",slug:"i-wrote-my-module-bundler",type:"blog"};class fn extends Y{constructor(n){super(),V(this,n,null,dn,p,{})}}setTimeout(()=>{new fn({target:document.querySelector("#app"),hydrate:!0});if(document.querySelector(".twitter-tweet")){const n=document.createElement("script");n.async=!0,n.src="https://platform.twitter.com/widgets.js",n.charset="utf-8",document.body.appendChild(n)}if("loading"in HTMLImageElement.prototype){document.querySelectorAll('img[loading="lazy"]').forEach(n=>{n.src=n.dataset.src})}else{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js",document.body.appendChild(n)}},3e3);
