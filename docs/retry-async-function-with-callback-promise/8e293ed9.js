function n(){}function a(n,a){for(const s in a)n[s]=a[s];return n}function s(n){return n()}function t(){return Object.create(null)}function e(n){n.forEach(s)}function o(n){return"function"==typeof n}function p(n,a){return n!=n?a==a:n!==a||n&&"object"==typeof n||"function"==typeof n}function c(n,s,t,e){return n[1]&&e?a(t.ctx.slice(),n[1](e(s))):t.ctx}function l(n,a,s,t,e,o,p){const l=function(n,a,s,t){if(n[2]&&t){const e=n[2](t(s));if(void 0===a.dirty)return e;if("object"==typeof e){const n=[],s=Math.max(a.dirty.length,e.length);for(let t=0;t<s;t+=1)n[t]=a.dirty[t]|e[t];return n}return a.dirty|e}return a.dirty}(a,t,e,o);if(l){const e=c(a,s,t,p);n.p(e,l)}}function i(n,a){n.appendChild(a)}function u(n,a,s){n.insertBefore(a,s||null)}function r(n){n.parentNode.removeChild(n)}function k(n,a){for(let s=0;s<n.length;s+=1)n[s]&&n[s].d(a)}function h(n){return document.createElement(n)}function f(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function d(n){return document.createTextNode(n)}function m(){return d(" ")}function g(){return d("")}function w(n,a,s){null==s?n.removeAttribute(a):n.getAttribute(a)!==s&&n.setAttribute(a,s)}function y(n){return Array.from(n.childNodes)}function E(n,a,s,t){for(let t=0;t<n.length;t+=1){const e=n[t];if(e.nodeName===a){let a=0;const o=[];for(;a<e.attributes.length;){const n=e.attributes[a++];s[n.name]||o.push(n.name)}for(let n=0;n<o.length;n++)e.removeAttribute(o[n]);return n.splice(t,1)[0]}}return t?f(a):h(a)}function v(n,a){for(let s=0;s<n.length;s+=1){const t=n[s];if(3===t.nodeType)return t.data=""+a,n.splice(s,1)[0]}return d(a)}function b(n){return v(n," ")}function j(n,a){a=""+a,n.wholeText!==a&&(n.data=a)}function P(n,a){n.value=null==a?"":a}class T{constructor(n=null){this.a=n,this.e=this.n=null}m(n,a,s=null){this.e||(this.e=h(a.nodeName),this.t=a,this.h(n)),this.i(s)}h(n){this.e.innerHTML=n,this.n=Array.from(this.e.childNodes)}i(n){for(let a=0;a<this.n.length;a+=1)u(this.t,this.n[a],n)}p(n){this.d(),this.h(n),this.i(this.a)}d(){this.n.forEach(r)}}let C;function O(n){C=n}function L(n){(function(){if(!C)throw new Error("Function called outside component initialization");return C})().$$.on_mount.push(n)}const A=[],$=[],D=[],M=[],I=Promise.resolve();let S=!1;function H(n){D.push(n)}let x=!1;const N=new Set;function F(){if(!x){x=!0;do{for(let n=0;n<A.length;n+=1){const a=A[n];O(a),R(a.$$)}for(A.length=0;$.length;)$.pop()();for(let n=0;n<D.length;n+=1){const a=D[n];N.has(a)||(N.add(a),a())}D.length=0}while(A.length);for(;M.length;)M.pop()();S=!1,x=!1,N.clear()}}function R(n){if(null!==n.fragment){n.update(),e(n.before_update);const a=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,a),n.after_update.forEach(H)}}const q=new Set;function W(n,a){n&&n.i&&(q.delete(n),n.i(a))}function _(n,a,s,t){if(n&&n.o){if(q.has(n))return;q.add(n),(void 0).c.push(()=>{q.delete(n),t&&(s&&n.d(1),t())}),n.o(a)}}function J(n){n&&n.c()}function B(n,a){n&&n.l(a)}function U(n,a,t){const{fragment:p,on_mount:c,on_destroy:l,after_update:i}=n.$$;p&&p.m(a,t),H(()=>{const a=c.map(s).filter(o);l?l.push(...a):e(a),n.$$.on_mount=[]}),i.forEach(H)}function z(n,a){const s=n.$$;null!==s.fragment&&(e(s.on_destroy),s.fragment&&s.fragment.d(a),s.on_destroy=s.fragment=null,s.ctx=[])}function G(n,a){-1===n.$$.dirty[0]&&(A.push(n),S||(S=!0,I.then(F)),n.$$.dirty.fill(0)),n.$$.dirty[a/31|0]|=1<<a%31}function V(a,s,o,p,c,l,i=[-1]){const u=C;O(a);const k=s.props||{},h=a.$$={fragment:null,ctx:null,props:l,update:n,not_equal:c,bound:t(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:t(),dirty:i};let f=!1;if(h.ctx=o?o(a,k,(n,s,...t)=>{const e=t.length?t[0]:s;return h.ctx&&c(h.ctx[n],h.ctx[n]=e)&&(h.bound[n]&&h.bound[n](e),f&&G(a,n)),s}):[],h.update(),f=!0,e(h.before_update),h.fragment=!!p&&p(h.ctx),s.target){if(s.hydrate){const n=y(s.target);h.fragment&&h.fragment.l(n),n.forEach(r)}else h.fragment&&h.fragment.c();s.intro&&W(a.$$.fragment),U(a,s.target,s.anchor),F()}O(u)}class Y{$destroy(){z(this,1),this.$destroy=n}$on(n,a){const s=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return s.push(a),()=>{const n=s.indexOf(a);-1!==n&&s.splice(n,1)}}$set(){}}function K(a){let s,t,e,o,p,c,l,k,g,j,P,T,C,O,L,A,$,D,M,I,S,H,x,N,F,R,q,W,_,J,B,U,z,G,V;return{c(){s=h("header"),t=h("nav"),e=h("ul"),o=h("li"),p=h("a"),c=d("Tan Li Hau"),l=m(),k=h("li"),g=h("a"),j=d("About"),P=m(),T=h("li"),C=h("a"),O=d("Writings"),L=m(),A=h("li"),$=h("a"),D=d("Talks"),M=m(),I=h("li"),S=h("a"),H=d("Notes"),x=m(),N=h("li"),F=h("a"),R=d("Newsletter"),q=m(),W=h("li"),_=h("a"),J=f("svg"),B=f("path"),U=m(),z=h("a"),G=f("svg"),V=f("path"),this.h()},l(n){s=E(n,"HEADER",{class:!0});var a=y(s);t=E(a,"NAV",{});var i=y(t);e=E(i,"UL",{class:!0});var u=y(e);o=E(u,"LI",{class:!0});var h=y(o);p=E(h,"A",{href:!0,class:!0});var f=y(p);c=v(f,"Tan Li Hau"),f.forEach(r),h.forEach(r),l=b(u),k=E(u,"LI",{class:!0});var d=y(k);g=E(d,"A",{href:!0,class:!0});var m=y(g);j=v(m,"About"),m.forEach(r),d.forEach(r),P=b(u),T=E(u,"LI",{class:!0});var w=y(T);C=E(w,"A",{href:!0,class:!0});var Y=y(C);O=v(Y,"Writings"),Y.forEach(r),w.forEach(r),L=b(u),A=E(u,"LI",{class:!0});var K=y(A);$=E(K,"A",{href:!0,class:!0});var Z=y($);D=v(Z,"Talks"),Z.forEach(r),K.forEach(r),M=b(u),I=E(u,"LI",{class:!0});var Q=y(I);S=E(Q,"A",{href:!0,class:!0});var X=y(S);H=v(X,"Notes"),X.forEach(r),Q.forEach(r),x=b(u),N=E(u,"LI",{class:!0});var nn=y(N);F=E(nn,"A",{href:!0,class:!0});var an=y(F);R=v(an,"Newsletter"),an.forEach(r),nn.forEach(r),q=b(u),W=E(u,"LI",{class:!0});var sn=y(W);_=E(sn,"A",{"aria-label":!0,href:!0,class:!0});var tn=y(_);J=E(tn,"svg",{viewBox:!0,width:!0,height:!0,class:!0},1);var en=y(J);B=E(en,"path",{d:!0},1),y(B).forEach(r),en.forEach(r),tn.forEach(r),U=b(sn),z=E(sn,"A",{"aria-label":!0,href:!0,class:!0});var on=y(z);G=E(on,"svg",{viewBox:!0,width:!0,height:!0,class:!0},1);var pn=y(G);V=E(pn,"path",{d:!0},1),y(V).forEach(r),pn.forEach(r),on.forEach(r),sn.forEach(r),u.forEach(r),i.forEach(r),a.forEach(r),this.h()},h(){w(p,"href","/"),w(p,"class","svelte-f3e4uo"),w(o,"class","svelte-f3e4uo"),w(g,"href","/about"),w(g,"class","svelte-f3e4uo"),w(k,"class","svelte-f3e4uo"),w(C,"href","/blogs"),w(C,"class","svelte-f3e4uo"),w(T,"class","svelte-f3e4uo"),w($,"href","/talks"),w($,"class","svelte-f3e4uo"),w(A,"class","svelte-f3e4uo"),w(S,"href","/notes"),w(S,"class","svelte-f3e4uo"),w(I,"class","svelte-f3e4uo"),w(F,"href","/newsletter"),w(F,"class","svelte-f3e4uo"),w(N,"class","svelte-f3e4uo"),w(B,"d","M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66\n    10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5\n    4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"),w(J,"viewBox","0 0 24 24"),w(J,"width","1em"),w(J,"height","1em"),w(J,"class","svelte-f3e4uo"),w(_,"aria-label","Twitter account"),w(_,"href","https://twitter.com/lihautan"),w(_,"class","svelte-f3e4uo"),w(V,"d","M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0\n    0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07\n    5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65\n    5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42\n    3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"),w(G,"viewBox","0 0 24 24"),w(G,"width","1em"),w(G,"height","1em"),w(G,"class","svelte-f3e4uo"),w(z,"aria-label","Github account"),w(z,"href","https://github.com/tanhauhau"),w(z,"class","svelte-f3e4uo"),w(W,"class","social svelte-f3e4uo"),w(e,"class","svelte-f3e4uo"),w(s,"class","svelte-f3e4uo")},m(n,a){u(n,s,a),i(s,t),i(t,e),i(e,o),i(o,p),i(p,c),i(e,l),i(e,k),i(k,g),i(g,j),i(e,P),i(e,T),i(T,C),i(C,O),i(e,L),i(e,A),i(A,$),i($,D),i(e,M),i(e,I),i(I,S),i(S,H),i(e,x),i(e,N),i(N,F),i(F,R),i(e,q),i(e,W),i(W,_),i(_,J),i(J,B),i(W,U),i(W,z),i(z,G),i(G,V)},p:n,i:n,o:n,d(n){n&&r(s)}}}class Z extends Y{constructor(n){super(),V(this,n,null,K,p,{})}}function Q(a){let s,t,e,o,p,c,l,k,f,g,j,T,C,O,L,A,$,D,M,I;return{c(){s=h("div"),t=h("h1"),e=d("Subscribe to my newsletter"),o=m(),p=h("h2"),c=d("Get the latest blog posts and project updates delivered right to your inbox"),l=m(),k=h("form"),f=h("div"),g=h("input"),j=m(),T=h("input"),O=m(),L=h("input"),A=m(),$=h("p"),D=d("Powered by Buttondown."),this.h()},l(n){s=E(n,"DIV",{class:!0});var a=y(s);t=E(a,"H1",{});var i=y(t);e=v(i,"Subscribe to my newsletter"),i.forEach(r),o=b(a),p=E(a,"H2",{class:!0});var u=y(p);c=v(u,"Get the latest blog posts and project updates delivered right to your inbox"),u.forEach(r),l=b(a),k=E(a,"FORM",{action:!0,method:!0,target:!0,onsubmit:!0,class:!0});var h=y(k);f=E(h,"DIV",{class:!0});var d=y(f);g=E(d,"INPUT",{type:!0,name:!0,id:!0,"aria-label":!0,placeholder:!0,class:!0}),j=b(d),T=E(d,"INPUT",{type:!0,value:!0,disabled:!0,class:!0}),d.forEach(r),O=b(h),L=E(h,"INPUT",{type:!0,value:!0,name:!0,class:!0}),A=b(h),$=E(h,"P",{class:!0});var m=y($);D=v(m,"Powered by Buttondown."),m.forEach(r),h.forEach(r),a.forEach(r),this.h()},h(){w(p,"class","svelte-1k1s1co"),w(g,"type","email"),w(g,"name","email"),w(g,"id","bd-email"),w(g,"aria-label","email address"),w(g,"placeholder","youremail@example.com"),w(g,"class","svelte-1k1s1co"),w(T,"type","submit"),T.value="Subscribe",T.disabled=C=!a[0],w(T,"class","svelte-1k1s1co"),w(f,"class","form-item svelte-1k1s1co"),w(L,"type","hidden"),L.value="1",w(L,"name","embed"),w(L,"class","svelte-1k1s1co"),w($,"class","svelte-1k1s1co"),w(k,"action","https://buttondown.email/api/emails/embed-subscribe/lihautan"),w(k,"method","post"),w(k,"target","popupwindow"),w(k,"onsubmit","window.open('https://buttondown.email/lihautan', 'popupwindow')"),w(k,"class","embeddable-buttondown-form"),w(s,"class","form svelte-1k1s1co")},m(n,r){var h,d,m,w;u(n,s,r),i(s,t),i(t,e),i(s,o),i(s,p),i(p,c),i(s,l),i(s,k),i(k,f),i(f,g),P(g,a[0]),i(f,j),i(f,T),i(k,O),i(k,L),i(k,A),i(k,$),i($,D),M||(h=g,d="input",m=a[1],h.addEventListener(d,m,w),I=()=>h.removeEventListener(d,m,w),M=!0)},p(n,[a]){1&a&&g.value!==n[0]&&P(g,n[0]),1&a&&C!==(C=!n[0])&&(T.disabled=C)},i:n,o:n,d(n){n&&r(s),M=!1,I()}}}function X(n,a,s){let t;return[t,function(){t=this.value,s(0,t)}]}class nn extends Y{constructor(n){super(),V(this,n,X,Q,p,{})}}function an(n){return L(()=>(setTimeout(()=>{if(window.innerWidth>1080){const n=document.createElement("script");n.async=!0,n.type="text/javascript",n.src="//cdn.carbonads.com/carbon.js?serve=CE7ITK3E&placement=lihautancom",n.id="_carbonads_js",document.body.appendChild(n)}},5e3),()=>{try{const n=document.getElementById("carbonads");n.parentNode.removeChild(n)}catch(n){}})),[]}class sn extends Y{constructor(n){super(),V(this,n,an,null,p,{})}}var tn="https://lihautan.com/retry-async-function-with-callback-promise/assets/hero-twitter-3c52317b.jpg";function en(n,a,s){const t=n.slice();return t[6]=a[s],t}function on(n,a,s){const t=n.slice();return t[6]=a[s],t}function pn(n){let a,s;return{c(){a=h("meta"),this.h()},l(n){a=E(n,"META",{name:!0,content:!0}),this.h()},h(){w(a,"name","keywords"),w(a,"content",s=n[6])},m(n,s){u(n,a,s)},p(n,t){4&t&&s!==(s=n[6])&&w(a,"content",s)},d(n){n&&r(a)}}}function cn(n){let a,s,t=n[6]+"";return{c(){a=h("span"),s=d(t),this.h()},l(n){a=E(n,"SPAN",{class:!0});var e=y(a);s=v(e,t),e.forEach(r),this.h()},h(){w(a,"class","svelte-9tqnza")},m(n,t){u(n,a,t),i(a,s)},p(n,a){4&a&&t!==(t=n[6]+"")&&j(s,t)},d(n){n&&r(a)}}}function ln(n){let a,s,t,e,o,p,f,P,C,O,L,A,$,D,M,I,S,H,x,N,F,R,q,G,V,Y,K,Q,X,an,ln,un,rn,kn,hn,fn,dn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"Article",author:n[3],copyrightHolder:n[3],copyrightYear:"2020",creator:n[3],publisher:n[3],description:n[1],headline:n[0],name:n[0],inLanguage:"en"})}<\/script>`,mn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"BreadcrumbList",description:"Breadcrumbs list",name:"Breadcrumbs",itemListElement:[{"@type":"ListItem",item:{"@id":"https://lihautan.com",name:"Homepage"},name:"Homepage",position:1},{"@type":"ListItem",item:{"@id":"https%3A%2F%2Flihautan.com%2Fretry-async-function-with-callback-promise",name:n[0]},name:n[0],position:2}]})}<\/script>`;document.title=a=n[0]+" | Tan Li Hau";let gn=n[2],wn=[];for(let a=0;a<gn.length;a+=1)wn[a]=pn(on(n,gn,a));q=new Z({});let yn=n[2],En=[];for(let a=0;a<yn.length;a+=1)En[a]=cn(en(n,yn,a));const vn=n[5].default,bn=function(n,a,s,t){if(n){const e=c(n,a,s,t);return n[0](e)}}(vn,n,n[4],null);return rn=new nn({}),hn=new sn({}),{c(){s=h("meta"),t=h("meta"),e=h("meta"),o=h("meta"),p=h("meta"),f=h("meta"),P=h("meta"),C=h("meta"),O=h("meta"),L=h("meta"),A=h("meta");for(let n=0;n<wn.length;n+=1)wn[n].c();$=h("meta"),D=h("meta"),I=g(),H=g(),x=m(),N=h("a"),F=d("Skip to content"),R=m(),J(q.$$.fragment),G=m(),V=h("main"),Y=h("h1"),K=d(n[0]),Q=m();for(let n=0;n<En.length;n+=1)En[n].c();X=m(),an=h("article"),bn&&bn.c(),ln=m(),un=h("footer"),J(rn.$$.fragment),kn=m(),J(hn.$$.fragment),this.h()},l(a){const c=function(n,a=document.body){return Array.from(a.querySelectorAll(n))}('[data-svelte="svelte-15e3uyc"]',document.head);s=E(c,"META",{name:!0,content:!0}),t=E(c,"META",{name:!0,content:!0}),e=E(c,"META",{name:!0,content:!0}),o=E(c,"META",{name:!0,content:!0}),p=E(c,"META",{name:!0,content:!0}),f=E(c,"META",{name:!0,content:!0}),P=E(c,"META",{name:!0,content:!0}),C=E(c,"META",{name:!0,content:!0}),O=E(c,"META",{name:!0,content:!0}),L=E(c,"META",{name:!0,content:!0}),A=E(c,"META",{name:!0,content:!0});for(let n=0;n<wn.length;n+=1)wn[n].l(c);$=E(c,"META",{itemprop:!0,content:!0}),D=E(c,"META",{itemprop:!0,content:!0}),I=g(),H=g(),c.forEach(r),x=b(a),N=E(a,"A",{href:!0,class:!0});var l=y(N);F=v(l,"Skip to content"),l.forEach(r),R=b(a),B(q.$$.fragment,a),G=b(a),V=E(a,"MAIN",{id:!0,class:!0});var i=y(V);Y=E(i,"H1",{});var u=y(Y);K=v(u,n[0]),u.forEach(r),Q=b(i);for(let n=0;n<En.length;n+=1)En[n].l(i);X=b(i),an=E(i,"ARTICLE",{});var k=y(an);bn&&bn.l(k),k.forEach(r),i.forEach(r),ln=b(a),un=E(a,"FOOTER",{class:!0});var h=y(un);B(rn.$$.fragment,h),kn=b(h),B(hn.$$.fragment,h),h.forEach(r),this.h()},h(){w(s,"name","description"),w(s,"content",n[1]),w(t,"name","image"),w(t,"content",tn),w(e,"name","og:image"),w(e,"content",tn),w(o,"name","og:title"),w(o,"content",n[0]),w(p,"name","og:description"),w(p,"content",n[1]),w(f,"name","og:type"),w(f,"content","website"),w(P,"name","twitter:card"),w(P,"content","summary_large_image"),w(C,"name","twitter:creator"),w(C,"content","@lihautan"),w(O,"name","twitter:title"),w(O,"content",n[0]),w(L,"name","twitter:description"),w(L,"content",n[1]),w(A,"name","twitter:image"),w(A,"content",tn),w($,"itemprop","url"),w($,"content","https%3A%2F%2Flihautan.com%2Fretry-async-function-with-callback-promise"),w(D,"itemprop","image"),w(D,"content",tn),M=new T(I),S=new T(H),w(N,"href","#content"),w(N,"class","skip svelte-9tqnza"),w(V,"id","content"),w(V,"class","blog svelte-9tqnza"),w(un,"class","svelte-9tqnza")},m(n,a){i(document.head,s),i(document.head,t),i(document.head,e),i(document.head,o),i(document.head,p),i(document.head,f),i(document.head,P),i(document.head,C),i(document.head,O),i(document.head,L),i(document.head,A);for(let n=0;n<wn.length;n+=1)wn[n].m(document.head,null);i(document.head,$),i(document.head,D),M.m(dn,document.head),i(document.head,I),S.m(mn,document.head),i(document.head,H),u(n,x,a),u(n,N,a),i(N,F),u(n,R,a),U(q,n,a),u(n,G,a),u(n,V,a),i(V,Y),i(Y,K),i(V,Q);for(let n=0;n<En.length;n+=1)En[n].m(V,null);i(V,X),i(V,an),bn&&bn.m(an,null),u(n,ln,a),u(n,un,a),U(rn,un,null),i(un,kn),U(hn,un,null),fn=!0},p(n,[t]){if((!fn||1&t)&&a!==(a=n[0]+" | Tan Li Hau")&&(document.title=a),(!fn||2&t)&&w(s,"content",n[1]),(!fn||1&t)&&w(o,"content",n[0]),(!fn||2&t)&&w(p,"content",n[1]),(!fn||1&t)&&w(O,"content",n[0]),(!fn||2&t)&&w(L,"content",n[1]),4&t){let a;for(gn=n[2],a=0;a<gn.length;a+=1){const s=on(n,gn,a);wn[a]?wn[a].p(s,t):(wn[a]=pn(s),wn[a].c(),wn[a].m($.parentNode,$))}for(;a<wn.length;a+=1)wn[a].d(1);wn.length=gn.length}if((!fn||3&t)&&dn!==(dn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"Article",author:n[3],copyrightHolder:n[3],copyrightYear:"2020",creator:n[3],publisher:n[3],description:n[1],headline:n[0],name:n[0],inLanguage:"en"})}<\/script>`)&&M.p(dn),(!fn||1&t)&&mn!==(mn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"BreadcrumbList",description:"Breadcrumbs list",name:"Breadcrumbs",itemListElement:[{"@type":"ListItem",item:{"@id":"https://lihautan.com",name:"Homepage"},name:"Homepage",position:1},{"@type":"ListItem",item:{"@id":"https%3A%2F%2Flihautan.com%2Fretry-async-function-with-callback-promise",name:n[0]},name:n[0],position:2}]})}<\/script>`)&&S.p(mn),(!fn||1&t)&&j(K,n[0]),4&t){let a;for(yn=n[2],a=0;a<yn.length;a+=1){const s=en(n,yn,a);En[a]?En[a].p(s,t):(En[a]=cn(s),En[a].c(),En[a].m(V,X))}for(;a<En.length;a+=1)En[a].d(1);En.length=yn.length}bn&&bn.p&&16&t&&l(bn,vn,n,n[4],t,null,null)},i(n){fn||(W(q.$$.fragment,n),W(bn,n),W(rn.$$.fragment,n),W(hn.$$.fragment,n),fn=!0)},o(n){_(q.$$.fragment,n),_(bn,n),_(rn.$$.fragment,n),_(hn.$$.fragment,n),fn=!1},d(n){r(s),r(t),r(e),r(o),r(p),r(f),r(P),r(C),r(O),r(L),r(A),k(wn,n),r($),r(D),r(I),n&&M.d(),r(H),n&&S.d(),n&&r(x),n&&r(N),n&&r(R),z(q,n),n&&r(G),n&&r(V),k(En,n),bn&&bn.d(n),n&&r(ln),n&&r(un),z(rn),z(hn)}}}function un(n,a,s){let{title:t=""}=a,{description:e=""}=a,{tags:o=[]}=a;const p={"@type":"Person",name:"Tan Li Hau"};let{$$slots:c={},$$scope:l}=a;return n.$set=n=>{"title"in n&&s(0,t=n.title),"description"in n&&s(1,e=n.description),"tags"in n&&s(2,o=n.tags),"$$scope"in n&&s(4,l=n.$$scope)},[t,e,o,p,l,c]}class rn extends Y{constructor(n){super(),V(this,n,un,ln,p,{title:0,description:1,tags:2})}}function kn(a){let s,t,e,o,p,c,l,k,f,g,j,P,T,C,O,L,A,$,D,M,I,S,H,x,N,F,R,q,W,_,J,B,U,z,G,V,Y,K,Z,Q,X,nn,an,sn,tn,en,on,pn,cn,ln,un,rn,kn,hn,fn,dn,mn,gn,wn,yn,En,vn,bn,jn,Pn,Tn,Cn,On,Ln,An,$n,Dn,Mn,In,Sn,Hn,xn,Nn,Fn,Rn,qn,Wn,_n,Jn,Bn,Un,zn,Gn,Vn,Yn,Kn,Zn,Qn,Xn,na,aa,sa,ta,ea,oa,pa,ca,la,ia,ua,ra,ka,ha,fa,da,ma,ga,wa,ya,Ea,va,ba,ja,Pa,Ta,Ca,Oa,La,Aa,$a,Da,Ma,Ia,Sa,Ha,xa,Na,Fa,Ra,qa,Wa,_a,Ja,Ba,Ua,za,Ga,Va,Ya,Ka,Za,Qa,Xa,ns,as,ss,ts,es,os,ps,cs,ls,is,us,rs,ks,hs,fs,ds,ms,gs,ws,ys,Es,vs,bs,js,Ps,Ts,Cs,Os,Ls,As,$s,Ds,Ms,Is,Ss,Hs,xs,Ns,Fs,Rs,qs,Ws,_s,Js,Bs,Us,zs,Gs,Vs,Ys,Ks,Zs,Qs,Xs,nt,at,st,tt,et,ot,pt,ct,lt,it,ut,rt,kt,ht,ft,dt,mt,gt,wt,yt,Et,vt,bt,jt,Pt,Tt,Ct,Ot,Lt,At,$t,Dt,Mt,It,St,Ht,xt,Nt,Ft,Rt,qt,Wt,_t,Jt,Bt,Ut,zt,Gt,Vt,Yt,Kt,Zt,Qt,Xt,ne,ae,se,te,ee,oe,pe,ce,le,ie,ue,re,ke,he,fe,de,me,ge,we,ye,Ee,ve,be,je,Pe,Te,Ce,Oe,Le,Ae,$e,De,Me,Ie,Se,He,xe,Ne,Fe,Re,qe,We,_e,Je,Be,Ue,ze,Ge,Ve,Ye,Ke,Ze,Qe,Xe,no,ao,so,to,eo,oo,po,co,lo,io,uo,ro,ko,ho,fo,mo,go,wo,yo,Eo,vo,bo,jo,Po,To,Co,Oo,Lo,Ao,$o,Do,Mo,Io,So,Ho,xo,No,Fo,Ro,qo,Wo,_o,Jo,Bo,Uo,zo,Go,Vo,Yo,Ko,Zo,Qo,Xo,np,ap,sp,tp,ep,op,pp,cp,lp,ip,up,rp,kp,hp,fp,dp,mp,gp,wp,yp,Ep,vp,bp,jp,Pp,Tp,Cp,Op,Lp,Ap,$p,Dp,Mp,Ip,Sp,Hp,xp,Np,Fp,Rp,qp,Wp,_p,Jp,Bp,Up,zp,Gp,Vp,Yp,Kp,Zp,Qp,Xp,nc,ac,sc,tc,ec,oc,pc,cc,lc,ic,uc,rc,kc,hc,fc,dc,mc,gc,wc,yc,Ec,vc,bc,jc,Pc,Tc,Cc,Oc,Lc,Ac,$c,Dc,Mc,Ic,Sc,Hc,xc,Nc,Fc,Rc,qc,Wc,_c,Jc,Bc,Uc,zc,Gc,Vc,Yc,Kc,Zc,Qc,Xc,nl,al,sl,tl,el,ol,pl,cl,ll,il,ul,rl,kl,hl,fl,dl,ml,gl,wl,yl,El,vl,bl,jl,Pl,Tl,Cl,Ol,Ll,Al,$l,Dl,Ml,Il,Sl,Hl,xl,Nl,Fl,Rl,ql,Wl,_l,Jl,Bl,Ul,zl,Gl,Vl,Yl,Kl,Zl,Ql,Xl,ni,ai,si,ti,ei,oi,pi,ci,li,ii,ui,ri,ki,hi,fi,di,mi,gi,wi,yi,Ei,vi,bi,ji,Pi,Ti,Ci,Oi,Li,Ai,$i,Di,Mi,Ii,Si,Hi,xi,Ni,Fi,Ri,qi,Wi,_i,Ji,Bi,Ui,zi,Gi,Vi,Yi,Ki,Zi,Qi,Xi,nu,au,su,tu,eu,ou,pu,cu,lu,iu,uu,ru,ku,hu,fu,du,mu,gu,wu,yu,Eu,vu,bu,ju,Pu,Tu,Cu,Ou,Lu,Au,$u,Du,Mu,Iu,Su,Hu,xu,Nu,Fu,Ru,qu,Wu,_u,Ju,Bu,Uu,zu,Gu,Vu,Yu,Ku,Zu,Qu,Xu,nr,ar,sr,tr,er;return{c(){s=h("section"),t=h("ul"),e=h("li"),o=h("a"),p=d("The callback pattern"),c=h("li"),l=h("a"),k=d("The promise chain"),f=h("li"),g=h("a"),j=d("Async await"),P=h("li"),T=h("a"),C=d("Testing"),O=h("li"),L=h("a"),A=d("Closing Note"),$=m(),D=h("p"),M=d("JavaScript is a single-threaded programming language, which means only one thing can happen at a time in a single thread."),I=m(),S=h("p"),H=d("That’s where asynchronous JavaScript comes into play. Using asynchronous JavaScript (such as callbacks, promises, and async/await), you can perform long network requests without blocking the main thread."),x=m(),N=h("p"),F=d("In this article, I'm going to show how you can retry an asynchronous function in JavaScript, using the callback pattern, promise chain pattern and async await. Also, I'll show you how to write test to verify it works."),R=m(),q=h("section"),W=h("h2"),_=h("a"),J=d("The callback pattern"),B=m(),U=h("p"),z=d("Let's take a look at retrying asynchronous function that takes in a callback function that follows "),G=h("a"),V=d("the callback convention"),Y=d(":"),K=m(),Z=h("ul"),Q=h("li"),X=d("The first argument of the callback function is an error object"),nn=m(),an=h("li"),sn=d("The second argument contains the callback results."),tn=m(),en=h("pre"),on=m(),pn=h("p"),cn=d("So we are going to implement the "),ln=h("code"),un=d("retry"),rn=d(" function, that takes in the asynchronous function to retry, "),kn=h("code"),hn=d("fn"),fn=d(" and a callback function, "),dn=h("code"),mn=d("cb"),gn=d(", that will be called when the function succeeded or failed after all the retry attempts."),wn=m(),yn=h("pre"),En=m(),vn=h("p"),bn=d("The first thing we are going to do is to call the function "),jn=h("code"),Pn=d("fn"),Tn=d(":"),Cn=m(),On=h("pre"),Ln=m(),An=h("p"),$n=d("We check if there's an error, if there's no error, we can call the "),Dn=h("code"),Mn=d("cb"),In=d(" function to indicate the function succeeded. However, if there's an error, we are going to call the function again to retry."),Sn=m(),Hn=h("pre"),xn=m(),Nn=h("p"),Fn=d("Let's retry at most 3 times:"),Rn=m(),qn=h("pre"),Wn=m(),_n=h("p"),Jn=d("Notice that it starts to get unwieldy as we are nesting more callback functions. It's hard to figure out which close bracket "),Bn=h("code"),Un=d("}"),zn=d(" is belong to without proper indentation."),Gn=m(),Vn=h("p"),Yn=d("This is the so-called "),Kn=h("a"),Zn=d('"Callback Hell"'),Qn=d(" in JavaScript."),Xn=m(),na=h("p"),aa=d("Let's make it more unbearable to prove the point by flipping the if case:"),sa=m(),ta=h("pre"),ea=m(),oa=h("p"),pa=d("Now can you tell which "),ca=h("code"),la=d("data"),ia=d(" is belong to which function?"),ua=m(),ra=h("p"),ka=d("Now, instead of always retry at most 3 times, we are going to retry at most "),ha=h("code"),fa=d("n"),da=d(" times."),ma=m(),ga=h("p"),wa=d("So we are going to introduce a new argument, "),ya=h("code"),Ea=d("n"),va=d(":"),ba=m(),ja=h("pre"),Pa=m(),Ta=h("p"),Ca=d("The function keeps going forever, until it reaches "),Oa=h("code"),La=d("n"),Aa=d(" attempt."),$a=m(),Da=h("p"),Ma=d("If you stare at the code hard enough, you would notice that the code starts to repeat itself:"),Ia=m(),Sa=h("p"),Ha=h("picture"),xa=h("source"),Na=h("source"),Fa=h("img"),Ra=m(),qa=h("p"),Wa=d("Note that the code within the outer red square is the same as the code within the inner red square, which is the same as the inner inner red square ..."),_a=m(),Ja=h("p"),Ba=d("So, let's extract the code within the red square out into a function and replace the red squares with the function:"),Ua=m(),za=h("pre"),Ga=m(),Va=h("p"),Ya=d("And there you go, retrying an asynchronous function with callback pattern."),Ka=m(),Za=h("p"),Qa=d("Does it work? Well, we have to test it to verify it. Stay till the end to see how we are going to write unit test to verify it."),Xa=m(),ns=h("section"),as=h("h2"),ss=h("a"),ts=d("The promise chain"),es=m(),os=h("p"),ps=d("A "),cs=h("a"),ls=d("Promise"),is=d(", according to MDN, object represents the eventual completion of an asynchronous operation, and its resulting value."),us=m(),rs=h("p"),ks=d("A Promise object provides "),hs=h("code"),fs=d(".then"),ds=d(" and "),ms=h("code"),gs=d(".catch"),ws=d(" method, which takes in callback function to be called when the promise is resolved or rejected respectively. The "),ys=h("code"),Es=d(".then"),vs=d(" and "),bs=h("code"),js=d(".catch"),Ps=d(" method then returns a new Promise of the return value of the callback function."),Ts=m(),Cs=h("pre"),Os=m(),Ls=h("p"),As=d("The chaining of "),$s=h("code"),Ds=d(".then"),Ms=d(" and "),Is=h("code"),Ss=d(".catch"),Hs=d(" is a common pattern, called "),xs=h("a"),Ns=d("Promise chaining"),Fs=d("."),Rs=m(),qs=h("p"),Ws=d("Now, lets implement the "),_s=h("code"),Js=d("retry"),Bs=d(" function, which takes in the asynchronous function to retry, "),Us=h("code"),zs=d("fn"),Gs=d(" and return a promise, which resolved when the function succeeded or resolved after failing all the retry attempts."),Vs=m(),Ys=h("pre"),Ks=m(),Zs=h("p"),Qs=d("The first thing we are going to do is to call the function "),Xs=h("code"),nt=d("fn"),at=d(":"),st=m(),tt=h("pre"),et=m(),ot=h("p"),pt=d("We need to retry calling "),ct=h("code"),lt=d("fn"),it=d(" again, if the first "),ut=h("code"),rt=d("fn"),kt=d(" is rejected"),ht=m(),ft=h("pre"),dt=m(),mt=h("p"),gt=d("If that new promise rejected again, we retry by calling "),wt=h("code"),yt=d("fn"),Et=d(" again"),vt=m(),bt=h("pre"),jt=m(),Pt=h("p"),Tt=d("The last promise "),Ct=h("em"),Ot=d("(promise#3)"),Lt=d(" will reject if the 3rd "),At=h("code"),$t=d("fn()"),Dt=d(" attempt rejects, and resolve if any of the "),Mt=h("code"),It=d("fn()"),St=d(" attempts resolve."),Ht=m(),xt=h("p"),Nt=d("The callback method within "),Ft=h("code"),Rt=d(".catch"),qt=d(" will be called only when the previous "),Wt=h("code"),_t=d("fn()"),Jt=d(" attempt rejects."),Bt=m(),Ut=h("p"),zt=d("We are going to return a rejected promise with the error indicating max retries has met, if the last promise "),Gt=h("code"),Vt=d("(promise#3)"),Yt=d(" rejected, and a resolved promise with the result from "),Kt=h("code"),Zt=d("fn()"),Qt=d("."),Xt=m(),ne=h("pre"),ae=m(),se=h("p"),te=d("And we can make the code more concise, as the following two are equivalent, in terms of what is being resolved and rejected:"),ee=m(),oe=h("pre"),pe=m(),ce=h("p"),le=d("Also, we can substitute the variable "),ie=h("code"),ue=d("promise3"),re=d(" with it's promise chain value:"),ke=m(),he=h("pre"),fe=m(),de=h("p"),me=d("Now, instead of always retry at most 3 times, we are going to retry at most "),ge=h("code"),we=d("n"),ye=d(" times."),Ee=m(),ve=h("p"),be=d("So we are going to introduce a new argument, "),je=h("code"),Pe=d("n"),Te=d(":"),Ce=m(),Oe=h("pre"),Le=m(),Ae=h("p"),$e=d("Instead of writing "),De=h("code"),Me=d(".catch(() => fn())"),Ie=m(),Se=h("code"),He=d("n"),xe=d(" number of times, we can build the Promise up using a for loop."),Ne=m(),Fe=h("p"),Re=h("strong"),qe=d("Assuming "),We=h("code"),_e=d("n"),Je=d(" is always greater or equal to 1,"),Be=m(),Ue=h("pre"),ze=m(),Ge=h("p"),Ve=d("What if "),Ye=h("code"),Ke=d("n"),Ze=d(" is "),Qe=h("code"),Xe=d("0"),no=d(" or negative? We shouldn't call "),ao=h("code"),so=d("fn()"),to=d(" at all!"),eo=m(),oo=h("pre"),po=m(),co=h("p"),lo=d("Well, this maybe a little bit inelegant, having to execute the "),io=h("code"),uo=d("if (!promise) ... else ..."),ro=d(" on every loop, we can initialise the promise with a rejected promise, so that we can treat the 1st "),ko=h("code"),ho=d("fn()"),fo=d(" called as the 1st retry:"),mo=m(),go=h("pre"),wo=m(),yo=h("p"),Eo=d("And there you go, retrying an asynchronous function with promise chain."),vo=m(),bo=h("section"),jo=h("h2"),Po=h("a"),To=d("Async await"),Co=m(),Oo=h("p"),Lo=d("When you use a promise, you need to use "),Ao=h("code"),$o=d(".then"),Do=d(" to get the resolved value, and that happened asynchronously."),Mo=m(),Io=h("p"),So=d("Meaning, if you have"),Ho=m(),xo=h("pre"),No=m(),Fo=h("p"),Ro=d("You would see"),qo=m(),Wo=h("pre"),_o=m(),Jo=h("p"),Bo=d("first, and then some time later,"),Uo=m(),zo=h("pre"),Go=m(),Vo=h("p"),Yo=d("This is because the function in the "),Ko=h("code"),Zo=d(".then"),Qo=d(" is called asynchronously, it is executed in a separate timeline of execution, so to speak."),Xo=m(),np=h("p"),ap=d("And "),sp=h("code"),tp=d("async"),ep=d(" + "),op=h("code"),pp=d("await"),cp=d(" in JavaScript allow us to stitch multiple separate timeline of execution into disguisedly 1 timeline of execution flow."),lp=m(),ip=h("p"),up=d("Everytime when we "),rp=h("code"),kp=d("await"),hp=d(", we jump into a different asynchronous timeline."),fp=m(),dp=h("p"),mp=d("So, with the code with Promise + "),gp=h("code"),wp=d(".then"),yp=d(":"),Ep=m(),vp=h("pre"),bp=m(),jp=h("p"),Pp=d("can be written in "),Tp=h("code"),Cp=d("async"),Op=d(" + "),Lp=h("code"),Ap=d("await"),$p=d(" in the following manner:"),Dp=m(),Mp=h("pre"),Ip=m(),Sp=h("p"),Hp=d("Now, lets implement the "),xp=h("code"),Np=d("retry"),Fp=d(" function using "),Rp=h("code"),qp=d("async"),Wp=d(" + "),_p=h("code"),Jp=d("await"),Bp=d("."),Up=m(),zp=h("pre"),Gp=m(),Vp=h("p"),Yp=d("The first thing we are going to do is to call the function "),Kp=h("code"),Zp=d("fn"),Qp=d(":"),Xp=m(),nc=h("pre"),ac=m(),sc=h("p"),tc=d("We need to retry calling "),ec=h("code"),oc=d("fn"),pc=d(" again, if the first "),cc=h("code"),lc=d("fn"),ic=d(" is rejected. Instead of "),uc=h("code"),rc=d(".catch"),kc=d(", we use "),hc=h("code"),fc=d("await"),dc=d(" + "),mc=h("code"),gc=d("try catch"),wc=m(),yc=h("pre"),Ec=m(),vc=h("p"),bc=d("If the 2nd "),jc=h("code"),Pc=d("fn()"),Tc=d(" rejected again, we retry by calling "),Cc=h("code"),Oc=d("fn"),Lc=d(" again"),Ac=m(),$c=h("pre"),Dc=m(),Mc=h("p"),Ic=d("And if the last "),Sc=h("code"),Hc=d("fn()"),xc=d(" rejected again, we are going to return a rejected promise with an error indicating max retries has met by throw the error"),Nc=m(),Fc=h("pre"),Rc=m(),qc=h("p"),Wc=d("Now, if we need to return a Promise resolved with the resolved value from "),_c=h("code"),Jc=d("fn()"),Bc=m(),Uc=h("pre"),zc=m(),Gc=h("p"),Vc=d("Since we are ending early in the "),Yc=h("code"),Kc=d("try"),Zc=d(" block, and we are not using the error from the "),Qc=h("code"),Xc=d("catch"),nl=d(" block, we can make the code less nested"),al=m(),sl=h("pre"),tl=m(),el=h("p"),ol=d("Now, instead of always retry at most 3 times, we are going to retry at most "),pl=h("code"),cl=d("n"),ll=d(" times."),il=m(),ul=h("p"),rl=d("So we are going to introduce a new argument, "),kl=h("code"),hl=d("n"),fl=d(":"),dl=m(),ml=h("pre"),gl=m(),wl=h("p"),yl=d("Instead of writing it "),El=h("code"),vl=d("n"),bl=d(" number of times, we can achieve it using a "),jl=h("code"),Pl=d("for"),Tl=d(" loop:"),Cl=m(),Ol=h("pre"),Ll=m(),Al=h("p"),$l=d("And there you go, retrying an asynchronous function using "),Dl=h("code"),Ml=d("async"),Il=d(" + "),Sl=h("code"),Hl=d("await"),xl=d("."),Nl=m(),Fl=h("section"),Rl=h("h2"),ql=h("a"),Wl=d("Testing"),_l=m(),Jl=h("p"),Bl=d("To test whether our "),Ul=h("code"),zl=d("retry"),Gl=d(" function works, we need to have a max number of retry in mind, say 3. And we need a function, "),Vl=h("code"),Yl=d("fn"),Kl=d(" that we can control when it succeed and when it failed."),Zl=m(),Ql=h("p"),Xl=d("So we can have the following test cases:"),ni=m(),ai=h("ul"),si=h("li"),ti=h("code"),ei=d("fn"),oi=d(" always succeed;"),pi=h("ul"),ci=h("li"),li=d("verify "),ii=h("code"),ui=d("fn"),ri=d(" get called only 1 time"),ki=m(),hi=h("li"),fi=d("verify we get the return value from the 1st attempt"),di=m(),mi=h("li"),gi=h("code"),wi=d("fn"),yi=d(" failed on 1st attempt, and succeed thereafter;"),Ei=h("ul"),vi=h("li"),bi=d("verify "),ji=h("code"),Pi=d("fn"),Ti=d(" get called only 2 times"),Ci=m(),Oi=h("li"),Li=d("verify we get the return value from the 2nd attempt"),Ai=m(),$i=h("li"),Di=h("code"),Mi=d("fn"),Ii=d(" failed on 1st, 2nd attempt, and succeed thereafter;"),Si=h("ul"),Hi=h("li"),xi=d("verify "),Ni=h("code"),Fi=d("fn"),Ri=d(" get called only 3 times"),qi=m(),Wi=h("li"),_i=d("verify we get the return value from the 3rd attempt"),Ji=m(),Bi=h("li"),Ui=h("code"),zi=d("fn"),Gi=d(" failed on 1st, 2nd, 3rd attempt, and succeed thereafter;"),Vi=h("ul"),Yi=h("li"),Ki=d("verify "),Zi=h("code"),Qi=d("fn"),Xi=d(" get called only 3 times"),nu=m(),au=h("li"),su=d("verify we get the max retry error"),tu=m(),eu=h("p"),ou=d("So, the key is to devise such "),pu=h("code"),cu=d("fn"),lu=d(" that we can control when it succeed and when it failed."),iu=m(),uu=h("p"),ru=d("We can create a function that returns such function"),ku=m(),hu=h("pre"),fu=m(),du=h("p"),mu=d("The function takes in number indicating how many time the return function would fail, before succeeding thereafter"),gu=m(),wu=h("pre"),yu=m(),Eu=h("p"),vu=d("To know how many times the function is called, we can track it with a variable"),bu=m(),ju=h("pre"),Pu=m(),Tu=h("p"),Cu=d("As long as the number of times called is less than the number of time it should fail, it will fail."),Ou=m(),Lu=h("pre"),Au=m(),$u=h("p"),Du=d('Next, to verify the function get called a certain number of times, we can create a "spy" function:'),Mu=m(),Iu=h("pre"),Su=m(),Hu=h("p"),xu=d("So, let's put all of them together:"),Nu=m(),Fu=h("pre"),Ru=m(),qu=h("section"),Wu=h("h2"),_u=h("a"),Ju=d("Closing Note"),Bu=m(),Uu=h("p"),zu=d("We've seen how we can retry an asynchronous function using the callback pattern, promise chain pattern and "),Gu=h("code"),Vu=d("async"),Yu=d(" + "),Ku=h("code"),Zu=d("await"),Qu=d("."),Xu=m(),nr=h("p"),ar=d("Each of the 3 methods is important in its on right, albeit some is more verbose than another."),sr=m(),tr=h("p"),er=d("Lastly, we also cover how to write test to verify our code, and also how to create the mock function to facilitate our test cases."),this.h()},l(n){s=E(n,"SECTION",{});var a=y(s);t=E(a,"UL",{class:!0,id:!0,role:!0,"aria-label":!0});var i=y(t);e=E(i,"LI",{});var u=y(e);o=E(u,"A",{href:!0});var h=y(o);p=v(h,"The callback pattern"),h.forEach(r),u.forEach(r),c=E(i,"LI",{});var d=y(c);l=E(d,"A",{href:!0});var m=y(l);k=v(m,"The promise chain"),m.forEach(r),d.forEach(r),f=E(i,"LI",{});var w=y(f);g=E(w,"A",{href:!0});var or=y(g);j=v(or,"Async await"),or.forEach(r),w.forEach(r),P=E(i,"LI",{});var pr=y(P);T=E(pr,"A",{href:!0});var cr=y(T);C=v(cr,"Testing"),cr.forEach(r),pr.forEach(r),O=E(i,"LI",{});var lr=y(O);L=E(lr,"A",{href:!0});var ir=y(L);A=v(ir,"Closing Note"),ir.forEach(r),lr.forEach(r),i.forEach(r),a.forEach(r),$=b(n),D=E(n,"P",{});var ur=y(D);M=v(ur,"JavaScript is a single-threaded programming language, which means only one thing can happen at a time in a single thread."),ur.forEach(r),I=b(n),S=E(n,"P",{});var rr=y(S);H=v(rr,"That’s where asynchronous JavaScript comes into play. Using asynchronous JavaScript (such as callbacks, promises, and async/await), you can perform long network requests without blocking the main thread."),rr.forEach(r),x=b(n),N=E(n,"P",{});var kr=y(N);F=v(kr,"In this article, I'm going to show how you can retry an asynchronous function in JavaScript, using the callback pattern, promise chain pattern and async await. Also, I'll show you how to write test to verify it works."),kr.forEach(r),R=b(n),q=E(n,"SECTION",{});var hr=y(q);W=E(hr,"H2",{});var fr=y(W);_=E(fr,"A",{href:!0,id:!0});var dr=y(_);J=v(dr,"The callback pattern"),dr.forEach(r),fr.forEach(r),B=b(hr),U=E(hr,"P",{});var mr=y(U);z=v(mr,"Let's take a look at retrying asynchronous function that takes in a callback function that follows "),G=E(mr,"A",{href:!0,rel:!0});var gr=y(G);V=v(gr,"the callback convention"),gr.forEach(r),Y=v(mr,":"),mr.forEach(r),K=b(hr),Z=E(hr,"UL",{});var wr=y(Z);Q=E(wr,"LI",{});var yr=y(Q);X=v(yr,"The first argument of the callback function is an error object"),yr.forEach(r),nn=b(wr),an=E(wr,"LI",{});var Er=y(an);sn=v(Er,"The second argument contains the callback results."),Er.forEach(r),wr.forEach(r),tn=b(hr),en=E(hr,"PRE",{class:!0}),y(en).forEach(r),on=b(hr),pn=E(hr,"P",{});var vr=y(pn);cn=v(vr,"So we are going to implement the "),ln=E(vr,"CODE",{});var br=y(ln);un=v(br,"retry"),br.forEach(r),rn=v(vr," function, that takes in the asynchronous function to retry, "),kn=E(vr,"CODE",{});var jr=y(kn);hn=v(jr,"fn"),jr.forEach(r),fn=v(vr," and a callback function, "),dn=E(vr,"CODE",{});var Pr=y(dn);mn=v(Pr,"cb"),Pr.forEach(r),gn=v(vr,", that will be called when the function succeeded or failed after all the retry attempts."),vr.forEach(r),wn=b(hr),yn=E(hr,"PRE",{class:!0}),y(yn).forEach(r),En=b(hr),vn=E(hr,"P",{});var Tr=y(vn);bn=v(Tr,"The first thing we are going to do is to call the function "),jn=E(Tr,"CODE",{});var Cr=y(jn);Pn=v(Cr,"fn"),Cr.forEach(r),Tn=v(Tr,":"),Tr.forEach(r),Cn=b(hr),On=E(hr,"PRE",{class:!0}),y(On).forEach(r),Ln=b(hr),An=E(hr,"P",{});var Or=y(An);$n=v(Or,"We check if there's an error, if there's no error, we can call the "),Dn=E(Or,"CODE",{});var Lr=y(Dn);Mn=v(Lr,"cb"),Lr.forEach(r),In=v(Or," function to indicate the function succeeded. However, if there's an error, we are going to call the function again to retry."),Or.forEach(r),Sn=b(hr),Hn=E(hr,"PRE",{class:!0}),y(Hn).forEach(r),xn=b(hr),Nn=E(hr,"P",{});var Ar=y(Nn);Fn=v(Ar,"Let's retry at most 3 times:"),Ar.forEach(r),Rn=b(hr),qn=E(hr,"PRE",{class:!0}),y(qn).forEach(r),Wn=b(hr),_n=E(hr,"P",{});var $r=y(_n);Jn=v($r,"Notice that it starts to get unwieldy as we are nesting more callback functions. It's hard to figure out which close bracket "),Bn=E($r,"CODE",{});var Dr=y(Bn);Un=v(Dr,"}"),Dr.forEach(r),zn=v($r," is belong to without proper indentation."),$r.forEach(r),Gn=b(hr),Vn=E(hr,"P",{});var Mr=y(Vn);Yn=v(Mr,"This is the so-called "),Kn=E(Mr,"A",{href:!0,rel:!0});var Ir=y(Kn);Zn=v(Ir,'"Callback Hell"'),Ir.forEach(r),Qn=v(Mr," in JavaScript."),Mr.forEach(r),Xn=b(hr),na=E(hr,"P",{});var Sr=y(na);aa=v(Sr,"Let's make it more unbearable to prove the point by flipping the if case:"),Sr.forEach(r),sa=b(hr),ta=E(hr,"PRE",{class:!0}),y(ta).forEach(r),ea=b(hr),oa=E(hr,"P",{});var Hr=y(oa);pa=v(Hr,"Now can you tell which "),ca=E(Hr,"CODE",{});var xr=y(ca);la=v(xr,"data"),xr.forEach(r),ia=v(Hr," is belong to which function?"),Hr.forEach(r),ua=b(hr),ra=E(hr,"P",{});var Nr=y(ra);ka=v(Nr,"Now, instead of always retry at most 3 times, we are going to retry at most "),ha=E(Nr,"CODE",{});var Fr=y(ha);fa=v(Fr,"n"),Fr.forEach(r),da=v(Nr," times."),Nr.forEach(r),ma=b(hr),ga=E(hr,"P",{});var Rr=y(ga);wa=v(Rr,"So we are going to introduce a new argument, "),ya=E(Rr,"CODE",{});var qr=y(ya);Ea=v(qr,"n"),qr.forEach(r),va=v(Rr,":"),Rr.forEach(r),ba=b(hr),ja=E(hr,"PRE",{class:!0}),y(ja).forEach(r),Pa=b(hr),Ta=E(hr,"P",{});var Wr=y(Ta);Ca=v(Wr,"The function keeps going forever, until it reaches "),Oa=E(Wr,"CODE",{});var _r=y(Oa);La=v(_r,"n"),_r.forEach(r),Aa=v(Wr," attempt."),Wr.forEach(r),$a=b(hr),Da=E(hr,"P",{});var Jr=y(Da);Ma=v(Jr,"If you stare at the code hard enough, you would notice that the code starts to repeat itself:"),Jr.forEach(r),Ia=b(hr),Sa=E(hr,"P",{});var Br=y(Sa);Ha=E(Br,"PICTURE",{});var Ur=y(Ha);xa=E(Ur,"SOURCE",{type:!0,srcset:!0}),Na=E(Ur,"SOURCE",{type:!0,srcset:!0}),Fa=E(Ur,"IMG",{title:!0,alt:!0,"data-src":!0,loading:!0}),Ur.forEach(r),Br.forEach(r),Ra=b(hr),qa=E(hr,"P",{});var zr=y(qa);Wa=v(zr,"Note that the code within the outer red square is the same as the code within the inner red square, which is the same as the inner inner red square ..."),zr.forEach(r),_a=b(hr),Ja=E(hr,"P",{});var Gr=y(Ja);Ba=v(Gr,"So, let's extract the code within the red square out into a function and replace the red squares with the function:"),Gr.forEach(r),Ua=b(hr),za=E(hr,"PRE",{class:!0}),y(za).forEach(r),Ga=b(hr),Va=E(hr,"P",{});var Vr=y(Va);Ya=v(Vr,"And there you go, retrying an asynchronous function with callback pattern."),Vr.forEach(r),Ka=b(hr),Za=E(hr,"P",{});var Yr=y(Za);Qa=v(Yr,"Does it work? Well, we have to test it to verify it. Stay till the end to see how we are going to write unit test to verify it."),Yr.forEach(r),hr.forEach(r),Xa=b(n),ns=E(n,"SECTION",{});var Kr=y(ns);as=E(Kr,"H2",{});var Zr=y(as);ss=E(Zr,"A",{href:!0,id:!0});var Qr=y(ss);ts=v(Qr,"The promise chain"),Qr.forEach(r),Zr.forEach(r),es=b(Kr),os=E(Kr,"P",{});var Xr=y(os);ps=v(Xr,"A "),cs=E(Xr,"A",{href:!0,rel:!0});var nk=y(cs);ls=v(nk,"Promise"),nk.forEach(r),is=v(Xr,", according to MDN, object represents the eventual completion of an asynchronous operation, and its resulting value."),Xr.forEach(r),us=b(Kr),rs=E(Kr,"P",{});var ak=y(rs);ks=v(ak,"A Promise object provides "),hs=E(ak,"CODE",{});var sk=y(hs);fs=v(sk,".then"),sk.forEach(r),ds=v(ak," and "),ms=E(ak,"CODE",{});var tk=y(ms);gs=v(tk,".catch"),tk.forEach(r),ws=v(ak," method, which takes in callback function to be called when the promise is resolved or rejected respectively. The "),ys=E(ak,"CODE",{});var ek=y(ys);Es=v(ek,".then"),ek.forEach(r),vs=v(ak," and "),bs=E(ak,"CODE",{});var ok=y(bs);js=v(ok,".catch"),ok.forEach(r),Ps=v(ak," method then returns a new Promise of the return value of the callback function."),ak.forEach(r),Ts=b(Kr),Cs=E(Kr,"PRE",{class:!0}),y(Cs).forEach(r),Os=b(Kr),Ls=E(Kr,"P",{});var pk=y(Ls);As=v(pk,"The chaining of "),$s=E(pk,"CODE",{});var ck=y($s);Ds=v(ck,".then"),ck.forEach(r),Ms=v(pk," and "),Is=E(pk,"CODE",{});var lk=y(Is);Ss=v(lk,".catch"),lk.forEach(r),Hs=v(pk," is a common pattern, called "),xs=E(pk,"A",{href:!0,rel:!0});var ik=y(xs);Ns=v(ik,"Promise chaining"),ik.forEach(r),Fs=v(pk,"."),pk.forEach(r),Rs=b(Kr),qs=E(Kr,"P",{});var uk=y(qs);Ws=v(uk,"Now, lets implement the "),_s=E(uk,"CODE",{});var rk=y(_s);Js=v(rk,"retry"),rk.forEach(r),Bs=v(uk," function, which takes in the asynchronous function to retry, "),Us=E(uk,"CODE",{});var kk=y(Us);zs=v(kk,"fn"),kk.forEach(r),Gs=v(uk," and return a promise, which resolved when the function succeeded or resolved after failing all the retry attempts."),uk.forEach(r),Vs=b(Kr),Ys=E(Kr,"PRE",{class:!0}),y(Ys).forEach(r),Ks=b(Kr),Zs=E(Kr,"P",{});var hk=y(Zs);Qs=v(hk,"The first thing we are going to do is to call the function "),Xs=E(hk,"CODE",{});var fk=y(Xs);nt=v(fk,"fn"),fk.forEach(r),at=v(hk,":"),hk.forEach(r),st=b(Kr),tt=E(Kr,"PRE",{class:!0}),y(tt).forEach(r),et=b(Kr),ot=E(Kr,"P",{});var dk=y(ot);pt=v(dk,"We need to retry calling "),ct=E(dk,"CODE",{});var mk=y(ct);lt=v(mk,"fn"),mk.forEach(r),it=v(dk," again, if the first "),ut=E(dk,"CODE",{});var gk=y(ut);rt=v(gk,"fn"),gk.forEach(r),kt=v(dk," is rejected"),dk.forEach(r),ht=b(Kr),ft=E(Kr,"PRE",{class:!0}),y(ft).forEach(r),dt=b(Kr),mt=E(Kr,"P",{});var wk=y(mt);gt=v(wk,"If that new promise rejected again, we retry by calling "),wt=E(wk,"CODE",{});var yk=y(wt);yt=v(yk,"fn"),yk.forEach(r),Et=v(wk," again"),wk.forEach(r),vt=b(Kr),bt=E(Kr,"PRE",{class:!0}),y(bt).forEach(r),jt=b(Kr),Pt=E(Kr,"P",{});var Ek=y(Pt);Tt=v(Ek,"The last promise "),Ct=E(Ek,"EM",{});var vk=y(Ct);Ot=v(vk,"(promise#3)"),vk.forEach(r),Lt=v(Ek," will reject if the 3rd "),At=E(Ek,"CODE",{});var bk=y(At);$t=v(bk,"fn()"),bk.forEach(r),Dt=v(Ek," attempt rejects, and resolve if any of the "),Mt=E(Ek,"CODE",{});var jk=y(Mt);It=v(jk,"fn()"),jk.forEach(r),St=v(Ek," attempts resolve."),Ek.forEach(r),Ht=b(Kr),xt=E(Kr,"P",{});var Pk=y(xt);Nt=v(Pk,"The callback method within "),Ft=E(Pk,"CODE",{});var Tk=y(Ft);Rt=v(Tk,".catch"),Tk.forEach(r),qt=v(Pk," will be called only when the previous "),Wt=E(Pk,"CODE",{});var Ck=y(Wt);_t=v(Ck,"fn()"),Ck.forEach(r),Jt=v(Pk," attempt rejects."),Pk.forEach(r),Bt=b(Kr),Ut=E(Kr,"P",{});var Ok=y(Ut);zt=v(Ok,"We are going to return a rejected promise with the error indicating max retries has met, if the last promise "),Gt=E(Ok,"CODE",{});var Lk=y(Gt);Vt=v(Lk,"(promise#3)"),Lk.forEach(r),Yt=v(Ok," rejected, and a resolved promise with the result from "),Kt=E(Ok,"CODE",{});var Ak=y(Kt);Zt=v(Ak,"fn()"),Ak.forEach(r),Qt=v(Ok,"."),Ok.forEach(r),Xt=b(Kr),ne=E(Kr,"PRE",{class:!0}),y(ne).forEach(r),ae=b(Kr),se=E(Kr,"P",{});var $k=y(se);te=v($k,"And we can make the code more concise, as the following two are equivalent, in terms of what is being resolved and rejected:"),$k.forEach(r),ee=b(Kr),oe=E(Kr,"PRE",{class:!0}),y(oe).forEach(r),pe=b(Kr),ce=E(Kr,"P",{});var Dk=y(ce);le=v(Dk,"Also, we can substitute the variable "),ie=E(Dk,"CODE",{});var Mk=y(ie);ue=v(Mk,"promise3"),Mk.forEach(r),re=v(Dk," with it's promise chain value:"),Dk.forEach(r),ke=b(Kr),he=E(Kr,"PRE",{class:!0}),y(he).forEach(r),fe=b(Kr),de=E(Kr,"P",{});var Ik=y(de);me=v(Ik,"Now, instead of always retry at most 3 times, we are going to retry at most "),ge=E(Ik,"CODE",{});var Sk=y(ge);we=v(Sk,"n"),Sk.forEach(r),ye=v(Ik," times."),Ik.forEach(r),Ee=b(Kr),ve=E(Kr,"P",{});var Hk=y(ve);be=v(Hk,"So we are going to introduce a new argument, "),je=E(Hk,"CODE",{});var xk=y(je);Pe=v(xk,"n"),xk.forEach(r),Te=v(Hk,":"),Hk.forEach(r),Ce=b(Kr),Oe=E(Kr,"PRE",{class:!0}),y(Oe).forEach(r),Le=b(Kr),Ae=E(Kr,"P",{});var Nk=y(Ae);$e=v(Nk,"Instead of writing "),De=E(Nk,"CODE",{});var Fk=y(De);Me=v(Fk,".catch(() => fn())"),Fk.forEach(r),Ie=b(Nk),Se=E(Nk,"CODE",{});var Rk=y(Se);He=v(Rk,"n"),Rk.forEach(r),xe=v(Nk," number of times, we can build the Promise up using a for loop."),Nk.forEach(r),Ne=b(Kr),Fe=E(Kr,"P",{});var qk=y(Fe);Re=E(qk,"STRONG",{});var Wk=y(Re);qe=v(Wk,"Assuming "),We=E(Wk,"CODE",{});var _k=y(We);_e=v(_k,"n"),_k.forEach(r),Je=v(Wk," is always greater or equal to 1,"),Wk.forEach(r),qk.forEach(r),Be=b(Kr),Ue=E(Kr,"PRE",{class:!0}),y(Ue).forEach(r),ze=b(Kr),Ge=E(Kr,"P",{});var Jk=y(Ge);Ve=v(Jk,"What if "),Ye=E(Jk,"CODE",{});var Bk=y(Ye);Ke=v(Bk,"n"),Bk.forEach(r),Ze=v(Jk," is "),Qe=E(Jk,"CODE",{});var Uk=y(Qe);Xe=v(Uk,"0"),Uk.forEach(r),no=v(Jk," or negative? We shouldn't call "),ao=E(Jk,"CODE",{});var zk=y(ao);so=v(zk,"fn()"),zk.forEach(r),to=v(Jk," at all!"),Jk.forEach(r),eo=b(Kr),oo=E(Kr,"PRE",{class:!0}),y(oo).forEach(r),po=b(Kr),co=E(Kr,"P",{});var Gk=y(co);lo=v(Gk,"Well, this maybe a little bit inelegant, having to execute the "),io=E(Gk,"CODE",{});var Vk=y(io);uo=v(Vk,"if (!promise) ... else ..."),Vk.forEach(r),ro=v(Gk," on every loop, we can initialise the promise with a rejected promise, so that we can treat the 1st "),ko=E(Gk,"CODE",{});var Yk=y(ko);ho=v(Yk,"fn()"),Yk.forEach(r),fo=v(Gk," called as the 1st retry:"),Gk.forEach(r),mo=b(Kr),go=E(Kr,"PRE",{class:!0}),y(go).forEach(r),wo=b(Kr),yo=E(Kr,"P",{});var Kk=y(yo);Eo=v(Kk,"And there you go, retrying an asynchronous function with promise chain."),Kk.forEach(r),Kr.forEach(r),vo=b(n),bo=E(n,"SECTION",{});var Zk=y(bo);jo=E(Zk,"H2",{});var Qk=y(jo);Po=E(Qk,"A",{href:!0,id:!0});var Xk=y(Po);To=v(Xk,"Async await"),Xk.forEach(r),Qk.forEach(r),Co=b(Zk),Oo=E(Zk,"P",{});var nh=y(Oo);Lo=v(nh,"When you use a promise, you need to use "),Ao=E(nh,"CODE",{});var ah=y(Ao);$o=v(ah,".then"),ah.forEach(r),Do=v(nh," to get the resolved value, and that happened asynchronously."),nh.forEach(r),Mo=b(Zk),Io=E(Zk,"P",{});var sh=y(Io);So=v(sh,"Meaning, if you have"),sh.forEach(r),Ho=b(Zk),xo=E(Zk,"PRE",{class:!0}),y(xo).forEach(r),No=b(Zk),Fo=E(Zk,"P",{});var th=y(Fo);Ro=v(th,"You would see"),th.forEach(r),qo=b(Zk),Wo=E(Zk,"PRE",{class:!0}),y(Wo).forEach(r),_o=b(Zk),Jo=E(Zk,"P",{});var eh=y(Jo);Bo=v(eh,"first, and then some time later,"),eh.forEach(r),Uo=b(Zk),zo=E(Zk,"PRE",{class:!0}),y(zo).forEach(r),Go=b(Zk),Vo=E(Zk,"P",{});var oh=y(Vo);Yo=v(oh,"This is because the function in the "),Ko=E(oh,"CODE",{});var ph=y(Ko);Zo=v(ph,".then"),ph.forEach(r),Qo=v(oh," is called asynchronously, it is executed in a separate timeline of execution, so to speak."),oh.forEach(r),Xo=b(Zk),np=E(Zk,"P",{});var ch=y(np);ap=v(ch,"And "),sp=E(ch,"CODE",{});var lh=y(sp);tp=v(lh,"async"),lh.forEach(r),ep=v(ch," + "),op=E(ch,"CODE",{});var ih=y(op);pp=v(ih,"await"),ih.forEach(r),cp=v(ch," in JavaScript allow us to stitch multiple separate timeline of execution into disguisedly 1 timeline of execution flow."),ch.forEach(r),lp=b(Zk),ip=E(Zk,"P",{});var uh=y(ip);up=v(uh,"Everytime when we "),rp=E(uh,"CODE",{});var rh=y(rp);kp=v(rh,"await"),rh.forEach(r),hp=v(uh,", we jump into a different asynchronous timeline."),uh.forEach(r),fp=b(Zk),dp=E(Zk,"P",{});var kh=y(dp);mp=v(kh,"So, with the code with Promise + "),gp=E(kh,"CODE",{});var hh=y(gp);wp=v(hh,".then"),hh.forEach(r),yp=v(kh,":"),kh.forEach(r),Ep=b(Zk),vp=E(Zk,"PRE",{class:!0}),y(vp).forEach(r),bp=b(Zk),jp=E(Zk,"P",{});var fh=y(jp);Pp=v(fh,"can be written in "),Tp=E(fh,"CODE",{});var dh=y(Tp);Cp=v(dh,"async"),dh.forEach(r),Op=v(fh," + "),Lp=E(fh,"CODE",{});var mh=y(Lp);Ap=v(mh,"await"),mh.forEach(r),$p=v(fh," in the following manner:"),fh.forEach(r),Dp=b(Zk),Mp=E(Zk,"PRE",{class:!0}),y(Mp).forEach(r),Ip=b(Zk),Sp=E(Zk,"P",{});var gh=y(Sp);Hp=v(gh,"Now, lets implement the "),xp=E(gh,"CODE",{});var wh=y(xp);Np=v(wh,"retry"),wh.forEach(r),Fp=v(gh," function using "),Rp=E(gh,"CODE",{});var yh=y(Rp);qp=v(yh,"async"),yh.forEach(r),Wp=v(gh," + "),_p=E(gh,"CODE",{});var Eh=y(_p);Jp=v(Eh,"await"),Eh.forEach(r),Bp=v(gh,"."),gh.forEach(r),Up=b(Zk),zp=E(Zk,"PRE",{class:!0}),y(zp).forEach(r),Gp=b(Zk),Vp=E(Zk,"P",{});var vh=y(Vp);Yp=v(vh,"The first thing we are going to do is to call the function "),Kp=E(vh,"CODE",{});var bh=y(Kp);Zp=v(bh,"fn"),bh.forEach(r),Qp=v(vh,":"),vh.forEach(r),Xp=b(Zk),nc=E(Zk,"PRE",{class:!0}),y(nc).forEach(r),ac=b(Zk),sc=E(Zk,"P",{});var jh=y(sc);tc=v(jh,"We need to retry calling "),ec=E(jh,"CODE",{});var Ph=y(ec);oc=v(Ph,"fn"),Ph.forEach(r),pc=v(jh," again, if the first "),cc=E(jh,"CODE",{});var Th=y(cc);lc=v(Th,"fn"),Th.forEach(r),ic=v(jh," is rejected. Instead of "),uc=E(jh,"CODE",{});var Ch=y(uc);rc=v(Ch,".catch"),Ch.forEach(r),kc=v(jh,", we use "),hc=E(jh,"CODE",{});var Oh=y(hc);fc=v(Oh,"await"),Oh.forEach(r),dc=v(jh," + "),mc=E(jh,"CODE",{});var Lh=y(mc);gc=v(Lh,"try catch"),Lh.forEach(r),jh.forEach(r),wc=b(Zk),yc=E(Zk,"PRE",{class:!0}),y(yc).forEach(r),Ec=b(Zk),vc=E(Zk,"P",{});var Ah=y(vc);bc=v(Ah,"If the 2nd "),jc=E(Ah,"CODE",{});var $h=y(jc);Pc=v($h,"fn()"),$h.forEach(r),Tc=v(Ah," rejected again, we retry by calling "),Cc=E(Ah,"CODE",{});var Dh=y(Cc);Oc=v(Dh,"fn"),Dh.forEach(r),Lc=v(Ah," again"),Ah.forEach(r),Ac=b(Zk),$c=E(Zk,"PRE",{class:!0}),y($c).forEach(r),Dc=b(Zk),Mc=E(Zk,"P",{});var Mh=y(Mc);Ic=v(Mh,"And if the last "),Sc=E(Mh,"CODE",{});var Ih=y(Sc);Hc=v(Ih,"fn()"),Ih.forEach(r),xc=v(Mh," rejected again, we are going to return a rejected promise with an error indicating max retries has met by throw the error"),Mh.forEach(r),Nc=b(Zk),Fc=E(Zk,"PRE",{class:!0}),y(Fc).forEach(r),Rc=b(Zk),qc=E(Zk,"P",{});var Sh=y(qc);Wc=v(Sh,"Now, if we need to return a Promise resolved with the resolved value from "),_c=E(Sh,"CODE",{});var Hh=y(_c);Jc=v(Hh,"fn()"),Hh.forEach(r),Sh.forEach(r),Bc=b(Zk),Uc=E(Zk,"PRE",{class:!0}),y(Uc).forEach(r),zc=b(Zk),Gc=E(Zk,"P",{});var xh=y(Gc);Vc=v(xh,"Since we are ending early in the "),Yc=E(xh,"CODE",{});var Nh=y(Yc);Kc=v(Nh,"try"),Nh.forEach(r),Zc=v(xh," block, and we are not using the error from the "),Qc=E(xh,"CODE",{});var Fh=y(Qc);Xc=v(Fh,"catch"),Fh.forEach(r),nl=v(xh," block, we can make the code less nested"),xh.forEach(r),al=b(Zk),sl=E(Zk,"PRE",{class:!0}),y(sl).forEach(r),tl=b(Zk),el=E(Zk,"P",{});var Rh=y(el);ol=v(Rh,"Now, instead of always retry at most 3 times, we are going to retry at most "),pl=E(Rh,"CODE",{});var qh=y(pl);cl=v(qh,"n"),qh.forEach(r),ll=v(Rh," times."),Rh.forEach(r),il=b(Zk),ul=E(Zk,"P",{});var Wh=y(ul);rl=v(Wh,"So we are going to introduce a new argument, "),kl=E(Wh,"CODE",{});var _h=y(kl);hl=v(_h,"n"),_h.forEach(r),fl=v(Wh,":"),Wh.forEach(r),dl=b(Zk),ml=E(Zk,"PRE",{class:!0}),y(ml).forEach(r),gl=b(Zk),wl=E(Zk,"P",{});var Jh=y(wl);yl=v(Jh,"Instead of writing it "),El=E(Jh,"CODE",{});var Bh=y(El);vl=v(Bh,"n"),Bh.forEach(r),bl=v(Jh," number of times, we can achieve it using a "),jl=E(Jh,"CODE",{});var Uh=y(jl);Pl=v(Uh,"for"),Uh.forEach(r),Tl=v(Jh," loop:"),Jh.forEach(r),Cl=b(Zk),Ol=E(Zk,"PRE",{class:!0}),y(Ol).forEach(r),Ll=b(Zk),Al=E(Zk,"P",{});var zh=y(Al);$l=v(zh,"And there you go, retrying an asynchronous function using "),Dl=E(zh,"CODE",{});var Gh=y(Dl);Ml=v(Gh,"async"),Gh.forEach(r),Il=v(zh," + "),Sl=E(zh,"CODE",{});var Vh=y(Sl);Hl=v(Vh,"await"),Vh.forEach(r),xl=v(zh,"."),zh.forEach(r),Zk.forEach(r),Nl=b(n),Fl=E(n,"SECTION",{});var Yh=y(Fl);Rl=E(Yh,"H2",{});var Kh=y(Rl);ql=E(Kh,"A",{href:!0,id:!0});var Zh=y(ql);Wl=v(Zh,"Testing"),Zh.forEach(r),Kh.forEach(r),_l=b(Yh),Jl=E(Yh,"P",{});var Qh=y(Jl);Bl=v(Qh,"To test whether our "),Ul=E(Qh,"CODE",{});var Xh=y(Ul);zl=v(Xh,"retry"),Xh.forEach(r),Gl=v(Qh," function works, we need to have a max number of retry in mind, say 3. And we need a function, "),Vl=E(Qh,"CODE",{});var nf=y(Vl);Yl=v(nf,"fn"),nf.forEach(r),Kl=v(Qh," that we can control when it succeed and when it failed."),Qh.forEach(r),Zl=b(Yh),Ql=E(Yh,"P",{});var af=y(Ql);Xl=v(af,"So we can have the following test cases:"),af.forEach(r),ni=b(Yh),ai=E(Yh,"UL",{});var sf=y(ai);si=E(sf,"LI",{});var tf=y(si);ti=E(tf,"CODE",{});var ef=y(ti);ei=v(ef,"fn"),ef.forEach(r),oi=v(tf," always succeed;"),pi=E(tf,"UL",{});var of=y(pi);ci=E(of,"LI",{});var pf=y(ci);li=v(pf,"verify "),ii=E(pf,"CODE",{});var cf=y(ii);ui=v(cf,"fn"),cf.forEach(r),ri=v(pf," get called only 1 time"),pf.forEach(r),ki=b(of),hi=E(of,"LI",{});var lf=y(hi);fi=v(lf,"verify we get the return value from the 1st attempt"),lf.forEach(r),of.forEach(r),tf.forEach(r),di=b(sf),mi=E(sf,"LI",{});var uf=y(mi);gi=E(uf,"CODE",{});var rf=y(gi);wi=v(rf,"fn"),rf.forEach(r),yi=v(uf," failed on 1st attempt, and succeed thereafter;"),Ei=E(uf,"UL",{});var kf=y(Ei);vi=E(kf,"LI",{});var hf=y(vi);bi=v(hf,"verify "),ji=E(hf,"CODE",{});var ff=y(ji);Pi=v(ff,"fn"),ff.forEach(r),Ti=v(hf," get called only 2 times"),hf.forEach(r),Ci=b(kf),Oi=E(kf,"LI",{});var df=y(Oi);Li=v(df,"verify we get the return value from the 2nd attempt"),df.forEach(r),kf.forEach(r),uf.forEach(r),Ai=b(sf),$i=E(sf,"LI",{});var mf=y($i);Di=E(mf,"CODE",{});var gf=y(Di);Mi=v(gf,"fn"),gf.forEach(r),Ii=v(mf," failed on 1st, 2nd attempt, and succeed thereafter;"),Si=E(mf,"UL",{});var wf=y(Si);Hi=E(wf,"LI",{});var yf=y(Hi);xi=v(yf,"verify "),Ni=E(yf,"CODE",{});var Ef=y(Ni);Fi=v(Ef,"fn"),Ef.forEach(r),Ri=v(yf," get called only 3 times"),yf.forEach(r),qi=b(wf),Wi=E(wf,"LI",{});var vf=y(Wi);_i=v(vf,"verify we get the return value from the 3rd attempt"),vf.forEach(r),wf.forEach(r),mf.forEach(r),Ji=b(sf),Bi=E(sf,"LI",{});var bf=y(Bi);Ui=E(bf,"CODE",{});var jf=y(Ui);zi=v(jf,"fn"),jf.forEach(r),Gi=v(bf," failed on 1st, 2nd, 3rd attempt, and succeed thereafter;"),Vi=E(bf,"UL",{});var Pf=y(Vi);Yi=E(Pf,"LI",{});var Tf=y(Yi);Ki=v(Tf,"verify "),Zi=E(Tf,"CODE",{});var Cf=y(Zi);Qi=v(Cf,"fn"),Cf.forEach(r),Xi=v(Tf," get called only 3 times"),Tf.forEach(r),nu=b(Pf),au=E(Pf,"LI",{});var Of=y(au);su=v(Of,"verify we get the max retry error"),Of.forEach(r),Pf.forEach(r),bf.forEach(r),sf.forEach(r),tu=b(Yh),eu=E(Yh,"P",{});var Lf=y(eu);ou=v(Lf,"So, the key is to devise such "),pu=E(Lf,"CODE",{});var Af=y(pu);cu=v(Af,"fn"),Af.forEach(r),lu=v(Lf," that we can control when it succeed and when it failed."),Lf.forEach(r),iu=b(Yh),uu=E(Yh,"P",{});var $f=y(uu);ru=v($f,"We can create a function that returns such function"),$f.forEach(r),ku=b(Yh),hu=E(Yh,"PRE",{class:!0}),y(hu).forEach(r),fu=b(Yh),du=E(Yh,"P",{});var Df=y(du);mu=v(Df,"The function takes in number indicating how many time the return function would fail, before succeeding thereafter"),Df.forEach(r),gu=b(Yh),wu=E(Yh,"PRE",{class:!0}),y(wu).forEach(r),yu=b(Yh),Eu=E(Yh,"P",{});var Mf=y(Eu);vu=v(Mf,"To know how many times the function is called, we can track it with a variable"),Mf.forEach(r),bu=b(Yh),ju=E(Yh,"PRE",{class:!0}),y(ju).forEach(r),Pu=b(Yh),Tu=E(Yh,"P",{});var If=y(Tu);Cu=v(If,"As long as the number of times called is less than the number of time it should fail, it will fail."),If.forEach(r),Ou=b(Yh),Lu=E(Yh,"PRE",{class:!0}),y(Lu).forEach(r),Au=b(Yh),$u=E(Yh,"P",{});var Sf=y($u);Du=v(Sf,'Next, to verify the function get called a certain number of times, we can create a "spy" function:'),Sf.forEach(r),Mu=b(Yh),Iu=E(Yh,"PRE",{class:!0}),y(Iu).forEach(r),Su=b(Yh),Hu=E(Yh,"P",{});var Hf=y(Hu);xu=v(Hf,"So, let's put all of them together:"),Hf.forEach(r),Nu=b(Yh),Fu=E(Yh,"PRE",{class:!0}),y(Fu).forEach(r),Yh.forEach(r),Ru=b(n),qu=E(n,"SECTION",{});var xf=y(qu);Wu=E(xf,"H2",{});var Nf=y(Wu);_u=E(Nf,"A",{href:!0,id:!0});var Ff=y(_u);Ju=v(Ff,"Closing Note"),Ff.forEach(r),Nf.forEach(r),Bu=b(xf),Uu=E(xf,"P",{});var Rf=y(Uu);zu=v(Rf,"We've seen how we can retry an asynchronous function using the callback pattern, promise chain pattern and "),Gu=E(Rf,"CODE",{});var qf=y(Gu);Vu=v(qf,"async"),qf.forEach(r),Yu=v(Rf," + "),Ku=E(Rf,"CODE",{});var Wf=y(Ku);Zu=v(Wf,"await"),Wf.forEach(r),Qu=v(Rf,"."),Rf.forEach(r),Xu=b(xf),nr=E(xf,"P",{});var _f=y(nr);ar=v(_f,"Each of the 3 methods is important in its on right, albeit some is more verbose than another."),_f.forEach(r),sr=b(xf),tr=E(xf,"P",{});var Jf=y(tr);er=v(Jf,"Lastly, we also cover how to write test to verify our code, and also how to create the mock function to facilitate our test cases."),Jf.forEach(r),xf.forEach(r),this.h()},h(){w(o,"href","#the-callback-pattern"),w(l,"href","#the-promise-chain"),w(g,"href","#async-await"),w(T,"href","#testing"),w(L,"href","#closing-note"),w(t,"class","sitemap"),w(t,"id","sitemap"),w(t,"role","navigation"),w(t,"aria-label","Table of Contents"),w(_,"href","#the-callback-pattern"),w(_,"id","the-callback-pattern"),w(G,"href","https://gist.github.com/sunnycmf/b2ad4f80a3b627f04ff2"),w(G,"rel","nofollow"),w(en,"class","language-js"),w(yn,"class","language-js"),w(On,"class","language-js"),w(Hn,"class","language-js"),w(qn,"class","language-js"),w(Kn,"href","http://callbackhell.com/"),w(Kn,"rel","nofollow"),w(ta,"class","language-js"),w(ja,"class","language-js"),w(xa,"type","image/webp"),w(xa,"srcset","25ca4aff5059749c.webp"),w(Na,"type","image/jpeg"),w(Na,"srcset","25ca4aff5059749c.png"),w(Fa,"title","null"),w(Fa,"alt","recursive pattern"),w(Fa,"data-src","25ca4aff5059749c.png"),w(Fa,"loading","lazy"),w(za,"class","language-js"),w(ss,"href","#the-promise-chain"),w(ss,"id","the-promise-chain"),w(cs,"href","https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"),w(cs,"rel","nofollow"),w(Cs,"class","language-js"),w(xs,"href","https://www.javascripttutorial.net/es6/promise-chaining/"),w(xs,"rel","nofollow"),w(Ys,"class","language-js"),w(tt,"class","language-js"),w(ft,"class","language-js"),w(bt,"class","language-js"),w(ne,"class","language-js"),w(oe,"class","language-js"),w(he,"class","language-js"),w(Oe,"class","language-js"),w(Ue,"class","language-js"),w(oo,"class","language-js"),w(go,"class","language-js"),w(Po,"href","#async-await"),w(Po,"id","async-await"),w(xo,"class","language-js"),w(Wo,"class","language-js"),w(zo,"class","language-js"),w(vp,"class","language-js"),w(Mp,"class","language-js"),w(zp,"class","language-js"),w(nc,"class","language-js"),w(yc,"class","language-js"),w($c,"class","language-js"),w(Fc,"class","language-js"),w(Uc,"class","language-js"),w(sl,"class","language-js"),w(ml,"class","language-js"),w(Ol,"class","language-js"),w(ql,"href","#testing"),w(ql,"id","testing"),w(hu,"class","language-js"),w(wu,"class","language-js"),w(ju,"class","language-js"),w(Lu,"class","language-js"),w(Iu,"class","language-js"),w(Fu,"class","language-js"),w(_u,"href","#closing-note"),w(_u,"id","closing-note")},m(n,a){u(n,s,a),i(s,t),i(t,e),i(e,o),i(o,p),i(t,c),i(c,l),i(l,k),i(t,f),i(f,g),i(g,j),i(t,P),i(P,T),i(T,C),i(t,O),i(O,L),i(L,A),u(n,$,a),u(n,D,a),i(D,M),u(n,I,a),u(n,S,a),i(S,H),u(n,x,a),u(n,N,a),i(N,F),u(n,R,a),u(n,q,a),i(q,W),i(W,_),i(_,J),i(q,B),i(q,U),i(U,z),i(U,G),i(G,V),i(U,Y),i(q,K),i(q,Z),i(Z,Q),i(Q,X),i(Z,nn),i(Z,an),i(an,sn),i(q,tn),i(q,en),en.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">&#125;</span></code>',i(q,on),i(q,pn),i(pn,cn),i(pn,ln),i(ln,un),i(pn,rn),i(pn,kn),i(kn,hn),i(pn,fn),i(pn,dn),i(dn,mn),i(pn,gn),i(q,wn),i(q,yn),yn.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">//</span>\n<span class="token punctuation">&#125;</span></code>',i(q,En),i(q,vn),i(vn,bn),i(vn,jn),i(jn,Pn),i(vn,Tn),i(q,Cn),i(q,On),On.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">    <span class="token comment">//</span></span>\n<span class="prism-highlight-code-line">  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token punctuation">&#125;</span></code>',i(q,Ln),i(q,An),i(An,$n),i(An,Dn),i(Dn,Mn),i(An,In),i(q,Sn),i(q,Hn),Hn.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">      <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">        <span class="token comment">//</span></span>\n<span class="prism-highlight-code-line">      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">&#125;</span></span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(q,xn),i(q,Nn),i(Nn,Fn),i(q,Rn),i(q,qn),qn.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// 1st attempt</span>\n  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// 2nd attempt</span>\n      <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n          <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n          <span class="token comment">// 3rd attempt</span>\n          <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n              <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n              <span class="token comment">// failed for 3 times</span>\n              <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Failed retrying 3 times\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">&#125;</span>\n          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">&#125;</span>\n      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(q,Wn),i(q,_n),i(_n,Jn),i(_n,Bn),i(Bn,Un),i(_n,zn),i(q,Gn),i(q,Vn),i(Vn,Yn),i(Vn,Kn),i(Kn,Zn),i(Vn,Qn),i(q,Xn),i(q,na),i(na,aa),i(q,sa),i(q,ta),ta.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// 1st attempt</span>\n  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// 2nd attempt</span>\n      <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n          <span class="token comment">// 3rd attempt</span>\n          <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n              <span class="token comment">// failed for 3 times</span>\n              <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Failed retrying 3 times\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n              <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">&#125;</span>\n          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n          <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">&#125;</span>\n      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(q,ea),i(q,oa),i(oa,pa),i(oa,ca),i(ca,la),i(oa,ia),i(q,ua),i(q,ra),i(ra,ka),i(ra,ha),i(ha,fa),i(ra,da),i(q,ma),i(q,ga),i(ga,wa),i(ga,ya),i(ya,Ea),i(ga,va),i(q,ba),i(q,ja),ja.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> n<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token keyword">let</span> attempt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 1st attempt</span></span>\n  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>attempt<span class="token operator">++</span> <span class="token operator">===</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Failed retrying </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>n<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></span>\n        <span class="token comment">// 2nd attempt</span>\n        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n            <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>attempt<span class="token operator">++</span> <span class="token operator">===</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">              <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Failed retrying </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>n<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></span>\n              <span class="token function">fn</span><span class="token punctuation">(</span><span class="token comment">/* this goes forever ...*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">&#125;</span>\n          <span class="token punctuation">&#125;</span>\n        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">&#125;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(q,Pa),i(q,Ta),i(Ta,Ca),i(Ta,Oa),i(Oa,La),i(Ta,Aa),i(q,$a),i(q,Da),i(Da,Ma),i(q,Ia),i(q,Sa),i(Sa,Ha),i(Ha,xa),i(Ha,Na),i(Ha,Fa),i(q,Ra),i(q,qa),i(qa,Wa),i(q,_a),i(q,Ja),i(Ja,Ba),i(q,Ua),i(q,za),za.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> n<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">let</span> attempt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n\n<span class="prism-highlight-code-line">  <span class="token keyword">function</span> <span class="token function">_retry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>attempt<span class="token operator">++</span> <span class="token operator">===</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">          <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Failed retrying </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>n<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">          <span class="token function">_retry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">        <span class="token punctuation">&#125;</span></span>\n<span class="prism-highlight-code-line">      <span class="token punctuation">&#125;</span></span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">  <span class="token punctuation">&#125;</span></span>\n<span class="prism-highlight-code-line"></span>\n<span class="prism-highlight-code-line">  <span class="token function">_retry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token punctuation">&#125;</span></code>',i(q,Ga),i(q,Va),i(Va,Ya),i(q,Ka),i(q,Za),i(Za,Qa),u(n,Xa,a),u(n,ns,a),i(ns,as),i(as,ss),i(ss,ts),i(ns,es),i(ns,os),i(os,ps),i(os,cs),i(cs,ls),i(os,is),i(ns,us),i(ns,rs),i(rs,ks),i(rs,hs),i(hs,fs),i(rs,ds),i(rs,ms),i(ms,gs),i(rs,ws),i(rs,ys),i(ys,Es),i(rs,vs),i(rs,bs),i(bs,js),i(rs,Ps),i(ns,Ts),i(ns,Cs),Cs.innerHTML='<code class="language-js"><span class="token function">getPromiseA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a promise</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleA<span class="token punctuation">)</span> <span class="token comment">// returns a new promise</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleB<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns another new promise</span>\n\n<span class="token function">getPromiseB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// a promise</span>\n  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>handleA<span class="token punctuation">)</span> <span class="token comment">// returns a new promise</span>\n  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>handleB<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns another new promise</span></code>',i(ns,Os),i(ns,Ls),i(Ls,As),i(Ls,$s),i($s,Ds),i(Ls,Ms),i(Ls,Is),i(Is,Ss),i(Ls,Hs),i(Ls,xs),i(xs,Ns),i(Ls,Fs),i(ns,Rs),i(ns,qs),i(qs,Ws),i(qs,_s),i(_s,Js),i(qs,Bs),i(qs,Us),i(Us,zs),i(qs,Gs),i(ns,Vs),i(ns,Ys),Ys.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">//</span>\n<span class="token punctuation">&#125;</span></code>',i(ns,Ks),i(ns,Zs),i(Zs,Qs),i(Zs,Xs),i(Xs,nt),i(Zs,at),i(ns,st),i(ns,tt),tt.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns a promise</span></span>\n<span class="token punctuation">&#125;</span></code>',i(ns,et),i(ns,ot),i(ot,pt),i(ot,ct),i(ct,lt),i(ot,it),i(ot,ut),i(ut,rt),i(ot,kt),i(ns,ht),i(ns,ft),ft.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// returns a promise</span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns a new promise</span></span>\n<span class="token punctuation">&#125;</span></code>',i(ns,dt),i(ns,mt),i(mt,gt),i(mt,wt),i(wt,yt),i(mt,Et),i(ns,vt),i(ns,bt),bt.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// returns a promise (promise#1)</span>\n    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// returns a new promise (promise#2)</span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns yet a new promise (promise#3)</span></span>\n<span class="token punctuation">&#125;</span></code>',i(ns,jt),i(ns,Pt),i(Pt,Tt),i(Pt,Ct),i(Ct,Ot),i(Pt,Lt),i(Pt,At),i(At,$t),i(Pt,Dt),i(Pt,Mt),i(Mt,It),i(Pt,St),i(ns,Ht),i(ns,xt),i(xt,Nt),i(xt,Ft),i(Ft,Rt),i(xt,qt),i(xt,Wt),i(Wt,_t),i(xt,Jt),i(ns,Bt),i(ns,Ut),i(Ut,zt),i(Ut,Gt),i(Gt,Vt),i(Ut,Yt),i(Ut,Kt),i(Kt,Zt),i(Ut,Qt),i(ns,Xt),i(ns,ne),ne.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> promise3 <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// returns a promise (promise#1)</span>\n    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// returns a new promise (promise#2)</span>\n    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns yet a new promise (promise#3)</span>\n\n  <span class="token keyword">return</span> promise3<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n    <span class="token parameter">data</span> <span class="token operator">=></span> data<span class="token punctuation">,</span> <span class="token comment">// resolved with the result from &#96;fn()&#96;</span>\n    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// reject with the max retry error</span>\n      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Failed retrying 3 times\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(ns,ae),i(ns,se),i(se,te),i(ns,ee),i(ns,oe),oe.innerHTML='<code class="language-js">promise3<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token parameter">data</span> <span class="token operator">=></span> data<span class="token punctuation">,</span> <span class="token comment">// resolved with the result from &#96;fn()&#96;</span>\n  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// reject with the max retry error</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Failed retrying 3 times\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// is equivalent to</span>\npromise3 <span class="token comment">// resolved with the result from &#96;fn()&#96;</span>\n  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// reject with the max retry error</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Failed retrying 3 times\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>',i(ns,pe),i(ns,ce),i(ce,le),i(ce,ie),i(ie,ue),i(ce,re),i(ns,ke),i(ns,he),he.innerHTML='<code class="language-js"><span class="token comment">// prettier-ignore</span>\n<span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// returns a promise (promise#1)</span></span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// returns a new promise (promise#2)</span></span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// returns yet a new promise (promise#3)</span></span>\n    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// reject with the max retry error</span>\n      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Failed retrying 3 times\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(ns,fe),i(ns,de),i(de,me),i(de,ge),i(ge,we),i(de,ye),i(ns,Ee),i(ns,ve),i(ve,be),i(ve,je),i(je,Pe),i(ve,Te),i(ns,Ce),i(ns,Oe),Oe.innerHTML='<code class="language-js"><span class="token comment">// prettier-ignore</span>\n<span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// attempt #1</span>\n    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// attempt #2</span>\n    <span class="token comment">// ...</span>\n    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// attempt #n</span>\n    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Failed retrying </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>n<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(ns,Le),i(ns,Ae),i(Ae,$e),i(Ae,De),i(De,Me),i(Ae,Ie),i(Ae,Se),i(Se,He),i(Ae,xe),i(ns,Ne),i(ns,Fe),i(Fe,Re),i(Re,qe),i(Re,We),i(We,_e),i(Re,Je),i(ns,Be),i(ns,Ue),Ue.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span>\n  promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Failed retrying </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>n<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(ns,ze),i(ns,Ge),i(Ge,Ve),i(Ge,Ye),i(Ye,Ke),i(Ge,Ze),i(Ge,Qe),i(Qe,Xe),i(Ge,no),i(Ge,ao),i(ao,so),i(Ge,to),i(ns,eo),i(ns,oo),oo.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">let</span> promise<span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>promise<span class="token punctuation">)</span> promise <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">    <span class="token keyword">else</span> promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n  <span class="token punctuation">&#125;</span>\n  promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Failed retrying </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>n<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(ns,po),i(ns,co),i(co,lo),i(co,io),i(io,uo),i(co,ro),i(co,ko),i(ko,ho),i(co,fo),i(ns,mo),i(ns,go),go.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">    promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n  <span class="token punctuation">&#125;</span>\n  promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Failed retrying </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>n<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(ns,wo),i(ns,yo),i(yo,Eo),u(n,vo,a),u(n,bo,a),i(bo,jo),i(jo,Po),i(Po,To),i(bo,Co),i(bo,Oo),i(Oo,Lo),i(Oo,Ao),i(Ao,$o),i(Oo,Do),i(bo,Mo),i(bo,Io),i(Io,So),i(bo,Ho),i(bo,xo),xo.innerHTML='<code class="language-js"><span class="token keyword">let</span> value<span class="token punctuation">;</span>\npromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n  value <span class="token operator">=</span> data<span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'resolved\'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'here\'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span></code>',i(bo,No),i(bo,Fo),i(Fo,Ro),i(bo,qo),i(bo,Wo),Wo.innerHTML='<code class="language-js"><span class="token string">"here"</span> <span class="token keyword">undefined</span></code>',i(bo,_o),i(bo,Jo),i(Jo,Bo),i(bo,Uo),i(bo,zo),zo.innerHTML='<code class="language-js"><span class="token string">"resolved"</span> <span class="token string">"value"</span></code>',i(bo,Go),i(bo,Vo),i(Vo,Yo),i(Vo,Ko),i(Ko,Zo),i(Vo,Qo),i(bo,Xo),i(bo,np),i(np,ap),i(np,sp),i(sp,tp),i(np,ep),i(np,op),i(op,pp),i(np,cp),i(bo,lp),i(bo,ip),i(ip,up),i(ip,rp),i(rp,kp),i(ip,hp),i(bo,fp),i(bo,dp),i(dp,mp),i(dp,gp),i(gp,wp),i(dp,yp),i(bo,Ep),i(bo,vp),vp.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// timeline #1</span>\n  promise\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// timeline #2</span>\n      <span class="token keyword">return</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data2</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// timeline #3</span>\n      <span class="token function">doAnotherThing</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// timeline #1</span>\n<span class="token punctuation">&#125;</span></code>',i(bo,bp),i(bo,jp),i(jp,Pp),i(jp,Tp),i(Tp,Cp),i(jp,Op),i(jp,Lp),i(Lp,Ap),i(jp,$p),i(bo,Dp),i(bo,Mp),Mp.innerHTML='<code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// timeline #1</span>\n  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> promise<span class="token punctuation">;</span>\n  <span class="token comment">// timeline #2</span>\n  <span class="token keyword">let</span> data2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// timeline #3</span>\n  <span class="token function">doAnotherThing</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(bo,Ip),i(bo,Sp),i(Sp,Hp),i(Sp,xp),i(xp,Np),i(Sp,Fp),i(Sp,Rp),i(Rp,qp),i(Sp,Wp),i(Sp,_p),i(_p,Jp),i(Sp,Bp),i(bo,Up),i(bo,zp),zp.innerHTML='<code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">//</span>\n<span class="token punctuation">&#125;</span></code>',i(bo,Gp),i(bo,Vp),i(Vp,Yp),i(Vp,Kp),i(Kp,Zp),i(Vp,Qp),i(bo,Xp),i(bo,nc),nc.innerHTML='<code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns a promise</span></span>\n<span class="token punctuation">&#125;</span></code>',i(bo,ac),i(bo,sc),i(sc,tc),i(sc,ec),i(ec,oc),i(sc,pc),i(sc,cc),i(cc,lc),i(sc,ic),i(sc,uc),i(uc,rc),i(sc,kc),i(sc,hc),i(hc,fc),i(sc,dc),i(sc,mc),i(mc,gc),i(bo,wc),i(bo,yc),yc.innerHTML='<code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></span>\n    <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="prism-highlight-code-line">  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">  <span class="token punctuation">&#125;</span></span>\n<span class="token punctuation">&#125;</span></code>',i(bo,Ec),i(bo,vc),i(vc,bc),i(vc,jc),i(jc,Pc),i(vc,Tc),i(vc,Cc),i(Cc,Oc),i(vc,Lc),i(bo,Ac),i(bo,$c),$c.innerHTML='<code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">      <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">      <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">&#125;</span></span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',i(bo,Dc),i(bo,Mc),i(Mc,Ic),i(Mc,Sc),i(Sc,Hc),i(Mc,xc),i(bo,Nc),i(bo,Fc),Fc.innerHTML='<code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n        <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Failed retrying 3 times\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n      <span class="token punctuation">&#125;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',i(bo,Rc),i(bo,qc),i(qc,Wc),i(qc,_c),i(_c,Jc),i(bo,Bc),i(bo,Uc),Uc.innerHTML='<code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">      <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">        <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span>\n        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Failed retrying 3 times\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">&#125;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',i(bo,zc),i(bo,Gc),i(Gc,Vc),i(Gc,Yc),i(Yc,Kc),i(Gc,Zc),i(Gc,Qc),i(Qc,Xc),i(Gc,nl),i(bo,al),i(bo,sl),sl.innerHTML='<code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>\n\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>\n\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>\n\n  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Failed retrying 3 times\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(bo,tl),i(bo,el),i(el,ol),i(el,pl),i(pl,cl),i(el,ll),i(bo,il),i(bo,ul),i(ul,rl),i(ul,kl),i(kl,hl),i(ul,fl),i(bo,dl),i(bo,ml),ml.innerHTML='<code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1st attempt</span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>\n\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2nd attempt</span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>\n\n  <span class="token comment">// ...</span>\n\n  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// nth attempt</span>\n  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>\n\n  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Failed retrying </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>n<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(bo,gl),i(bo,wl),i(wl,yl),i(wl,El),i(El,vl),i(wl,bl),i(wl,jl),i(jl,Pl),i(wl,Tl),i(bo,Cl),i(bo,Ol),Ol.innerHTML='<code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">retry</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n\n  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Failed retrying </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>n<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(bo,Ll),i(bo,Al),i(Al,$l),i(Al,Dl),i(Dl,Ml),i(Al,Il),i(Al,Sl),i(Sl,Hl),i(Al,xl),u(n,Nl,a),u(n,Fl,a),i(Fl,Rl),i(Rl,ql),i(ql,Wl),i(Fl,_l),i(Fl,Jl),i(Jl,Bl),i(Jl,Ul),i(Ul,zl),i(Jl,Gl),i(Jl,Vl),i(Vl,Yl),i(Jl,Kl),i(Fl,Zl),i(Fl,Ql),i(Ql,Xl),i(Fl,ni),i(Fl,ai),i(ai,si),i(si,ti),i(ti,ei),i(si,oi),i(si,pi),i(pi,ci),i(ci,li),i(ci,ii),i(ii,ui),i(ci,ri),i(pi,ki),i(pi,hi),i(hi,fi),i(ai,di),i(ai,mi),i(mi,gi),i(gi,wi),i(mi,yi),i(mi,Ei),i(Ei,vi),i(vi,bi),i(vi,ji),i(ji,Pi),i(vi,Ti),i(Ei,Ci),i(Ei,Oi),i(Oi,Li),i(ai,Ai),i(ai,$i),i($i,Di),i(Di,Mi),i($i,Ii),i($i,Si),i(Si,Hi),i(Hi,xi),i(Hi,Ni),i(Ni,Fi),i(Hi,Ri),i(Si,qi),i(Si,Wi),i(Wi,_i),i(ai,Ji),i(ai,Bi),i(Bi,Ui),i(Ui,zi),i(Bi,Gi),i(Bi,Vi),i(Vi,Yi),i(Yi,Ki),i(Yi,Zi),i(Zi,Qi),i(Yi,Xi),i(Vi,nu),i(Vi,au),i(au,su),i(Fl,tu),i(Fl,eu),i(eu,ou),i(eu,pu),i(pu,cu),i(eu,lu),i(Fl,iu),i(Fl,uu),i(uu,ru),i(Fl,ku),i(Fl,hu),hu.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">mockFnFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(Fl,fu),i(Fl,du),i(du,mu),i(Fl,gu),i(Fl,wu),wu.innerHTML='<code class="language-js"><span class="prism-highlight-code-line"><span class="token keyword">function</span> <span class="token function">mockFnFactory</span><span class="token punctuation">(</span><span class="token parameter">numFailure</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(Fl,yu),i(Fl,Eu),i(Eu,vu),i(Fl,bu),i(Fl,ju),ju.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">mockFnFactory</span><span class="token punctuation">(</span><span class="token parameter">numFailure</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token keyword">let</span> numCalls <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">    numCalls<span class="token operator">++</span><span class="token punctuation">;</span></span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(Fl,Pu),i(Fl,Tu),i(Tu,Cu),i(Fl,Ou),i(Fl,Lu),Lu.innerHTML='<code class="language-js"><span class="token comment">// calback version</span>\n<span class="token keyword">function</span> <span class="token function">mockFnFactory</span><span class="token punctuation">(</span><span class="token parameter">numFailure</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">let</span> numCalls <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    numCalls<span class="token operator">++</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>numCalls <span class="token operator">&lt;=</span> numFailure<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> numCalls<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token comment">// promise version</span>\n<span class="token keyword">function</span> <span class="token function">mockFnFactory</span><span class="token punctuation">(</span><span class="token parameter">numFailure</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">let</span> numCalls <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    numCalls<span class="token operator">++</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>numCalls <span class="token operator">&lt;=</span> numFailure<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>numCalls<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(Fl,Au),i(Fl,$u),i($u,Du),i(Fl,Mu),i(Fl,Iu),Iu.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">spy</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">let</span> numCalled <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>\n    <span class="token function-variable function">fn</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      numCalled<span class="token operator">++</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n    <span class="token function">getNumberOfTimesCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">return</span> numCalled<span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(Fl,Su),i(Fl,Hu),i(Hu,xu),i(Fl,Nu),i(Fl,Fu),Fu.innerHTML='<code class="language-js"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">\'&#96;fn&#96; failed on 1st attempt, and succeed thereafter (callback based)\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">mockFnFactory</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> spied <span class="token operator">=</span> <span class="token function">spy</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// retry at most 3 times</span>\n  <span class="token function">retry</span><span class="token punctuation">(</span>spied<span class="token punctuation">.</span>fn<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// verify &#96;fn&#96; get called only 2 times</span>\n    <span class="token function">assert</span><span class="token punctuation">(</span>spied<span class="token punctuation">.</span><span class="token function">getNumberOfTimesCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// verify we get the return value from the 2nd attempt</span>\n    <span class="token function">assert</span><span class="token punctuation">(</span>data <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">\'&#96;fn&#96; failed on 1st attempt, and succeed thereafter (promise based)\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">mockFnFactory</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> spied <span class="token operator">=</span> <span class="token function">spy</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// retry at most 3 times</span>\n  <span class="token function">retry</span><span class="token punctuation">(</span>spied<span class="token punctuation">.</span>fn<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n    <span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n      <span class="token comment">// verify &#96;fn&#96; get called only 2 times</span>\n      <span class="token function">assert</span><span class="token punctuation">(</span>spied<span class="token punctuation">.</span><span class="token function">getNumberOfTimesCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// verify we get the return value from the 2nd attempt</span>\n      <span class="token function">assert</span><span class="token punctuation">(</span>data <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>\n    <span class="token parameter">error</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>',u(n,Ru,a),u(n,qu,a),i(qu,Wu),i(Wu,_u),i(_u,Ju),i(qu,Bu),i(qu,Uu),i(Uu,zu),i(Uu,Gu),i(Gu,Vu),i(Uu,Yu),i(Uu,Ku),i(Ku,Zu),i(Uu,Qu),i(qu,Xu),i(qu,nr),i(nr,ar),i(qu,sr),i(qu,tr),i(tr,er)},p:n,d(n){n&&r(s),n&&r($),n&&r(D),n&&r(I),n&&r(S),n&&r(x),n&&r(N),n&&r(R),n&&r(q),n&&r(Xa),n&&r(ns),n&&r(vo),n&&r(bo),n&&r(Nl),n&&r(Fl),n&&r(Ru),n&&r(qu)}}}function hn(n){let s,t;const e=[fn];let o={$$slots:{default:[kn]},$$scope:{ctx:n}};for(let n=0;n<e.length;n+=1)o=a(o,e[n]);return s=new rn({props:o}),{c(){J(s.$$.fragment)},l(n){B(s.$$.fragment,n)},m(n,a){U(s,n,a),t=!0},p(n,[a]){const t=0&a?function(n,a){const s={},t={},e={$$scope:1};let o=n.length;for(;o--;){const p=n[o],c=a[o];if(c){for(const n in p)n in c||(t[n]=1);for(const n in c)e[n]||(s[n]=c[n],e[n]=1);n[o]=c}else for(const n in p)e[n]=1}for(const n in t)n in s||(s[n]=void 0);return s}(e,[(o=fn,"object"==typeof o&&null!==o?o:{})]):{};var o;1&a&&(t.$$scope={dirty:a,ctx:n}),s.$set(t)},i(n){t||(W(s.$$.fragment,n),t=!0)},o(n){_(s.$$.fragment,n),t=!1},d(n){z(s,n)}}}const fn={title:"Retry asynchronous function using the callback pattern, promise chain and async await",date:"2020-06-21T08:00:00Z",tags:["JavaScript","Asynchronous","Problem Solving"],description:"How to retry asynchronous function using the callback pattern, promise chain and async await. Mental model for asynchronous JavaScript.",slug:"retry-async-function-with-callback-promise",type:"blog"};class dn extends Y{constructor(n){super(),V(this,n,null,hn,p,{})}}setTimeout(()=>{new dn({target:document.querySelector("#app"),hydrate:!0});if(document.querySelector(".twitter-tweet")){const n=document.createElement("script");n.async=!0,n.src="https://platform.twitter.com/widgets.js",n.charset="utf-8",document.body.appendChild(n)}if("loading"in HTMLImageElement.prototype){document.querySelectorAll('img[loading="lazy"]').forEach(n=>{n.src=n.dataset.src})}else{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js",document.body.appendChild(n)}},3e3);
