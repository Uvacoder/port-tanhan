<!DOCTYPE html>
<html lang="en">

<head>
  <meta charSet="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="preconnect dns-prefetch" href="https://www.google-analytics.com" />
  <link rel="preconnect dns-prefetch" href="https://fonts.googleapis.com" />
  <link href="https://twitter.com/lihautan" rel="me" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#bd93f9" />
  <link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="icon" href="/icons/icon-48x48.png?v=8d2ab22a78631a892833a1e109f6aba0" />
  <link rel="preload"
    href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,500;0,700;1,300&display=swap" as="style"
    onload="this.rel='stylesheet'">
  <link rel="alternate" type="application/rss+xml" title="Tan Li Hau&#x27;s RSS Feed" href="/rss.xml"/>
  <link rel="sitemap" type="application/xml" href="/sitemap.xml"/>
  <link rel="webmention" href="https://webmention.io/lihautan.com/webmention" />
  <link rel="pingback" href="https://webmention.io/lihautan.com/xmlrpc" />
  <style>
    html {
      font-family: 'Lato', sans-serif;
      font-weight: 400;
      font-size: 19px;
      background: linear-gradient(0deg, transparent, #bd93f917, transparent);
    }

    html,
    body {
      margin: 0;
      padding: 0;
    }

    :root {
      --prism-padding: 20px;
      --margin: 1.62em;
      --box-shadow-size: 6px;
      --box-shadow: var(--box-shadow-size) var(--box-shadow-size) var(--primary-color);
      --box-shadow-hover: 10px 10px var(--primary-color);
      --easing: 200ms ease-in-out;
      --primary-color: #bd93f9;
      --secondary-color: #9547b7;
      --dark-color: #282936;
    }
  </style>

  
  <title>Compile Svelte in your head (Part 4) | Tan Li Hau</title><meta name="description" content="" data-svelte="svelte-15e3uyc"><meta name="image" content="https://lihautan.com/compile-svelte-in-your-head-part-4/assets/hero-twitter-cf288ab2.jpg" data-svelte="svelte-15e3uyc"><meta name="og:image" content="https://lihautan.com/compile-svelte-in-your-head-part-4/assets/hero-twitter-cf288ab2.jpg" data-svelte="svelte-15e3uyc"><meta name="og:title" content="Compile Svelte in your head (Part 4)" data-svelte="svelte-15e3uyc"><meta name="og:description" content="" data-svelte="svelte-15e3uyc"><meta name="og:type" content="website" data-svelte="svelte-15e3uyc"><meta name="twitter:card" content="summary_large_image" data-svelte="svelte-15e3uyc"><meta name="twitter:creator" content="@lihautan" data-svelte="svelte-15e3uyc"><meta name="twitter:title" content="Compile Svelte in your head (Part 4)" data-svelte="svelte-15e3uyc"><meta name="twitter:description" content="" data-svelte="svelte-15e3uyc"><meta name="twitter:image" content="https://lihautan.com/compile-svelte-in-your-head-part-4/assets/hero-twitter-cf288ab2.jpg" data-svelte="svelte-15e3uyc"><meta name="keywords" content="Svelte" data-svelte="svelte-15e3uyc"><meta name="keywords" content="JavaScript" data-svelte="svelte-15e3uyc"><meta itemprop="url" content="https%3A%2F%2Flihautan.com%2Fcompile-svelte-in-your-head-part-4" data-svelte="svelte-15e3uyc"><meta itemprop="image" content="https://lihautan.com/compile-svelte-in-your-head-part-4/assets/hero-twitter-cf288ab2.jpg" data-svelte="svelte-15e3uyc"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"Tan Li Hau"},"copyrightHolder":{"@type":"Person","name":"Tan Li Hau"},"copyrightYear":"2020","creator":{"@type":"Person","name":"Tan Li Hau"},"publisher":{"@type":"Person","name":"Tan Li Hau"},"description":"","headline":"Compile Svelte in your head (Part 4)","name":"Compile Svelte in your head (Part 4)","inLanguage":"en"}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","description":"Breadcrumbs list","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","item":{"@id":"https://lihautan.com","name":"Homepage"},"name":"Homepage","position":1},{"@type":"ListItem","item":{"@id":"https%3A%2F%2Flihautan.com%2Fcompile-svelte-in-your-head-part-4","name":"Compile Svelte in your head (Part 4)"},"name":"Compile Svelte in your head (Part 4)","position":2}]}</script><link as="script" rel="preload" href="./dc7887a6.js"><link as="style" rel="preload" href="./assets/blog-base-248115e4.css"><link as="style" rel="preload" href="./dc7887a6.css"><link href="./assets/blog-base-248115e4.css" rel="stylesheet"><link href="./dc7887a6.css" rel="stylesheet">
</head>

<body>
  <div id="app">

<a href="#content" class="skip svelte-142ghl5">Skip to content</a>
<header class="svelte-1axnxyd"><nav><ul class="svelte-1axnxyd"><li class="svelte-1axnxyd"><a href="/" class="svelte-1axnxyd">Tan Li Hau</a></li>
    <li class="svelte-1axnxyd"><a href="/about" class="svelte-1axnxyd">About</a></li>
    <li class="svelte-1axnxyd"><a href="/blogs" class="svelte-1axnxyd">Writings</a></li>
    <li class="svelte-1axnxyd"><a href="/videos" class="svelte-1axnxyd">Videos</a></li>
    <li class="svelte-1axnxyd"><a href="/talks" class="svelte-1axnxyd">Talks</a></li>
    <li class="svelte-1axnxyd"><a href="/notes" class="svelte-1axnxyd">Notes</a></li>
    <li class="svelte-1axnxyd"><a href="/newsletter" class="svelte-1axnxyd">Newsletter</a></li>
    <li class="social svelte-1axnxyd"><a aria-label="Twitter account" href="https://twitter.com/lihautan" class="svelte-1axnxyd"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-1axnxyd"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66
    10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5
    4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
      <a aria-label="Github account" href="https://github.com/tanhauhau" class="svelte-1axnxyd"><svg viewBox="0 0 24 24" width="1em" height="1em" class="svelte-1axnxyd"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0
    0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07
    5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65
    5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42
    3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></li></ul></nav>
</header>

<main id="content" class="blog svelte-142ghl5"><h1>Compile Svelte in your head (Part 4)</h1>
  
  <span class="svelte-142ghl5">Svelte</span><span class="svelte-142ghl5">JavaScript</span>

  <article><section><ul class="sitemap" id="sitemap" role="navigation" aria-label="Table of Contents"><li><a href="#the-if-block">The  {#if}  block</a></li><li><a href="#the-vanilla-js">The Vanilla JS</a></li><ul><li><a href="#implementating-the-if-block">Implementating the if block</a></li><li><a href="#refactor-the-code">Refactor the code</a></li></ul><li><a href="#the-compiled-js">The Compiled JS</a></li><ul><li><a href="#the-extra-text-node">The extra text node</a></li></ul><li><a href="#closing-note">Closing Note</a></li></ul></section>
<p><strong>⬅ ⬅ Previously in <a href="/compile-svelte-in-your-head-part-3/">Part 3</a>.</strong></p>
<p>In this article, we are going to cover our first logic block, the <strong>if block</strong>.</p>
<p>To make sure we are on the same page, let&#39;s first explain how if block works.</p>
<section><h2><a href="#the-if-block" id="the-if-block">The <code>{#if}</code> block</a></h2>
<p>To render content conditionally, you can wrap it with the <code>{#if}</code> block:</p>
<pre class="language-svelte"><code class="language-svelte"><span class="token language-javascript"><span class="token punctuation">&#123;</span>#<span class="token keyword">if</span> condition<span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Conditionally rendered content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">&#125;</span></span></code></pre>
<p>If the <code>condition</code> is truthy, you will see the <code>&lt;div&gt;Conditionally rendered content&lt;/div&gt;</code>, otherwise you will see nothing.</p>
<p>Like JavaScript, you can use <code>else</code> and <code>else if</code> in Svelte to test multiple conditions too:</p>
<pre class="language-svelte"><code class="language-svelte"><span class="token language-javascript"><span class="token punctuation">&#123;</span>#<span class="token keyword">if</span> condition_a<span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Rendered due to condition_a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token punctuation">:</span><span class="token keyword">else</span> <span class="token keyword">if</span> condition_b<span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Rendered due to condition_b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token punctuation">:</span><span class="token keyword">else</span><span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Otherwise<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">&#125;</span></span></code></pre>
<p>You can visit Svelte&#39;s interactive tutorial to learn more about the <a href="https://svelte.dev/tutorial/if-blocks" rel="nofollow"><code>{#if}</code> logic block</a>.</p></section>
<section><h2><a href="#the-vanilla-js" id="the-vanilla-js">The Vanilla JS</a></h2>
<p>So how do we implement an <code>{#if}</code> logic without any framework?</p>
<p>As <a href="/compile-svelte-in-your-head-part-1/#creating-an-element">mentioned in the Part 1 of the series</a>, we&#39;ve seen how we can create elements without framework help.</p></section>
<section><h3><a href="#implementating-the-if-block" id="implementating-the-if-block">Implementating the if block</a></h3>
<p>Implementing an <code>{#if}</code> logic block can be as follow:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createElementsIfConditionA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// code to create &#96;&lt;div>Rendered due to condition_a&lt;/div>&#96;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">createElementsIfConditionB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// code to create &#96;&lt;div>Rendered due to condition_b&lt;/div>&#96;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">createElementsElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// code to create &#96;&lt;div>Otherwise&lt;/div>&#96;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">createIfBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>condition_a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">createElementsIfConditionA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>condition_b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">createElementsIfConditionB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token function">createElementsElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>The <code>condition_a</code> and <code>condition_b</code> could be dynamic, which means if the condition changed, we may need to call <code>createIfBlock</code> again.</p>
<p>But before that, we need to remove the elements that we created previously. This depends on which conditions were met previously, and which elements were created previously.</p>
<p>So, let&#39;s store that information in a variable:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">destroyElementsIfConditionA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// code to destroy &#96;&lt;div>Rendered due to condition_a&lt;/div>&#96;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">destroyElementsIfConditionB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// code to destroy &#96;&lt;div>Rendered due to condition_b&lt;/div>&#96;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">destroyElementsElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// code to destroy &#96;&lt;div>Otherwise&lt;/div>&#96;</span>
<span class="token punctuation">&#125;</span>

<span class="prism-highlight-code-line"><span class="token keyword">let</span> previousDestroy<span class="token punctuation">;</span></span>
<span class="prism-highlight-code-line"><span class="token keyword">function</span> <span class="token function">getPreviousDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>
<span class="prism-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>condition_a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>
<span class="prism-highlight-code-line">    previousDestroy <span class="token operator">=</span> destroyElementsIfConditionA<span class="token punctuation">;</span></span>
<span class="prism-highlight-code-line">  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>condition_b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>
<span class="prism-highlight-code-line">    previousDestroy <span class="token operator">=</span> destroyElementsIfConditionB<span class="token punctuation">;</span></span>
<span class="prism-highlight-code-line">  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></span>
<span class="prism-highlight-code-line">    previousDestroy <span class="token operator">=</span> destroyElementsElse<span class="token punctuation">;</span></span>
<span class="prism-highlight-code-line">  <span class="token punctuation">&#125;</span></span>
<span class="prism-highlight-code-line"><span class="token punctuation">&#125;</span></span>

<span class="token keyword">function</span> <span class="token function">createIfBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
<span class="prism-highlight-code-line">  <span class="token function">getPreviousDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token punctuation">&#125;</span></code></pre>
<p>So, <strong>if conditions changed</strong>, we destroy the previously created elements, and create a new one:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">updateIfBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// if &#96;condition_a&#96; or &#96;condition_b&#96; changed</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>conditionChanged<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">previousDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">createIfBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>However, if the condition does not change, but the content within the if block changes, for example, <code>value_a</code>, <code>value_b</code> or <code>value_else</code> change in the following code:</p>
<pre class="language-svelte"><code class="language-svelte"><span class="token language-javascript"><span class="token punctuation">&#123;</span>#<span class="token keyword">if</span> condition_a<span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token language-javascript"><span class="token punctuation">&#123;</span> value_a <span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token punctuation">:</span><span class="token keyword">else</span> <span class="token keyword">if</span> condition_b<span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token language-javascript"><span class="token punctuation">&#123;</span> value_b <span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token punctuation">:</span><span class="token keyword">else</span><span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token language-javascript"><span class="token punctuation">&#123;</span> value_else <span class="token punctuation">&#125;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">&#125;</span></span></code></pre>
<p>Then we need to know how to update the elements as well:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">updateElementsIfConditionA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// code to update &#96;&lt;div>&#123; value_a &#125;&lt;/div>&#96;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">updateElementsIfConditionB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// code to update &#96;&lt;div>&#123; value_b &#125;&lt;/div>&#96;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">updateElementsElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// code to update &#96;&lt;div>&#123; value_else &#125;&lt;/div>&#96;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">updateIfBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// if &#96;condition_a&#96; or &#96;condition_b&#96; changed</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>conditionChanged<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">previousDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">createIfBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="prism-highlight-code-line">  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></span>
<span class="prism-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>condition_a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>
<span class="prism-highlight-code-line">      <span class="token function">updateElementsIfConditionA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="prism-highlight-code-line">    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>condition_b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>
<span class="prism-highlight-code-line">      <span class="token function">updateElementsIfConditionB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="prism-highlight-code-line">    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></span>
<span class="prism-highlight-code-line">      <span class="token function">updateElementsElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="prism-highlight-code-line">    <span class="token punctuation">&#125;</span></span>
<span class="prism-highlight-code-line">  <span class="token punctuation">&#125;</span></span>
<span class="token punctuation">&#125;</span></code></pre>
<p>Finally to destroy the elements if we want to unmount the whole <code>{#if}</code> block, we can use <code>previousDestroy</code>, since it will be based on the conditions that the elements were created with:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">destroyIfBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">previousDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>Here we have <code>createIfBlock</code>, <code>updateIfBlock</code> and <code>destroyIfBlock</code>. It looks unwieldy, as the <code>if (condition)</code> logic is scattered across <code>createIfBlock</code>, <code>getPreviousDestroy</code> and <code>updateIfBlock</code>.</p>
<p>So, let&#39;s refactor this. Let&#39;s shift code around to make it cleaner. ✨</p></section>
<section><h3><a href="#refactor-the-code" id="refactor-the-code">Refactor the code</a></h3>
<p>For each of the logic branch, we have functions to create, update and destroy its elements. For the first condition branch, we have:</p>
<ul><li><code>createElementsIfConditionA</code></li>
<li><code>updateElementsIfConditionA</code></li>
<li><code>destroyElementsIfConditionA</code></li></ul>
<p>It seems like we can employ some sort of <a href="https://dev.to/carlillo/design-patterns---strategy-pattern-in-javascript-2hg3" rel="nofollow">Strategy Pattern</a> over here.</p>
<p>We can group the operations for each condition branch together, where each operation has the same interface, <code>{ create(){}, update(){}, destroy(){} }</code> :</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> operationConditionA <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  create<span class="token punctuation">:</span> createElementsIfConditionA<span class="token punctuation">,</span>
  update<span class="token punctuation">:</span> updateElementsIfConditionA<span class="token punctuation">,</span>
  destroy<span class="token punctuation">:</span> destroyElementsIfConditionA<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> operationConditionB <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  create<span class="token punctuation">:</span> createElementsIfConditionB<span class="token punctuation">,</span>
  update<span class="token punctuation">:</span> updateElementsIfConditionB<span class="token punctuation">,</span>
  destroy<span class="token punctuation">:</span> destroyElementsIfConditionB<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> operationConditionElse <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  create<span class="token punctuation">:</span> createElementsElse<span class="token punctuation">,</span>
  update<span class="token punctuation">:</span> updateElementsElse<span class="token punctuation">,</span>
  destroy<span class="token punctuation">:</span> destroyElementsElse<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>
<p>Now, we choose the operation based on the condition, since they have the same interface, they should be able to be used interchangeably:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>condition_a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> operationConditionA<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>condition_b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> operationConditionB<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> operationConditionElse<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>Here, we can rewrite our <code>createIfBlock</code>, <code>updateIfBlock</code> and <code>destroyIfBlock</code>:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">let</span> currentOperation <span class="token operator">=</span> <span class="token function">getOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createIfBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  currentOperation<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">updateIfBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> previousOperation <span class="token operator">=</span> currentOperation<span class="token punctuation">;</span>
  currentOperation <span class="token operator">=</span> <span class="token function">getOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// if (conditionChanged)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentOperation <span class="token operator">!==</span> previousOperation<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    previousOperation<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    currentOperation<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    currentOperation<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">destroyIfBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  currentOperation<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>To determine whether the condition changed, we can compute the operation and compare it with the previous operation to see if it has changed.</p></section>
<section><h2><a href="#the-compiled-js" id="the-compiled-js">The Compiled JS</a></h2>
<p>Now let&#39;s take look at how Svelte compiles <code>{#if}</code> into output JavaScript.</p>
<pre class="language-svelte"><code class="language-svelte"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">let</span> loggedIn <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">function</span> <span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		loggedIn <span class="token operator">=</span> <span class="token operator">!</span>loggedIn<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token language-javascript"><span class="token punctuation">&#123;</span>#<span class="token keyword">if</span> loggedIn<span class="token punctuation">&#125;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>toggle<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span>
		Log out
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token punctuation">:</span><span class="token keyword">else</span><span class="token punctuation">&#125;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click=</span><span class="token language-javascript"><span class="token punctuation">&#123;</span>toggle<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span>
		Log in
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">&#125;</span></span></code></pre>
<p><a href="https://svelte.dev/repl/39aec874a5214a35b34ff069ae9fa143" rel="nofollow">Svelte REPL</a></p>
<p>The output code:</p>
<details><summary>Click to expand...</summary>
<pre class="language-js"><code class="language-js"><span class="token comment">/* App.svelte generated by Svelte v3.25.1 */</span>
<span class="token comment">// ...</span>
<span class="token keyword">function</span> <span class="token function">create_else_block</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    p<span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
    <span class="token function">d</span><span class="token punctuation">(</span><span class="token parameter">detaching</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// (9:0) &#123;#if loggedIn&#125;</span>
<span class="token keyword">function</span> <span class="token function">create_if_block</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    p<span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
    <span class="token function">d</span><span class="token punctuation">(</span><span class="token parameter">detaching</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">create_fragment</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">function</span> <span class="token function">select_block_type</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> dirty</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/*loggedIn*/</span> ctx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> create_if_block<span class="token punctuation">;</span>
    <span class="token keyword">return</span> create_else_block<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">let</span> current_block_type <span class="token operator">=</span> <span class="token function">select_block_type</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> if_block <span class="token operator">=</span> <span class="token function">current_block_type</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      if_block<span class="token punctuation">.</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      if_block_anchor <span class="token operator">=</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">m</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> anchor</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      if_block<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">insert</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> if_block_anchor<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">p</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> <span class="token punctuation">[</span>dirty<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>current_block_type <span class="token operator">===</span> <span class="token punctuation">(</span>current_block_type <span class="token operator">=</span> <span class="token function">select_block_type</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> dirty<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> if_block<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        if_block<span class="token punctuation">.</span><span class="token function">p</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> dirty<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        if_block<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        if_block <span class="token operator">=</span> <span class="token function">current_block_type</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>if_block<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          if_block<span class="token punctuation">.</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          if_block<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span>if_block_anchor<span class="token punctuation">.</span>parentNode<span class="token punctuation">,</span> if_block_anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    i<span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
    o<span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
    <span class="token function">d</span><span class="token punctuation">(</span><span class="token parameter">detaching</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      if_block<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>detaching<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>detaching<span class="token punctuation">)</span> <span class="token function">detach</span><span class="token punctuation">(</span>if_block_anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></details>
<p>Some observations:</p>
<p><strong>Observation 1: If you compare the Svelte&#39;s compiled output and the JS code we came out earlier, you may see some resemblance:</strong></p>
<ul><li><p>For each logic branch, we have a <a href="/compile-svelte-in-your-head-part-1/#create-fragment"><code>create_fragment</code> function</a>, which in this case is <code>create_else_block</code> and <code>create_if_block</code>. As explain in the previous article, these functions return an <em>instruction manual</em> on how to build the DOM fragment for each logic branch.</p>
<p>This is similar to the operations we discussed earlier, eg: <code>operationConditionA</code>, <code>operationConditionB</code> and <code>operationConditionElse</code>.</p></li>
<li><p>To determine which <code>create_fragment</code> function to use, we have the <code>select_block_type</code> function.</p>
<p>This is similar to the <code>getOperation</code> we discussed earlier.</p></li>
<li><p>We then initialise the fragment for the current condition branch,</p></li></ul>
<pre class="language-js"><code class="language-js"><span class="token keyword">let</span> current_block_type <span class="token operator">=</span> <span class="token function">select_block_type</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> if_block <span class="token operator">=</span> <span class="token function">current_block_type</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ul><li><p>Now we can:</p>
<ul><li>create <code>if_block.c()</code></li>
<li>mount <code>if_block.m(target, anchor)</code></li>
<li>update <code>if_block.p(ctx, dirty)</code></li>
<li>destroy <code>if_block.d(detaching)</code></li></ul>
<p>elements for the <code>{#if}</code> block.</p></li>
<li><p>In the <code>p</code> <strong>(u_p_date)</strong> method, we check if the <code>current_block_type</code> has changed, if not, then we call <code>if_block.p(ctx, dirty)</code> to update as necessary.</p>
<p>If there&#39;s change, then we destroy <code>if_block.d(1)</code> the previous elements, create a new fragment based on the <code>current_block_type</code>, then create and mount the elements via <code>if_block.c()</code> and <code>if_block.m(...)</code>.</p>
<p>This is similar to how we call <code>previousOperation.destroy()</code> and <code>currentOperation.create()</code>  or <code>currentOperation.update()</code>.</p></li></ul>
<p><strong>Observation 2: There&#39;s a <code>if_block_anchor</code> inserted after the <code>if_block</code></strong></p>
<pre class="language-js"><code class="language-js">if_block_anchor <span class="token operator">=</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><code>empty()</code> creates an empty text node.</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// https://github.com/sveltejs/svelte/blob/v3.25.1/src/runtime/internal/dom.ts#L56-L58</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
<p>The <code>if_block_anchor</code> is then used when mounting the <code>if_block</code> in the <strong>u_p_date</strong> method.</p>
<pre class="language-js"><code class="language-js">if_block<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span>if_block_anchor<span class="token punctuation">.</span>parentNode<span class="token punctuation">,</span> if_block_anchor<span class="token punctuation">)</span></code></pre>
<p>So what is this extra empty text node for?</p></section>
<section><h3><a href="#the-extra-text-node" id="the-extra-text-node">The extra text node</a></h3>
<p>When we update the <code>{#if}</code> block and notice that we need to change the fragment block type, we need to destroy the elements created previously, and insert newly created elements.</p>
<p>When we insert the new elements, we need to know where to insert them. The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore" rel="nofollow"><code>insertBefore</code></a> API allow us to specify which node the elements should be inserted before. So now it begs the question, which node?</p>
<p>The answer depends on the position <code>{#if}</code> block is written in the component. There are 4 possible scenarios:</p>
<p><strong>1. There&#39;s an element right after the <code>{#if}</code> block</strong></p>
<pre class="language-svelte"><code class="language-svelte"><span class="token language-javascript"><span class="token punctuation">&#123;</span>#<span class="token keyword">if</span> condition<span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">&#125;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token punctuation">/></span></span></code></pre>
<p><a href="https://svelte.dev/repl/5d75daf3190f412f83656fd2e689cb14" rel="nofollow">Svelte REPL</a></p>
<p>You&#39;ll see that</p>
<ul><li>Svelte does not create the extra text node</li>
<li>Instead, Svelte uses the <code>&lt;span /&gt;</code> node instead</li></ul>
<pre class="language-js"><code class="language-js">if_block<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span>span<span class="token punctuation">.</span>parentNode<span class="token punctuation">,</span> span<span class="token punctuation">)</span></code></pre>
<blockquote><p>When the <code>{#if}</code> condition changes, <code>{#if}</code> block will replace and insert new elements before the <code>&lt;span /&gt;</code> element.</p></blockquote>
<p><strong>2. <code>{#if}</code> block is the last child, <code>{#if}</code> block has a parent</strong></p>
<pre class="language-svelte"><code class="language-svelte"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
  <span class="token language-javascript"><span class="token punctuation">&#123;</span>#<span class="token keyword">if</span> condition<span class="token punctuation">&#125;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/></span></span>
  <span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">&#125;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p><a href="https://svelte.dev/repl/5fac48804cfb49639cfda1ab8273cba8" rel="nofollow">Svelte REPL</a></p>
<p>You&#39;ll see that</p>
<ul><li>Svelte does not create the extra text node</li>
<li>Instead, Svelte inserts the <code>{#if}</code> block into the parent node, <code>&lt;div /&gt;</code> and insert before <code>null</code>. (If you pass <code>null</code> to <code>insertBefore</code>, it will append the element as the last child)</li></ul>
<pre class="language-js"><code class="language-js">if_block<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<blockquote><p>When the <code>{#if}</code> condition changes, <code>{#if}</code> block will replace and insert new elements as the last children of the parent <code>&lt;div /&gt;</code> element.</p></blockquote>
<p><strong>3. <code>{#if}</code> block is the last child, <code>{#if}</code> block does not have a parent</strong></p>
<pre class="language-svelte"><code class="language-svelte"><span class="token language-javascript"><span class="token punctuation">&#123;</span>#<span class="token keyword">if</span> condition<span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">&#125;</span></span></code></pre>
<p><a href="https://svelte.dev/repl/b9b5dae5ab9f4399bf901f802a6885cb" rel="nofollow">Svelte REPL</a></p>
<p>You&#39;ll see that</p>
<ul><li>Svelte creates an extra <code>anchor</code> element</li>
<li>The <code>anchor</code> element is inserted after the <code>{#if}</code> block.</li>
<li>Subsequently in the <strong>u_p_date</strong> function, Svelte insert <code>{#if}</code> block before the <code>anchor</code> element.</li></ul>
<pre class="language-js"><code class="language-js">if_block<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span>if_block_anchor<span class="token punctuation">.</span>parentNode<span class="token punctuation">,</span> if_block_anchor<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<blockquote><p>When the <code>{#if}</code> condition changes, <code>{#if}</code> block will replace and insert new elements before the <code>anchor</code> element.</p></blockquote>
<p>But why?</p>
<p>This is because a Svelte component can be used in anywhere.</p>
<p>Let&#39;s take a look at the scenario below:</p>
<pre class="language-svelte"><code class="language-svelte"><span class="token comment">&lt;!-- A.svelte --></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span>#<span class="token keyword">if</span> condition<span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">&#125;</span></span>

<span class="token comment">&lt;!-- B.svelte --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token comment">&lt;!-- App.svelte --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">'./A.svelte'</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token constant">B</span> <span class="token keyword">from</span> <span class="token string">'./B.svelte'</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>A</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>B</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>In the <code>A.svelte</code>, the <code>{#if}</code> block is the last child, it does not have any sibling elements after it. </p>
<p>Let&#39;s first assume we don&#39;t have the <code>anchor</code> element. When the <code>condition</code> changes from <code>false</code> to <code>true</code>, Svelte will have to insert the new element <code>&lt;div id=&quot;a&quot;&gt;</code> into its parent. And because there&#39;s no next element after <code>{#if}</code> block, and no <code>anchor</code> element, we will have to insert before <code>null</code>. In which, the <code>&lt;div id=&quot;a&quot; /&gt;</code> will be inserted as the last child of the parent element, <code>&lt;div id=&quot;parent&quot;&gt;</code>. And hey, we got ourselves a bug! Elements inside <code>&lt;A /&gt;</code> appears after <code>&lt;B /&gt;</code>!</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- newly inserted element --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>We can prevent this from happening by adding an <code>anchor</code> element.</p>
<p>When the <code>condition</code> is <code>false</code>, our DOM looks like this:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#text</span> <span class="token punctuation">/></span></span> <span class="token comment">&lt;!-- an empty text node, not visible to the user --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>And when the <code>condition</code> turns <code>true</code>, we insert <code>&lt;div id=&quot;a&quot; /&gt;</code> before the <code>anchor</code> element:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- newly inserted element --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#text</span> <span class="token punctuation">/></span></span> <span class="token comment">&lt;!-- an empty text node, not visible to the user --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>Yay, we maintain the order of <code>&lt;A /&gt;</code> and <code>&lt;B /&gt;</code> 🎉 !</p>
<p>The <code>anchor</code> element to the <code>{#if}</code> block, is like <a href="https://www.britannica.com/technology/anchor-nautical-device" rel="nofollow">an anchor to a ship</a>, &quot;Here is where <code>{#if}</code> block should <code>insertBefore()</code> !&quot;</p>
<p><strong>4. <code>{#if}</code> block followed by another logic block</strong></p>
<p>The final scenario. <code>{#if}</code> block followed by another logic block:</p>
<pre class="language-svelte"><code class="language-svelte"><span class="token language-javascript"><span class="token punctuation">&#123;</span>#<span class="token keyword">if</span> condition<span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">&#125;</span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span>#<span class="token keyword">if</span> condition2<span class="token punctuation">&#125;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token language-javascript"><span class="token punctuation">&#123;</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">&#125;</span></span></code></pre>
<p>The 2nd <code>{#if}</code> block condition could be <code>true</code> or <code>false</code>. Which means <code>&lt;div id=&quot;b&quot; /&gt;</code> could be there or not there.</p>
<p>So, to know where we should insert <code>&lt;div id=&quot;a&quot; /&gt;</code> when chaging the <code>condition</code>, we need an <code>anchor</code> element after the 1st <code>{#if}</code> block, before the 2nd <code>{#if}</code> block.</p></section>
<section><h2><a href="#closing-note" id="closing-note">Closing Note</a></h2>
<p>We&#39;ve covered how Svelte compiles an <code>{#if}</code> block, as well as how and why an <code>anchor</code> element is needed for the <code>{#if}</code> block.</p>
<p>If you wish to learn more about Svelte, <a href="https://twitter.com/lihautan" rel="nofollow">follow me on Twitter</a>.</p>
<p>I&#39;ll post it on Twitter when the next part is ready, the next post will be about <code>{#each}</code> logic block.</p></section></article></main>

<footer class="svelte-142ghl5"><div class="form svelte-1k1s1co"><h1>Subscribe to my newsletter</h1>
  <h2 class="svelte-1k1s1co">Get the latest blog posts and project updates delivered right to your inbox</h2>
  <form action="https://buttondown.email/api/emails/embed-subscribe/lihautan" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/lihautan', 'popupwindow')" class="embeddable-buttondown-form"><div class="form-item svelte-1k1s1co"><input type="email" name="email" id="bd-email" aria-label="email address" placeholder="youremail@example.com" class="svelte-1k1s1co">
      <input type="submit" value="Subscribe" disabled class="svelte-1k1s1co"></div>
    <input type="hidden" value="1" name="embed" class="svelte-1k1s1co">
    <p class="svelte-1k1s1co">Powered by Buttondown.</p></form>
</div>
  
</footer><script src="./dc7887a6.js" async></script></div>
  

  <script>if ('serviceWorker' in navigator) { window.addEventListener('load', function () { navigator.serviceWorker.register('/sw.js'); }); }</script>
  <script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); if (typeof ga === "function") { ga('create', 'UA-135921142-1', 'auto', {}); }</script>
  <script>if ('loading' in HTMLImageElement.prototype) { const images = document.querySelectorAll('img[loading="lazy"]'); images.forEach(img => { img.src = img.dataset.src; }); } else { const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js'; document.body.appendChild(script); }</script>
</body>

</html>