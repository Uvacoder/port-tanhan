function n(){}function a(n,a){for(const s in a)n[s]=a[s];return n}function s(n){return n()}function t(){return Object.create(null)}function e(n){n.forEach(s)}function o(n){return"function"==typeof n}function p(n,a){return n!=n?a==a:n!==a||n&&"object"==typeof n||"function"==typeof n}function c(n,s,t,e){return n[1]&&e?a(t.ctx.slice(),n[1](e(s))):t.ctx}function r(n,a,s,t,e,o,p){const r=function(n,a,s,t){if(n[2]&&t){const e=n[2](t(s));if(void 0===a.dirty)return e;if("object"==typeof e){const n=[],s=Math.max(a.dirty.length,e.length);for(let t=0;t<s;t+=1)n[t]=a.dirty[t]|e[t];return n}return a.dirty|e}return a.dirty}(a,t,e,o);if(r){const e=c(a,s,t,p);n.p(e,r)}}function i(n,a){n.appendChild(a)}function l(n,a,s){n.insertBefore(a,s||null)}function u(n){n.parentNode.removeChild(n)}function h(n,a){for(let s=0;s<n.length;s+=1)n[s]&&n[s].d(a)}function k(n){return document.createElement(n)}function d(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function f(n){return document.createTextNode(n)}function g(){return f(" ")}function m(){return f("")}function v(n,a,s){null==s?n.removeAttribute(a):n.getAttribute(a)!==s&&n.setAttribute(a,s)}function y(n){return Array.from(n.childNodes)}function w(n,a,s,t){for(let t=0;t<n.length;t+=1){const e=n[t];if(e.nodeName===a){let a=0;const o=[];for(;a<e.attributes.length;){const n=e.attributes[a++];s[n.name]||o.push(n.name)}for(let n=0;n<o.length;n++)e.removeAttribute(o[n]);return n.splice(t,1)[0]}}return t?d(a):k(a)}function E(n,a){for(let s=0;s<n.length;s+=1){const t=n[s];if(3===t.nodeType)return t.data=""+a,n.splice(s,1)[0]}return f(a)}function b(n){return E(n," ")}function T(n,a){a=""+a,n.wholeText!==a&&(n.data=a)}function A(n,a){n.value=null==a?"":a}function S(n,a,s,t){n.style.setProperty(a,s,t?"important":"")}class x{constructor(n=null){this.a=n,this.e=this.n=null}m(n,a,s=null){this.e||(this.e=k(a.nodeName),this.t=a,this.h(n)),this.i(s)}h(n){this.e.innerHTML=n,this.n=Array.from(this.e.childNodes)}i(n){for(let a=0;a<this.n.length;a+=1)l(this.t,this.n[a],n)}p(n){this.d(),this.h(n),this.i(this.a)}d(){this.n.forEach(u)}}let j;function P(n){j=n}function I(n){(function(){if(!j)throw new Error("Function called outside component initialization");return j})().$$.on_mount.push(n)}const L=[],M=[],C=[],N=[],$=Promise.resolve();let O=!1;function H(n){C.push(n)}let R=!1;const D=new Set;function B(){if(!R){R=!0;do{for(let n=0;n<L.length;n+=1){const a=L[n];P(a),F(a.$$)}for(L.length=0;M.length;)M.pop()();for(let n=0;n<C.length;n+=1){const a=C[n];D.has(a)||(D.add(a),a())}C.length=0}while(L.length);for(;N.length;)N.pop()();O=!1,R=!1,D.clear()}}function F(n){if(null!==n.fragment){n.update(),e(n.before_update);const a=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,a),n.after_update.forEach(H)}}const _=new Set;function z(n,a){n&&n.i&&(_.delete(n),n.i(a))}function J(n,a,s,t){if(n&&n.o){if(_.has(n))return;_.add(n),(void 0).c.push(()=>{_.delete(n),t&&(s&&n.d(1),t())}),n.o(a)}}function U(n){n&&n.c()}function W(n,a){n&&n.l(a)}function G(n,a,t){const{fragment:p,on_mount:c,on_destroy:r,after_update:i}=n.$$;p&&p.m(a,t),H(()=>{const a=c.map(s).filter(o);r?r.push(...a):e(a),n.$$.on_mount=[]}),i.forEach(H)}function Y(n,a){const s=n.$$;null!==s.fragment&&(e(s.on_destroy),s.fragment&&s.fragment.d(a),s.on_destroy=s.fragment=null,s.ctx=[])}function q(n,a){-1===n.$$.dirty[0]&&(L.push(n),O||(O=!0,$.then(B)),n.$$.dirty.fill(0)),n.$$.dirty[a/31|0]|=1<<a%31}function K(a,s,o,p,c,r,i=[-1]){const l=j;P(a);const h=s.props||{},k=a.$$={fragment:null,ctx:null,props:r,update:n,not_equal:c,bound:t(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:[]),callbacks:t(),dirty:i};let d=!1;if(k.ctx=o?o(a,h,(n,s,...t)=>{const e=t.length?t[0]:s;return k.ctx&&c(k.ctx[n],k.ctx[n]=e)&&(k.bound[n]&&k.bound[n](e),d&&q(a,n)),s}):[],k.update(),d=!0,e(k.before_update),k.fragment=!!p&&p(k.ctx),s.target){if(s.hydrate){const n=y(s.target);k.fragment&&k.fragment.l(n),n.forEach(u)}else k.fragment&&k.fragment.c();s.intro&&z(a.$$.fragment),G(a,s.target,s.anchor),B()}P(l)}class V{$destroy(){Y(this,1),this.$destroy=n}$on(n,a){const s=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return s.push(a),()=>{const n=s.indexOf(a);-1!==n&&s.splice(n,1)}}$set(){}}function Q(a){let s,t,e,o,p,c,r,h,m,T,A,S,x,j,P,I,L,M,C,N,$,O,H,R,D,B,F,_,z,J,U,W,G,Y,q;return{c(){s=k("header"),t=k("nav"),e=k("ul"),o=k("li"),p=k("a"),c=f("Tan Li Hau"),r=g(),h=k("li"),m=k("a"),T=f("About"),A=g(),S=k("li"),x=k("a"),j=f("Writings"),P=g(),I=k("li"),L=k("a"),M=f("Talks"),C=g(),N=k("li"),$=k("a"),O=f("Notes"),H=g(),R=k("li"),D=k("a"),B=f("Newsletter"),F=g(),_=k("li"),z=k("a"),J=d("svg"),U=d("path"),W=g(),G=k("a"),Y=d("svg"),q=d("path"),this.h()},l(n){s=w(n,"HEADER",{class:!0});var a=y(s);t=w(a,"NAV",{});var i=y(t);e=w(i,"UL",{class:!0});var l=y(e);o=w(l,"LI",{class:!0});var k=y(o);p=w(k,"A",{href:!0,class:!0});var d=y(p);c=E(d,"Tan Li Hau"),d.forEach(u),k.forEach(u),r=b(l),h=w(l,"LI",{class:!0});var f=y(h);m=w(f,"A",{href:!0,class:!0});var g=y(m);T=E(g,"About"),g.forEach(u),f.forEach(u),A=b(l),S=w(l,"LI",{class:!0});var v=y(S);x=w(v,"A",{href:!0,class:!0});var K=y(x);j=E(K,"Writings"),K.forEach(u),v.forEach(u),P=b(l),I=w(l,"LI",{class:!0});var V=y(I);L=w(V,"A",{href:!0,class:!0});var Q=y(L);M=E(Q,"Talks"),Q.forEach(u),V.forEach(u),C=b(l),N=w(l,"LI",{class:!0});var Z=y(N);$=w(Z,"A",{href:!0,class:!0});var X=y($);O=E(X,"Notes"),X.forEach(u),Z.forEach(u),H=b(l),R=w(l,"LI",{class:!0});var nn=y(R);D=w(nn,"A",{href:!0,class:!0});var an=y(D);B=E(an,"Newsletter"),an.forEach(u),nn.forEach(u),F=b(l),_=w(l,"LI",{class:!0});var sn=y(_);z=w(sn,"A",{"aria-label":!0,href:!0,class:!0});var tn=y(z);J=w(tn,"svg",{viewBox:!0,width:!0,height:!0,class:!0},1);var en=y(J);U=w(en,"path",{d:!0},1),y(U).forEach(u),en.forEach(u),tn.forEach(u),W=b(sn),G=w(sn,"A",{"aria-label":!0,href:!0,class:!0});var on=y(G);Y=w(on,"svg",{viewBox:!0,width:!0,height:!0,class:!0},1);var pn=y(Y);q=w(pn,"path",{d:!0},1),y(q).forEach(u),pn.forEach(u),on.forEach(u),sn.forEach(u),l.forEach(u),i.forEach(u),a.forEach(u),this.h()},h(){v(p,"href","/"),v(p,"class","svelte-f3e4uo"),v(o,"class","svelte-f3e4uo"),v(m,"href","/about"),v(m,"class","svelte-f3e4uo"),v(h,"class","svelte-f3e4uo"),v(x,"href","/blogs"),v(x,"class","svelte-f3e4uo"),v(S,"class","svelte-f3e4uo"),v(L,"href","/talks"),v(L,"class","svelte-f3e4uo"),v(I,"class","svelte-f3e4uo"),v($,"href","/notes"),v($,"class","svelte-f3e4uo"),v(N,"class","svelte-f3e4uo"),v(D,"href","/newsletter"),v(D,"class","svelte-f3e4uo"),v(R,"class","svelte-f3e4uo"),v(U,"d","M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66\n    10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5\n    4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"),v(J,"viewBox","0 0 24 24"),v(J,"width","1em"),v(J,"height","1em"),v(J,"class","svelte-f3e4uo"),v(z,"aria-label","Twitter account"),v(z,"href","https://twitter.com/lihautan"),v(z,"class","svelte-f3e4uo"),v(q,"d","M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0\n    0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07\n    5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65\n    5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42\n    3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"),v(Y,"viewBox","0 0 24 24"),v(Y,"width","1em"),v(Y,"height","1em"),v(Y,"class","svelte-f3e4uo"),v(G,"aria-label","Github account"),v(G,"href","https://github.com/tanhauhau"),v(G,"class","svelte-f3e4uo"),v(_,"class","social svelte-f3e4uo"),v(e,"class","svelte-f3e4uo"),v(s,"class","svelte-f3e4uo")},m(n,a){l(n,s,a),i(s,t),i(t,e),i(e,o),i(o,p),i(p,c),i(e,r),i(e,h),i(h,m),i(m,T),i(e,A),i(e,S),i(S,x),i(x,j),i(e,P),i(e,I),i(I,L),i(L,M),i(e,C),i(e,N),i(N,$),i($,O),i(e,H),i(e,R),i(R,D),i(D,B),i(e,F),i(e,_),i(_,z),i(z,J),i(J,U),i(_,W),i(_,G),i(G,Y),i(Y,q)},p:n,i:n,o:n,d(n){n&&u(s)}}}class Z extends V{constructor(n){super(),K(this,n,null,Q,p,{})}}function X(a){let s,t,e,o,p,c,r,h,d,m,T,S,x,j,P,I,L,M,C,N;return{c(){s=k("div"),t=k("h1"),e=f("Subscribe to my newsletter"),o=g(),p=k("h2"),c=f("Get the latest blog posts and project updates delivered right to your inbox"),r=g(),h=k("form"),d=k("div"),m=k("input"),T=g(),S=k("input"),j=g(),P=k("input"),I=g(),L=k("p"),M=f("Powered by Buttondown."),this.h()},l(n){s=w(n,"DIV",{class:!0});var a=y(s);t=w(a,"H1",{});var i=y(t);e=E(i,"Subscribe to my newsletter"),i.forEach(u),o=b(a),p=w(a,"H2",{class:!0});var l=y(p);c=E(l,"Get the latest blog posts and project updates delivered right to your inbox"),l.forEach(u),r=b(a),h=w(a,"FORM",{action:!0,method:!0,target:!0,onsubmit:!0,class:!0});var k=y(h);d=w(k,"DIV",{class:!0});var f=y(d);m=w(f,"INPUT",{type:!0,name:!0,id:!0,"aria-label":!0,placeholder:!0,class:!0}),T=b(f),S=w(f,"INPUT",{type:!0,value:!0,disabled:!0,class:!0}),f.forEach(u),j=b(k),P=w(k,"INPUT",{type:!0,value:!0,name:!0,class:!0}),I=b(k),L=w(k,"P",{class:!0});var g=y(L);M=E(g,"Powered by Buttondown."),g.forEach(u),k.forEach(u),a.forEach(u),this.h()},h(){v(p,"class","svelte-1k1s1co"),v(m,"type","email"),v(m,"name","email"),v(m,"id","bd-email"),v(m,"aria-label","email address"),v(m,"placeholder","youremail@example.com"),v(m,"class","svelte-1k1s1co"),v(S,"type","submit"),S.value="Subscribe",S.disabled=x=!a[0],v(S,"class","svelte-1k1s1co"),v(d,"class","form-item svelte-1k1s1co"),v(P,"type","hidden"),P.value="1",v(P,"name","embed"),v(P,"class","svelte-1k1s1co"),v(L,"class","svelte-1k1s1co"),v(h,"action","https://buttondown.email/api/emails/embed-subscribe/lihautan"),v(h,"method","post"),v(h,"target","popupwindow"),v(h,"onsubmit","window.open('https://buttondown.email/lihautan', 'popupwindow')"),v(h,"class","embeddable-buttondown-form"),v(s,"class","form svelte-1k1s1co")},m(n,u){var k,f,g,v;l(n,s,u),i(s,t),i(t,e),i(s,o),i(s,p),i(p,c),i(s,r),i(s,h),i(h,d),i(d,m),A(m,a[0]),i(d,T),i(d,S),i(h,j),i(h,P),i(h,I),i(h,L),i(L,M),C||(k=m,f="input",g=a[1],k.addEventListener(f,g,v),N=()=>k.removeEventListener(f,g,v),C=!0)},p(n,[a]){1&a&&m.value!==n[0]&&A(m,n[0]),1&a&&x!==(x=!n[0])&&(S.disabled=x)},i:n,o:n,d(n){n&&u(s),C=!1,N()}}}function nn(n,a,s){let t;return[t,function(){t=this.value,s(0,t)}]}class an extends V{constructor(n){super(),K(this,n,nn,X,p,{})}}function sn(n){return I(()=>(setTimeout(()=>{if(window.innerWidth>1080){const n=document.createElement("script");n.async=!0,n.type="text/javascript",n.src="//cdn.carbonads.com/carbon.js?serve=CE7ITK3E&placement=lihautancom",n.id="_carbonads_js",document.body.appendChild(n)}},5e3),()=>{try{const n=document.getElementById("carbonads");n.parentNode.removeChild(n)}catch(n){}})),[]}class tn extends V{constructor(n){super(),K(this,n,sn,null,p,{})}}var en="https://lihautan.com/manipulating-ast-with-javascript/assets/hero-twitter-b36b194e.jpg";function on(n,a,s){const t=n.slice();return t[6]=a[s],t}function pn(n,a,s){const t=n.slice();return t[6]=a[s],t}function cn(n){let a,s;return{c(){a=k("meta"),this.h()},l(n){a=w(n,"META",{name:!0,content:!0}),this.h()},h(){v(a,"name","keywords"),v(a,"content",s=n[6])},m(n,s){l(n,a,s)},p(n,t){4&t&&s!==(s=n[6])&&v(a,"content",s)},d(n){n&&u(a)}}}function rn(n){let a,s,t=n[6]+"";return{c(){a=k("span"),s=f(t),this.h()},l(n){a=w(n,"SPAN",{class:!0});var e=y(a);s=E(e,t),e.forEach(u),this.h()},h(){v(a,"class","svelte-9tqnza")},m(n,t){l(n,a,t),i(a,s)},p(n,a){4&a&&t!==(t=n[6]+"")&&T(s,t)},d(n){n&&u(a)}}}function ln(n){let a,s,t,e,o,p,d,A,S,j,P,I,L,M,C,N,$,O,H,R,D,B,F,_,q,K,V,Q,X,nn,sn,ln,un,hn,kn,dn,fn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"Article",author:n[3],copyrightHolder:n[3],copyrightYear:"2020",creator:n[3],publisher:n[3],description:n[1],headline:n[0],name:n[0],inLanguage:"en"})}<\/script>`,gn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"BreadcrumbList",description:"Breadcrumbs list",name:"Breadcrumbs",itemListElement:[{"@type":"ListItem",item:{"@id":"https://lihautan.com",name:"Homepage"},name:"Homepage",position:1},{"@type":"ListItem",item:{"@id":"https%3A%2F%2Flihautan.com%2Fmanipulating-ast-with-javascript",name:n[0]},name:n[0],position:2}]})}<\/script>`;document.title=a=n[0]+" | Tan Li Hau";let mn=n[2],vn=[];for(let a=0;a<mn.length;a+=1)vn[a]=cn(pn(n,mn,a));F=new Z({});let yn=n[2],wn=[];for(let a=0;a<yn.length;a+=1)wn[a]=rn(on(n,yn,a));const En=n[5].default,bn=function(n,a,s,t){if(n){const e=c(n,a,s,t);return n[0](e)}}(En,n,n[4],null);return un=new an({}),kn=new tn({}),{c(){s=k("meta"),t=k("meta"),e=k("meta"),o=k("meta"),p=k("meta"),d=k("meta"),A=k("meta"),S=k("meta"),j=k("meta"),P=k("meta"),I=k("meta");for(let n=0;n<vn.length;n+=1)vn[n].c();L=k("meta"),M=k("meta"),N=m(),O=m(),H=g(),R=k("a"),D=f("Skip to content"),B=g(),U(F.$$.fragment),_=g(),q=k("main"),K=k("h1"),V=f(n[0]),Q=g();for(let n=0;n<wn.length;n+=1)wn[n].c();X=g(),nn=k("article"),bn&&bn.c(),sn=g(),ln=k("footer"),U(un.$$.fragment),hn=g(),U(kn.$$.fragment),this.h()},l(a){const c=function(n,a=document.body){return Array.from(a.querySelectorAll(n))}('[data-svelte="svelte-15e3uyc"]',document.head);s=w(c,"META",{name:!0,content:!0}),t=w(c,"META",{name:!0,content:!0}),e=w(c,"META",{name:!0,content:!0}),o=w(c,"META",{name:!0,content:!0}),p=w(c,"META",{name:!0,content:!0}),d=w(c,"META",{name:!0,content:!0}),A=w(c,"META",{name:!0,content:!0}),S=w(c,"META",{name:!0,content:!0}),j=w(c,"META",{name:!0,content:!0}),P=w(c,"META",{name:!0,content:!0}),I=w(c,"META",{name:!0,content:!0});for(let n=0;n<vn.length;n+=1)vn[n].l(c);L=w(c,"META",{itemprop:!0,content:!0}),M=w(c,"META",{itemprop:!0,content:!0}),N=m(),O=m(),c.forEach(u),H=b(a),R=w(a,"A",{href:!0,class:!0});var r=y(R);D=E(r,"Skip to content"),r.forEach(u),B=b(a),W(F.$$.fragment,a),_=b(a),q=w(a,"MAIN",{id:!0,class:!0});var i=y(q);K=w(i,"H1",{});var l=y(K);V=E(l,n[0]),l.forEach(u),Q=b(i);for(let n=0;n<wn.length;n+=1)wn[n].l(i);X=b(i),nn=w(i,"ARTICLE",{});var h=y(nn);bn&&bn.l(h),h.forEach(u),i.forEach(u),sn=b(a),ln=w(a,"FOOTER",{class:!0});var k=y(ln);W(un.$$.fragment,k),hn=b(k),W(kn.$$.fragment,k),k.forEach(u),this.h()},h(){v(s,"name","description"),v(s,"content",n[1]),v(t,"name","image"),v(t,"content",en),v(e,"name","og:image"),v(e,"content",en),v(o,"name","og:title"),v(o,"content",n[0]),v(p,"name","og:description"),v(p,"content",n[1]),v(d,"name","og:type"),v(d,"content","website"),v(A,"name","twitter:card"),v(A,"content","summary_large_image"),v(S,"name","twitter:creator"),v(S,"content","@lihautan"),v(j,"name","twitter:title"),v(j,"content",n[0]),v(P,"name","twitter:description"),v(P,"content",n[1]),v(I,"name","twitter:image"),v(I,"content",en),v(L,"itemprop","url"),v(L,"content","https%3A%2F%2Flihautan.com%2Fmanipulating-ast-with-javascript"),v(M,"itemprop","image"),v(M,"content",en),C=new x(N),$=new x(O),v(R,"href","#content"),v(R,"class","skip svelte-9tqnza"),v(q,"id","content"),v(q,"class","blog svelte-9tqnza"),v(ln,"class","svelte-9tqnza")},m(n,a){i(document.head,s),i(document.head,t),i(document.head,e),i(document.head,o),i(document.head,p),i(document.head,d),i(document.head,A),i(document.head,S),i(document.head,j),i(document.head,P),i(document.head,I);for(let n=0;n<vn.length;n+=1)vn[n].m(document.head,null);i(document.head,L),i(document.head,M),C.m(fn,document.head),i(document.head,N),$.m(gn,document.head),i(document.head,O),l(n,H,a),l(n,R,a),i(R,D),l(n,B,a),G(F,n,a),l(n,_,a),l(n,q,a),i(q,K),i(K,V),i(q,Q);for(let n=0;n<wn.length;n+=1)wn[n].m(q,null);i(q,X),i(q,nn),bn&&bn.m(nn,null),l(n,sn,a),l(n,ln,a),G(un,ln,null),i(ln,hn),G(kn,ln,null),dn=!0},p(n,[t]){if((!dn||1&t)&&a!==(a=n[0]+" | Tan Li Hau")&&(document.title=a),(!dn||2&t)&&v(s,"content",n[1]),(!dn||1&t)&&v(o,"content",n[0]),(!dn||2&t)&&v(p,"content",n[1]),(!dn||1&t)&&v(j,"content",n[0]),(!dn||2&t)&&v(P,"content",n[1]),4&t){let a;for(mn=n[2],a=0;a<mn.length;a+=1){const s=pn(n,mn,a);vn[a]?vn[a].p(s,t):(vn[a]=cn(s),vn[a].c(),vn[a].m(L.parentNode,L))}for(;a<vn.length;a+=1)vn[a].d(1);vn.length=mn.length}if((!dn||3&t)&&fn!==(fn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"Article",author:n[3],copyrightHolder:n[3],copyrightYear:"2020",creator:n[3],publisher:n[3],description:n[1],headline:n[0],name:n[0],inLanguage:"en"})}<\/script>`)&&C.p(fn),(!dn||1&t)&&gn!==(gn=`<script type="application/ld+json">${JSON.stringify({"@context":"https://schema.org","@type":"BreadcrumbList",description:"Breadcrumbs list",name:"Breadcrumbs",itemListElement:[{"@type":"ListItem",item:{"@id":"https://lihautan.com",name:"Homepage"},name:"Homepage",position:1},{"@type":"ListItem",item:{"@id":"https%3A%2F%2Flihautan.com%2Fmanipulating-ast-with-javascript",name:n[0]},name:n[0],position:2}]})}<\/script>`)&&$.p(gn),(!dn||1&t)&&T(V,n[0]),4&t){let a;for(yn=n[2],a=0;a<yn.length;a+=1){const s=on(n,yn,a);wn[a]?wn[a].p(s,t):(wn[a]=rn(s),wn[a].c(),wn[a].m(q,X))}for(;a<wn.length;a+=1)wn[a].d(1);wn.length=yn.length}bn&&bn.p&&16&t&&r(bn,En,n,n[4],t,null,null)},i(n){dn||(z(F.$$.fragment,n),z(bn,n),z(un.$$.fragment,n),z(kn.$$.fragment,n),dn=!0)},o(n){J(F.$$.fragment,n),J(bn,n),J(un.$$.fragment,n),J(kn.$$.fragment,n),dn=!1},d(n){u(s),u(t),u(e),u(o),u(p),u(d),u(A),u(S),u(j),u(P),u(I),h(vn,n),u(L),u(M),u(N),n&&C.d(),u(O),n&&$.d(),n&&u(H),n&&u(R),n&&u(B),Y(F,n),n&&u(_),n&&u(q),h(wn,n),bn&&bn.d(n),n&&u(sn),n&&u(ln),Y(un),Y(kn)}}}function un(n,a,s){let{title:t=""}=a,{description:e=""}=a,{tags:o=[]}=a;const p={"@type":"Person",name:"Tan Li Hau"};let{$$slots:c={},$$scope:r}=a;return n.$set=n=>{"title"in n&&s(0,t=n.title),"description"in n&&s(1,e=n.description),"tags"in n&&s(2,o=n.tags),"$$scope"in n&&s(4,r=n.$$scope)},[t,e,o,p,r,c]}class hn extends V{constructor(n){super(),K(this,n,un,ln,p,{title:0,description:1,tags:2})}}function kn(a){let s,t,e,o,p,c,r,h,d,m,T,A,x,j,P,I,L,M,C,N,$,O,H,R,D,B,F,_,z,J,U,W,G,Y,q,K,V,Q,Z,X,nn,an,sn,tn,en,on,pn,cn,rn,ln,un,hn,kn,dn,fn,gn,mn,vn,yn,wn,En,bn,Tn,An,Sn,xn,jn,Pn,In,Ln,Mn,Cn,Nn,$n,On,Hn,Rn,Dn,Bn,Fn,_n,zn,Jn,Un,Wn,Gn,Yn,qn,Kn,Vn,Qn,Zn,Xn,na,aa,sa,ta,ea,oa,pa,ca,ra,ia,la,ua,ha,ka,da,fa,ga,ma,va,ya,wa,Ea,ba,Ta,Aa,Sa,xa,ja,Pa,Ia,La,Ma,Ca,Na,$a,Oa,Ha,Ra,Da,Ba,Fa,_a,za,Ja,Ua,Wa,Ga,Ya,qa,Ka,Va,Qa,Za,Xa,ns,as,ss,ts,es,os,ps,cs,rs,is,ls,us,hs,ks,ds,fs,gs,ms,vs,ys,ws,Es,bs,Ts,As,Ss,xs,js,Ps,Is,Ls,Ms,Cs,Ns,$s,Os,Hs,Rs,Ds,Bs,Fs,_s,zs,Js,Us,Ws,Gs,Ys,qs,Ks,Vs,Qs,Zs,Xs,nt,at,st,tt,et,ot,pt,ct,rt,it,lt,ut,ht,kt,dt,ft,gt,mt,vt,yt,wt,Et,bt,Tt,At,St,xt,jt,Pt,It,Lt,Mt,Ct,Nt,$t,Ot,Ht,Rt,Dt,Bt,Ft,_t,zt,Jt,Ut,Wt,Gt,Yt,qt,Kt,Vt,Qt,Zt,Xt,ne,ae,se,te,ee,oe,pe,ce,re,ie,le,ue,he,ke,de,fe,ge,me,ve,ye,we,Ee,be,Te,Ae,Se,xe,je,Pe,Ie,Le,Me,Ce,Ne,$e,Oe,He,Re,De,Be,Fe,_e,ze,Je,Ue,We,Ge,Ye,qe,Ke,Ve,Qe,Ze,Xe,no,ao,so,to,eo,oo,po,co,ro,io,lo,uo,ho,ko,fo,go,mo,vo,yo,wo,Eo,bo,To,Ao,So,xo,jo,Po,Io,Lo,Mo,Co,No,$o,Oo,Ho,Ro,Do,Bo,Fo,_o,zo,Jo,Uo,Wo,Go,Yo,qo,Ko,Vo,Qo,Zo,Xo,np,ap,sp,tp,ep,op,pp,cp,rp,ip,lp,up,hp,kp,dp,fp,gp,mp,vp,yp,wp,Ep,bp,Tp,Ap,Sp,xp,jp,Pp,Ip,Lp,Mp,Cp,Np,$p,Op,Hp,Rp,Dp,Bp,Fp,_p,zp,Jp,Up,Wp,Gp,Yp,qp,Kp,Vp,Qp,Zp,Xp,nc,ac,sc,tc,ec,oc,pc,cc,rc,ic,lc,uc,hc,kc,dc,fc,gc,mc,vc,yc,wc,Ec,bc,Tc,Ac,Sc,xc,jc,Pc,Ic,Lc,Mc,Cc,Nc,$c,Oc,Hc,Rc,Dc,Bc,Fc,_c,zc,Jc,Uc,Wc,Gc,Yc,qc,Kc,Vc,Qc,Zc,Xc,nr,ar,sr,tr,er,or,pr,cr,rr,ir,lr,ur,hr,kr,dr,fr,gr,mr,vr,yr,wr,Er,br,Tr,Ar,Sr,xr,jr,Pr,Ir,Lr,Mr,Cr,Nr,$r,Or,Hr,Rr,Dr,Br,Fr,_r,zr,Jr,Ur,Wr,Gr,Yr,qr,Kr,Vr,Qr,Zr,Xr,ni,ai,si,ti,ei,oi,pi,ci,ri,ii,li,ui,hi,ki,di,fi,gi,mi,vi,yi,wi,Ei,bi,Ti,Ai,Si,xi,ji,Pi,Ii,Li,Mi,Ci,Ni,$i,Oi,Hi,Ri,Di,Bi,Fi,_i,zi,Ji,Ui,Wi,Gi,Yi,qi,Ki,Vi,Qi,Zi,Xi,nl,al,sl,tl,el,ol,pl,cl,rl,il,ll,ul,hl,kl,dl,fl,gl,ml,vl,yl,wl,El,bl,Tl,Al,Sl,xl,jl,Pl,Il,Ll,Ml,Cl,Nl,$l,Ol,Hl,Rl,Dl,Bl,Fl,_l,zl,Jl,Ul,Wl,Gl,Yl,ql,Kl,Vl,Ql,Zl,Xl,nu,au,su,tu,eu,ou,pu,cu,ru,iu,lu,uu,hu,ku,du,fu,gu,mu,vu,yu,wu,Eu,bu,Tu,Au,Su,xu,ju,Pu,Iu,Lu,Mu,Cu,Nu,$u,Ou,Hu,Ru,Du,Bu,Fu,_u,zu;return{c(){s=k("section"),t=k("ul"),e=k("li"),o=k("a"),p=f("The parsers"),c=k("li"),r=k("a"),h=f("Traversing an AST"),d=k("li"),m=k("a"),T=f("Manipulating AST"),A=k("ul"),x=k("li"),j=k("a"),P=f("Adding a node"),I=k("li"),L=k("a"),M=f("Replacing a node"),C=k("li"),N=k("a"),$=f("Removing a node"),O=k("li"),H=k("a"),R=f("Targeting a node"),D=k("li"),B=k("a"),F=f("Creating a node"),_=k("li"),z=k("a"),J=f("Summary"),U=k("li"),W=k("a"),G=f("Further Readings"),Y=g(),q=k("p"),K=f("Previously, I've talked about "),V=k("a"),Q=f("how to write a babel transformation"),Z=f(", and I went one step deeper into "),X=k("a"),nn=f("Babel"),an=f(", by "),sn=k("a"),tn=f("showing how you can create a custom JavaScript syntax"),en=f(", I demonstrated how Babel parses your code into AST, transforms it and generates back into code."),on=g(),pn=k("p"),cn=f("Armed with the knowledge and experience of playing the JavaScript AST with Babel, let's take a look at how we can generalize this knowledge into other languages as well."),rn=g(),ln=k("blockquote"),un=k("p"),hn=f('When I refer to "other languages", I am actually referring to popular frontend languages, for example: '),kn=k("a"),dn=f("JavaScript"),fn=f(", "),gn=k("a"),mn=f("TypeScript"),vn=f(", "),yn=k("a"),wn=f("Sass"),En=f(", "),bn=k("a"),Tn=f("CSS"),An=f(", "),Sn=k("a"),xn=f("HTML"),jn=f(", "),Pn=k("a"),In=f("markdown"),Ln=f("..."),Mn=g(),Cn=k("p"),Nn=f("Of course, it does not limit to just frontend languages. It's just that it's easier to find a parser for these languages written in JavaScript than other languages, say C++ or Java."),$n=g(),On=k("section"),Hn=k("h2"),Rn=k("a"),Dn=f("The parsers"),Bn=g(),Fn=k("p"),_n=f("Like how we use Babel to do parsing and generating JavaScript, there are other libraries out there to help us with parsing and generating our language."),zn=g(),Jn=k("p"),Un=f("One easy trick to find these libraries is through "),Wn=k("a"),Gn=f("https://astexplorer.net/"),Yn=f("."),qn=g(),Kn=k("p"),Vn=k("img"),Qn=g(),Zn=k("p"),Xn=f("After you choose a language, you would see a list of parsers you can use to parse your language. For example, if you choose "),na=k("strong"),aa=f("HTML"),sa=f(", there's "),ta=k("a"),ea=f("htmlparser2"),oa=f(", "),pa=k("a"),ca=f("hyntax"),ra=f(", "),ia=k("a"),la=f("parse5"),ua=f("... And when you choose one of the parsers, you can immediately see how the AST looks like on the right panel and the Github link to the parser on the top right."),ha=g(),ka=k("p"),da=k("picture"),fa=k("source"),ga=k("source"),ma=k("img"),va=g(),ya=k("p"),wa=f("Here is a un-exhaustive list of parsers, and it's "),Ea=k("code"),ba=f("parse"),Ta=f(" and "),Aa=k("code"),Sa=f("generate"),xa=f(" methods:"),ja=g(),Pa=k("div"),Ia=k("table"),La=k("thead"),Ma=k("tr"),Ca=k("th"),Na=f("Language"),$a=g(),Oa=k("th"),Ha=f("Parser"),Ra=g(),Da=k("th"),Ba=k("code"),Fa=f("parse"),_a=g(),za=k("th"),Ja=k("code"),Ua=f("generate"),Wa=g(),Ga=k("tbody"),Ya=k("tr"),qa=k("td"),Ka=f("HTML"),Va=g(),Qa=k("td"),Za=k("a"),Xa=f("parse5"),ns=g(),as=k("td"),ss=k("a"),ts=k("code"),es=f("parse5.parse(str)"),os=g(),ps=k("td"),cs=k("a"),rs=k("code"),is=f("parse5.serialize(ast)"),ls=g(),us=k("tr"),hs=k("td"),ks=f("Markdown"),ds=g(),fs=k("td"),gs=k("a"),ms=f("remark"),vs=g(),ys=k("td"),ws=k("a"),Es=k("code"),bs=f("unified().use(remarkParse)"),Ts=g(),As=k("td"),Ss=k("a"),xs=k("code"),js=f("unified().use(remarkStringify)"),Ps=g(),Is=k("tr"),Ls=k("td"),Ms=f("CSS"),Cs=g(),Ns=k("td"),$s=k("a"),Os=f("css-tree"),Hs=g(),Rs=k("td"),Ds=k("a"),Bs=k("code"),Fs=f("csstree.parse(str)"),_s=g(),zs=k("td"),Js=k("a"),Us=k("code"),Ws=f("csstree.generate(ast)"),Gs=g(),Ys=k("tr"),qs=k("td"),Ks=f("Sass"),Vs=g(),Qs=k("td"),Zs=k("a"),Xs=f("sast"),nt=g(),at=k("td"),st=k("a"),tt=k("code"),et=f("sast.parse(str)"),ot=g(),pt=k("td"),ct=k("a"),rt=k("code"),it=f("sast.stringify(ast)"),lt=g(),ut=k("tr"),ht=k("td"),kt=f("JavaScript"),dt=g(),ft=k("td"),gt=k("a"),mt=f("babel"),vt=g(),yt=k("td"),wt=k("a"),Et=k("code"),bt=f("babel.parse(str)"),Tt=g(),At=k("td"),St=k("a"),xt=k("code"),jt=f("babel.generate(ast)"),Pt=g(),It=k("tr"),Lt=k("td"),Mt=f("TypeScript"),Ct=g(),Nt=k("td"),$t=k("a"),Ot=f("TypeScript"),Ht=g(),Rt=k("td"),Dt=k("a"),Bt=k("code"),Ft=f("ts.createSourceFile(str)"),_t=g(),zt=k("td"),Jt=k("a"),Ut=k("code"),Wt=f("ts.createPrinter().printFile(ast)"),Gt=g(),Yt=k("p"),qt=f("As you can see most parsers provide both parsing and generating methods."),Kt=g(),Vt=k("p"),Qt=f("So in general, you can have the following as a template to write your code transformation code:"),Zt=g(),Xt=k("pre"),ne=g(),ae=k("p"),se=f("You can, of course, transforming AST of one language to AST of another language, for example: Sass ➡️ CSS, Markdown ➡️ HTML, and use the generator of another language to generate out the code."),te=g(),ee=k("pre"),oe=g(),pe=k("p"),ce=f("Now armed with this template, let's talk about the more "),re=k("em"),ie=f("magical"),le=f(" stuff, "),ue=k("em"),he=f("the transform function"),ke=f("."),de=g(),fe=k("section"),ge=k("h2"),me=k("a"),ve=f("Traversing an AST"),ye=g(),we=k("p"),Ee=f("As the name AST suggests, AST uses a tree data structure. To hone the skills of manipulating AST, we need to recall our long distant memory of "),be=k("em"),Te=f('"Algorithm 101"'),Ae=f(", the "),Se=k("strong"),xe=f("depth-first search (DFS)"),je=f(" tree traversal algorithm."),Pe=g(),Ie=k("p"),Le=k("a"),Me=f("Vaidehi Joshi"),Ce=f(" wrote an amazing article on "),Ne=k("a"),$e=f("demystifying Depth-First Search"),Oe=f(", I don't think I can explain any better, so if you want to recap on depth-first search, please go and read "),He=k("a"),Re=f("her article"),De=f(" before we continue."),Be=g(),Fe=k("p"),_e=f("Now you have a clearer idea of how depth-first search works, a depth-first search on an AST would look something like this:"),ze=g(),Je=k("pre"),Ue=g(),We=k("p"),Ge=f("We can then fill up the "),Ye=k("code"),qe=f("TODO"),Ke=f(" with our manipulation code."),Ve=g(),Qe=k("p"),Ze=f("If we find ourselves needing to do multiple traversals, with different AST manipulation, we would soon realize that mixing AST manipulation code with the traversal code is "),Xe=k("em"),no=f("not clean enough"),ao=f(". Naturally, you would realize "),so=k("em"),to=f("it is cleaner"),eo=f(" to pass in a callback function that gets called every time we visit a node:"),oo=g(),po=k("pre"),co=g(),ro=k("p"),io=f("The "),lo=k("code"),uo=f("visit"),ho=f(" function is now generic enough that you can use it for any AST:"),ko=g(),fo=k("pre"),go=g(),mo=k("p"),vo=f("Naturally, you would think that having the information of the parent node, and the key / index of the current node would be useful to have in the callback function:"),yo=g(),wo=k("pre"),Eo=g(),bo=k("p"),To=f("Now, we might think to ourselves, I dont want to get callback for every node visited, I just need callback for a certain node. You might be tempted to add a condition in the "),Ao=k("code"),So=f("visit"),xo=f(" function:"),jo=g(),Po=k("pre"),Io=g(),Lo=k("p"),Mo=f("But you think twice: "),Co=k("em"),No=f("what if someone else wants to use "),$o=k("code"),Oo=f("visit"),Ho=f(" but with a different condition for callback?"),Ro=g(),Do=k("p"),Bo=f("For most of the time, you want to callback only to a certain types of node. In that case, instead of passing in a callback function, you can pass in a map of node type to their respective callback functions:"),Fo=g(),_o=k("pre"),zo=g(),Jo=k("p"),Uo=f("At this point, you maybe realize, "),Wo=k("em"),Go=f("hey, this looks so much like one of those AST traversing libraries!"),Yo=f(" And yes, this is how they get implemented."),qo=g(),Ko=k("p"),Vo=f("Now we can traverse the AST, and find the node that we are interested in, so the next step is to manipulate them."),Qo=g(),Zo=k("section"),Xo=k("h2"),np=k("a"),ap=f("Manipulating AST"),sp=g(),tp=k("p"),ep=f("Manipulating the AST can be categorized into 3 different operations:"),op=g(),pp=k("ul"),cp=k("li"),rp=f("Adding a node"),ip=g(),lp=k("li"),up=f("Replacing a node"),hp=g(),kp=k("li"),dp=f("Removing a node"),fp=g(),gp=k("section"),mp=k("h3"),vp=k("a"),yp=f("Adding a node"),wp=g(),Ep=k("p"),bp=f("To add a node, you can assign it to a keyed property of your node:"),Tp=g(),Ap=k("pre"),Sp=g(),xp=k("p"),jp=f("or push the new node, if the keyed property is an array:"),Pp=g(),Ip=k("pre"),Lp=g(),Mp=k("p"),Cp=f("To add a node as a sibling, you may need to access the node's parent:"),Np=g(),$p=k("pre"),Op=g(),Hp=k("section"),Rp=k("h3"),Dp=k("a"),Bp=f("Replacing a node"),Fp=g(),_p=k("p"),zp=f("To replace the current node to another node, update the key property of the current node's parent:"),Jp=g(),Up=k("pre"),Wp=g(),Gp=k("p"),Yp=f("If the key property of the parent is an array:"),qp=g(),Kp=k("pre"),Vp=g(),Qp=k("section"),Zp=k("h3"),Xp=k("a"),nc=f("Removing a node"),ac=g(),sc=k("p"),tc=f("To remove the current node, delete the key property of the current node's parent:"),ec=g(),oc=k("pre"),pc=g(),cc=k("p"),rc=f("If the key property of the parent is an array:"),ic=g(),lc=k("pre"),uc=g(),hc=k("blockquote"),kc=k("p"),dc=f("The operations of "),fc=k("strong"),gc=f("adding"),mc=f(", "),vc=k("strong"),yc=f("replacing"),wc=f(", and "),Ec=k("strong"),bc=f("removing"),Tc=f(" nodes are so common that, they are usually implemented as a util function."),Ac=g(),Sc=k("p"),xc=f("However, there's "),jc=k("strong"),Pc=f("one important step"),Ic=f(" that I did not cover: after you mutate the node, you need to make sure that the traversal still works fine."),Lc=g(),Mc=k("p"),Cc=f("For a node that is a property of a key of its parent, adding, replacing and removing them are usually fine. Except for the replace operation, you might need to revisit the "),Nc=k("em"),$c=f('"current node"'),Oc=f(", which is the "),Hc=k("em"),Rc=f("new replacing node"),Dc=f("."),Bc=g(),Fc=k("p"),_c=f("However, for node that are in an array, you need to take special care to update the array index of the loop:"),zc=g(),Jc=k("pre"),Uc=g(),Wc=k("p"),Gc=f("But how do you know that the current node was removed?"),Yc=g(),qc=k("p"),Kc=f("Well, knowing when a node got removed is sometimes a secret that lies within the "),Vc=k("code"),Qc=f("remove"),Zc=f(" util function from the tree traversal library."),Xc=g(),nr=k("p"),ar=f("It could be as simple as setting a flag when you call "),sr=k("code"),tr=f("remove"),er=f(":"),or=g(),pr=k("pre"),cr=g(),rr=k("p"),ir=f("But sometimes, instead of having to import the "),lr=k("code"),ur=f("remove"),hr=f(" util from the tree traversal library, the "),kr=k("code"),dr=f("remove"),fr=f(" function is available in "),gr=k("code"),mr=f("this"),vr=f(" of the "),yr=k("code"),wr=f("visitCallback"),Er=f(":"),br=g(),Tr=k("pre"),Ar=g(),Sr=k("p"),xr=f("Now you learned the 3 basic operations of manipulating the AST, you maybe wonder how exactly is to use these basic operations to write a codemod or an AST transform plugin?"),jr=g(),Pr=k("p"),Ir=f("Well, in my "),Lr=k("a"),Mr=f("step-by-step guide"),Cr=f(", I've explained that, you can use AST explorer like "),Nr=k("a"),$r=f("http://astexplorer.net/"),Or=f(" or "),Hr=k("a"),Rr=f("Babel AST Explorer"),Dr=f(" to help you."),Br=g(),Fr=k("p"),_r=f("You need to:"),zr=g(),Jr=k("ul"),Ur=k("li"),Wr=k("strong"),Gr=f("Know how the part of the code you want to change look like in the AST"),Yr=f(", so you can target the specific type of the node, and"),qr=g(),Kr=k("li"),Vr=k("strong"),Qr=f("Know how does the final output you wish to see look like in the AST"),Zr=f(", so you know what nodes to create, update or remove."),Xr=g(),ni=k("p"),ai=f("So we are going to elaborate more on these 2 steps specifically."),si=g(),ti=k("section"),ei=k("h2"),oi=k("a"),pi=f("Targeting a node"),ci=g(),ri=k("p"),ii=f("Node targeting, most of the times, is just a lot of "),li=k("code"),ui=f("==="),hi=f("."),ki=g(),di=k("p"),fi=f("For example, if you want to target a "),gi=k("code"),mi=f("<figure>"),vi=f(" with a class "),yi=k("code"),wi=f("foo"),Ei=f(" that contains an "),bi=k("code"),Ti=f("<img>"),Ai=f(" and a "),Si=k("code"),xi=f("<figcaption>"),ji=f(" in "),Pi=k("a"),Ii=f("htmlparser2"),Li=f(":"),Mi=g(),Ci=k("pre"),Ni=g(),$i=k("p"),Oi=f("You need to check:"),Hi=g(),Ri=k("pre"),Di=g(),Bi=k("p"),Fi=f("To make it less verbose, we can refactor each check into reusable functions:"),_i=g(),zi=k("pre"),Ji=g(),Ui=k("section"),Wi=k("h2"),Gi=k("a"),Yi=f("Creating a node"),qi=g(),Ki=k("p"),Vi=f("There are a few ways you can create an AST node."),Qi=g(),Zi=k("p"),Xi=f("The simplest and crudest way is to "),nl=k("strong"),al=f("manually create the node object"),sl=f(". Most of the time, the node object is a JavaScript object. So you can just create them manually:"),tl=g(),el=k("pre"),ol=g(),pl=k("p"),cl=f("It may become unwieldy when creating large, complex AST nodes, so sometimes library decides to provide builder functions, like "),rl=k("a"),il=f("@babel/types"),ll=f(" to simplify node creation and provide default values:"),ul=g(),hl=k("pre"),kl=g(),dl=k("p"),fl=f("It looked more concise and tidier, but it is hard to comprehend and grasp what node it is creating."),gl=g(),ml=k("p"),vl=f("So, a better way of creating complex AST node, is to use the "),yl=k("code"),wl=f("parse"),El=f(" function + "),bl=k("code"),Tl=f("string"),Al=f(":"),Sl=g(),xl=k("pre"),jl=g(),Pl=k("p"),Il=f("For Babel, there's an amazing util called "),Ll=k("a"),Ml=f("@babel/template"),Cl=f(", where you can use "),Nl=k("a"),$l=f("template literals"),Ol=f(" to create AST node:"),Hl=g(),Rl=k("pre"),Dl=g(),Bl=k("section"),Fl=k("h2"),_l=k("a"),zl=f("Summary"),Jl=g(),Ul=k("p"),Wl=f("We've gone through:"),Gl=g(),Yl=k("ul"),ql=k("li"),Kl=f("How to traverse an AST, using depth-first search algorithm,"),Vl=g(),Ql=k("li"),Zl=f("The 3 basic AST manipulations, addition, replacement, and removal,"),Xl=g(),nu=k("li"),au=f("How to target a node in AST, and"),su=g(),tu=k("li"),eu=f("How to create an AST node"),ou=g(),pu=k("section"),cu=k("h2"),ru=k("a"),iu=f("Further Readings"),lu=g(),uu=k("p"),hu=k("a"),ku=f("Dinesh (@flexdinesh)"),du=g(),fu=k("a"),gu=f("tweeted"),mu=f(" his pocket collection of AST resources:"),vu=g(),yu=k("ul"),wu=k("li"),Eu=k("a"),bu=f("Code Transformation and Linting with ASTs"),Tu=g(),Au=k("li"),Su=k("a"),xu=f("Write your own code transform for fun and profit"),ju=g(),Pu=k("li"),Iu=k("a"),Lu=f("Understanding ASTs by Building Your Own Babel Plugin"),Mu=g(),Cu=k("li"),Nu=k("a"),$u=f("Writing your first Babel Plugin"),Ou=g(),Hu=k("li"),Ru=k("a"),Du=f("This is how I build Babel plug-ins"),Bu=g(),Fu=k("li"),_u=k("a"),zu=f("Writing My First Babel Plugin"),this.h()},l(n){s=w(n,"SECTION",{});var a=y(s);t=w(a,"UL",{class:!0,id:!0,role:!0,"aria-label":!0});var i=y(t);e=w(i,"LI",{});var l=y(e);o=w(l,"A",{href:!0});var k=y(o);p=E(k,"The parsers"),k.forEach(u),l.forEach(u),c=w(i,"LI",{});var f=y(c);r=w(f,"A",{href:!0});var g=y(r);h=E(g,"Traversing an AST"),g.forEach(u),f.forEach(u),d=w(i,"LI",{});var v=y(d);m=w(v,"A",{href:!0});var S=y(m);T=E(S,"Manipulating AST"),S.forEach(u),v.forEach(u),A=w(i,"UL",{});var Ju=y(A);x=w(Ju,"LI",{});var Uu=y(x);j=w(Uu,"A",{href:!0});var Wu=y(j);P=E(Wu,"Adding a node"),Wu.forEach(u),Uu.forEach(u),I=w(Ju,"LI",{});var Gu=y(I);L=w(Gu,"A",{href:!0});var Yu=y(L);M=E(Yu,"Replacing a node"),Yu.forEach(u),Gu.forEach(u),C=w(Ju,"LI",{});var qu=y(C);N=w(qu,"A",{href:!0});var Ku=y(N);$=E(Ku,"Removing a node"),Ku.forEach(u),qu.forEach(u),Ju.forEach(u),O=w(i,"LI",{});var Vu=y(O);H=w(Vu,"A",{href:!0});var Qu=y(H);R=E(Qu,"Targeting a node"),Qu.forEach(u),Vu.forEach(u),D=w(i,"LI",{});var Zu=y(D);B=w(Zu,"A",{href:!0});var Xu=y(B);F=E(Xu,"Creating a node"),Xu.forEach(u),Zu.forEach(u),_=w(i,"LI",{});var nh=y(_);z=w(nh,"A",{href:!0});var ah=y(z);J=E(ah,"Summary"),ah.forEach(u),nh.forEach(u),U=w(i,"LI",{});var sh=y(U);W=w(sh,"A",{href:!0});var th=y(W);G=E(th,"Further Readings"),th.forEach(u),sh.forEach(u),i.forEach(u),a.forEach(u),Y=b(n),q=w(n,"P",{});var eh=y(q);K=E(eh,"Previously, I've talked about "),V=w(eh,"A",{href:!0});var oh=y(V);Q=E(oh,"how to write a babel transformation"),oh.forEach(u),Z=E(eh,", and I went one step deeper into "),X=w(eh,"A",{href:!0,rel:!0});var ph=y(X);nn=E(ph,"Babel"),ph.forEach(u),an=E(eh,", by "),sn=w(eh,"A",{href:!0});var ch=y(sn);tn=E(ch,"showing how you can create a custom JavaScript syntax"),ch.forEach(u),en=E(eh,", I demonstrated how Babel parses your code into AST, transforms it and generates back into code."),eh.forEach(u),on=b(n),pn=w(n,"P",{});var rh=y(pn);cn=E(rh,"Armed with the knowledge and experience of playing the JavaScript AST with Babel, let's take a look at how we can generalize this knowledge into other languages as well."),rh.forEach(u),rn=b(n),ln=w(n,"BLOCKQUOTE",{});var ih=y(ln);un=w(ih,"P",{});var lh=y(un);hn=E(lh,'When I refer to "other languages", I am actually referring to popular frontend languages, for example: '),kn=w(lh,"A",{href:!0,rel:!0});var uh=y(kn);dn=E(uh,"JavaScript"),uh.forEach(u),fn=E(lh,", "),gn=w(lh,"A",{href:!0,rel:!0});var hh=y(gn);mn=E(hh,"TypeScript"),hh.forEach(u),vn=E(lh,", "),yn=w(lh,"A",{href:!0,rel:!0});var kh=y(yn);wn=E(kh,"Sass"),kh.forEach(u),En=E(lh,", "),bn=w(lh,"A",{href:!0,rel:!0});var dh=y(bn);Tn=E(dh,"CSS"),dh.forEach(u),An=E(lh,", "),Sn=w(lh,"A",{href:!0,rel:!0});var fh=y(Sn);xn=E(fh,"HTML"),fh.forEach(u),jn=E(lh,", "),Pn=w(lh,"A",{href:!0,rel:!0});var gh=y(Pn);In=E(gh,"markdown"),gh.forEach(u),Ln=E(lh,"..."),lh.forEach(u),Mn=b(ih),Cn=w(ih,"P",{});var mh=y(Cn);Nn=E(mh,"Of course, it does not limit to just frontend languages. It's just that it's easier to find a parser for these languages written in JavaScript than other languages, say C++ or Java."),mh.forEach(u),ih.forEach(u),$n=b(n),On=w(n,"SECTION",{});var vh=y(On);Hn=w(vh,"H2",{});var yh=y(Hn);Rn=w(yh,"A",{href:!0,id:!0});var wh=y(Rn);Dn=E(wh,"The parsers"),wh.forEach(u),yh.forEach(u),Bn=b(vh),Fn=w(vh,"P",{});var Eh=y(Fn);_n=E(Eh,"Like how we use Babel to do parsing and generating JavaScript, there are other libraries out there to help us with parsing and generating our language."),Eh.forEach(u),zn=b(vh),Jn=w(vh,"P",{});var bh=y(Jn);Un=E(bh,"One easy trick to find these libraries is through "),Wn=w(bh,"A",{href:!0,rel:!0});var Th=y(Wn);Gn=E(Th,"https://astexplorer.net/"),Th.forEach(u),Yn=E(bh,"."),bh.forEach(u),qn=b(vh),Kn=w(vh,"P",{});var Ah=y(Kn);Vn=w(Ah,"IMG",{title:!0,alt:!0,"data-src":!0,loading:!0}),Ah.forEach(u),Qn=b(vh),Zn=w(vh,"P",{});var Sh=y(Zn);Xn=E(Sh,"After you choose a language, you would see a list of parsers you can use to parse your language. For example, if you choose "),na=w(Sh,"STRONG",{});var xh=y(na);aa=E(xh,"HTML"),xh.forEach(u),sa=E(Sh,", there's "),ta=w(Sh,"A",{href:!0,rel:!0});var jh=y(ta);ea=E(jh,"htmlparser2"),jh.forEach(u),oa=E(Sh,", "),pa=w(Sh,"A",{href:!0,rel:!0});var Ph=y(pa);ca=E(Ph,"hyntax"),Ph.forEach(u),ra=E(Sh,", "),ia=w(Sh,"A",{href:!0,rel:!0});var Ih=y(ia);la=E(Ih,"parse5"),Ih.forEach(u),ua=E(Sh,"... And when you choose one of the parsers, you can immediately see how the AST looks like on the right panel and the Github link to the parser on the top right."),Sh.forEach(u),ha=b(vh),ka=w(vh,"P",{});var Lh=y(ka);da=w(Lh,"PICTURE",{});var Mh=y(da);fa=w(Mh,"SOURCE",{type:!0,srcset:!0}),ga=w(Mh,"SOURCE",{type:!0,srcset:!0}),ma=w(Mh,"IMG",{title:!0,alt:!0,"data-src":!0,loading:!0}),Mh.forEach(u),Lh.forEach(u),va=b(vh),ya=w(vh,"P",{});var Ch=y(ya);wa=E(Ch,"Here is a un-exhaustive list of parsers, and it's "),Ea=w(Ch,"CODE",{});var Nh=y(Ea);ba=E(Nh,"parse"),Nh.forEach(u),Ta=E(Ch," and "),Aa=w(Ch,"CODE",{});var $h=y(Aa);Sa=E($h,"generate"),$h.forEach(u),xa=E(Ch," methods:"),Ch.forEach(u),ja=b(vh),Pa=w(vh,"DIV",{style:!0});var Oh=y(Pa);Ia=w(Oh,"TABLE",{});var Hh=y(Ia);La=w(Hh,"THEAD",{});var Rh=y(La);Ma=w(Rh,"TR",{});var Dh=y(Ma);Ca=w(Dh,"TH",{});var Bh=y(Ca);Na=E(Bh,"Language"),Bh.forEach(u),$a=b(Dh),Oa=w(Dh,"TH",{});var Fh=y(Oa);Ha=E(Fh,"Parser"),Fh.forEach(u),Ra=b(Dh),Da=w(Dh,"TH",{});var _h=y(Da);Ba=w(_h,"CODE",{class:!0});var zh=y(Ba);Fa=E(zh,"parse"),zh.forEach(u),_h.forEach(u),_a=b(Dh),za=w(Dh,"TH",{});var Jh=y(za);Ja=w(Jh,"CODE",{class:!0});var Uh=y(Ja);Ua=E(Uh,"generate"),Uh.forEach(u),Jh.forEach(u),Dh.forEach(u),Rh.forEach(u),Wa=b(Hh),Ga=w(Hh,"TBODY",{});var Wh=y(Ga);Ya=w(Wh,"TR",{});var Gh=y(Ya);qa=w(Gh,"TD",{});var Yh=y(qa);Ka=E(Yh,"HTML"),Yh.forEach(u),Va=b(Gh),Qa=w(Gh,"TD",{});var qh=y(Qa);Za=w(qh,"A",{href:!0});var Kh=y(Za);Xa=E(Kh,"parse5"),Kh.forEach(u),qh.forEach(u),ns=b(Gh),as=w(Gh,"TD",{});var Vh=y(as);ss=w(Vh,"A",{href:!0});var Qh=y(ss);ts=w(Qh,"CODE",{class:!0});var Zh=y(ts);es=E(Zh,"parse5.parse(str)"),Zh.forEach(u),Qh.forEach(u),Vh.forEach(u),os=b(Gh),ps=w(Gh,"TD",{});var Xh=y(ps);cs=w(Xh,"A",{href:!0});var nk=y(cs);rs=w(nk,"CODE",{class:!0});var ak=y(rs);is=E(ak,"parse5.serialize(ast)"),ak.forEach(u),nk.forEach(u),Xh.forEach(u),Gh.forEach(u),ls=b(Wh),us=w(Wh,"TR",{});var sk=y(us);hs=w(sk,"TD",{});var tk=y(hs);ks=E(tk,"Markdown"),tk.forEach(u),ds=b(sk),fs=w(sk,"TD",{});var ek=y(fs);gs=w(ek,"A",{href:!0});var ok=y(gs);ms=E(ok,"remark"),ok.forEach(u),ek.forEach(u),vs=b(sk),ys=w(sk,"TD",{});var pk=y(ys);ws=w(pk,"A",{href:!0});var ck=y(ws);Es=w(ck,"CODE",{class:!0});var rk=y(Es);bs=E(rk,"unified().use(remarkParse)"),rk.forEach(u),ck.forEach(u),pk.forEach(u),Ts=b(sk),As=w(sk,"TD",{});var ik=y(As);Ss=w(ik,"A",{href:!0});var lk=y(Ss);xs=w(lk,"CODE",{class:!0});var uk=y(xs);js=E(uk,"unified().use(remarkStringify)"),uk.forEach(u),lk.forEach(u),ik.forEach(u),sk.forEach(u),Ps=b(Wh),Is=w(Wh,"TR",{});var hk=y(Is);Ls=w(hk,"TD",{});var kk=y(Ls);Ms=E(kk,"CSS"),kk.forEach(u),Cs=b(hk),Ns=w(hk,"TD",{});var dk=y(Ns);$s=w(dk,"A",{href:!0});var fk=y($s);Os=E(fk,"css-tree"),fk.forEach(u),dk.forEach(u),Hs=b(hk),Rs=w(hk,"TD",{});var gk=y(Rs);Ds=w(gk,"A",{href:!0});var mk=y(Ds);Bs=w(mk,"CODE",{class:!0});var vk=y(Bs);Fs=E(vk,"csstree.parse(str)"),vk.forEach(u),mk.forEach(u),gk.forEach(u),_s=b(hk),zs=w(hk,"TD",{});var yk=y(zs);Js=w(yk,"A",{href:!0});var wk=y(Js);Us=w(wk,"CODE",{class:!0});var Ek=y(Us);Ws=E(Ek,"csstree.generate(ast)"),Ek.forEach(u),wk.forEach(u),yk.forEach(u),hk.forEach(u),Gs=b(Wh),Ys=w(Wh,"TR",{});var bk=y(Ys);qs=w(bk,"TD",{});var Tk=y(qs);Ks=E(Tk,"Sass"),Tk.forEach(u),Vs=b(bk),Qs=w(bk,"TD",{});var Ak=y(Qs);Zs=w(Ak,"A",{href:!0});var Sk=y(Zs);Xs=E(Sk,"sast"),Sk.forEach(u),Ak.forEach(u),nt=b(bk),at=w(bk,"TD",{});var xk=y(at);st=w(xk,"A",{href:!0});var jk=y(st);tt=w(jk,"CODE",{class:!0});var Pk=y(tt);et=E(Pk,"sast.parse(str)"),Pk.forEach(u),jk.forEach(u),xk.forEach(u),ot=b(bk),pt=w(bk,"TD",{});var Ik=y(pt);ct=w(Ik,"A",{href:!0});var Lk=y(ct);rt=w(Lk,"CODE",{class:!0});var Mk=y(rt);it=E(Mk,"sast.stringify(ast)"),Mk.forEach(u),Lk.forEach(u),Ik.forEach(u),bk.forEach(u),lt=b(Wh),ut=w(Wh,"TR",{});var Ck=y(ut);ht=w(Ck,"TD",{});var Nk=y(ht);kt=E(Nk,"JavaScript"),Nk.forEach(u),dt=b(Ck),ft=w(Ck,"TD",{});var $k=y(ft);gt=w($k,"A",{href:!0});var Ok=y(gt);mt=E(Ok,"babel"),Ok.forEach(u),$k.forEach(u),vt=b(Ck),yt=w(Ck,"TD",{});var Hk=y(yt);wt=w(Hk,"A",{href:!0});var Rk=y(wt);Et=w(Rk,"CODE",{class:!0});var Dk=y(Et);bt=E(Dk,"babel.parse(str)"),Dk.forEach(u),Rk.forEach(u),Hk.forEach(u),Tt=b(Ck),At=w(Ck,"TD",{});var Bk=y(At);St=w(Bk,"A",{href:!0});var Fk=y(St);xt=w(Fk,"CODE",{class:!0});var _k=y(xt);jt=E(_k,"babel.generate(ast)"),_k.forEach(u),Fk.forEach(u),Bk.forEach(u),Ck.forEach(u),Pt=b(Wh),It=w(Wh,"TR",{});var zk=y(It);Lt=w(zk,"TD",{});var Jk=y(Lt);Mt=E(Jk,"TypeScript"),Jk.forEach(u),Ct=b(zk),Nt=w(zk,"TD",{});var Uk=y(Nt);$t=w(Uk,"A",{href:!0});var Wk=y($t);Ot=E(Wk,"TypeScript"),Wk.forEach(u),Uk.forEach(u),Ht=b(zk),Rt=w(zk,"TD",{});var Gk=y(Rt);Dt=w(Gk,"A",{href:!0});var Yk=y(Dt);Bt=w(Yk,"CODE",{class:!0});var qk=y(Bt);Ft=E(qk,"ts.createSourceFile(str)"),qk.forEach(u),Yk.forEach(u),Gk.forEach(u),_t=b(zk),zt=w(zk,"TD",{});var Kk=y(zt);Jt=w(Kk,"A",{href:!0});var Vk=y(Jt);Ut=w(Vk,"CODE",{class:!0});var Qk=y(Ut);Wt=E(Qk,"ts.createPrinter().printFile(ast)"),Qk.forEach(u),Vk.forEach(u),Kk.forEach(u),zk.forEach(u),Wh.forEach(u),Hh.forEach(u),Oh.forEach(u),Gt=b(vh),Yt=w(vh,"P",{});var Zk=y(Yt);qt=E(Zk,"As you can see most parsers provide both parsing and generating methods."),Zk.forEach(u),Kt=b(vh),Vt=w(vh,"P",{});var Xk=y(Vt);Qt=E(Xk,"So in general, you can have the following as a template to write your code transformation code:"),Xk.forEach(u),Zt=b(vh),Xt=w(vh,"PRE",{class:!0}),y(Xt).forEach(u),ne=b(vh),ae=w(vh,"P",{});var nd=y(ae);se=E(nd,"You can, of course, transforming AST of one language to AST of another language, for example: Sass ➡️ CSS, Markdown ➡️ HTML, and use the generator of another language to generate out the code."),nd.forEach(u),te=b(vh),ee=w(vh,"PRE",{class:!0}),y(ee).forEach(u),oe=b(vh),pe=w(vh,"P",{});var ad=y(pe);ce=E(ad,"Now armed with this template, let's talk about the more "),re=w(ad,"EM",{});var sd=y(re);ie=E(sd,"magical"),sd.forEach(u),le=E(ad," stuff, "),ue=w(ad,"EM",{});var td=y(ue);he=E(td,"the transform function"),td.forEach(u),ke=E(ad,"."),ad.forEach(u),vh.forEach(u),de=b(n),fe=w(n,"SECTION",{});var ed=y(fe);ge=w(ed,"H2",{});var od=y(ge);me=w(od,"A",{href:!0,id:!0});var pd=y(me);ve=E(pd,"Traversing an AST"),pd.forEach(u),od.forEach(u),ye=b(ed),we=w(ed,"P",{});var cd=y(we);Ee=E(cd,"As the name AST suggests, AST uses a tree data structure. To hone the skills of manipulating AST, we need to recall our long distant memory of "),be=w(cd,"EM",{});var rd=y(be);Te=E(rd,'"Algorithm 101"'),rd.forEach(u),Ae=E(cd,", the "),Se=w(cd,"STRONG",{});var id=y(Se);xe=E(id,"depth-first search (DFS)"),id.forEach(u),je=E(cd," tree traversal algorithm."),cd.forEach(u),Pe=b(ed),Ie=w(ed,"P",{});var ld=y(Ie);Le=w(ld,"A",{href:!0,rel:!0});var ud=y(Le);Me=E(ud,"Vaidehi Joshi"),ud.forEach(u),Ce=E(ld," wrote an amazing article on "),Ne=w(ld,"A",{href:!0,rel:!0});var hd=y(Ne);$e=E(hd,"demystifying Depth-First Search"),hd.forEach(u),Oe=E(ld,", I don't think I can explain any better, so if you want to recap on depth-first search, please go and read "),He=w(ld,"A",{href:!0,rel:!0});var kd=y(He);Re=E(kd,"her article"),kd.forEach(u),De=E(ld," before we continue."),ld.forEach(u),Be=b(ed),Fe=w(ed,"P",{});var dd=y(Fe);_e=E(dd,"Now you have a clearer idea of how depth-first search works, a depth-first search on an AST would look something like this:"),dd.forEach(u),ze=b(ed),Je=w(ed,"PRE",{class:!0}),y(Je).forEach(u),Ue=b(ed),We=w(ed,"P",{});var fd=y(We);Ge=E(fd,"We can then fill up the "),Ye=w(fd,"CODE",{});var gd=y(Ye);qe=E(gd,"TODO"),gd.forEach(u),Ke=E(fd," with our manipulation code."),fd.forEach(u),Ve=b(ed),Qe=w(ed,"P",{});var md=y(Qe);Ze=E(md,"If we find ourselves needing to do multiple traversals, with different AST manipulation, we would soon realize that mixing AST manipulation code with the traversal code is "),Xe=w(md,"EM",{});var vd=y(Xe);no=E(vd,"not clean enough"),vd.forEach(u),ao=E(md,". Naturally, you would realize "),so=w(md,"EM",{});var yd=y(so);to=E(yd,"it is cleaner"),yd.forEach(u),eo=E(md," to pass in a callback function that gets called every time we visit a node:"),md.forEach(u),oo=b(ed),po=w(ed,"PRE",{class:!0}),y(po).forEach(u),co=b(ed),ro=w(ed,"P",{});var wd=y(ro);io=E(wd,"The "),lo=w(wd,"CODE",{});var Ed=y(lo);uo=E(Ed,"visit"),Ed.forEach(u),ho=E(wd," function is now generic enough that you can use it for any AST:"),wd.forEach(u),ko=b(ed),fo=w(ed,"PRE",{class:!0}),y(fo).forEach(u),go=b(ed),mo=w(ed,"P",{});var bd=y(mo);vo=E(bd,"Naturally, you would think that having the information of the parent node, and the key / index of the current node would be useful to have in the callback function:"),bd.forEach(u),yo=b(ed),wo=w(ed,"PRE",{class:!0}),y(wo).forEach(u),Eo=b(ed),bo=w(ed,"P",{});var Td=y(bo);To=E(Td,"Now, we might think to ourselves, I dont want to get callback for every node visited, I just need callback for a certain node. You might be tempted to add a condition in the "),Ao=w(Td,"CODE",{});var Ad=y(Ao);So=E(Ad,"visit"),Ad.forEach(u),xo=E(Td," function:"),Td.forEach(u),jo=b(ed),Po=w(ed,"PRE",{class:!0}),y(Po).forEach(u),Io=b(ed),Lo=w(ed,"P",{});var Sd=y(Lo);Mo=E(Sd,"But you think twice: "),Co=w(Sd,"EM",{});var xd=y(Co);No=E(xd,"what if someone else wants to use "),$o=w(xd,"CODE",{});var jd=y($o);Oo=E(jd,"visit"),jd.forEach(u),Ho=E(xd," but with a different condition for callback?"),xd.forEach(u),Sd.forEach(u),Ro=b(ed),Do=w(ed,"P",{});var Pd=y(Do);Bo=E(Pd,"For most of the time, you want to callback only to a certain types of node. In that case, instead of passing in a callback function, you can pass in a map of node type to their respective callback functions:"),Pd.forEach(u),Fo=b(ed),_o=w(ed,"PRE",{class:!0}),y(_o).forEach(u),zo=b(ed),Jo=w(ed,"P",{});var Id=y(Jo);Uo=E(Id,"At this point, you maybe realize, "),Wo=w(Id,"EM",{});var Ld=y(Wo);Go=E(Ld,"hey, this looks so much like one of those AST traversing libraries!"),Ld.forEach(u),Yo=E(Id," And yes, this is how they get implemented."),Id.forEach(u),qo=b(ed),Ko=w(ed,"P",{});var Md=y(Ko);Vo=E(Md,"Now we can traverse the AST, and find the node that we are interested in, so the next step is to manipulate them."),Md.forEach(u),ed.forEach(u),Qo=b(n),Zo=w(n,"SECTION",{});var Cd=y(Zo);Xo=w(Cd,"H2",{});var Nd=y(Xo);np=w(Nd,"A",{href:!0,id:!0});var $d=y(np);ap=E($d,"Manipulating AST"),$d.forEach(u),Nd.forEach(u),sp=b(Cd),tp=w(Cd,"P",{});var Od=y(tp);ep=E(Od,"Manipulating the AST can be categorized into 3 different operations:"),Od.forEach(u),op=b(Cd),pp=w(Cd,"UL",{});var Hd=y(pp);cp=w(Hd,"LI",{});var Rd=y(cp);rp=E(Rd,"Adding a node"),Rd.forEach(u),ip=b(Hd),lp=w(Hd,"LI",{});var Dd=y(lp);up=E(Dd,"Replacing a node"),Dd.forEach(u),hp=b(Hd),kp=w(Hd,"LI",{});var Bd=y(kp);dp=E(Bd,"Removing a node"),Bd.forEach(u),Hd.forEach(u),Cd.forEach(u),fp=b(n),gp=w(n,"SECTION",{});var Fd=y(gp);mp=w(Fd,"H3",{});var _d=y(mp);vp=w(_d,"A",{href:!0,id:!0});var zd=y(vp);yp=E(zd,"Adding a node"),zd.forEach(u),_d.forEach(u),wp=b(Fd),Ep=w(Fd,"P",{});var Jd=y(Ep);bp=E(Jd,"To add a node, you can assign it to a keyed property of your node:"),Jd.forEach(u),Tp=b(Fd),Ap=w(Fd,"PRE",{class:!0}),y(Ap).forEach(u),Sp=b(Fd),xp=w(Fd,"P",{});var Ud=y(xp);jp=E(Ud,"or push the new node, if the keyed property is an array:"),Ud.forEach(u),Pp=b(Fd),Ip=w(Fd,"PRE",{class:!0}),y(Ip).forEach(u),Lp=b(Fd),Mp=w(Fd,"P",{});var Wd=y(Mp);Cp=E(Wd,"To add a node as a sibling, you may need to access the node's parent:"),Wd.forEach(u),Np=b(Fd),$p=w(Fd,"PRE",{class:!0}),y($p).forEach(u),Fd.forEach(u),Op=b(n),Hp=w(n,"SECTION",{});var Gd=y(Hp);Rp=w(Gd,"H3",{});var Yd=y(Rp);Dp=w(Yd,"A",{href:!0,id:!0});var qd=y(Dp);Bp=E(qd,"Replacing a node"),qd.forEach(u),Yd.forEach(u),Fp=b(Gd),_p=w(Gd,"P",{});var Kd=y(_p);zp=E(Kd,"To replace the current node to another node, update the key property of the current node's parent:"),Kd.forEach(u),Jp=b(Gd),Up=w(Gd,"PRE",{class:!0}),y(Up).forEach(u),Wp=b(Gd),Gp=w(Gd,"P",{});var Vd=y(Gp);Yp=E(Vd,"If the key property of the parent is an array:"),Vd.forEach(u),qp=b(Gd),Kp=w(Gd,"PRE",{class:!0}),y(Kp).forEach(u),Gd.forEach(u),Vp=b(n),Qp=w(n,"SECTION",{});var Qd=y(Qp);Zp=w(Qd,"H3",{});var Zd=y(Zp);Xp=w(Zd,"A",{href:!0,id:!0});var Xd=y(Xp);nc=E(Xd,"Removing a node"),Xd.forEach(u),Zd.forEach(u),ac=b(Qd),sc=w(Qd,"P",{});var nf=y(sc);tc=E(nf,"To remove the current node, delete the key property of the current node's parent:"),nf.forEach(u),ec=b(Qd),oc=w(Qd,"PRE",{class:!0}),y(oc).forEach(u),pc=b(Qd),cc=w(Qd,"P",{});var af=y(cc);rc=E(af,"If the key property of the parent is an array:"),af.forEach(u),ic=b(Qd),lc=w(Qd,"PRE",{class:!0}),y(lc).forEach(u),uc=b(Qd),hc=w(Qd,"BLOCKQUOTE",{});var sf=y(hc);kc=w(sf,"P",{});var tf=y(kc);dc=E(tf,"The operations of "),fc=w(tf,"STRONG",{});var ef=y(fc);gc=E(ef,"adding"),ef.forEach(u),mc=E(tf,", "),vc=w(tf,"STRONG",{});var of=y(vc);yc=E(of,"replacing"),of.forEach(u),wc=E(tf,", and "),Ec=w(tf,"STRONG",{});var pf=y(Ec);bc=E(pf,"removing"),pf.forEach(u),Tc=E(tf," nodes are so common that, they are usually implemented as a util function."),tf.forEach(u),sf.forEach(u),Ac=b(Qd),Sc=w(Qd,"P",{});var cf=y(Sc);xc=E(cf,"However, there's "),jc=w(cf,"STRONG",{});var rf=y(jc);Pc=E(rf,"one important step"),rf.forEach(u),Ic=E(cf," that I did not cover: after you mutate the node, you need to make sure that the traversal still works fine."),cf.forEach(u),Lc=b(Qd),Mc=w(Qd,"P",{});var lf=y(Mc);Cc=E(lf,"For a node that is a property of a key of its parent, adding, replacing and removing them are usually fine. Except for the replace operation, you might need to revisit the "),Nc=w(lf,"EM",{});var uf=y(Nc);$c=E(uf,'"current node"'),uf.forEach(u),Oc=E(lf,", which is the "),Hc=w(lf,"EM",{});var hf=y(Hc);Rc=E(hf,"new replacing node"),hf.forEach(u),Dc=E(lf,"."),lf.forEach(u),Bc=b(Qd),Fc=w(Qd,"P",{});var kf=y(Fc);_c=E(kf,"However, for node that are in an array, you need to take special care to update the array index of the loop:"),kf.forEach(u),zc=b(Qd),Jc=w(Qd,"PRE",{class:!0}),y(Jc).forEach(u),Uc=b(Qd),Wc=w(Qd,"P",{});var df=y(Wc);Gc=E(df,"But how do you know that the current node was removed?"),df.forEach(u),Yc=b(Qd),qc=w(Qd,"P",{});var ff=y(qc);Kc=E(ff,"Well, knowing when a node got removed is sometimes a secret that lies within the "),Vc=w(ff,"CODE",{});var gf=y(Vc);Qc=E(gf,"remove"),gf.forEach(u),Zc=E(ff," util function from the tree traversal library."),ff.forEach(u),Xc=b(Qd),nr=w(Qd,"P",{});var mf=y(nr);ar=E(mf,"It could be as simple as setting a flag when you call "),sr=w(mf,"CODE",{});var vf=y(sr);tr=E(vf,"remove"),vf.forEach(u),er=E(mf,":"),mf.forEach(u),or=b(Qd),pr=w(Qd,"PRE",{class:!0}),y(pr).forEach(u),cr=b(Qd),rr=w(Qd,"P",{});var yf=y(rr);ir=E(yf,"But sometimes, instead of having to import the "),lr=w(yf,"CODE",{});var wf=y(lr);ur=E(wf,"remove"),wf.forEach(u),hr=E(yf," util from the tree traversal library, the "),kr=w(yf,"CODE",{});var Ef=y(kr);dr=E(Ef,"remove"),Ef.forEach(u),fr=E(yf," function is available in "),gr=w(yf,"CODE",{});var bf=y(gr);mr=E(bf,"this"),bf.forEach(u),vr=E(yf," of the "),yr=w(yf,"CODE",{});var Tf=y(yr);wr=E(Tf,"visitCallback"),Tf.forEach(u),Er=E(yf,":"),yf.forEach(u),br=b(Qd),Tr=w(Qd,"PRE",{class:!0}),y(Tr).forEach(u),Ar=b(Qd),Sr=w(Qd,"P",{});var Af=y(Sr);xr=E(Af,"Now you learned the 3 basic operations of manipulating the AST, you maybe wonder how exactly is to use these basic operations to write a codemod or an AST transform plugin?"),Af.forEach(u),jr=b(Qd),Pr=w(Qd,"P",{});var Sf=y(Pr);Ir=E(Sf,"Well, in my "),Lr=w(Sf,"A",{href:!0});var xf=y(Lr);Mr=E(xf,"step-by-step guide"),xf.forEach(u),Cr=E(Sf,", I've explained that, you can use AST explorer like "),Nr=w(Sf,"A",{href:!0,rel:!0});var jf=y(Nr);$r=E(jf,"http://astexplorer.net/"),jf.forEach(u),Or=E(Sf," or "),Hr=w(Sf,"A",{href:!0,rel:!0});var Pf=y(Hr);Rr=E(Pf,"Babel AST Explorer"),Pf.forEach(u),Dr=E(Sf," to help you."),Sf.forEach(u),Br=b(Qd),Fr=w(Qd,"P",{});var If=y(Fr);_r=E(If,"You need to:"),If.forEach(u),zr=b(Qd),Jr=w(Qd,"UL",{});var Lf=y(Jr);Ur=w(Lf,"LI",{});var Mf=y(Ur);Wr=w(Mf,"STRONG",{});var Cf=y(Wr);Gr=E(Cf,"Know how the part of the code you want to change look like in the AST"),Cf.forEach(u),Yr=E(Mf,", so you can target the specific type of the node, and"),Mf.forEach(u),qr=b(Lf),Kr=w(Lf,"LI",{});var Nf=y(Kr);Vr=w(Nf,"STRONG",{});var $f=y(Vr);Qr=E($f,"Know how does the final output you wish to see look like in the AST"),$f.forEach(u),Zr=E(Nf,", so you know what nodes to create, update or remove."),Nf.forEach(u),Lf.forEach(u),Xr=b(Qd),ni=w(Qd,"P",{});var Of=y(ni);ai=E(Of,"So we are going to elaborate more on these 2 steps specifically."),Of.forEach(u),Qd.forEach(u),si=b(n),ti=w(n,"SECTION",{});var Hf=y(ti);ei=w(Hf,"H2",{});var Rf=y(ei);oi=w(Rf,"A",{href:!0,id:!0});var Df=y(oi);pi=E(Df,"Targeting a node"),Df.forEach(u),Rf.forEach(u),ci=b(Hf),ri=w(Hf,"P",{});var Bf=y(ri);ii=E(Bf,"Node targeting, most of the times, is just a lot of "),li=w(Bf,"CODE",{});var Ff=y(li);ui=E(Ff,"==="),Ff.forEach(u),hi=E(Bf,"."),Bf.forEach(u),ki=b(Hf),di=w(Hf,"P",{});var _f=y(di);fi=E(_f,"For example, if you want to target a "),gi=w(_f,"CODE",{});var zf=y(gi);mi=E(zf,"<figure>"),zf.forEach(u),vi=E(_f," with a class "),yi=w(_f,"CODE",{});var Jf=y(yi);wi=E(Jf,"foo"),Jf.forEach(u),Ei=E(_f," that contains an "),bi=w(_f,"CODE",{});var Uf=y(bi);Ti=E(Uf,"<img>"),Uf.forEach(u),Ai=E(_f," and a "),Si=w(_f,"CODE",{});var Wf=y(Si);xi=E(Wf,"<figcaption>"),Wf.forEach(u),ji=E(_f," in "),Pi=w(_f,"A",{href:!0,rel:!0});var Gf=y(Pi);Ii=E(Gf,"htmlparser2"),Gf.forEach(u),Li=E(_f,":"),_f.forEach(u),Mi=b(Hf),Ci=w(Hf,"PRE",{class:!0}),y(Ci).forEach(u),Ni=b(Hf),$i=w(Hf,"P",{});var Yf=y($i);Oi=E(Yf,"You need to check:"),Yf.forEach(u),Hi=b(Hf),Ri=w(Hf,"PRE",{class:!0}),y(Ri).forEach(u),Di=b(Hf),Bi=w(Hf,"P",{});var qf=y(Bi);Fi=E(qf,"To make it less verbose, we can refactor each check into reusable functions:"),qf.forEach(u),_i=b(Hf),zi=w(Hf,"PRE",{class:!0}),y(zi).forEach(u),Hf.forEach(u),Ji=b(n),Ui=w(n,"SECTION",{});var Kf=y(Ui);Wi=w(Kf,"H2",{});var Vf=y(Wi);Gi=w(Vf,"A",{href:!0,id:!0});var Qf=y(Gi);Yi=E(Qf,"Creating a node"),Qf.forEach(u),Vf.forEach(u),qi=b(Kf),Ki=w(Kf,"P",{});var Zf=y(Ki);Vi=E(Zf,"There are a few ways you can create an AST node."),Zf.forEach(u),Qi=b(Kf),Zi=w(Kf,"P",{});var Xf=y(Zi);Xi=E(Xf,"The simplest and crudest way is to "),nl=w(Xf,"STRONG",{});var ng=y(nl);al=E(ng,"manually create the node object"),ng.forEach(u),sl=E(Xf,". Most of the time, the node object is a JavaScript object. So you can just create them manually:"),Xf.forEach(u),tl=b(Kf),el=w(Kf,"PRE",{class:!0}),y(el).forEach(u),ol=b(Kf),pl=w(Kf,"P",{});var ag=y(pl);cl=E(ag,"It may become unwieldy when creating large, complex AST nodes, so sometimes library decides to provide builder functions, like "),rl=w(ag,"A",{href:!0,rel:!0});var sg=y(rl);il=E(sg,"@babel/types"),sg.forEach(u),ll=E(ag," to simplify node creation and provide default values:"),ag.forEach(u),ul=b(Kf),hl=w(Kf,"PRE",{class:!0}),y(hl).forEach(u),kl=b(Kf),dl=w(Kf,"P",{});var tg=y(dl);fl=E(tg,"It looked more concise and tidier, but it is hard to comprehend and grasp what node it is creating."),tg.forEach(u),gl=b(Kf),ml=w(Kf,"P",{});var eg=y(ml);vl=E(eg,"So, a better way of creating complex AST node, is to use the "),yl=w(eg,"CODE",{});var og=y(yl);wl=E(og,"parse"),og.forEach(u),El=E(eg," function + "),bl=w(eg,"CODE",{});var pg=y(bl);Tl=E(pg,"string"),pg.forEach(u),Al=E(eg,":"),eg.forEach(u),Sl=b(Kf),xl=w(Kf,"PRE",{class:!0}),y(xl).forEach(u),jl=b(Kf),Pl=w(Kf,"P",{});var cg=y(Pl);Il=E(cg,"For Babel, there's an amazing util called "),Ll=w(cg,"A",{href:!0,rel:!0});var rg=y(Ll);Ml=E(rg,"@babel/template"),rg.forEach(u),Cl=E(cg,", where you can use "),Nl=w(cg,"A",{href:!0,rel:!0});var ig=y(Nl);$l=E(ig,"template literals"),ig.forEach(u),Ol=E(cg," to create AST node:"),cg.forEach(u),Hl=b(Kf),Rl=w(Kf,"PRE",{class:!0}),y(Rl).forEach(u),Kf.forEach(u),Dl=b(n),Bl=w(n,"SECTION",{});var lg=y(Bl);Fl=w(lg,"H2",{});var ug=y(Fl);_l=w(ug,"A",{href:!0,id:!0});var hg=y(_l);zl=E(hg,"Summary"),hg.forEach(u),ug.forEach(u),Jl=b(lg),Ul=w(lg,"P",{});var kg=y(Ul);Wl=E(kg,"We've gone through:"),kg.forEach(u),Gl=b(lg),Yl=w(lg,"UL",{});var dg=y(Yl);ql=w(dg,"LI",{});var fg=y(ql);Kl=E(fg,"How to traverse an AST, using depth-first search algorithm,"),fg.forEach(u),Vl=b(dg),Ql=w(dg,"LI",{});var gg=y(Ql);Zl=E(gg,"The 3 basic AST manipulations, addition, replacement, and removal,"),gg.forEach(u),Xl=b(dg),nu=w(dg,"LI",{});var mg=y(nu);au=E(mg,"How to target a node in AST, and"),mg.forEach(u),su=b(dg),tu=w(dg,"LI",{});var vg=y(tu);eu=E(vg,"How to create an AST node"),vg.forEach(u),dg.forEach(u),lg.forEach(u),ou=b(n),pu=w(n,"SECTION",{});var yg=y(pu);cu=w(yg,"H2",{});var wg=y(cu);ru=w(wg,"A",{href:!0,id:!0});var Eg=y(ru);iu=E(Eg,"Further Readings"),Eg.forEach(u),wg.forEach(u),lu=b(yg),uu=w(yg,"P",{});var bg=y(uu);hu=w(bg,"A",{href:!0,rel:!0});var Tg=y(hu);ku=E(Tg,"Dinesh (@flexdinesh)"),Tg.forEach(u),du=b(bg),fu=w(bg,"A",{href:!0,rel:!0});var Ag=y(fu);gu=E(Ag,"tweeted"),Ag.forEach(u),mu=E(bg," his pocket collection of AST resources:"),bg.forEach(u),vu=b(yg),yu=w(yg,"UL",{});var Sg=y(yu);wu=w(Sg,"LI",{});var xg=y(wu);Eu=w(xg,"A",{href:!0,rel:!0});var jg=y(Eu);bu=E(jg,"Code Transformation and Linting with ASTs"),jg.forEach(u),xg.forEach(u),Tu=b(Sg),Au=w(Sg,"LI",{});var Pg=y(Au);Su=w(Pg,"A",{href:!0,rel:!0});var Ig=y(Su);xu=E(Ig,"Write your own code transform for fun and profit"),Ig.forEach(u),Pg.forEach(u),ju=b(Sg),Pu=w(Sg,"LI",{});var Lg=y(Pu);Iu=w(Lg,"A",{href:!0,rel:!0});var Mg=y(Iu);Lu=E(Mg,"Understanding ASTs by Building Your Own Babel Plugin"),Mg.forEach(u),Lg.forEach(u),Mu=b(Sg),Cu=w(Sg,"LI",{});var Cg=y(Cu);Nu=w(Cg,"A",{href:!0,rel:!0});var Ng=y(Nu);$u=E(Ng,"Writing your first Babel Plugin"),Ng.forEach(u),Cg.forEach(u),Ou=b(Sg),Hu=w(Sg,"LI",{});var $g=y(Hu);Ru=w($g,"A",{href:!0,rel:!0});var Og=y(Ru);Du=E(Og,"This is how I build Babel plug-ins"),Og.forEach(u),$g.forEach(u),Bu=b(Sg),Fu=w(Sg,"LI",{});var Hg=y(Fu);_u=w(Hg,"A",{href:!0,rel:!0});var Rg=y(_u);zu=E(Rg,"Writing My First Babel Plugin"),Rg.forEach(u),Hg.forEach(u),Sg.forEach(u),yg.forEach(u),this.h()},h(){v(o,"href","#the-parsers"),v(r,"href","#traversing-an-ast"),v(m,"href","#manipulating-ast"),v(j,"href","#adding-a-node"),v(L,"href","#replacing-a-node"),v(N,"href","#removing-a-node"),v(H,"href","#targeting-a-node"),v(B,"href","#creating-a-node"),v(z,"href","#summary"),v(W,"href","#further-readings"),v(t,"class","sitemap"),v(t,"id","sitemap"),v(t,"role","navigation"),v(t,"aria-label","Table of Contents"),v(V,"href","/step-by-step-guide-for-writing-a-babel-transformation"),v(X,"href","https://babeljs.io/"),v(X,"rel","nofollow"),v(sn,"href","/creating-custom-javascript-syntax-with-babel"),v(kn,"href","https://www.ecma-international.org/publications/standards/Ecma-262.htm"),v(kn,"rel","nofollow"),v(gn,"href","http://typescriptlang.org/"),v(gn,"rel","nofollow"),v(yn,"href","https://sass-lang.com/"),v(yn,"rel","nofollow"),v(bn,"href","https://www.w3.org/Style/CSS/"),v(bn,"rel","nofollow"),v(Sn,"href","https://www.w3.org/html/"),v(Sn,"rel","nofollow"),v(Pn,"href","https://en.wikipedia.org/wiki/Markdown"),v(Pn,"rel","nofollow"),v(Rn,"href","#the-parsers"),v(Rn,"id","the-parsers"),v(Wn,"href","https://astexplorer.net/"),v(Wn,"rel","nofollow"),v(Vn,"title","null"),v(Vn,"alt","ast explorer"),v(Vn,"data-src","b581a0310d989fe0.gif"),v(Vn,"loading","lazy"),v(ta,"href","https://github.com/fb55/htmlparser2"),v(ta,"rel","nofollow"),v(pa,"href","https://github.com/nik-garmash/hyntax"),v(pa,"rel","nofollow"),v(ia,"href","https://github.com/inikulin/parse5"),v(ia,"rel","nofollow"),v(fa,"type","image/webp"),v(fa,"srcset","25aa4cbe5d6607fb.webp"),v(ga,"type","image/jpeg"),v(ga,"srcset","25aa4cbe5d6607fb.png"),v(ma,"title","null"),v(ma,"alt","ast explorer"),v(ma,"data-src","25aa4cbe5d6607fb.png"),v(ma,"loading","lazy"),v(Ba,"class","language-text"),v(Ja,"class","language-text"),v(Za,"href","https://github.com/inikulin/parse5/tree/master/packages/parse5"),v(ts,"class","language-text"),v(ss,"href","https://github.com/inikulin/parse5/blob/master/packages/parse5/docs/index.md#parse"),v(rs,"class","language-text"),v(cs,"href","https://github.com/inikulin/parse5/blob/master/packages/parse5/docs/index.md#serialize"),v(gs,"href","https://github.com/remarkjs/remark"),v(Es,"class","language-text"),v(ws,"href","https://github.com/remarkjs/remark/tree/master/packages/remark-parse"),v(xs,"class","language-text"),v(Ss,"href","https://github.com/remarkjs/remark/tree/master/packages/remark-stringify"),v($s,"href","https://github.com/csstree/csstree"),v(Bs,"class","language-text"),v(Ds,"href","https://github.com/csstree/csstree/blob/master/docs/parsing.md"),v(Us,"class","language-text"),v(Js,"href","https://github.com/csstree/csstree/blob/master/docs/generate.md"),v(Zs,"href","https://github.com/shawnbot/sast"),v(tt,"class","language-text"),v(st,"href","https://github.com/shawnbot/sast#sastparsesource--options-"),v(rt,"class","language-text"),v(ct,"href","https://github.com/shawnbot/sast#saststringifynode-"),v(gt,"href","https://babeljs.io/"),v(Et,"class","language-text"),v(wt,"href","https://babeljs.io/docs/en/babel-parser#babelparserparsecode-options"),v(xt,"class","language-text"),v(St,"href","https://babeljs.io/docs/en/babel-generator"),v($t,"href","http://typescriptlang.org/"),v(Bt,"class","language-text"),v(Dt,"href","https://github.com/microsoft/TypeScript/wiki/Using-the-Compiler-API#creating-and-printing-a-typescript-ast"),v(Ut,"class","language-text"),v(Jt,"href","https://github.com/microsoft/TypeScript/wiki/Using-the-Compiler-API#creating-and-printing-a-typescript-ast"),S(Pa,"overflow","auto"),S(Pa,"margin-bottom","2em"),v(Xt,"class","language-js"),v(ee,"class","language-js"),v(me,"href","#traversing-an-ast"),v(me,"id","traversing-an-ast"),v(Le,"href","https://twitter.com/vaidehijoshi"),v(Le,"rel","nofollow"),v(Ne,"href","https://medium.com/basecs/demystifying-depth-first-search-a7c14cccf056"),v(Ne,"rel","nofollow"),v(He,"href","https://medium.com/basecs/demystifying-depth-first-search-a7c14cccf056"),v(He,"rel","nofollow"),v(Je,"class","language-js"),v(po,"class","language-js"),v(fo,"class","language-js"),v(wo,"class","language-js"),v(Po,"class","language-js"),v(_o,"class","language-js"),v(np,"href","#manipulating-ast"),v(np,"id","manipulating-ast"),v(vp,"href","#adding-a-node"),v(vp,"id","adding-a-node"),v(Ap,"class","language-js"),v(Ip,"class","language-js"),v($p,"class","language-js"),v(Dp,"href","#replacing-a-node"),v(Dp,"id","replacing-a-node"),v(Up,"class","language-js"),v(Kp,"class","language-js"),v(Xp,"href","#removing-a-node"),v(Xp,"id","removing-a-node"),v(oc,"class","language-js"),v(lc,"class","language-js"),v(Jc,"class","language-js"),v(pr,"class","language-js"),v(Tr,"class","language-js"),v(Lr,"href","/step-by-step-guide-for-writing-a-babel-transformation"),v(Nr,"href","http://astexplorer.net/"),v(Nr,"rel","nofollow"),v(Hr,"href","https://lihautan.com/babel-ast-explorer"),v(Hr,"rel","nofollow"),v(oi,"href","#targeting-a-node"),v(oi,"id","targeting-a-node"),v(Pi,"href","https://github.com/fb55/htmlparser2"),v(Pi,"rel","nofollow"),v(Ci,"class","language-html"),v(Ri,"class","language-js"),v(zi,"class","language-js"),v(Gi,"href","#creating-a-node"),v(Gi,"id","creating-a-node"),v(el,"class","language-js"),v(rl,"href","https://babeljs.io/docs/en/babel-types"),v(rl,"rel","nofollow"),v(hl,"class","language-js"),v(xl,"class","language-js"),v(Ll,"href","https://babeljs.io/docs/en/babel-template"),v(Ll,"rel","nofollow"),v(Nl,"href","https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals"),v(Nl,"rel","nofollow"),v(Rl,"class","language-js"),v(_l,"href","#summary"),v(_l,"id","summary"),v(ru,"href","#further-readings"),v(ru,"id","further-readings"),v(hu,"href","https://twitter.com/flexdinesh"),v(hu,"rel","nofollow"),v(fu,"href","https://twitter.com/flexdinesh/status/1196680010343432192"),v(fu,"rel","nofollow"),v(Eu,"href","https://frontendmasters.com/courses/linting-asts/"),v(Eu,"rel","nofollow"),v(Su,"href","https://kentcdodds.com/blog/write-your-own-code-transform/"),v(Su,"rel","nofollow"),v(Iu,"href","https://www.sitepoint.com/understanding-asts-building-babel-plugin/"),v(Iu,"rel","nofollow"),v(Nu,"href","https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md#toc-writing-your-first-babel-plugin"),v(Nu,"rel","nofollow"),v(Ru,"href","https://medium.com/the-guild/this-is-how-i-build-babel-plug-ins-b0a13dcd0352"),v(Ru,"rel","nofollow"),v(_u,"href","https://varunzxzx.github.io/blog/writing-babel-plugin"),v(_u,"rel","nofollow")},m(n,a){l(n,s,a),i(s,t),i(t,e),i(e,o),i(o,p),i(t,c),i(c,r),i(r,h),i(t,d),i(d,m),i(m,T),i(t,A),i(A,x),i(x,j),i(j,P),i(A,I),i(I,L),i(L,M),i(A,C),i(C,N),i(N,$),i(t,O),i(O,H),i(H,R),i(t,D),i(D,B),i(B,F),i(t,_),i(_,z),i(z,J),i(t,U),i(U,W),i(W,G),l(n,Y,a),l(n,q,a),i(q,K),i(q,V),i(V,Q),i(q,Z),i(q,X),i(X,nn),i(q,an),i(q,sn),i(sn,tn),i(q,en),l(n,on,a),l(n,pn,a),i(pn,cn),l(n,rn,a),l(n,ln,a),i(ln,un),i(un,hn),i(un,kn),i(kn,dn),i(un,fn),i(un,gn),i(gn,mn),i(un,vn),i(un,yn),i(yn,wn),i(un,En),i(un,bn),i(bn,Tn),i(un,An),i(un,Sn),i(Sn,xn),i(un,jn),i(un,Pn),i(Pn,In),i(un,Ln),i(ln,Mn),i(ln,Cn),i(Cn,Nn),l(n,$n,a),l(n,On,a),i(On,Hn),i(Hn,Rn),i(Rn,Dn),i(On,Bn),i(On,Fn),i(Fn,_n),i(On,zn),i(On,Jn),i(Jn,Un),i(Jn,Wn),i(Wn,Gn),i(Jn,Yn),i(On,qn),i(On,Kn),i(Kn,Vn),i(On,Qn),i(On,Zn),i(Zn,Xn),i(Zn,na),i(na,aa),i(Zn,sa),i(Zn,ta),i(ta,ea),i(Zn,oa),i(Zn,pa),i(pa,ca),i(Zn,ra),i(Zn,ia),i(ia,la),i(Zn,ua),i(On,ha),i(On,ka),i(ka,da),i(da,fa),i(da,ga),i(da,ma),i(On,va),i(On,ya),i(ya,wa),i(ya,Ea),i(Ea,ba),i(ya,Ta),i(ya,Aa),i(Aa,Sa),i(ya,xa),i(On,ja),i(On,Pa),i(Pa,Ia),i(Ia,La),i(La,Ma),i(Ma,Ca),i(Ca,Na),i(Ma,$a),i(Ma,Oa),i(Oa,Ha),i(Ma,Ra),i(Ma,Da),i(Da,Ba),i(Ba,Fa),i(Ma,_a),i(Ma,za),i(za,Ja),i(Ja,Ua),i(Ia,Wa),i(Ia,Ga),i(Ga,Ya),i(Ya,qa),i(qa,Ka),i(Ya,Va),i(Ya,Qa),i(Qa,Za),i(Za,Xa),i(Ya,ns),i(Ya,as),i(as,ss),i(ss,ts),i(ts,es),i(Ya,os),i(Ya,ps),i(ps,cs),i(cs,rs),i(rs,is),i(Ga,ls),i(Ga,us),i(us,hs),i(hs,ks),i(us,ds),i(us,fs),i(fs,gs),i(gs,ms),i(us,vs),i(us,ys),i(ys,ws),i(ws,Es),i(Es,bs),i(us,Ts),i(us,As),i(As,Ss),i(Ss,xs),i(xs,js),i(Ga,Ps),i(Ga,Is),i(Is,Ls),i(Ls,Ms),i(Is,Cs),i(Is,Ns),i(Ns,$s),i($s,Os),i(Is,Hs),i(Is,Rs),i(Rs,Ds),i(Ds,Bs),i(Bs,Fs),i(Is,_s),i(Is,zs),i(zs,Js),i(Js,Us),i(Us,Ws),i(Ga,Gs),i(Ga,Ys),i(Ys,qs),i(qs,Ks),i(Ys,Vs),i(Ys,Qs),i(Qs,Zs),i(Zs,Xs),i(Ys,nt),i(Ys,at),i(at,st),i(st,tt),i(tt,et),i(Ys,ot),i(Ys,pt),i(pt,ct),i(ct,rt),i(rt,it),i(Ga,lt),i(Ga,ut),i(ut,ht),i(ht,kt),i(ut,dt),i(ut,ft),i(ft,gt),i(gt,mt),i(ut,vt),i(ut,yt),i(yt,wt),i(wt,Et),i(Et,bt),i(ut,Tt),i(ut,At),i(At,St),i(St,xt),i(xt,jt),i(Ga,Pt),i(Ga,It),i(It,Lt),i(Lt,Mt),i(It,Ct),i(It,Nt),i(Nt,$t),i($t,Ot),i(It,Ht),i(It,Rt),i(Rt,Dt),i(Dt,Bt),i(Bt,Ft),i(It,_t),i(It,zt),i(zt,Jt),i(Jt,Ut),i(Ut,Wt),i(On,Gt),i(On,Yt),i(Yt,qt),i(On,Kt),i(On,Vt),i(Vt,Qt),i(On,Zt),i(On,Xt),Xt.innerHTML='<code class="language-js"><span class="token keyword">const</span> code <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">\'/file/to/code\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parserMethod</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// the magical transform function</span>\n<span class="token comment">// usually not a pure function</span>\n<span class="token function">transform</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token function">generatorMethod</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>\nfs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">\'/file/to/output\'</span><span class="token punctuation">,</span> output<span class="token punctuation">,</span> <span class="token string">\'utf8\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>',i(On,ne),i(On,ae),i(ae,se),i(On,te),i(On,ee),ee.innerHTML='<code class="language-js"><span class="token keyword">const</span> lang1 <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">\'/file/to/code\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parserMethodLang1</span><span class="token punctuation">(</span>lang1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// the magical transform function</span>\n<span class="token comment">// usually not a pure function</span>\n<span class="token function">transformLang1ToLang2</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> lang2 <span class="token operator">=</span> <span class="token function">generatorMethodLang2</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>\nfs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">\'/file/to/output\'</span><span class="token punctuation">,</span> lang2<span class="token punctuation">,</span> <span class="token string">\'utf8\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>',i(On,oe),i(On,pe),i(pe,ce),i(pe,re),i(re,ie),i(pe,le),i(pe,ue),i(ue,he),i(pe,ke),l(n,de,a),l(n,fe,a),i(fe,ge),i(ge,me),i(me,ve),i(fe,ye),i(fe,we),i(we,Ee),i(we,be),i(be,Te),i(we,Ae),i(we,Se),i(Se,xe),i(we,je),i(fe,Pe),i(fe,Ie),i(Ie,Le),i(Le,Me),i(Ie,Ce),i(Ie,Ne),i(Ne,$e),i(Ie,Oe),i(Ie,He),i(He,Re),i(Ie,De),i(fe,Be),i(fe,Fe),i(Fe,_e),i(fe,ze),i(fe,Je),Je.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token parameter">ast</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// TODO: do something with this node</span>\n\n  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">const</span> child <span class="token operator">=</span> ast<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// could be an array of nodes or just a node</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> child<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n        <span class="token function">visit</span><span class="token punctuation">(</span>child<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">&#125;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNode</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token function">visit</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token keyword">function</span> <span class="token function">isNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// probably need more check,</span>\n  <span class="token comment">// for example,</span>\n  <span class="token comment">// if the node contains certain properties</span>\n  <span class="token keyword">return</span> <span class="token keyword">typeof</span> node <span class="token operator">===</span> <span class="token string">\'object\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(fe,Ue),i(fe,We),i(We,Ge),i(We,Ye),i(Ye,qe),i(We,Ke),i(fe,Ve),i(fe,Qe),i(Qe,Ze),i(Qe,Xe),i(Xe,no),i(Qe,ao),i(Qe,so),i(so,to),i(Qe,eo),i(fe,oo),i(fe,po),po.innerHTML='<code class="language-js"><span class="prism-highlight-code-line"><span class="token keyword">function</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token parameter">ast<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">  <span class="token function">callback</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n\n  <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">const</span> child <span class="token operator">=</span> ast<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> child<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">        <span class="token function">visit</span><span class="token punctuation">(</span>child<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n      <span class="token punctuation">&#125;</span>\n    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNode</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">      <span class="token function">visit</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token keyword">function</span> <span class="token function">isNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// probably need more check,</span>\n  <span class="token comment">// for example,</span>\n  <span class="token comment">// if the node contains certain properties</span>\n  <span class="token keyword">return</span> <span class="token keyword">typeof</span> node <span class="token operator">===</span> <span class="token string">\'object\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(fe,co),i(fe,ro),i(ro,io),i(ro,lo),i(lo,uo),i(ro,ho),i(fe,ko),i(fe,fo),fo.innerHTML='<code class="language-js"><span class="token function">visit</span><span class="token punctuation">(</span>htmlAst<span class="token punctuation">,</span> <span class="token parameter">htmlAstNode</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">/*...*/</span>\n<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">visit</span><span class="token punctuation">(</span>cssAst<span class="token punctuation">,</span> <span class="token parameter">cssAstNode</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">/*...*/</span>\n<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>',i(fe,go),i(fe,mo),i(mo,vo),i(fe,yo),i(fe,wo),wo.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token parameter">ast<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token keyword">function</span> <span class="token function">_visit</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">    <span class="token function">callback</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n\n    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">const</span> child <span class="token operator">=</span> node<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> child<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">          <span class="token function">_visit</span><span class="token punctuation">(</span>child<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n        <span class="token punctuation">&#125;</span>\n      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNode</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">        <span class="token function">_visit</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> node<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n      <span class="token punctuation">&#125;</span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="prism-highlight-code-line">  <span class="token function">_visit</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token punctuation">&#125;</span></code>',i(fe,Eo),i(fe,bo),i(bo,To),i(bo,Ao),i(Ao,So),i(bo,xo),i(fe,jo),i(fe,Po),Po.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token parameter">ast<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">function</span> <span class="token function">_visit</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">someCondition</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n      <span class="token function">callback</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n    <span class="token operator">...</span></code>',i(fe,Io),i(fe,Lo),i(Lo,Mo),i(Lo,Co),i(Co,No),i(Co,$o),i($o,Oo),i(Co,Ho),i(fe,Ro),i(fe,Do),i(Do,Bo),i(fe,Fo),i(fe,_o),_o.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token parameter">ast<span class="token punctuation">,</span> callbackMap</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">function</span> <span class="token function">_visit</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">    <span class="token keyword">const</span> nodeType <span class="token operator">=</span> <span class="token function">getNodeType</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeType <span class="token keyword">in</span> callbackMap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">      callbackMap<span class="token punctuation">[</span>nodeType<span class="token punctuation">]</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">&#125;</span></span>\n    <span class="token operator">...</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token function">visit</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>\n  <span class="token function">Identifier</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// do something</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code>',i(fe,zo),i(fe,Jo),i(Jo,Uo),i(Jo,Wo),i(Wo,Go),i(Jo,Yo),i(fe,qo),i(fe,Ko),i(Ko,Vo),l(n,Qo,a),l(n,Zo,a),i(Zo,Xo),i(Xo,np),i(np,ap),i(Zo,sp),i(Zo,tp),i(tp,ep),i(Zo,op),i(Zo,pp),i(pp,cp),i(cp,rp),i(pp,ip),i(pp,lp),i(lp,up),i(pp,hp),i(pp,kp),i(kp,dp),l(n,fp,a),l(n,gp,a),i(gp,mp),i(mp,vp),i(vp,yp),i(gp,wp),i(gp,Ep),i(Ep,bp),i(gp,Tp),i(gp,Ap),Ap.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visitCallback</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  node<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token function">createNewNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(gp,Sp),i(gp,xp),i(xp,jp),i(gp,Pp),i(gp,Ip),Ip.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visitCallback</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  node<span class="token punctuation">.</span>foo<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">createNewNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(gp,Lp),i(gp,Mp),i(Mp,Cp),i(gp,Np),i(gp,$p),$p.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visitCallback</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token comment">// add as first sibling</span>\n  parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token function">createNewNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// add as last sibling</span>\n  parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">createNewNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// add as next sibling</span>\n  parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">createNewNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// add as prev sibling</span>\n  parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">createNewNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',l(n,Op,a),l(n,Hp,a),i(Hp,Rp),i(Rp,Dp),i(Dp,Bp),i(Hp,Fp),i(Hp,_p),i(_p,zp),i(Hp,Jp),i(Hp,Up),Up.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visitCallback</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">updatedNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(Hp,Wp),i(Hp,Gp),i(Gp,Yp),i(Hp,qp),i(Hp,Kp),Kp.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visitCallback</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">updatedNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',l(n,Vp,a),l(n,Qp,a),i(Qp,Zp),i(Zp,Xp),i(Xp,nc),i(Qp,ac),i(Qp,sc),i(sc,tc),i(Qp,ec),i(Qp,oc),oc.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visitCallback</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">delete</span> parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(Qp,pc),i(Qp,cc),i(cc,rc),i(Qp,ic),i(Qp,lc),lc.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visitCallback</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  parent<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',i(Qp,uc),i(Qp,hc),i(hc,kc),i(kc,dc),i(kc,fc),i(fc,gc),i(kc,mc),i(kc,vc),i(vc,yc),i(kc,wc),i(kc,Ec),i(Ec,bc),i(kc,Tc),i(Qp,Ac),i(Qp,Sc),i(Sc,xc),i(Sc,jc),i(jc,Pc),i(Sc,Ic),i(Qp,Lc),i(Qp,Mc),i(Mc,Cc),i(Mc,Nc),i(Nc,$c),i(Mc,Oc),i(Mc,Hc),i(Hc,Rc),i(Mc,Dc),i(Qp,Bc),i(Qp,Fc),i(Fc,_c),i(Qp,zc),i(Qp,Jc),Jc.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token parameter">ast<span class="token punctuation">,</span> callbackMap</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">function</span> <span class="token function">_visit</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// ...</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> child<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n        <span class="token function">_visit</span><span class="token punctuation">(</span>child<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="prism-highlight-code-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasRemoved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">          <span class="token comment">// offset the index</span></span>\n<span class="prism-highlight-code-line">          j<span class="token operator">--</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">        <span class="token punctuation">&#125;</span></span>\n      <span class="token punctuation">&#125;</span>\n    <span class="token punctuation">&#125;</span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',i(Qp,Uc),i(Qp,Wc),i(Wc,Gc),i(Qp,Yc),i(Qp,qc),i(qc,Kc),i(qc,Vc),i(Vc,Qc),i(qc,Zc),i(Qp,Xc),i(Qp,nr),i(nr,ar),i(nr,sr),i(sr,tr),i(nr,er),i(Qp,or),i(Qp,pr),pr.innerHTML='<code class="language-js"><span class="prism-highlight-code-line"><span class="token keyword">let</span> _hasRemoved <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line"><span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">  _hasRemoved <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">  <span class="token comment">// proceed to remove current node</span></span>\n<span class="prism-highlight-code-line"><span class="token punctuation">&#125;</span></span>\n<span class="prism-highlight-code-line"><span class="token keyword">function</span> <span class="token function">hasRemoved</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">  <span class="token keyword">let</span> result <span class="token operator">=</span> _hasRemoved<span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">  <span class="token comment">// reset back</span></span>\n<span class="prism-highlight-code-line">  _hasRemoved <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">  <span class="token keyword">return</span> result<span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line"><span class="token punctuation">&#125;</span></span>\n\n<span class="token comment">// function _visit(...) &#123; ...</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> child<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token function">_visit</span><span class="token punctuation">(</span>child<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="prism-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasRemoved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token comment">// ...somewhere in your visitCallback</span>\n<span class="token keyword">function</span> <span class="token function">visitCallback</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token function">remove</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token punctuation">&#125;</span></code>',i(Qp,cr),i(Qp,rr),i(rr,ir),i(rr,lr),i(lr,ur),i(rr,hr),i(rr,kr),i(kr,dr),i(rr,fr),i(rr,gr),i(gr,mr),i(rr,vr),i(rr,yr),i(yr,wr),i(rr,Er),i(Qp,br),i(Qp,Tr),Tr.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token parameter">ast<span class="token punctuation">,</span> callbackMap</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">function</span> <span class="token function">_visit</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">    <span class="token keyword">let</span> _hasRemoved <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">      <span class="token comment">// don\'t need to take in &#96;node&#96; and &#96;parent&#96;,</span></span>\n<span class="prism-highlight-code-line">      <span class="token comment">// because it know exactly what they are</span></span>\n<span class="prism-highlight-code-line">      <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></span>\n<span class="prism-highlight-code-line">        _hasRemoved <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>\n<span class="prism-highlight-code-line">        <span class="token comment">// proceed to remove current node</span></span>\n<span class="prism-highlight-code-line">      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></span>\n<span class="prism-highlight-code-line">    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></span>\n\n    <span class="token comment">// ...</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeType <span class="token keyword">in</span> callbackMap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">      callbackMap<span class="token punctuation">[</span>nodeType<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n    <span class="token punctuation">&#125;</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span>\n\n<span class="token comment">// ...somewhere in your visitCallback</span>\n<span class="token keyword">function</span> <span class="token function">visitCallback</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent<span class="token punctuation">,</span> key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n<span class="prism-highlight-code-line">  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token punctuation">&#125;</span></code>',i(Qp,Ar),i(Qp,Sr),i(Sr,xr),i(Qp,jr),i(Qp,Pr),i(Pr,Ir),i(Pr,Lr),i(Lr,Mr),i(Pr,Cr),i(Pr,Nr),i(Nr,$r),i(Pr,Or),i(Pr,Hr),i(Hr,Rr),i(Pr,Dr),i(Qp,Br),i(Qp,Fr),i(Fr,_r),i(Qp,zr),i(Qp,Jr),i(Jr,Ur),i(Ur,Wr),i(Wr,Gr),i(Ur,Yr),i(Jr,qr),i(Jr,Kr),i(Kr,Vr),i(Vr,Qr),i(Kr,Zr),i(Qp,Xr),i(Qp,ni),i(ni,ai),l(n,si,a),l(n,ti,a),i(ti,ei),i(ei,oi),i(oi,pi),i(ti,ci),i(ti,ri),i(ri,ii),i(ri,li),i(li,ui),i(ri,hi),i(ti,ki),i(ti,di),i(di,fi),i(di,gi),i(gi,mi),i(di,vi),i(di,yi),i(yi,wi),i(di,Ei),i(di,bi),i(bi,Ti),i(di,Ai),i(di,Si),i(Si,xi),i(di,ji),i(di,Pi),i(Pi,Ii),i(di,Li),i(ti,Mi),i(ti,Ci),Ci.innerHTML='<code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>figure</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>foo<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>figcaption</span><span class="token punctuation">></span></span>lorem ipsum<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>figcaption</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>figure</span><span class="token punctuation">></span></span></code>',i(ti,Ni),i(ti,$i),i($i,Oi),i(ti,Hi),i(ti,Ri),Ri.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>\n    <span class="token comment">/* 1. is node &lt;figure> */</span>\n    node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'tag\'</span> <span class="token operator">&amp;&amp;</span>\n    node<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">\'figure\'</span> <span class="token operator">&amp;&amp;</span>\n    <span class="token comment">/* 2. is node contain class &#96;foo&#96; */</span>\n    node<span class="token punctuation">.</span>attribs<span class="token punctuation">.</span>class <span class="token operator">===</span> <span class="token string">\'foo\'</span> <span class="token operator">&amp;&amp;</span>\n    <span class="token comment">/* 3. is node children contain &lt;img> */</span>\n    node<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>\n      <span class="token parameter">child</span> <span class="token operator">=></span> child<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'tag\'</span> <span class="token operator">&amp;&amp;</span> child<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">\'img\'</span>\n    <span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span>\n    <span class="token comment">/* 4. is node children contain &lt;figcaption> */</span>\n    node<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>\n      <span class="token parameter">child</span> <span class="token operator">=></span> child<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'tag\'</span> <span class="token operator">&amp;&amp;</span> child<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">\'figcaption\'</span>\n    <span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span>\n  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// do something</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',i(ti,Di),i(ti,Bi),i(Bi,Fi),i(ti,_i),i(ti,zi),zi.innerHTML='<code class="language-js"><span class="token keyword">function</span> <span class="token function">isTag</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'tag\'</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>name <span class="token operator">===</span> name<span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n<span class="token keyword">function</span> <span class="token function">hasAttr</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> node<span class="token punctuation">.</span>attribs<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> value<span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n<span class="token keyword">function</span> <span class="token function">hasChild</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">return</span> node<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span>\n<span class="token keyword">function</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>\n    <span class="token comment">/* 1. is node &lt;figure> */</span>\n<span class="prism-highlight-code-line">    <span class="token function">isTag</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token string">\'figure\'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></span>\n    <span class="token comment">/* 2. is node contain class &#96;foo&#96; */</span>\n<span class="prism-highlight-code-line">    <span class="token function">hasAttr</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token string">\'class\'</span><span class="token punctuation">,</span> <span class="token string">\'foo\'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></span>\n    <span class="token comment">/* 3. is node children contain &lt;img> */</span>\n<span class="prism-highlight-code-line">    <span class="token function">hasChild</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=></span> <span class="token function">isTag</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token string">\'img\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span></span>\n    <span class="token comment">/* 4. is node children contain &lt;figcaption> */</span>\n<span class="prism-highlight-code-line">    <span class="token function">hasChild</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=></span> <span class="token function">isTag</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token string">\'figcaption\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>\n  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token comment">// do something</span>\n  <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#125;</span></code>',l(n,Ji,a),l(n,Ui,a),i(Ui,Wi),i(Wi,Gi),i(Gi,Yi),i(Ui,qi),i(Ui,Ki),i(Ki,Vi),i(Ui,Qi),i(Ui,Zi),i(Zi,Xi),i(Zi,nl),i(nl,al),i(Zi,sl),i(Ui,tl),i(Ui,el),el.innerHTML='<code class="language-js"><span class="token keyword">const</span> newNode <span class="token operator">=</span> <span class="token punctuation">&#123;</span>\n  type<span class="token punctuation">:</span> <span class="token string">\'Identifier\'</span><span class="token punctuation">,</span>\n  name<span class="token punctuation">:</span> <span class="token string">\'foo\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code>',i(Ui,ol),i(Ui,pl),i(pl,cl),i(pl,rl),i(rl,il),i(pl,ll),i(Ui,ul),i(Ui,hl),hl.innerHTML='<code class="language-js"><span class="token keyword">const</span> newNode <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">\'foo\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> newNode2 <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">functionDeclaration</span><span class="token punctuation">(</span>\n  <span class="token string">\'bar\'</span><span class="token punctuation">,</span>\n  <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">\'foo\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token punctuation">[</span>\n    t<span class="token punctuation">.</span><span class="token function">expressionStatement</span><span class="token punctuation">(</span>\n      t<span class="token punctuation">.</span><span class="token function">callExpression</span><span class="token punctuation">(</span>\n        t<span class="token punctuation">.</span><span class="token function">memberExpression</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">\'console\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">\'log\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">\'foo\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n      <span class="token punctuation">)</span>\n    <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    t<span class="token punctuation">.</span><span class="token function">returnStatement</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">\'foo\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code>',i(Ui,kl),i(Ui,dl),i(dl,fl),i(Ui,gl),i(Ui,ml),i(ml,vl),i(ml,yl),i(yl,wl),i(ml,El),i(ml,bl),i(bl,Tl),i(ml,Al),i(Ui,Sl),i(Ui,xl),xl.innerHTML='<code class="language-js"><span class="token keyword">const</span> newNode2 <span class="token operator">=</span> babelParser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">\n  function bar(foo) &#123;\n    console.log(foo);\n    return foo;\n  &#125;\n</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>program<span class="token punctuation">.</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> newNode3 <span class="token operator">=</span> cssTree<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>\n  <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">\n  .foo &#123;\n    color: red;\n  &#125;\n</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span>\n  <span class="token punctuation">&#123;</span> context<span class="token punctuation">:</span> <span class="token string">\'rule\'</span> <span class="token punctuation">&#125;</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code>',i(Ui,jl),i(Ui,Pl),i(Pl,Il),i(Pl,Ll),i(Ll,Ml),i(Pl,Cl),i(Pl,Nl),i(Nl,$l),i(Pl,Ol),i(Ui,Hl),i(Ui,Rl),Rl.innerHTML='<code class="language-js"><span class="token keyword">const</span> newNode4 <span class="token operator">=</span> template<span class="token punctuation">.</span>statement<span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">\n  console.log(foo);\n</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">;</span>\n\n<span class="token comment">// placeholder can be an AST node or string</span>\n<span class="token keyword">const</span> newNode5 <span class="token operator">=</span> template<span class="token punctuation">.</span>statement<span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">\n  function bar(foo) &#123;\n    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>newNode4<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">\n    alert("</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token string">\'hello world\'</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">")\n    return foo;\n  &#125;\n</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">;</span></code>',l(n,Dl,a),l(n,Bl,a),i(Bl,Fl),i(Fl,_l),i(_l,zl),i(Bl,Jl),i(Bl,Ul),i(Ul,Wl),i(Bl,Gl),i(Bl,Yl),i(Yl,ql),i(ql,Kl),i(Yl,Vl),i(Yl,Ql),i(Ql,Zl),i(Yl,Xl),i(Yl,nu),i(nu,au),i(Yl,su),i(Yl,tu),i(tu,eu),l(n,ou,a),l(n,pu,a),i(pu,cu),i(cu,ru),i(ru,iu),i(pu,lu),i(pu,uu),i(uu,hu),i(hu,ku),i(uu,du),i(uu,fu),i(fu,gu),i(uu,mu),i(pu,vu),i(pu,yu),i(yu,wu),i(wu,Eu),i(Eu,bu),i(yu,Tu),i(yu,Au),i(Au,Su),i(Su,xu),i(yu,ju),i(yu,Pu),i(Pu,Iu),i(Iu,Lu),i(yu,Mu),i(yu,Cu),i(Cu,Nu),i(Nu,$u),i(yu,Ou),i(yu,Hu),i(Hu,Ru),i(Ru,Du),i(yu,Bu),i(yu,Fu),i(Fu,_u),i(_u,zu)},p:n,d(n){n&&u(s),n&&u(Y),n&&u(q),n&&u(on),n&&u(pn),n&&u(rn),n&&u(ln),n&&u($n),n&&u(On),n&&u(de),n&&u(fe),n&&u(Qo),n&&u(Zo),n&&u(fp),n&&u(gp),n&&u(Op),n&&u(Hp),n&&u(Vp),n&&u(Qp),n&&u(si),n&&u(ti),n&&u(Ji),n&&u(Ui),n&&u(Dl),n&&u(Bl),n&&u(ou),n&&u(pu)}}}function dn(n){let s,t;const e=[fn];let o={$$slots:{default:[kn]},$$scope:{ctx:n}};for(let n=0;n<e.length;n+=1)o=a(o,e[n]);return s=new hn({props:o}),{c(){U(s.$$.fragment)},l(n){W(s.$$.fragment,n)},m(n,a){G(s,n,a),t=!0},p(n,[a]){const t=0&a?function(n,a){const s={},t={},e={$$scope:1};let o=n.length;for(;o--;){const p=n[o],c=a[o];if(c){for(const n in p)n in c||(t[n]=1);for(const n in c)e[n]||(s[n]=c[n],e[n]=1);n[o]=c}else for(const n in p)e[n]=1}for(const n in t)n in s||(s[n]=void 0);return s}(e,[(o=fn,"object"==typeof o&&null!==o?o:{})]):{};var o;1&a&&(t.$$scope={dirty:a,ctx:n}),s.$set(t)},i(n){t||(z(s.$$.fragment,n),t=!0)},o(n){J(s.$$.fragment,n),t=!1},d(n){Y(s,n)}}}const fn={title:"Manipulating AST with JavaScript",date:"2019-11-22T08:00:00Z",description:"Manipulating AST is not that hard anyway",tags:["JavaScript","ast","transform","depth-first-search","dfs"],series:"AST",slug:"manipulating-ast-with-javascript",type:"blog"};class gn extends V{constructor(n){super(),K(this,n,null,dn,p,{})}}setTimeout(()=>{new gn({target:document.querySelector("#app"),hydrate:!0});if(document.querySelector(".twitter-tweet")){const n=document.createElement("script");n.async=!0,n.src="https://platform.twitter.com/widgets.js",n.charset="utf-8",document.body.appendChild(n)}if("loading"in HTMLImageElement.prototype){document.querySelectorAll('img[loading="lazy"]').forEach(n=>{n.src=n.dataset.src})}else{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js",document.body.appendChild(n)}},3e3);
